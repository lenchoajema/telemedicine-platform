var Sa=Object.defineProperty;var wa=(s,a,t)=>a in s?Sa(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t;var Fs=(s,a,t)=>(wa(s,typeof a!="symbol"?a+"":a,t),t);import{r as n,j as e,l as Ds,R as Js,u as ye,B as Ca,m as Ws,n as ls,o as ka,p as Pa,q as Da,L as V,s as as,t as Xe,v as Aa,w as Gs,x as cs,y as es,z as He,D as bs,G as Re,V as Os,H as Ss,Q as Ta,I as ps,J as Ea,N as Ia,O as Ra,i as ds,b as We,W as Cs,Y as La,Z as Ys,_ as Qs,$ as $a,a0 as Ma,a1 as Fa,a2 as Oa,a3 as Y,a4 as _a}from"./vendor-5f7f2f36.js";import{u as me,a as xe,b as ge,A as Ba,L as De,c as R,F as _e,d as Ua,N as za,V as _s,e as qa,R as Ha,f as Va,g as Ja,h as Wa,i as Ga,j as Ya,k as Qa,l as Ka,m as Za,n as Xa,o as et,p as st}from"./admin-e33aff00.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))i(h);new MutationObserver(h=>{for(const l of h)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(h){const l={};return h.integrity&&(l.integrity=h.integrity),h.referrerPolicy&&(l.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?l.credentials="include":h.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(h){if(h.ep)return;h.ep=!0;const l=t(h);fetch(h.href,l)}})();const Ks=n.createContext(null),at=()=>{const s=n.useContext(Ks);if(!s)throw new Error("useReminders must be used within a RemindersProvider");return s},tt=({children:s})=>{const{user:a}=me(),[t,i]=n.useState([]),[h,l]=n.useState(!1),r=async()=>{var y;if(a)try{l(!0);const c=await xe.get(`/reminders/${a._id}`);console.log("fetchReminders API response for user",a._id,c.data.data),(y=c.data)!=null&&y.data&&(i(c.data.data),console.log("Reminders set in context:",c.data.data.length))}catch(c){console.log("Error fetching reminders",c)}finally{l(!1)}},m=async y=>{try{await xe.patch(`/reminders/${y}/read`),i(c=>c.map(o=>o._id===y?{...o,read:!0}:o))}catch(c){console.log("Error marking reminder read",c)}};return n.useEffect(()=>{r();const y=setInterval(r,60*1e3);return()=>clearInterval(y)},[a]),e.jsx(Ks.Provider,{value:{reminders:t,loading:h,fetchReminders:r,markAsRead:m},children:s})},Zs=n.createContext(null),nt=()=>{const s=n.useContext(Zs);if(!s)throw new Error("useChat must be used within ChatProvider");return s},rt=({children:s})=>{const{user:a}=me(),t=n.useMemo(()=>Ds({}.VITE_WS_URL||"http://localhost:5000"),[]),[i,h]=n.useState([]),[l,r]=n.useState(null),[m,y]=n.useState([]),[c,o]=n.useState(!1),[f,p]=n.useState({providers:[],support:null,others:[]}),g=async()=>{if(a)try{const d=await xe.get("/chats/contacts");p(d.data.data||{providers:[],support:null,others:[]})}catch(d){console.log("Error fetching contacts:",d)}},v=async()=>{if(a)try{const d=await xe.get("/chats/sessions");h(d.data.data||[])}catch(d){console.log("Error fetching chat sessions:",d)}},u=async d=>{if(d){o(!0);try{const S=await xe.get(`/chats/sessions/${d}/messages`);y(S.data.data||[])}catch(S){console.log("Error fetching chat messages:",S)}finally{o(!1)}}};n.useEffect(()=>{g()},[a]),n.useEffect(()=>{v(),g()},[a]),n.useEffect(()=>(t.on("new_message",d=>{d.sessionId===(l==null?void 0:l._id)&&y(S=>[...S,d])}),()=>{t.off("new_message")}),[t,l]);const x=d=>{r(d),u(d._id),t.emit("joinSession",d._id)},C=async d=>{if(l)try{t.emit("send_message",{sessionId:l._id,content:d}),await xe.post(`/chats/sessions/${l._id}/messages`,{content:d})}catch(S){console.log("Error sending chat message:",S)}},A=async(d,S=null)=>{try{const w={participants:d};S&&(w.appointmentId=S);const D=(await xe.post("/chats/sessions",w)).data.data;return h(b=>[D,...b]),D}catch(w){console.log("Error creating chat session:",w)}},N=async()=>{try{const S=(await xe.get("/chats/support-session")).data.data;return h(w=>w.some(k=>k._id===S._id)?w:[S,...w]),S}catch(d){console.log("Error fetching support session:",d)}};return e.jsx(Zs.Provider,{value:{sessions:i,selectedSession:l,messages:m,loading:c,fetchSessions:v,createSession:A,getSupportSession:N,selectSession:x,sendMessage:C,contacts:f,fetchContacts:g},children:s})};class it extends Js.Component{constructor(t){super(t);Fs(this,"handleReset",()=>{this.props.onReset&&this.props.onReset(),this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,i){console.error("Error caught by ErrorBoundary:",t,i),this.setState({errorInfo:i})}render(){return this.state.hasError?e.jsxs("div",{className:"error-boundary",children:[e.jsx("h2",{children:"Something went wrong."}),e.jsxs("details",{children:[e.jsx("summary",{children:"View error details"}),e.jsx("p",{children:this.state.error&&this.state.error.toString()}),e.jsx("p",{children:"Component Stack Error Details:"}),e.jsx("pre",{children:this.state.errorInfo&&this.state.errorInfo.componentStack})]}),e.jsx("button",{onClick:this.handleReset,className:"btn-primary",children:"Try again"})]}):this.props.children}}function lt(){const{reminders:s,loading:a,markAsRead:t}=at();Js.useEffect(()=>{console.log("RemindersDropdown state:",{reminders:s,loading:a})},[s,a]);const[i,h]=n.useState(!1),l=ye(),r=()=>h(c=>!c),m=(c,o)=>{t(c),h(!1),o&&l(`/appointments/${o}`)},y=[...s].sort((c,o)=>new Date(c.scheduledAt)-new Date(o.scheduledAt));return e.jsxs("div",{className:"reminders-dropdown",children:[e.jsxs("button",{className:"reminders-btn",onClick:r,children:[e.jsx(Ca,{className:"reminders-icon"}),s.some(c=>!c.read)&&e.jsx("span",{className:"badge"})]}),i&&e.jsxs("div",{className:"reminders-menu",children:[e.jsx("h4",{children:"Upcoming Reminders"}),a&&e.jsx("p",{children:"Loading..."}),!a&&y.length===0&&e.jsx("p",{children:"No reminders."}),!a&&y.map(c=>{var o,f;return e.jsxs("div",{className:`reminder-item ${c.read?"read":"unread"}`,onClick:()=>{var p;return m(c._id,(p=c.appointmentId)==null?void 0:p._id)},children:[e.jsx(Ws,{className:"reminder-icon"}),e.jsxs("div",{className:"reminder-info",children:[e.jsxs("div",{className:"reminder-text",children:["Appointment ",(o=c.appointmentId)==null?void 0:o.status," on"," ",new Date((f=c.appointmentId)==null?void 0:f.date).toLocaleDateString()," at"," ",new Date(c.scheduledAt).toLocaleTimeString()]}),e.jsx("div",{className:"reminder-time",children:new Date(c.scheduledAt).toLocaleString()})]})]},c._id)})]})]})}const Bs="tm-theme";function Xs({className:s="",variant:a="select"}){const[t,i]=n.useState(()=>{try{return localStorage.getItem(Bs)||"system"}catch{return"system"}});n.useEffect(()=>{const r=document.documentElement;t==="light"?r.setAttribute("data-theme","light"):t==="dark"?r.setAttribute("data-theme","dark"):r.removeAttribute("data-theme");try{localStorage.setItem(Bs,t)}catch{}},[t]);const h=()=>t==="system"?"light":t==="light"?"dark":"system",l=()=>t==="dark"?e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}):t==="light"?e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"})]}):e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),e.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),e.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]});if(a==="icon"){const r=`Switch theme (current: ${t})`;return e.jsx("button",{type:"button",className:`btn btn-ghost btn-sm ${s}`,onClick:()=>i(h()),"aria-label":r,title:r,children:e.jsx(l,{})})}return e.jsxs("div",{className:`flex items-center gap-2 ${s}`,children:[e.jsx("label",{className:"label",children:"Theme"}),e.jsxs("select",{className:"select",value:t,onChange:r=>i(r.target.value),"aria-label":"Select theme",children:[e.jsx("option",{value:"system",children:"System"}),e.jsx("option",{value:"light",children:"Light"}),e.jsx("option",{value:"dark",children:"Dark"})]})]})}ls.use(ka).init({lng:"en",fallbackLng:"en",debug:!1,interpolation:{escapeValue:!1},resources:{en:{common:{nav:{home:"Home",about:"About",services:"Services",contact:"Contact"},actions:{signIn:"Sign in",getStarted:"Get Started"}}}},defaultNS:"common",ns:["common"]});const ea=n.createContext({locale:"en",locales:[],setLocale:()=>{}});function ot({children:s}){const[a,t]=n.useState(()=>localStorage.getItem("locale")||"en"),[i,h]=n.useState([]);n.useEffect(()=>{xe.get("/i18n/locales").then(r=>{var m;return h(((m=r.data)==null?void 0:m.data)||[])}).catch(()=>h([{code:"en",name:"English",rtl:!1}]))},[]),n.useEffect(()=>{async function r(){var m;try{const c=["common","dashboard","clinical","billing","notifications"].map(u=>`ns[]=${encodeURIComponent(u)}`).join("&"),f=((m=(await xe.get(`/i18n/resources?locale=${encodeURIComponent(a)}&${c}`)).data)==null?void 0:m.data)||{};Object.entries(f).forEach(([u,x])=>{ls.addResourceBundle(a,u,x,!0,!0)});const p=Object.keys(f);p.length>0&&await ls.reloadResources([a],p),await ls.changeLanguage(a);const v=!!(i.find(u=>u.code===a)||{}).rtl||a.startsWith("ar");document.documentElement.setAttribute("lang",a),document.documentElement.setAttribute("dir",v?"rtl":"ltr"),document.body.classList.toggle("rtl",v),document.body.classList.toggle("ethiopic",a.startsWith("am-ET")||a.startsWith("ti-"))}catch{await ls.changeLanguage("en")}}localStorage.setItem("locale",a),r()},[a,i]);const l=n.useMemo(()=>({locale:a,locales:i,setLocale:t}),[a,i]);return e.jsx(ea.Provider,{value:l,children:s})}function sa(){return n.useContext(ea)}function Us({className:s=""}){const{locale:a,locales:t,setLocale:i}=sa(),h=t!=null&&t.length?t:[{code:"en",name:"English",rtl:!1}];return e.jsx("select",{"aria-label":"Language",className:s,value:a,onChange:l=>{const r=l.target.value;r!==a&&i(r)},children:h.map(l=>e.jsxs("option",{value:l.code,children:[l.name," (",l.code,")"]},l.code))})}function ct({sidebarOpen:s,setSidebarOpen:a}){var p,g,v;const{t}=Pa("common"),{user:i,logout:h}=me(),l=ye(),[r,m]=n.useState(!1),[y,c]=n.useState(!1);sa();const o=()=>{h(),l("/login")},f=[{name:t("nav.home","Home"),href:"/"},{name:t("nav.about","About"),href:"/about"},{name:t("nav.services","Services"),href:"/services"},{name:t("nav.contact","Contact"),href:"/contact"}];return e.jsxs("header",{className:"header",children:[e.jsx("div",{className:"header-container",children:e.jsxs("div",{className:"header-content",children:[e.jsxs("div",{className:"header-left",children:[i&&e.jsxs("button",{type:"button",className:"mobile-menu-btn",onClick:()=>a&&a(!s),children:[e.jsx("span",{className:"sr-only",children:"Open sidebar"}),e.jsx(Da,{className:"menu-icon","aria-hidden":"true"})]}),e.jsx("div",{className:"logo-container",children:e.jsxs(V,{to:"/",className:"logo-link",children:[e.jsx("div",{className:"logo-icon",children:e.jsx("span",{className:"logo-text",children:"TM"})}),e.jsx("span",{className:"logo-title",children:"TeleMedicine"})]})})]}),!i&&e.jsx("nav",{className:"header-nav",children:f.map(u=>e.jsx(V,{to:u.href,className:"nav-link",children:u.name},u.name))}),e.jsxs("div",{className:"header-right",children:[e.jsx(Us,{className:"lang-switcher"}),i?e.jsxs(e.Fragment,{children:[e.jsx(lt,{}),e.jsx(Xs,{variant:"icon"}),e.jsxs("div",{className:"user-menu",children:[e.jsxs("button",{type:"button",className:"user-menu-btn",onClick:()=>c(!y),children:[e.jsx("span",{className:"sr-only",children:"Open user menu"}),e.jsx("div",{className:"user-avatar",children:(p=i.profile)!=null&&p.photo?e.jsx("img",{className:"user-avatar-img",src:i.profile.photo,alt:""}):e.jsx(as,{className:"user-avatar-icon","aria-hidden":"true"})})]}),y&&e.jsxs("div",{className:"user-menu-dropdown",children:[e.jsxs("div",{className:"user-info",children:[e.jsxs("p",{className:"user-name",children:[(g=i.profile)==null?void 0:g.firstName," ",(v=i.profile)==null?void 0:v.lastName]}),e.jsx("p",{className:"user-email",children:i.email})]}),e.jsx("div",{className:"menu-divider"}),e.jsxs(V,{to:"/profile",className:"menu-item",children:[e.jsx(as,{className:"menu-icon"}),t("nav.profile","Profile")]}),e.jsxs(V,{to:"/settings",className:"menu-item",children:[e.jsx(Xe,{className:"menu-icon"}),t("nav.settings","Settings")]}),e.jsx("div",{className:"menu-divider"}),e.jsxs("button",{onClick:o,className:"menu-item menu-item-logout",children:[e.jsx(Aa,{className:"menu-icon"}),t("actions.signOut","Sign out")]})]})]})]}):e.jsxs("div",{className:"auth-buttons",children:[e.jsx(V,{to:"/login",className:"btn btn-secondary",children:t("actions.signIn","Sign in")}),e.jsx(V,{to:"/register",className:"btn btn-primary",children:t("actions.getStarted","Get Started")}),e.jsx(Us,{className:"lang-switcher"})]})]})]})}),!i&&r&&e.jsx("div",{className:"mobile-menu-overlay",children:e.jsxs("div",{className:"mobile-menu",children:[e.jsxs("div",{className:"mobile-menu-header",children:[e.jsxs("div",{className:"logo-container",children:[e.jsx("div",{className:"logo-icon",children:e.jsx("span",{className:"logo-text",children:"TM"})}),e.jsx("span",{className:"logo-title",children:"TeleMedicine"})]}),e.jsxs("button",{type:"button",className:"mobile-menu-close",onClick:()=>m(!1),children:[e.jsx("span",{className:"sr-only",children:"Close menu"}),e.jsx(Gs,{className:"close-icon","aria-hidden":"true"})]})]}),e.jsxs("div",{className:"mobile-nav",children:[f.map(u=>e.jsx(V,{to:u.href,className:"mobile-nav-link",onClick:()=>m(!1),children:u.name},u.name)),e.jsxs("div",{className:"mobile-auth",children:[e.jsx(V,{to:"/login",className:"btn btn-secondary btn-full",children:"Sign in"}),e.jsx(V,{to:"/register",className:"btn btn-primary btn-full",children:"Get Started"})]})]})]})})]})}function dt({sidebarOpen:s,setSidebarOpen:a}){var r,m,y,c,o,f,p;const{user:t}=me(),i=cs(),l=(()=>{const g=[{name:"Dashboard",href:"/dashboard",icon:ps},{name:"Community",href:"/forums/categories",icon:Re}];return(t==null?void 0:t.role)==="doctor"?[...g,{name:"Appointments",href:"/doctor/appointments",icon:He},{name:"Calendar",href:"/doctor/calendar",icon:He},{name:"Patients",href:"/doctor/patients",icon:bs},{name:"Medical Records",href:"/doctor/medical-records",icon:Re},{name:"Video Calls",href:"/video-calls",icon:Os},{name:"Chat",href:"/chat",icon:es},{name:"Analytics",href:"/analytics",icon:Ss},{name:"Settings",href:"/settings",icon:Xe}]:(t==null?void 0:t.role)==="patient"?[...g,{name:"Appointments",href:"/appointments",icon:He},{name:"My Doctors",href:"/doctors",icon:bs},{name:"Chat",href:"/chat",icon:es},{name:"Medical History",href:"/medical-records",icon:Re},{name:"Symptom Checker",href:"/symptom-check",icon:Ta},{name:"PHR",href:"/phr",icon:Re},{name:"Video Calls",href:"/patient/video-calls",icon:Os},{name:"Settings",href:"/patient/settings",icon:Xe}]:(t==null?void 0:t.role)==="admin"?[{name:"Dashboard",href:"/dashboard",icon:ps},{name:"User Management",href:"/admin/users",icon:bs},{name:"Roles",href:"/admin/roles",icon:Ea},{name:"Doctors",href:"/admin/doctors",icon:as},{name:"Appointments",href:"/admin/appointments",icon:He},{name:"Analytics",href:"/admin/analytics",icon:Ss},{name:"Metrics",href:"/admin/metrics",icon:Ss},{name:"Pricing",href:"/admin/pricing",icon:Re},{name:"Banks",href:"/admin/banks",icon:Re},{name:"Bank Change Log",href:"/admin/banks?tab=logs",icon:Re},{name:"Settings",href:"/admin/settings",icon:Xe},{name:"Audit Logs",href:"/admin/audit-logs",icon:Re}]:(t==null?void 0:t.role)==="pharmacist"?[{name:"Dashboard",href:"/dashboard",icon:ps},{name:"Portals",href:"/portals",icon:Re},{name:"Pharmacy Profile",href:"/pharmacy/portal",icon:as},{name:"Inventory",href:"/pharmacy/inventory",icon:Re},{name:"Orders",href:"/pharmacy/orders",icon:He},{name:"Chat",href:"/chat",icon:es},{name:"Settings",href:"/settings",icon:Xe}]:(t==null?void 0:t.role)==="laboratory"?[{name:"Dashboard",href:"/dashboard",icon:ps},{name:"Portals",href:"/portals",icon:Re},{name:"Lab Profile",href:"/laboratory/portal",icon:as},{name:"Catalog",href:"/laboratory/catalog",icon:Re},{name:"Orders",href:"/laboratory/orders",icon:He},{name:"Chat",href:"/chat",icon:es},{name:"Settings",href:"/settings",icon:Xe}]:g})();return l.push({name:"Support",href:"/chat?support=true",icon:es}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`sidebar-overlay ${s?"open":""}`,onClick:()=>a(!1)}),e.jsx("div",{className:`sidebar ${s?"open":""}`,children:e.jsxs("div",{className:"sidebar-content",children:[e.jsx("div",{className:"sidebar-close-container",children:e.jsxs("button",{type:"button",className:"sidebar-close-btn",onClick:()=>a(!1),children:[e.jsx("span",{className:"sr-only",children:"Close sidebar"}),e.jsx(Gs,{className:"close-icon","aria-hidden":"true"})]})}),e.jsx("div",{className:"sidebar-header",children:e.jsxs("div",{className:"sidebar-logo",children:[e.jsx("div",{className:"logo-icon",children:e.jsx("span",{className:"logo-text",children:"TM"})}),e.jsx("span",{className:"logo-title",children:"TeleMedicine"})]})}),e.jsx("nav",{className:"sidebar-nav",children:e.jsx("ul",{className:"nav-list",children:l.map(g=>{const v=i.pathname===g.href;return e.jsx("li",{className:"nav-item",children:e.jsxs(V,{to:g.href,className:`nav-link ${v?"active":""}`,children:[e.jsx(g.icon,{className:"nav-icon","aria-hidden":"true"}),e.jsx("span",{className:"nav-text",children:g.name})]})},g.name)})})}),e.jsx("div",{className:"sidebar-user",children:e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-avatar",children:(r=t==null?void 0:t.profile)!=null&&r.photo?e.jsx("img",{className:"user-avatar-img",src:t.profile.photo,alt:""}):e.jsx("span",{className:"user-avatar-text",children:((y=(m=t==null?void 0:t.profile)==null?void 0:m.firstName)==null?void 0:y[0])||((o=(c=t==null?void 0:t.email)==null?void 0:c[0])==null?void 0:o.toUpperCase())||"U"})}),e.jsxs("div",{className:"user-details",children:[e.jsxs("p",{className:"user-name",children:[(f=t==null?void 0:t.profile)==null?void 0:f.firstName," ",(p=t==null?void 0:t.profile)==null?void 0:p.lastName]}),e.jsx("p",{className:"user-role",children:t==null?void 0:t.role})]})]})})]})})]})}function ht(){const{user:s}=me(),a=cs(),t=i=>a.pathname===i;return e.jsxs(e.Fragment,{children:[!s&&e.jsxs("div",{className:"mobile-bottom-nav",children:[e.jsxs(V,{to:"/",className:`mobile-nav-item ${t("/")?"active":""}`,children:[e.jsx("div",{className:"mobile-nav-icon",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e.jsx("polyline",{points:"9,22 9,12 15,12 15,22"})]})}),e.jsx("span",{className:"mobile-nav-label",children:"Home"})]}),e.jsxs(V,{to:"/about",className:`mobile-nav-item ${t("/about")?"active":""}`,children:[e.jsx("div",{className:"mobile-nav-icon",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),e.jsx("path",{d:"M12 17h.01"})]})}),e.jsx("span",{className:"mobile-nav-label",children:"About"})]}),e.jsxs(V,{to:"/services",className:`mobile-nav-item ${t("/services")?"active":""}`,children:[e.jsx("div",{className:"mobile-nav-icon",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})})}),e.jsx("span",{className:"mobile-nav-label",children:"Services"})]}),e.jsxs(V,{to:"/contact",className:`mobile-nav-item ${t("/contact")?"active":""}`,children:[e.jsx("div",{className:"mobile-nav-icon",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}),e.jsx("polyline",{points:"22,6 12,13 2,6"})]})}),e.jsx("span",{className:"mobile-nav-label",children:"Contact"})]})]}),e.jsx("footer",{className:"footer",children:e.jsx("div",{className:"container",children:e.jsxs("p",{children:["© ",new Date().getFullYear()," TeleMed. All rights reserved."]})})})]})}function mt(){const{notifications:s,removeNotification:a}=ge();return s.length===0?null:e.jsx("div",{className:"notification-container",children:s.map(t=>e.jsxs("div",{className:`notification ${t.type}`,children:[e.jsx("span",{children:t.message}),e.jsx("button",{onClick:()=>a(t.id),children:"×"})]},t.id))})}function ut({children:s}){const[a,t]=n.useState(!1),{user:i}=me();return e.jsxs("div",{className:"layout-container",children:[e.jsx(ct,{sidebarOpen:a,setSidebarOpen:t}),e.jsx(mt,{}),e.jsxs("div",{className:"layout-content",children:[i&&e.jsx(dt,{sidebarOpen:a,setSidebarOpen:t}),e.jsx("main",{className:`main-content ${i?"with-sidebar":"without-sidebar"}`,children:e.jsx("div",{className:"content-container",children:s})})]}),e.jsx(ht,{})]})}function pt(){const{user:s}=me();return e.jsxs("div",{className:"home-page",children:[e.jsx("section",{className:"hero",children:e.jsxs("div",{className:"hero-content",children:[e.jsx("h1",{children:s?`Welcome back, ${s.name||"User"}`:"Healthcare at Your Fingertips"}),e.jsx("p",{children:"Connect with licensed doctors remotely and get medical advice, prescriptions, and care whenever you need it."}),e.jsxs("div",{className:"cta-buttons",children:[s?e.jsx(V,{to:"/dashboard",className:"btn btn-primary animated-element",children:"Go to Dashboard"}):e.jsx(V,{to:"/register",className:"btn btn-primary animated-element",children:"Get Started Now"}),e.jsx(V,{to:"/doctors",className:"btn btn-secondary",children:"Browse Doctors"})]})]})}),e.jsxs("section",{className:"features",children:[e.jsxs("div",{className:"feature-card",children:[e.jsx("div",{className:"feature-icon",children:"📅"}),e.jsx("h3",{children:"Quick Appointments"}),e.jsx("p",{children:"Schedule virtual visits with just a few clicks, no waiting rooms needed."})]}),e.jsxs("div",{className:"feature-card",children:[e.jsx("div",{className:"feature-icon",children:"👨‍⚕️"}),e.jsx("h3",{children:"Expert Doctors"}),e.jsx("p",{children:"Connect with board-certified physicians across various specialties."})]}),e.jsxs("div",{className:"feature-card",children:[e.jsx("div",{className:"feature-icon",children:"💊"}),e.jsx("h3",{children:"Digital Prescriptions"}),e.jsx("p",{children:"Get medications prescribed online and delivered to your doorstep."})]}),e.jsxs("div",{className:"feature-card",children:[e.jsx("div",{className:"feature-icon",children:"🔒"}),e.jsx("h3",{children:"Secure Platform"}),e.jsx("p",{children:"Your health information is protected with enterprise-grade security."})]})]}),e.jsxs("section",{className:"testimonials",children:[e.jsx("h2",{children:"What Our Patients Say"}),e.jsxs("div",{className:"testimonial-cards",children:[e.jsxs("div",{className:"testimonial-card",children:[e.jsx("p",{children:'"The virtual consultation saved me so much time. The doctor was professional and helped me quickly!"'}),e.jsxs("div",{className:"testimonial-author",children:[e.jsx("img",{src:"https://randomuser.me/api/portraits/women/45.jpg",alt:"Sarah M.",className:"author-avatar"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Sarah M."}),e.jsx("div",{children:"Patient"})]})]})]}),e.jsxs("div",{className:"testimonial-card",children:[e.jsx("p",{children:'"I was skeptical about telemedicine at first, but now I use it for all my regular check-ups. Highly recommend!"'}),e.jsxs("div",{className:"testimonial-author",children:[e.jsx("img",{src:"https://randomuser.me/api/portraits/men/32.jpg",alt:"David R.",className:"author-avatar"}),e.jsxs("div",{children:[e.jsx("strong",{children:"David R."}),e.jsx("div",{children:"Patient"})]})]})]}),e.jsxs("div",{className:"testimonial-card",children:[e.jsx("p",{children:'"As someone with a busy schedule, being able to talk to a doctor from my office has been a game-changer."'}),e.jsxs("div",{className:"testimonial-author",children:[e.jsx("img",{src:"https://randomuser.me/api/portraits/women/68.jpg",alt:"Lisa K.",className:"author-avatar"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Lisa K."}),e.jsx("div",{children:"Patient"})]})]})]})]})]}),e.jsx("section",{className:"cta-section",children:e.jsxs("div",{className:"cta-content",children:[e.jsx("h2",{children:"Ready to prioritize your health?"}),e.jsx("p",{children:"Join thousands of patients who've made healthcare easier with our telemedicine platform."}),s?e.jsx(V,{to:"/appointments",className:"btn btn-primary",children:"Schedule an Appointment"}):e.jsx(V,{to:"/register",className:"btn btn-primary",children:"Create Your Free Account"})]})})]})}function xt(){const[s,a]=n.useState(""),[t,i]=n.useState(""),[h,l]=n.useState(!1),{login:r}=me(),{addNotification:m}=ge(),y=ye(),c=async o=>{o.preventDefault(),console.log("handleSubmit triggered"),l(!0);try{const f=await r(s,t);console.log("Login completed, user received:",f),m("Login successful!","success"),setTimeout(()=>{console.log("Navigating to dashboard..."),y("/dashboard")},100)}catch(f){console.error("Login failed:",f),m(f.message||"Login failed","error")}finally{l(!1)}};return e.jsx("div",{className:"auth-page",children:e.jsxs("div",{className:"auth-container",children:[e.jsx("h1",{className:"auth-title",children:"Welcome Back"}),e.jsxs("form",{onSubmit:c,className:"auth-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"loginEmail",children:"Email"}),e.jsx("input",{id:"loginEmail",name:"email",type:"email",value:s,onChange:o=>a(o.target.value),required:!0,autoFocus:!0,className:"auth-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"loginPassword",children:"Password"}),e.jsx("input",{id:"loginPassword",name:"password",type:"password",value:t,onChange:o=>i(o.target.value),required:!0,className:"auth-input"})]}),e.jsx("div",{className:"auth-actions",children:e.jsx(V,{to:"/forgot-password",className:"auth-link",children:"Forgot password?"})}),e.jsx("button",{type:"submit",disabled:h,className:"btn btn-primary",children:h?"Signing in...":"Sign In"})]}),e.jsxs("div",{className:"auth-footer",children:["Don't have an account?"," ",e.jsx(V,{to:"/register",className:"auth-link",children:"Create one"})]})]})})}const As=()=>n.useContext(Ba);function jt(){const[s,a]=n.useState({username:"",firstName:"",lastName:"",email:"",password:"",confirmPassword:"",role:"patient",licenseNumber:"",specialization:""}),[t,i]=n.useState(!1),{register:h}=As(),{addNotification:l}=ge(),r=ye(),m=c=>{a({...s,[c.target.name]:c.target.value})},y=async c=>{if(c.preventDefault(),s.password!==s.confirmPassword){l("Passwords do not match","error");return}i(!0);try{const o={username:s.username,email:s.email,password:s.password,profile:{firstName:s.firstName,lastName:s.lastName},role:s.role};s.role==="doctor"&&(o.profile.licenseNumber=s.licenseNumber,o.profile.specialization=s.specialization),await h(o),l("Registration successful!","success"),s.role==="doctor"?r("/doctor/appointments"):s.role==="pharmacist"?r("/pharmacy/portal"):s.role==="laboratory"?r("/laboratory/portal"):r("/appointments")}catch(o){l(o.message||"Registration failed","error")}finally{i(!1)}};return e.jsx("div",{className:"auth-page",children:e.jsxs("div",{className:"auth-container",children:[e.jsx("h1",{className:"auth-title",children:"Create Account"}),e.jsx("p",{className:"auth-subtitle",children:"Get started with telemedicine"}),e.jsxs("form",{className:"auth-form",onSubmit:y,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"username",children:"Username"}),e.jsx("input",{id:"username",name:"username",value:s.username,onChange:m,placeholder:"e.g., jane.doe"})]}),e.jsxs("div",{className:"name-fields",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"firstName",children:"First Name"}),e.jsx("input",{id:"firstName",autoComplete:"given-name",name:"firstName",value:s.firstName,onChange:m,required:!0,autoFocus:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"lastName",children:"Last Name"}),e.jsx("input",{id:"lastName",name:"lastName",autoComplete:"family-name",value:s.lastName,onChange:m,required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email Address"}),e.jsx("input",{id:"email",type:"email",name:"email",autoComplete:"email",value:s.email,onChange:m,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{id:"password",type:"password",name:"password",autoComplete:"new-password",value:s.password,onChange:m,required:!0,minLength:"8"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsx("input",{id:"confirmPassword",type:"password",name:"confirmPassword",autoComplete:"new-password",value:s.confirmPassword,onChange:m,required:!0})]}),e.jsxs("div",{className:"role-selection",children:[e.jsx("label",{children:"I am a:"}),e.jsxs("div",{className:"radio-group",children:[e.jsxs("label",{htmlFor:"patientRole",children:[e.jsx("input",{id:"patientRole",type:"radio",name:"role",value:"patient",checked:s.role==="patient",onChange:m}),"Patient"]}),e.jsxs("label",{htmlFor:"doctorRole",children:[e.jsx("input",{id:"doctorRole",type:"radio",name:"role",value:"doctor",checked:s.role==="doctor",onChange:m}),"Doctor"]}),e.jsxs("label",{htmlFor:"pharmacistRole",children:[e.jsx("input",{id:"pharmacistRole",type:"radio",name:"role",value:"pharmacist",checked:s.role==="pharmacist",onChange:m}),"Pharmacist"]}),e.jsxs("label",{htmlFor:"laboratoristRole",children:[e.jsx("input",{id:"laboratoristRole",type:"radio",name:"role",value:"laboratory",checked:s.role==="laboratory",onChange:m}),"Laboratorist"]})]})]}),s.role==="doctor"&&e.jsxs("div",{className:"doctor-fields",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"licenseNumber",children:"License Number"}),e.jsx("input",{id:"licenseNumber",name:"licenseNumber",value:s.licenseNumber,onChange:m,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"specialization",children:"Specialization"}),e.jsxs("select",{id:"specialization",name:"specialization",value:s.specialization,onChange:m,required:!0,children:[e.jsx("option",{value:"",children:"-- Select Specialization --"}),e.jsx("option",{value:"General Medicine",children:"General Medicine"}),e.jsx("option",{value:"Cardiology",children:"Cardiology"}),e.jsx("option",{value:"Dermatology",children:"Dermatology"}),e.jsx("option",{value:"Orthopedics",children:"Orthopedics"}),e.jsx("option",{value:"Neurology",children:"Neurology"}),e.jsx("option",{value:"Pediatrics",children:"Pediatrics"}),e.jsx("option",{value:"Psychiatry",children:"Psychiatry"}),e.jsx("option",{value:"Gynecology",children:"Gynecology"}),e.jsx("option",{value:"Ophthalmology",children:"Ophthalmology"}),e.jsx("option",{value:"ENT",children:"ENT"})]})]})]}),e.jsx("button",{type:"submit",disabled:t,className:"btn btn-primary",children:t?"Creating Account...":"Create Account"})]}),e.jsxs("div",{className:"auth-footer",children:["Already have an account?"," ",e.jsx(V,{to:"/login",className:"auth-link",children:"Sign in"})]})]})})}function Be({title:s,value:a,icon:t,variant:i="primary",trend:h,trendValue:l,className:r=""}){const m={primary:"bg-blue-50 text-blue-600",secondary:"bg-purple-50 text-purple-600",success:"bg-green-50 text-green-600",warning:"bg-yellow-50 text-yellow-600",error:"bg-red-50 text-red-600"};return e.jsxs("div",{className:`dashboard-card ${m[i]} ${r}`,children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{className:"card-title",children:s}),t&&e.jsx("div",{className:"card-icon",children:t})]}),e.jsxs("div",{className:"card-content",children:[e.jsx("p",{className:"card-value",children:a}),h&&e.jsxs("div",{className:`trend-indicator ${h}`,children:[h==="up"?e.jsx(Ia,{className:"trend-icon"}):e.jsx(Ra,{className:"trend-icon"}),e.jsx("span",{children:l})]})]})]})}function gt(){const{user:s}=me(),{addNotification:a}=ge(),[t,i]=n.useState(null),[h,l]=n.useState([]),[r,m]=n.useState(!0);return n.useEffect(()=>{(async()=>{try{m(!0);const c=await fetch("http://localhost:5000/api/admin/stats",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!c.ok)throw new Error("Failed to fetch admin statistics");const o=await c.json(),f=await fetch("http://localhost:5000/api/admin/verifications/pending",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!f.ok)throw new Error("Failed to fetch pending verifications");const p=await f.json();i(o),l(p)}catch(c){a(`Failed to load admin dashboard data: ${c.message}`,"error")}finally{m(!1)}})()},[a]),r?e.jsx(De,{fullPage:!0}):e.jsxs("div",{className:"dashboard-page admin-dashboard",children:[e.jsx("h1",{className:"dashboard-title",children:"Admin Dashboard"}),e.jsxs("p",{className:"dashboard-subtitle",children:["Welcome, ",s.profile.firstName]}),e.jsxs("div",{className:"dashboard-stats",children:[e.jsx(Be,{title:"Total Users",value:(t==null?void 0:t.totalUsers)||0,icon:"users",variant:"primary"}),e.jsx(Be,{title:"Doctors",value:(t==null?void 0:t.doctorCount)||0,icon:"user-md",variant:"info"}),e.jsx(Be,{title:"Pending Verifications",value:(h==null?void 0:h.length)||0,icon:"clipboard-check",variant:"warning"}),e.jsx(Be,{title:"Total Appointments",value:(t==null?void 0:t.appointmentCount)||0,icon:"calendar",variant:"success"})]}),e.jsxs("section",{className:"dashboard-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"Pending Doctor Verifications"}),e.jsx(V,{to:"/admin/verifications",className:"btn primary",children:"View All"})]}),h.length===0?e.jsx("div",{className:"empty-state",children:"No pending verifications"}):e.jsxs("div",{className:"verification-list",children:[h.slice(0,5).map(y=>{var c,o,f,p;return e.jsxs("div",{className:"verification-item",children:[e.jsxs("div",{className:"doctor-info",children:[e.jsx("h3",{children:((o=(c=y.user)==null?void 0:c.profile)==null?void 0:o.fullName)||((f=y.profile)==null?void 0:f.fullName)||"Doctor"}),e.jsxs("p",{children:["Specialization: ",y.specialization||((p=y.profile)==null?void 0:p.specialization)||"Unknown"]})]}),e.jsx(V,{to:`/admin/verifications/${y._id}`,className:"btn secondary",children:"Review"})]},y._id)}),h.length>5&&e.jsx("div",{className:"view-more",children:e.jsxs(V,{to:"/admin/verifications",children:["View all ",h.length," pending verifications"]})})]})]}),e.jsxs("section",{className:"dashboard-section",children:[e.jsx("div",{className:"section-header",children:e.jsx("h2",{children:"Quick Actions"})}),e.jsxs("div",{className:"admin-quick-actions",children:[e.jsxs(V,{to:"/admin/verifications",className:"quick-action-card",children:[e.jsx("span",{className:"icon",children:"📋"}),e.jsx("span",{className:"title",children:"Review Verifications"})]}),e.jsxs(V,{to:"/admin/users",className:"quick-action-card",children:[e.jsx("span",{className:"icon",children:"👥"}),e.jsx("span",{className:"title",children:"Manage Users"})]}),e.jsxs(V,{to:"/admin/reports",className:"quick-action-card",children:[e.jsx("span",{className:"icon",children:"📊"}),e.jsx("span",{className:"title",children:"System Reports"})]})]})]})]})}function ft(){var o;const{user:s}=me(),{addNotification:a}=ge(),t=ye(),[i,h]=n.useState({totalAppointments:0,todayAppointments:0,totalPatients:0,revenue:0}),[l,r]=n.useState(!0),[m,y]=n.useState(null);n.useEffect(()=>{c()},[]);const c=async()=>{var f;try{r(!0),y(null);const p=await R.get("/doctors/stats");h(p.data||{totalAppointments:0,todayAppointments:0,totalPatients:0,revenue:0})}catch(p){console.error("Error fetching dashboard data:",p),y("Failed to load dashboard data"),h({totalAppointments:0,todayAppointments:0,totalPatients:0,revenue:0}),((f=p.response)==null?void 0:f.status)===404?a("Dashboard data not available","warning"):a("Failed to load dashboard data","error")}finally{r(!1)}};return l?e.jsxs("div",{className:"dashboard-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading dashboard..."})]}):e.jsxs("div",{className:"doctor-dashboard",children:[e.jsxs("div",{className:"dashboard-header",children:[e.jsxs("h1",{children:["Welcome, Dr. ",((o=s==null?void 0:s.profile)==null?void 0:o.firstName)||"Doctor"]}),e.jsx("p",{children:"Here's your practice overview"})]}),m&&e.jsxs("div",{className:"error-banner",children:[e.jsx("p",{children:m}),e.jsx("button",{onClick:c,children:"Retry"})]}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Total Appointments"}),e.jsx("p",{className:"stat-number",children:i.totalAppointments||0})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Today's Appointments"}),e.jsx("p",{className:"stat-number",children:i.todayAppointments||0})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Total Patients"}),e.jsx("p",{className:"stat-number",children:i.totalPatients||0})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Monthly Revenue"}),e.jsxs("p",{className:"stat-number",children:["$",i.revenue||0]})]})]}),e.jsxs("div",{className:"dashboard-actions",children:[e.jsx("button",{onClick:()=>t("/doctor/appointments"),children:"View Appointments"}),e.jsx("button",{onClick:()=>t("/doctor/availability"),children:"Set Availability"}),e.jsx("button",{onClick:()=>t("/doctor/patients"),children:"My Patients"})]})]})}class gs{static async getUpcomingAppointments(){try{return(await R.get("/appointments/upcoming")).data}catch(a){return console.log("Error fetching upcoming appointments:",a),[]}}static async getStats(){try{const t=(await R.get("/appointments/stats")).data;return t&&t.success&&t.data?t.data:t}catch(a){return console.log("Error fetching appointment stats:",a),{upcomingCount:0,completedCount:0,todayCount:0}}}static async getAvailableSlots(a,t=null){try{if(!t)return[];const i=a.toISOString().split("T")[0],l=(await R.get(`/doctors/${t}/slots`,{params:{from:i,to:i}})).data;return l&&l.success&&Array.isArray(l.data)?l.data:[]}catch(i){return console.log("Error fetching available slots:",i),[]}}static async getAppointmentsByDate(a){try{const t=await R.get("/appointments/by-date",{params:{date:a.toISOString().split("T")[0]}});return Array.isArray(t.data)?t.data:[]}catch(t){return console.log("Error fetching appointments by date:",t),[]}}static async createAppointment(a){try{return(await R.post("/appointments",a)).data}catch(t){throw console.log("Error creating appointment:",t),t}}static async cancelAppointment(a){try{return(await R.put(`/appointments/${a}/cancel`,{})).data}catch(t){throw console.log("Error cancelling appointment:",t),t}}static async rescheduleAppointment(a,t){try{return(await R.put(`/appointments/${a}/reschedule`,{date:t.toISOString()})).data}catch(i){throw console.log("Error rescheduling appointment:",i),i}}}function Ve(s){return new Date(s).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}function os(s){return new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}function vt({appointments:s=[],emptyMessage:a="No appointments scheduled",onCancel:t,onJoinCall:i,selectedDate:h}){if(!Array.isArray(s))return e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:a})});let l=s;return h&&(l=s.filter(r=>{const m=new Date(r.date);return m.getFullYear()===h.getFullYear()&&m.getMonth()===h.getMonth()&&m.getDate()===h.getDate()})),e.jsx("div",{className:"appointment-list",children:l.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:a})}):e.jsx("ul",{className:"appointment-items",children:l.map(r=>{var m,y,c,o,f,p,g,v,u;return!r||!r._id?(console.warn("Skipping appointment with missing data:",r),null):e.jsxs("li",{className:"appointment-card",children:[e.jsxs("div",{className:"appointment-header",children:[e.jsxs("h3",{className:"doctor-name",children:["Dr. ",((y=(m=r.doctor)==null?void 0:m.profile)==null?void 0:y.firstName)||((c=r.doctor)==null?void 0:c.firstName)," ",((f=(o=r.doctor)==null?void 0:o.profile)==null?void 0:f.lastName)||((p=r.doctor)==null?void 0:p.lastName),!((v=(g=r.doctor)==null?void 0:g.profile)!=null&&v.firstName)&&!((u=r.doctor)!=null&&u.firstName)&&"Unknown Doctor"]}),e.jsx("span",{className:`status-badge ${r.status||"unknown"}`,children:r.status||"Unknown"})]}),e.jsxs("div",{className:"appointment-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx(He,{className:"icon"}),e.jsx("span",{children:Ve(r.date)})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx(Ws,{className:"icon"}),e.jsxs("span",{children:[os(r.date)," -"," ",os(new Date(new Date(r.date).getTime()+r.duration*6e4))]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx(as,{className:"icon"}),e.jsx("span",{children:r.reason||"General Consultation"})]})]}),e.jsxs("div",{className:"appointment-actions",children:[r.status==="scheduled"&&e.jsx("button",{className:"btn secondary small",onClick:()=>t==null?void 0:t(r._id),disabled:!t,children:"Cancel"}),e.jsx("button",{className:"btn primary small",onClick:()=>{r.status==="scheduled"&&i?i(r):console.log("View details for appointment:",r._id)},children:r.status==="scheduled"?"Join Call":"View Details"})]})]},r._id)}).filter(Boolean)})})}function yt(){const{user:s}=me(),{addNotification:a}=ge(),[t,i]=n.useState(null),[h,l]=n.useState([]),[r,m]=n.useState([]),[y,c]=n.useState(!0);console.log("PatientDashboardPage rendered, user:",s),n.useEffect(()=>{console.log("PatientDashboardPage useEffect triggered"),(async()=>{try{c(!0);try{const g=await gs.getUpcomingAppointments(),v=await gs.getStats();let u=[];try{const x=await fetch("http://localhost:5000/api/patients/recent-doctors",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});x.ok?u=await x.json():console.warn("Could not fetch recent doctors:",x.status)}catch(x){console.error("Error fetching recent doctors:",x)}if(!u||u.length===0)try{const x=await fetch("http://localhost:5000/api/doctors",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(x.ok){const C=await x.json();u=(C.data||C).slice(0,5).map(N=>{var d,S,w,k,D,b,T,H,J,q,K,$;return{_id:N._id,profile:{fullName:((S=(d=N.user)==null?void 0:d.profile)==null?void 0:S.fullName)||`${((k=(w=N.user)==null?void 0:w.profile)==null?void 0:k.firstName)||""} ${((b=(D=N.user)==null?void 0:D.profile)==null?void 0:b.lastName)||""}`.trim(),firstName:(H=(T=N.user)==null?void 0:T.profile)==null?void 0:H.firstName,lastName:(q=(J=N.user)==null?void 0:J.profile)==null?void 0:q.lastName,specialization:N.specialization,avatar:($=(K=N.user)==null?void 0:K.profile)==null?void 0:$.photo,experience:N.experience}}})}}catch(x){console.error("Error fetching all doctors:",x)}else u=u.map(x=>({_id:x._id,profile:{fullName:`${x.firstName} ${x.lastName}`.trim(),firstName:x.firstName,lastName:x.lastName,specialization:x.specialization,avatar:x.avatar}}));l(g),i(v),m(u||[])}catch(g){console.error("Error in Promise.all for dashboard data:",g)}}catch(g){a(`Failed to load dashboard data: ${g.message}`,"error")}finally{c(!1)}})()},[a]);const o=async p=>{try{const g=await fetch(`http://localhost:5000/api/appointments/${p}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(g.ok)a("Appointment cancelled successfully","success"),l(v=>v.filter(u=>u._id!==p));else{const v=await g.json();a(`Failed to cancel appointment: ${v.error}`,"error")}}catch(g){a(`Error cancelling appointment: ${g.message}`,"error")}},f=p=>{var g,v,u;p.meetingUrl?window.open(p.meetingUrl,"_blank"):a(`Meeting for your appointment with Dr. ${((u=(v=(g=p.doctor)==null?void 0:g.user)==null?void 0:v.profile)==null?void 0:u.fullName)||"Doctor"} will start soon`,"info")};return y?e.jsx(De,{fullPage:!0}):e.jsxs("div",{className:"dashboard-page patient-dashboard",children:[e.jsx("h1",{className:"dashboard-title",children:"Patient Dashboard"}),e.jsxs("p",{className:"dashboard-subtitle",children:["Welcome, ",s.profile.firstName]}),e.jsxs("div",{className:"dashboard-stats",children:[e.jsx(Be,{title:"Upcoming Appointments",value:(t==null?void 0:t.upcomingCount)||0,icon:"calendar",variant:"primary"}),e.jsx(Be,{title:"Completed Visits",value:(t==null?void 0:t.completedCount)||0,icon:"check-circle",variant:"success"}),e.jsx(Be,{title:"Prescriptions",value:(t==null?void 0:t.prescriptionCount)||0,icon:"prescription",variant:"info"}),e.jsx(Be,{title:"Medical Records",value:(t==null?void 0:t.recordCount)||0,icon:"file-medical",variant:"warning"})]}),e.jsxs("section",{className:"dashboard-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"Your Upcoming Appointments"}),e.jsx(V,{to:"/appointments",className:"btn primary",children:"View All"})]}),e.jsx(vt,{appointments:h,emptyMessage:"No upcoming appointments",onCancel:o,onJoinCall:f}),e.jsx("div",{className:"dashboard-actions",children:e.jsx(V,{to:"/appointments/new",className:"btn primary",children:"Book New Appointment"})})]}),r.length>0&&e.jsxs("section",{className:"dashboard-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"Available Doctors"}),e.jsx(V,{to:"/doctors",className:"btn secondary",children:"Browse All Doctors"})]}),e.jsx("div",{className:"recent-doctors-list",children:r.map(p=>{var g,v,u,x,C,A,N;return e.jsxs("div",{className:"recent-doctor-card",children:[e.jsx("div",{className:"doctor-avatar",children:e.jsx("img",{src:((g=p.profile)==null?void 0:g.avatar)||"/default-avatar.png",alt:((v=p.profile)==null?void 0:v.fullName)||"Doctor",onError:d=>{d.target.src="/default-avatar.png"}})}),e.jsxs("div",{className:"doctor-info",children:[e.jsx("h3",{children:((u=p.profile)==null?void 0:u.fullName)||`Dr. ${((x=p.profile)==null?void 0:x.firstName)||""} ${((C=p.profile)==null?void 0:C.lastName)||""}`.trim()}),e.jsx("p",{className:"specialization",children:((A=p.profile)==null?void 0:A.specialization)||"General Medicine"}),((N=p.profile)==null?void 0:N.experience)&&e.jsxs("p",{className:"experience",children:[p.profile.experience," years experience"]}),e.jsxs("div",{className:"doctor-rating",children:[e.jsx("span",{className:"rating-stars",children:"⭐⭐⭐⭐⭐"}),e.jsx("span",{className:"rating-text",children:"4.8 (124 reviews)"})]})]}),e.jsxs("div",{className:"doctor-actions",children:[e.jsx(V,{to:`/doctors/${p._id}`,className:"btn text",children:"View Profile"}),e.jsx(V,{to:`/appointments/new?doctorId=${p._id}`,className:"btn secondary",children:"Book Appointment"})]})]},p._id)})})]}),e.jsxs("section",{className:"dashboard-section",children:[e.jsx("div",{className:"section-header",children:e.jsx("h2",{children:"Quick Actions"})}),e.jsxs("div",{className:"patient-quick-actions",children:[e.jsxs(V,{to:"/appointments/new",className:"quick-action-card",children:[e.jsx("span",{className:"icon",children:"📅"}),e.jsx("span",{className:"title",children:"Book Appointment"})]}),e.jsxs(V,{to:"/doctors",className:"quick-action-card",children:[e.jsx("span",{className:"icon",children:"👨‍⚕️"}),e.jsx("span",{className:"title",children:"Find Doctors"})]}),e.jsxs(V,{to:"/medical-records",className:"quick-action-card",children:[e.jsx("span",{className:"icon",children:"📋"}),e.jsx("span",{className:"title",children:"Medical Records"})]})]})]})]})}function Nt(){me();const[s,a]=n.useState(!0),[t,i]=n.useState({inventoryTotal:0,orders:{new:0,accepted:0,ready:0,dispensed:0,rejected:0},recentOrders:[]}),[h,l]=n.useState(null);return n.useEffect(()=>{let r=!0;async function m(){var y,c,o,f,p,g,v,u,x;try{a(!0),l(null);const[C,A,N,d,S,w]=await Promise.all([R.get("/pharmacy/inventory?page=1&pageSize=1"),R.get("/pharmacy/orders?status=New&page=1&pageSize=1"),R.get("/pharmacy/orders?status=Accepted&page=1&pageSize=1"),R.get("/pharmacy/orders?status=ReadyForPickup&page=1&pageSize=10&sort=-createdAt"),R.get("/pharmacy/orders?status=Dispensed&page=1&pageSize=1"),R.get("/pharmacy/orders?status=Rejected&page=1&pageSize=1")]);if(!r)return;i({inventoryTotal:((y=C.data)==null?void 0:y.total)||0,orders:{new:((c=A.data)==null?void 0:c.total)||0,accepted:((o=N.data)==null?void 0:o.total)||0,ready:((f=d.data)==null?void 0:f.total)||0,dispensed:((p=S.data)==null?void 0:p.total)||0,rejected:((g=w.data)==null?void 0:g.total)||0},recentOrders:Array.isArray((v=d.data)==null?void 0:v.data)?d.data.data:[]})}catch(C){if(!r)return;l(((x=(u=C==null?void 0:C.response)==null?void 0:u.data)==null?void 0:x.message)||C.message||"Failed to load")}finally{r&&a(!1)}}return m(),()=>{r=!1}},[]),s?e.jsxs("div",{className:"admin-page",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading pharmacy dashboard…"})]}):h?e.jsx("div",{className:"admin-page",children:e.jsxs("div",{className:"card",style:{borderColor:"crimson"},children:[e.jsx("p",{style:{color:"crimson"},children:String(h)}),String(h).toLowerCase().includes("no pharmacy profile")&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx("p",{children:"Please register your pharmacy profile first."}),e.jsx(V,{className:"btn",to:"/pharmacy/portal",children:"Open Pharmacy Portal"})]})]})}):e.jsxs("div",{className:"admin-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Pharmacy Dashboard"}),e.jsxs("div",{className:"actions",children:[e.jsx(V,{className:"btn",to:"/pharmacy/inventory",children:"Manage Inventory"}),e.jsx(V,{className:"btn",to:"/pharmacy/orders",children:"View Orders"}),e.jsx(V,{className:"btn",to:"/chat",children:"Open Chat"}),e.jsx(V,{className:"btn",to:"/pharmacy/profile/edit",children:"Update Profile"})]})]}),e.jsxs("div",{className:"analytics-overview",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"💊"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:t.inventoryTotal}),e.jsx("p",{children:"Inventory Items"})]})]}),e.jsxs(V,{className:"stat-card",to:"/pharmacy/orders?status=New",children:[e.jsx("div",{className:"stat-icon",children:"🆕"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:t.orders.new}),e.jsx("p",{children:"New Orders"})]})]}),e.jsxs(V,{className:"stat-card",to:"/pharmacy/orders?status=Accepted",children:[e.jsx("div",{className:"stat-icon",children:"✅"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:t.orders.accepted}),e.jsx("p",{children:"Accepted"})]})]}),e.jsxs(V,{className:"stat-card",to:"/pharmacy/orders?status=ReadyForPickup",children:[e.jsx("div",{className:"stat-icon",children:"📦"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:t.orders.ready}),e.jsx("p",{children:"Ready for Pickup"})]})]}),e.jsxs(V,{className:"stat-card",to:"/pharmacy/orders?status=Dispensed",children:[e.jsx("div",{className:"stat-icon",children:"🧾"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:t.orders.dispensed}),e.jsx("p",{children:"Dispensed"})]})]}),e.jsxs(V,{className:"stat-card",to:"/pharmacy/orders?status=Rejected",children:[e.jsx("div",{className:"stat-icon",children:"⛔"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:t.orders.rejected}),e.jsx("p",{children:"Rejected"})]})]})]}),e.jsxs("div",{className:"analytics-section",children:[e.jsx("h2",{children:"Recently Ready Orders"}),e.jsxs("div",{className:"top-doctors",children:[t.recentOrders.length===0&&e.jsx("div",{className:"no-data",children:"No orders yet"}),t.recentOrders.map(r=>e.jsxs("div",{className:"doctor-stat",children:[e.jsxs("div",{className:"doctor-info",children:[e.jsxs("div",{className:"doctor-name",children:["Order #",String(r._id).slice(-6)]}),e.jsxs("div",{className:"doctor-specialty",children:["Status: ",r.status]})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-value",children:new Date(r.createdAt).toLocaleString()}),e.jsx("span",{className:"metric-label",children:"Created"})]})]},r._id))]})]}),e.jsxs("div",{className:"analytics-section",children:[e.jsx("h2",{children:"Quick Tips"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Use Inventory to keep stock and pricing up to date."}),e.jsx("li",{children:"Accept new orders to open a chat thread with the patient."}),e.jsx("li",{children:"Dispense will record a stock movement and notify stakeholders."})]})]})]})}function bt(){me();const[s,a]=n.useState(!0),[t,i]=n.useState({catalogTotal:0,orders:{pending:0,inProgress:0,completed:0,rejected:0},recentOrders:[]}),[h,l]=n.useState(null);return n.useEffect(()=>{let r=!0;async function m(){var y,c,o,f,p,g,v,u;try{a(!0),l(null);const[x,C,A,N,d]=await Promise.all([R.get("/laboratory/catalog?page=1&pageSize=1"),R.get("/laboratory/orders?status=ordered&page=1&pageSize=1"),R.get("/laboratory/orders?status=in-progress&page=1&pageSize=1"),R.get("/laboratory/orders?status=completed&page=1&pageSize=10&sort=-createdAt"),R.get("/laboratory/orders?status=rejected&page=1&pageSize=1")]);if(!r)return;i({catalogTotal:((y=x.data)==null?void 0:y.total)||0,orders:{pending:((c=C.data)==null?void 0:c.total)||0,inProgress:((o=A.data)==null?void 0:o.total)||0,completed:((f=N.data)==null?void 0:f.total)||0,rejected:((p=d.data)==null?void 0:p.total)||0},recentOrders:Array.isArray((g=N.data)==null?void 0:g.data)?N.data.data:[]})}catch(x){if(!r)return;l(((u=(v=x==null?void 0:x.response)==null?void 0:v.data)==null?void 0:u.message)||x.message||"Failed to load")}finally{r&&a(!1)}}return m(),()=>{r=!1}},[]),s?e.jsxs("div",{className:"admin-page",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading laboratory dashboard…"})]}):h?e.jsx("div",{className:"admin-page",children:e.jsx("p",{style:{color:"crimson"},children:String(h)})}):e.jsxs("div",{className:"admin-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Laboratory Dashboard"}),e.jsxs("div",{className:"actions",children:[e.jsx(V,{className:"btn",to:"/laboratory/catalog",children:"Manage Catalog"}),e.jsx(V,{className:"btn",to:"/laboratory/orders",children:"View Orders"}),e.jsx(V,{className:"btn",to:"/chat",children:"Open Chat"})]})]}),e.jsxs("div",{className:"analytics-overview",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"🧪"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:t.catalogTotal}),e.jsx("p",{children:"Catalog Items"})]})]}),e.jsxs(V,{className:"stat-card",to:"/laboratory/orders?status=ordered",children:[e.jsx("div",{className:"stat-icon",children:"📝"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:t.orders.pending}),e.jsx("p",{children:"Pending Orders"})]})]}),e.jsxs(V,{className:"stat-card",to:"/laboratory/orders?status=in-progress",children:[e.jsx("div",{className:"stat-icon",children:"⚙️"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:t.orders.inProgress}),e.jsx("p",{children:"In Progress"})]})]}),e.jsxs(V,{className:"stat-card",to:"/laboratory/orders?status=completed",children:[e.jsx("div",{className:"stat-icon",children:"✅"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:t.orders.completed}),e.jsx("p",{children:"Completed"})]})]}),e.jsxs(V,{className:"stat-card",to:"/laboratory/orders?status=rejected",children:[e.jsx("div",{className:"stat-icon",children:"⛔"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:t.orders.rejected}),e.jsx("p",{children:"Rejected"})]})]})]}),e.jsxs("div",{className:"analytics-section",children:[e.jsx("h2",{children:"Recently Completed Orders"}),e.jsxs("div",{className:"top-doctors",children:[t.recentOrders.length===0&&e.jsx("div",{className:"no-data",children:"No orders yet"}),t.recentOrders.map(r=>e.jsxs("div",{className:"doctor-stat",children:[e.jsxs("div",{className:"doctor-info",children:[e.jsxs("div",{className:"doctor-name",children:["Lab #",String(r._id).slice(-6)]}),e.jsxs("div",{className:"doctor-specialty",children:["Status: ",r.status]})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-value",children:new Date(r.createdAt).toLocaleString()}),e.jsx("span",{className:"metric-label",children:"Created"})]})]},r._id))]})]}),e.jsxs("div",{className:"analytics-section",children:[e.jsx("h2",{children:"Quick Tips"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Keep your catalog pricing accurate for discovery results."}),e.jsx("li",{children:"Accept orders to notify providers and patients automatically."}),e.jsx("li",{children:"Upload results and then mark orders complete for delivery."})]})]})]})}function St(){const{user:s,loading:a}=me();if(console.log("DashboardPage - loading:",a,"user:",s,"user.role:",s==null?void 0:s.role),a)return e.jsx(De,{fullPage:!0});if(!s)return e.jsx("div",{children:"Please log in to view your dashboard."});switch(s.role){case"admin":return console.log("Routing to AdminDashboardPage"),e.jsx(gt,{});case"doctor":return console.log("Routing to DoctorDashboardPage"),e.jsx(ft,{});case"pharmacist":return console.log("Routing to PharmacyDashboardPage"),e.jsx(Nt,{});case"laboratory":return console.log("Routing to LaboratoryDashboardPage"),e.jsx(bt,{});case"patient":default:return console.log("Routing to PatientDashboardPage"),e.jsx(yt,{})}}const wt=()=>{const s=ye(),{addNotification:a}=ge(),[t,i]=n.useState([]),[h,l]=n.useState(!0),[r,m]=n.useState(""),[y,c]=n.useState(""),[o,f]=n.useState(""),[p,g]=n.useState(""),[v,u]=n.useState(""),[x,C]=n.useState("rating"),[A,N]=n.useState([]),[d,S]=n.useState([]),w=b=>{var J;const T=typeof(b==null?void 0:b.verificationStatus)=="string"?/^(approved)$/i.test(b.verificationStatus):!0,H=typeof((J=b==null?void 0:b.user)==null?void 0:J.status)=="string"?/^(active)$/i.test(b.user.status):!0;return T&&H};n.useEffect(()=>{(async()=>{var T,H;try{l(!0);const J=await fetch("http://localhost:5000/api/doctors",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!J.ok)throw new Error(`Failed to fetch doctors: ${J.statusText}`);const q=await J.json(),P=((Array.isArray(q)?q:Array.isArray(q==null?void 0:q.data)?q.data:Array.isArray((T=q==null?void 0:q.data)==null?void 0:T.doctors)?q.data.doctors:Array.isArray((H=q==null?void 0:q.data)==null?void 0:H.users)?q.data.users:Array.isArray(q==null?void 0:q.doctors)?q.doctors:Array.isArray(q==null?void 0:q.users)?q.users:[]).map(M=>{var Z,se,oe,B,U,_;return{...M,rating:M.rating||0,reviewCount:M.reviewCount||0,specialization:M.specialization||((Z=M.profile)==null?void 0:Z.specialization)||"General Medicine",name:M.user?`Dr. ${M.user.profile.firstName} ${M.user.profile.lastName}`:`Dr. ${M.firstName||"Doctor"} ${M.lastName||""}`,firstName:((oe=(se=M.user)==null?void 0:se.profile)==null?void 0:oe.firstName)||M.firstName,lastName:((U=(B=M.user)==null?void 0:B.profile)==null?void 0:U.lastName)||M.lastName,email:((_=M.user)==null?void 0:_.email)||M.email,location:M.location||"Remote",isAvailable:M.isAvailable!==void 0?M.isAvailable:!0,verificationStatus:M.verificationStatus||"pending"}})||[]).filter(w);i(P);const O=[...new Set(P.filter(M=>M.specialization).map(M=>M.specialization))];N(O)}catch(J){console.error("Error fetching doctors:",J),a("Failed to load doctors. Please try again later.","error"),i([])}finally{l(!1)}})()},[a]),n.useEffect(()=>{let b=t.filter(T=>{var O,M,Z,se,oe,B;const J=`${((M=(O=T.user)==null?void 0:O.profile)==null?void 0:M.firstName)||""} ${((se=(Z=T.user)==null?void 0:Z.profile)==null?void 0:se.lastName)||""}`.toLowerCase().includes(r.toLowerCase())||((oe=T.specialization)==null?void 0:oe.toLowerCase().includes(r.toLowerCase())),q=!y||T.specialization===y,K=!o||parseFloat(T.rating)>=parseFloat(o),$=!p||T.experience&&parseInt(T.experience)>=parseInt(p),P=!v||((B=T.location)==null?void 0:B.toLowerCase().includes(v.toLowerCase()));return J&&q&&K&&$&&P});b.sort((T,H)=>{var J,q,K,$,P,O,M,Z;switch(x){case"rating":return parseFloat(H.rating||0)-parseFloat(T.rating||0);case"experience":return parseInt(H.experience||0)-parseInt(T.experience||0);case"name":const se=`${((q=(J=T.user)==null?void 0:J.profile)==null?void 0:q.firstName)||""} ${(($=(K=T.user)==null?void 0:K.profile)==null?void 0:$.lastName)||""}`,oe=`${((O=(P=H.user)==null?void 0:P.profile)==null?void 0:O.firstName)||""} ${((Z=(M=H.user)==null?void 0:M.profile)==null?void 0:Z.lastName)||""}`;return se.localeCompare(oe);case"availability":return H.isAvailable-T.isAvailable;default:return 0}}),S(b)},[t,r,y,o,p,v,x]);const k=b=>{s(`/appointments/new?doctorId=${b}`)},D=()=>{m(""),c(""),f(""),g(""),u(""),C("rating")};return h?e.jsx(De,{}):e.jsxs("div",{className:"doctors-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Find a Doctor"}),e.jsx("p",{children:"Connect with qualified healthcare professionals"})]}),e.jsxs("div",{className:"search-filters-section",children:[e.jsx("div",{className:"search-bar",children:e.jsx("input",{type:"text",placeholder:"Search by name or specialization...",value:r,onChange:b=>m(b.target.value),className:"search-input"})}),e.jsxs("div",{className:"filters-row",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Specialization:"}),e.jsxs("select",{value:y,onChange:b=>c(b.target.value),children:[e.jsx("option",{value:"",children:"All Specializations"}),A.map(b=>e.jsx("option",{value:b,children:b},b))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Minimum Rating:"}),e.jsxs("select",{value:o,onChange:b=>f(b.target.value),children:[e.jsx("option",{value:"",children:"Any Rating"}),e.jsx("option",{value:"4.5",children:"4.5+ Stars"}),e.jsx("option",{value:"4.0",children:"4.0+ Stars"}),e.jsx("option",{value:"3.5",children:"3.5+ Stars"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Experience:"}),e.jsxs("select",{value:p,onChange:b=>g(b.target.value),children:[e.jsx("option",{value:"",children:"Any Experience"}),e.jsx("option",{value:"5",children:"5+ Years"}),e.jsx("option",{value:"10",children:"10+ Years"}),e.jsx("option",{value:"15",children:"15+ Years"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Sort by:"}),e.jsxs("select",{value:x,onChange:b=>C(b.target.value),children:[e.jsx("option",{value:"rating",children:"Highest Rated"}),e.jsx("option",{value:"experience",children:"Most Experienced"}),e.jsx("option",{value:"name",children:"Name (A-Z)"}),e.jsx("option",{value:"availability",children:"Available Now"})]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:D,children:"Clear Filters"})]})]}),e.jsx("div",{className:"results-summary",children:e.jsxs("p",{children:["Found ",d.length," doctor",d.length!==1?"s":""]})}),d.length>0?e.jsx("div",{className:"doctors-grid",children:d.map(b=>{var T,H,J,q,K,$,P,O,M,Z;return e.jsxs("div",{className:"doctor-card-enhanced",children:[e.jsxs("div",{className:"doctor-avatar",children:[e.jsx("img",{src:((H=(T=b.user)==null?void 0:T.profile)==null?void 0:H.photo)||"/default-doctor.png",alt:`${(q=(J=b.user)==null?void 0:J.profile)==null?void 0:q.firstName} ${($=(K=b.user)==null?void 0:K.profile)==null?void 0:$.lastName}`,onError:se=>{se.target.src="/default-doctor.png"}}),b.isAvailable&&e.jsx("div",{className:"availability-badge",children:"Available"})]}),e.jsxs("div",{className:"doctor-info",children:[e.jsxs("h3",{children:[(O=(P=b.user)==null?void 0:P.profile)==null?void 0:O.firstName," ",(Z=(M=b.user)==null?void 0:M.profile)==null?void 0:Z.lastName]}),e.jsx("p",{className:"specialization",children:b.specialization}),e.jsxs("div",{className:"doctor-stats",children:[e.jsx("div",{className:"stat-item",children:e.jsxs("span",{className:"rating",children:["⭐ ",b.rating," (",b.reviewCount," reviews)"]})}),b.experience&&e.jsx("div",{className:"stat-item",children:e.jsxs("span",{className:"experience",children:[b.experience," years experience"]})}),e.jsx("div",{className:"stat-item",children:e.jsxs("span",{className:"location",children:["📍 ",b.location]})})]}),b.bio&&e.jsxs("p",{className:"doctor-bio",children:[b.bio.substring(0,100),"..."]}),e.jsxs("div",{className:"doctor-actions",children:[e.jsx("button",{className:"btn btn-primary",onClick:()=>k(b._id),disabled:!w(b),title:w(b)?"":"Doctor not available for booking",children:"Book Appointment"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>s(`/doctors/${b._id}`),children:"View Profile"})]})]})]},b._id)})}):e.jsxs("div",{className:"no-results",children:[e.jsx("p",{children:"No doctors found matching your criteria."}),e.jsx("button",{className:"btn btn-primary",onClick:D,children:"Clear Filters"})]})]})},Ct=s=>s?s.split(/[-_]/).map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" "):"";function kt({appointment:s,onCancel:a,onViewDetails:t,onEdit:i,isPatient:h=!0}){var r,m,y,c,o,f,p,g,v,u,x,C,A;const l=N=>{switch(N){case"completed":return"status-completed";case"cancelled":return"status-cancelled";case"no-show":return"status-no-show";case"referred":return"status-referred";case"in-lab":return"status-in-lab";case"pharmacy":return"status-pharmacy";default:return"status-scheduled"}};return e.jsxs("div",{className:`appointment-card ${l(s.status)}`,children:[e.jsx("div",{className:"appointment-header",children:e.jsxs("div",{className:"appointment-title",children:[h?e.jsxs("h3",{children:["Dr."," ",((m=(r=s.doctor)==null?void 0:r.profile)==null?void 0:m.firstName)||((y=s.doctor)==null?void 0:y.firstName)," ",((o=(c=s.doctor)==null?void 0:c.profile)==null?void 0:o.lastName)||((f=s.doctor)==null?void 0:f.lastName),((p=s.doctor)==null?void 0:p.specialization)&&e.jsxs("span",{className:"doctor-specialization",children:[" ","- ",s.doctor.specialization]})]}):e.jsxs("h3",{children:[(v=(g=s.patient)==null?void 0:g.profile)==null?void 0:v.firstName," ",(x=(u=s.patient)==null?void 0:u.profile)==null?void 0:x.lastName]}),e.jsx("span",{className:`status-badge ${s.status}`,children:Ct(s.status)})]})}),e.jsxs("div",{className:"appointment-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Date:"}),e.jsx("span",{className:"detail-value",children:Ve(s.date)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Time:"}),e.jsxs("span",{className:"detail-value",children:[os(s.date)," -",os(new Date(new Date(s.date).getTime()+s.duration*6e4))]})]}),s.reason&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Reason:"}),e.jsx("span",{className:"detail-value",children:s.reason})]}),s.reason&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Reason:"}),e.jsx("span",{className:"detail-value",children:s.reason})]}),s.symptoms&&s.symptoms.length>0&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Symptoms:"}),e.jsx("span",{className:"detail-value",children:s.symptoms.join(", ")})]}),s.followUpRequired&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Follow-up:"}),e.jsxs("span",{className:"detail-value",children:["Required"," ",s.followUpDate&&`on ${Ve(s.followUpDate)}`]})]}),h&&((C=s.doctor)==null?void 0:C.specialization)&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Specialization:"}),e.jsx("span",{className:"detail-value",children:s.doctor.specialization})]}),h&&((A=s.doctor)==null?void 0:A.licenseNumber)&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"License:"}),e.jsx("span",{className:"detail-value",children:s.doctor.licenseNumber})]})]}),e.jsxs("div",{className:"appointment-actions",children:[t&&e.jsx("button",{onClick:()=>t(s),className:"btn btn-secondary",children:"View Details"}),s.status==="scheduled"&&i&&e.jsx("button",{onClick:()=>i(s),className:"btn btn-primary",children:"Edit"}),s.status==="scheduled"&&e.jsxs(e.Fragment,{children:[a&&e.jsx("button",{onClick:()=>a(s._id),className:"btn btn-outline",children:"Cancel"}),s.meetingUrl&&e.jsx("a",{href:s.meetingUrl,target:"_blank",rel:"noopener noreferrer",className:"btn btn-primary",children:"Join Call"})]}),s.status==="completed"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>t&&t(s),className:"btn btn-secondary",children:"View Summary"}),s.medicalRecord&&e.jsx("button",{className:"btn btn-info",children:"View Medical Record"})]})]})]})}function Pt({onClose:s,onCreate:a,availableSlots:t=[],selectedDate:i}){const{user:h}=me(),[l,r]=n.useState([]),[m,y]=n.useState([]),[c,o]=n.useState(!1),[f,p]=n.useState(!1),[g,v]=n.useState({doctorId:"",date:i,slot:"",reason:"",symptoms:"",duration:30}),[u,x]=n.useState(null),[C,A]=n.useState(!1);n.useEffect(()=>{(async()=>{try{o(!0);const D=await fetch("http://localhost:5000/api/doctors",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!D.ok)throw new Error("Failed to fetch doctors");const b=await D.json(),T=b.data||b;r(Array.isArray(T)?T:[])}catch(D){console.error("Error fetching doctors:",D)}finally{o(!1)}})()},[]),n.useEffect(()=>{(async()=>{if(g.doctorId&&i){p(!0);try{const D=await gs.getAvailableSlots(i,g.doctorId);y(D)}catch(D){console.error("Error fetching slots for doctor:",D),y([])}finally{p(!1)}}else y([])})()},[g.doctorId,i]);const N=k=>{const{name:D,value:b}=k.target;v(T=>({...T,[D]:b})),D==="doctorId"&&v(T=>({...T,slot:""}))},d=async k=>{var D;if(k.preventDefault(),!(!g.doctorId||!g.slot))try{o(!0);let b;if(u){A(!0);const J=new FormData;J.append("file",u),J.append("patientId",h._id);const q=await fetch("http://localhost:5000/api/medical-documents/upload",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:J});q.ok&&(b=(D=(await q.json()).data)==null?void 0:D._id),A(!1)}const T=await fetch("http://localhost:5000/api/appointments",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({doctorId:g.doctorId,slotId:g.slot,duration:g.duration,reason:g.reason,caseDetails:g.reason,symptoms:g.symptoms?g.symptoms.split(",").map(J=>J.trim()):[],medicalDocumentId:b})});if(!T.ok)throw new Error("Failed to create appointment");const H=await T.json();a(H)}catch(b){console.error("Error creating appointment:",b)}finally{o(!1)}},S=g.doctorId?m:t,w=Array.isArray(S)?S:[];return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Schedule New Appointment"}),e.jsx("button",{onClick:s,className:"close-button",children:"×"})]}),e.jsxs("form",{onSubmit:d,className:"appointment-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Doctor:"}),e.jsxs("select",{name:"doctorId",value:g.doctorId,onChange:N,required:!0,children:[e.jsx("option",{value:"",children:"-- Select a doctor --"}),l.map(k=>{var D,b,T,H,J,q;return e.jsxs("option",{value:k._id,children:["Dr."," ",((b=(D=k.user)==null?void 0:D.profile)==null?void 0:b.fullName)||`${((H=(T=k.user)==null?void 0:T.profile)==null?void 0:H.firstName)||""} ${((q=(J=k.user)==null?void 0:J.profile)==null?void 0:q.lastName)||""}`.trim()," ","- ",k.specialization]},k._id)})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Date:"}),e.jsx("div",{className:"selected-date",children:Ve(i)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Available Slots:"}),f?e.jsx("div",{className:"loading-slots",children:"Loading available slots..."}):e.jsxs("select",{name:"slot",value:g.slot,onChange:N,required:!0,children:[e.jsx("option",{value:"",children:"-- Select a time --"}),w.length>0?w.map(k=>e.jsxs("option",{value:k._id,children:[k.startTime," - ",k.endTime]},k._id)):e.jsx("option",{value:"",disabled:!0,children:g.doctorId?"No available slots for this doctor on selected date":"Please select a doctor first"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Duration (minutes):"}),e.jsxs("select",{name:"duration",value:g.duration,onChange:N,children:[e.jsx("option",{value:15,children:"15 min"}),e.jsx("option",{value:30,children:"30 min"}),e.jsx("option",{value:45,children:"45 min"}),e.jsx("option",{value:60,children:"60 min"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reason for Visit:"}),e.jsx("input",{type:"text",name:"reason",value:g.reason,onChange:N,placeholder:"E.g., Annual check-up, Flu symptoms",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Symptoms (comma separated):"}),e.jsx("textarea",{name:"symptoms",value:g.symptoms,onChange:N,placeholder:"E.g., Headache, Fever, Cough",rows:3})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Upload Medical Document"}),e.jsx("input",{type:"file",onChange:k=>x(k.target.files[0]||null),disabled:C}),u&&e.jsxs("p",{children:["Selected: ",u.name]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",onClick:s,className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:c,children:c?"Scheduling...":"Schedule Appointment"})]})]})]})})}const fs=["Acute respiratory infection","Diabetes mellitus","Hypertension","Asthma","Malaria","HIV/AIDS","Tuberculosis","Cardiovascular diseases","Chronic obstructive pulmonary disease","COVID-19","Influenza","Pneumonia","Stroke","Breast cancer","Cervical cancer","Diarrhoeal diseases","Mental disorders","Chronic kidney disease","Liver cirrhosis","Leukemia"],aa=["Paracetamol","Ibuprofen","Amoxicillin","Metformin","Atorvastatin","Omeprazole","Salbutamol","Amlodipine","Levothyroxine","Prednisone","Ciprofloxacin","Simvastatin","Losartan","Hydrochlorothiazide","Furosemide","Prednisolone","Captopril","Insulin","Warfarin","Diazepam"];function ta({appointment:s,onClose:a,onUpdate:t,onCreateMedicalRecord:i,initialEditMode:h=!1}){var je,ve,Ce,z,Q,re,ae,ue,le,pe,Ne,E,W;const{user:l}=me(),{addNotification:r}=ge(),m=ye(),[y,c]=n.useState(!1),[o,f]=n.useState(h),[p,g]=n.useState(null),[v,u]=n.useState([]),[x,C]=n.useState({required:s.followUpRequired||!1,date:s.followUpDate||"",notes:s.followUpNotes||""}),[A,N]=n.useState({reason:s.reason||"",symptoms:s.symptoms?s.symptoms.join(", "):"",status:s.status,notes:s.notes||""}),[d,S]=n.useState([]),[w,k]=n.useState(null),D=Array.isArray(fs)?fs:[],[b,T]=n.useState(!1),[H,J]=n.useState({diagnosis:"",medications:[{name:"",dosage:"",frequency:"",instructions:""}],notes:"",date:new Date().toISOString()}),q=(L,G)=>{J(F=>({...F,[L]:G}))},K=(L,G,F)=>{const ne=[...H.medications];ne[L][G]=F,J(de=>({...de,medications:ne}))},$=()=>{J(L=>({...L,medications:[...L.medications,{name:"",dosage:"",frequency:"",instructions:""}]}))},P=L=>{J(G=>({...G,medications:G.medications.filter((F,ne)=>ne!==L)}))},O=async()=>{try{const L=await R.post("/medical-records",{patientId:s.patient._id,appointmentId:s._id,...H}),G=L.data.record||L.data;r("Medical record added successfully","success"),g(G),t&&t({...s,medicalRecord:G._id}),T(!1)}catch(L){console.error("Error adding medical record:",L),r("Failed to add medical record","error")}};n.useEffect(()=>{s._id&&(M(),Z())},[s._id,s.medicalRecord]);const M=async()=>{if(s.medicalRecord)try{const L=await fetch(`http://localhost:5000/api/medical-records/${s.medicalRecord}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(L.ok){const G=await L.json();g(G.data||G)}}catch(L){console.error("Error fetching medical record:",L)}},Z=async()=>{try{const L=await fetch(`http://localhost:5000/api/admin/audit-logs?resourceType=appointment&resourceId=${s._id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(L.ok){const G=await L.json();u(G.logs||[])}}catch(L){console.error("Error fetching audit logs:",L)}},se=async()=>{try{c(!0);const L=await fetch(`http://localhost:5000/api/appointments/${s._id}/complete`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({followUpRequired:x.required,followUpDate:x.date,followUpNotes:x.notes})});if(L.ok){const G=await L.json();t(G.data),r("Appointment completed successfully","success"),Z()}else throw new Error("Failed to complete appointment")}catch(L){r(`Error: ${L.message}`,"error")}finally{c(!1)}},oe=(l==null?void 0:l.role)==="doctor",B=(l==null?void 0:l.role)==="admin",U=oe&&s.status==="scheduled",_=oe&&s.status==="scheduled",ce=(L,G)=>N(F=>({...F,[L]:G})),ie=async()=>{var L;try{c(!0);let G={};if(l.role==="patient"){if(G.reason=A.reason,G.symptoms=A.symptoms?A.symptoms.split(",").map(de=>de.trim()):[],d.length>0){const de=[];for(const fe of d){const we=new FormData;we.append("file",fe),we.append("patientId",s.patient._id);const Le=await fetch("http://localhost:5000/api/medical-documents/upload",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:we});if(!Le.ok)throw new Error("Document upload failed");const be=await Le.json();(L=be.data)!=null&&L._id&&de.push(be.data._id)}de.length&&(G.medicalDocumentIds=de)}}else G.status=A.status,G.notes=A.notes;const F=await fetch(`http://localhost:5000/api/appointments/${s._id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(G)});if(!F.ok){const de=await F.json();throw new Error(de.message||"Update failed")}const ne=await F.json();t(ne.data||ne),f(!1)}catch(G){console.error(G),r(G.message,"error")}finally{c(!1)}};return e.jsx("div",{className:"appointment-details-modal",children:e.jsx("div",{className:"modal-overlay",onClick:a,children:e.jsxs("div",{className:"modal-content",onClick:L=>L.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Appointment Details"}),e.jsx("button",{className:"close-btn",onClick:a,children:"×"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("section",{className:"appointment-info",children:[e.jsx("h3",{children:"Appointment Information"}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Status:"}),e.jsx("span",{className:`status-badge ${s.status}`,children:s.status})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Date & Time:"}),e.jsxs("span",{children:[Ve(s.date)," at"," ",os(s.date)]})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Duration:"}),e.jsxs("span",{children:[s.duration," minutes"]})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Doctor:"}),e.jsxs("span",{children:["Dr."," ",((ve=(je=s.doctor)==null?void 0:je.profile)==null?void 0:ve.firstName)||((Ce=s.doctor)==null?void 0:Ce.firstName)," ",((Q=(z=s.doctor)==null?void 0:z.profile)==null?void 0:Q.lastName)||((re=s.doctor)==null?void 0:re.lastName),((ae=s.doctor)==null?void 0:ae.specialization)&&e.jsxs("span",{className:"specialization",children:[" ","- ",s.doctor.specialization]})]})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Patient:"}),e.jsxs("span",{children:[((le=(ue=s.patient)==null?void 0:ue.profile)==null?void 0:le.firstName)||((pe=s.patient)==null?void 0:pe.firstName)," ",((E=(Ne=s.patient)==null?void 0:Ne.profile)==null?void 0:E.lastName)||((W=s.patient)==null?void 0:W.lastName)]})]}),s.reason&&e.jsxs("div",{className:"info-item full-width",children:[e.jsx("label",{children:"Reason for Visit:"}),e.jsx("span",{children:s.reason})]}),s.symptoms&&s.symptoms.length>0&&e.jsxs("div",{className:"info-item full-width",children:[e.jsx("label",{children:"Symptoms:"}),e.jsx("span",{children:s.symptoms.join(", ")})]})]})]})," ",(s.followUpRequired||U)&&e.jsxs("section",{className:"follow-up-info",children:[e.jsx("h3",{children:"Follow-up Information"}),U?e.jsxs("div",{className:"follow-up-form",children:[e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:x.required,onChange:L=>C(G=>({...G,required:L.target.checked}))}),"Follow-up appointment required"]}),x.required&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Follow-up Date:"}),e.jsx("input",{type:"date",value:x.date,onChange:L=>C(G=>({...G,date:L.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Follow-up Notes:"}),e.jsx("textarea",{value:x.notes,onChange:L=>C(G=>({...G,notes:L.target.value})),placeholder:"Notes for follow-up appointment..."})]})]})]}):e.jsxs("div",{className:"follow-up-display",children:[e.jsxs("p",{children:["Follow-up Required:"," ",s.followUpRequired?"Yes":"No"]}),s.followUpDate&&e.jsxs("p",{children:["Follow-up Date: ",Ve(s.followUpDate)]}),s.followUpNotes&&e.jsxs("p",{children:["Notes: ",s.followUpNotes]})]})]}),e.jsxs("section",{className:"attached-documents",children:[e.jsx("h3",{children:"Attached Documents"}),s.medicalDocuments&&s.medicalDocuments.length>0?e.jsx("ul",{className:"document-list",children:s.medicalDocuments.map(L=>e.jsx("li",{className:"document-item",children:e.jsxs("button",{type:"button",className:"document-link btn btn-link",onClick:()=>k(L),children:[L.filename,e.jsxs("span",{className:"doc-date",children:["(",new Date(L.createdAt).toLocaleString(),")"]})]})},L._id))}):e.jsx("p",{children:"No documents attached."})]}),e.jsxs("section",{className:"medical-record-info",children:[e.jsx("h3",{children:"Medical Record"}),p?e.jsxs("div",{className:"medical-record-summary",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Diagnosis:"})," ",p.diagnosis]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Treatment:"})," ",p.treatment]}),p.prescription&&e.jsxs("p",{children:[e.jsx("strong",{children:"Prescription:"})," ",p.prescription]}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>m(`/medical-records/${p._id}`),children:"View Full Record"})]}):e.jsx("div",{className:"no-medical-record",children:U&&s.status!=="cancelled"&&e.jsx("button",{className:"btn btn-primary",onClick:()=>T(!0),children:"Create Medical Record"})})]}),(B||oe)&&e.jsxs("section",{className:"audit-logs",children:[e.jsx("h3",{children:"Activity History"}),e.jsx("div",{className:"audit-log-list",children:v.length>0?v.map((L,G)=>{var F,ne,de,fe;return e.jsxs("div",{className:"audit-log-item",children:[e.jsxs("div",{className:"log-header",children:[e.jsx("span",{className:"log-action",children:L.action.replace("_"," ")}),e.jsx("span",{className:"log-timestamp",children:Ve(L.timestamp)})]}),e.jsxs("div",{className:"log-details",children:[e.jsxs("span",{className:"log-user",children:["by ",(ne=(F=L.userId)==null?void 0:F.profile)==null?void 0:ne.firstName," ",(fe=(de=L.userId)==null?void 0:de.profile)==null?void 0:fe.lastName," (",L.userRole,")"]}),L.details&&Object.keys(L.details).length>0&&e.jsx("div",{className:"log-extra",children:JSON.stringify(L.details,null,2)})]})]},G)}):e.jsx("p",{children:"No activity history available"})})]}),b&&e.jsxs("section",{className:"new-medical-record-form",children:[e.jsx("h3",{children:"New Medical Record"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Diagnosis:"}),e.jsxs("select",{value:H.diagnosis,onChange:L=>q("diagnosis",L.target.value),children:[e.jsx("option",{value:"",children:"Select disease"}),D.map(L=>e.jsx("option",{value:L,children:L},L))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Medications:"}),e.jsx("datalist",{id:"med-list",children:aa.map(L=>e.jsx("option",{value:L},L))}),H.medications.map((L,G)=>e.jsxs("div",{className:"med-row",children:[e.jsx("input",{list:"med-list",placeholder:"Medication",value:L.name,onChange:F=>K(G,"name",F.target.value)}),e.jsx("input",{placeholder:"Dosage",value:L.dosage,onChange:F=>K(G,"dosage",F.target.value)}),e.jsx("input",{placeholder:"Frequency",value:L.frequency,onChange:F=>K(G,"frequency",F.target.value)}),e.jsx("input",{placeholder:"Instructions",value:L.instructions,onChange:F=>K(G,"instructions",F.target.value)}),H.medications.length>1&&e.jsx("button",{onClick:()=>P(G),children:"Remove"})]},G)),e.jsx("button",{className:"btn btn-secondary",onClick:$,children:"Add Medication"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes:"}),e.jsx("textarea",{value:H.notes,onChange:L=>q("notes",L.target.value)})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-primary",onClick:O,children:"Save Record"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>T(!1),children:"Cancel"})]})]}),w&&e.jsxs("section",{className:"document-preview",children:[e.jsxs("h4",{children:["Preview: ",w.filename]}),w.mimeType.startsWith("image/")?e.jsx("img",{src:w.fileUrl,alt:w.filename,className:"preview-img"}):e.jsx("iframe",{src:w.fileUrl,title:w.filename,className:"preview-iframe"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>k(null),children:"Close Preview"})]})]}),o&&e.jsxs("section",{className:"edit-appointment-form",children:[e.jsx("h3",{children:"Edit Appointment"}),l.role==="patient"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reason:"}),e.jsx("input",{type:"text",value:A.reason,onChange:L=>ce("reason",L.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Symptoms:"}),e.jsx("input",{type:"text",value:A.symptoms,onChange:L=>ce("symptoms",L.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Attach Documents:"}),e.jsx("input",{type:"file",multiple:!0,onChange:L=>S(Array.from(L.target.files))}),d.length>0&&e.jsx("ul",{className:"selected-files-list",children:d.map((L,G)=>e.jsx("li",{children:L.name},G))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Status:"}),e.jsxs("select",{value:A.status,onChange:L=>ce("status",L.target.value),children:[e.jsx("option",{value:"scheduled",children:"Scheduled"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes:"}),e.jsx("textarea",{value:A.notes,onChange:L=>ce("notes",L.target.value)})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-primary",onClick:ie,disabled:y,children:y?"Saving...":"Save Changes"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>f(!1),children:"Cancel"})]})]}),e.jsxs("div",{className:"modal-footer",children:[!o&&U&&s.status==="scheduled"&&e.jsx("button",{className:"btn btn-primary",onClick:()=>f(!0),children:"Edit Appointment"}),_&&e.jsx("button",{className:"btn btn-success",onClick:se,disabled:y,children:y?"Completing...":"Complete Appointment"}),s.meetingUrl&&s.status==="scheduled"&&e.jsx("a",{href:s.meetingUrl,target:"_blank",rel:"noopener noreferrer",className:"btn btn-primary",children:"Join Call"}),e.jsx("button",{className:"btn btn-secondary",onClick:a,children:"Close"})]})]})})})}const Dt=()=>{const{user:s}=me(),{addNotification:a}=ge(),[t,i]=n.useState([]),[h,l]=n.useState([]),[r,m]=n.useState(!0),[y,c]=n.useState(null),[o,f]=n.useState(!1),[p,g]=n.useState(!1),[v,u]=n.useState(!1),[x,C]=n.useState(null),[A,N]=n.useState({status:"all",date:"upcoming",sortBy:"date-asc"}),[d,S]=n.useState(new Date),[w,k]=n.useState([]);n.useState(null),n.useState(!1);const D=n.useCallback(()=>{let $=[...Array.isArray(t)?t:[]];A.status!=="all"&&($=$.filter(O=>O.status===A.status));const P=new Date;A.date==="upcoming"?$=$.filter(O=>new Date(O.date)>P):A.date==="past"&&($=$.filter(O=>new Date(O.date)<P)),$=$.filter(O=>{const M=new Date(O.date);return M.getFullYear()===d.getFullYear()&&M.getMonth()===d.getMonth()&&M.getDate()===d.getDate()}),l($)},[t,A,d]);n.useCallback(async(K,$=null)=>{try{if($){const P=await gs.getAvailableSlots(K,$);k(P)}else k([])}catch(P){a(`Failed to fetch available slots: ${P.message}`,"error"),k([])}},[a]),n.useEffect(()=>{(async()=>{try{m(!0),console.log("Fetching appointments for patient...");const $=await fetch("http://localhost:5000/api/appointments",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!$.ok)throw new Error("Failed to fetch appointments");const P=await $.json();console.log("Patient appointments API response:",P);let O=[];Array.isArray(P)?O=P:(P&&P.success&&Array.isArray(P.data)||P&&Array.isArray(P.data))&&(O=P.data),console.log("Processed appointments array for patient:",O),i(O),l(O),m(!1)}catch($){c($.message),m(!1),a($.message,"error"),i([]),l([])}})()},[a]),n.useEffect(()=>{D()},[A,t,d,D]),n.useEffect(()=>{k([])},[d]);const b=async K=>{try{if(!(await fetch(`http://localhost:5000/api/appointments/${K}/cancel`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}})).ok)throw new Error("Failed to cancel appointment");i(P=>P.map(O=>O._id===K?{...O,status:"cancelled"}:O)),a("Appointment cancelled successfully","success")}catch($){a($.message,"error")}},T=K=>{i($=>[...$,K]),a("Appointment created successfully","success"),f(!1)},H=K=>{u(!1),C(K),g(!0)},J=K=>{u(!0),C(K),g(!0)},q=K=>{i($=>$.map(P=>P._id===K._id?K:P)),a("Appointment updated successfully","success"),g(!1)};return r?e.jsx("div",{className:"loading-spinner",children:"Loading appointments..."}):e.jsxs("div",{className:"appointments-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"My Appointments"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>f(!0),children:"New Appointment"})]})," ",e.jsx("div",{className:"appointments-list",children:t&&t.length>0?t.map(K=>e.jsx(kt,{appointment:K,onCancel:()=>b(K._id),onViewDetails:H,onEdit:J,isPatient:s.role==="patient"},K._id)):e.jsx("div",{className:"no-appointments",children:"No appointments available"})}),o&&e.jsx(Pt,{onClose:()=>f(!1),onCreate:T,availableSlots:w,selectedDate:d}),p&&x&&e.jsx(ta,{appointment:x,initialEditMode:v,onClose:()=>g(!1),onUpdate:q})]})};function At(){var K,$,P,O,M,Z,se,oe,B,U,_,ce,ie,je,ve,Ce,z,Q,re,ae,ue,le,pe,Ne,E,W,L,G;const[s]=ds(),a=ye(),{user:t}=me(),{addNotification:i}=ge(),[h,l]=n.useState([]),[r,m]=n.useState(null),[y,c]=n.useState([]),[o,f]=n.useState(!0),[p,g]=n.useState(!1),[v,u]=n.useState(!1),[x,C]=n.useState([]),[A,N]=n.useState(1),[d,S]=n.useState({doctorId:s.get("doctorId")||"",date:"",timeSlot:"",reason:"",symptoms:"",notes:"",type:"consultation"});n.useEffect(()=>{w()},[]),n.useEffect(()=>{const F=s.get("doctorId");if(F){k(F);const ne=q();S(de=>({...de,doctorId:F,date:ne,timeSlot:""})),N(2),D(F,ne)}},[]);const w=async()=>{try{f(!0),console.log("Fetching doctors...");const ne=(await xe.get("/doctors")).data;if(ne&&ne.success&&Array.isArray(ne.data))l(ne.data);else if(!Array.isArray(ne))throw new Error("Received invalid data format for doctors list.")}catch(F){console.error("Error fetching doctors:",F),i(`Error: ${F.message}`,"error"),l([])}finally{f(!1)}},k=async F=>{var ne;try{const de=await xe.get(`/doctors/${F}`),fe=((ne=de.data)==null?void 0:ne.data)||de.data;m(fe)}catch(de){console.error("Error fetching doctor:",de)}},D=async(F,ne)=>{try{g(!0),console.log(`Fetching available slots for doctor ${F} on ${ne}`);const fe=(await xe.get(`/doctors/${F}/slots`,{params:{from:ne,to:ne}})).data;console.log("Availability slots response:",fe);const we=fe!=null&&fe.success&&Array.isArray(fe.data)?fe.data:[];c(we),we.length===0&&i("No available slots for the selected date.","info")}catch(de){console.error("Error fetching available slots:",de),i(`Error: ${de.message}`,"error"),c([])}finally{g(!1)}},b=F=>{m(F),k(F._id);const ne=q();S(de=>({...de,doctorId:F._id,date:ne,timeSlot:""})),N(2),D(F._id,ne)},T=F=>{S({...d,date:F,timeSlot:""}),r&&(S(ne=>({...ne,date:F,timeSlot:""})),D(r._id,F))},H=F=>{const ne=F.startTime||F,de=F.id||F._id||ne;S(fe=>({...fe,timeSlot:ne,slotId:de,slotHash:F.slotHash})),N(3)},J=async()=>{var F,ne,de,fe,we,Le;try{u(!0);const be={doctorId:d.doctorId,reason:d.reason,symptoms:d.symptoms?d.symptoms.split(",").map(ze=>ze.trim()):[],caseDetails:d.notes,slotId:d.slotId,slotHash:d.slotHash};if(x.length>0){const ze=[];for(const hs of x){const ts=new FormData;ts.append("file",hs),ts.append("patientId",t._id);const Ye=await xe.post("/medical-documents/upload",ts,{headers:{"Content-Type":"multipart/form-data"}});(F=Ye.data)!=null&&F.success&&((ne=Ye.data.data)!=null&&ne._id)&&ze.push(Ye.data.data._id)}ze.length&&(be.medicalDocumentIds=ze)}console.log("Booking appointment with data:",be);const Ge=(await xe.post("/appointments",be)).data;i((Ge==null?void 0:Ge.message)||"Appointment booked successfully!","success"),a("/appointments")}catch(be){console.error("Error booking appointment:",be);const Ue=((fe=(de=be==null?void 0:be.response)==null?void 0:de.data)==null?void 0:fe.message)||((Le=(we=be==null?void 0:be.response)==null?void 0:we.data)==null?void 0:Le.error);i(Ue?`Error: ${Ue}`:`Error: ${be.message}`,"error")}finally{u(!1)}},q=()=>{const F=new Date;return F.setDate(F.getDate()+1),F.toISOString().split("T")[0]};return o?e.jsx(De,{fullPage:!0}):e.jsxs("div",{className:"new-appointment-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Book New Appointment"}),e.jsxs("div",{className:"step-indicator",children:[e.jsx("div",{className:`step ${A>=1?"active":""}`,children:"1. Select Doctor"}),e.jsx("div",{className:`step ${A>=2?"active":""}`,children:"2. Choose Time"}),e.jsx("div",{className:`step ${A>=3?"active":""}`,children:"3. Confirm"})]})]}),A===1&&e.jsxs("div",{className:"doctor-selection",children:[e.jsx("h2",{children:"Select a Doctor"}),e.jsx("div",{className:"doctors-grid",children:Array.isArray(h)&&h.map(F=>{var ne,de,fe,we,Le,be;return e.jsxs("div",{className:"doctor-card selectable",onClick:()=>b(F),children:[e.jsx("div",{className:"doctor-avatar",children:e.jsx("img",{src:((de=(ne=F.user)==null?void 0:ne.profile)==null?void 0:de.photo)||"/default-doctor.png",alt:((we=(fe=F.user)==null?void 0:fe.profile)==null?void 0:we.fullName)||"Doctor",onError:Ue=>{Ue.target.src="/default-doctor.png"}})}),e.jsxs("div",{className:"doctor-info",children:[e.jsx("h3",{children:((be=(Le=F.user)==null?void 0:Le.profile)==null?void 0:be.fullName)||"Dr. Anonymous"}),e.jsx("p",{className:"specialization",children:F.specialization||"General"}),F.experience&&e.jsxs("p",{className:"experience",children:[F.experience," years experience"]}),F.bio&&e.jsx("p",{className:"bio",children:F.bio})]}),e.jsx("div",{className:"select-button",children:e.jsx("button",{className:"btn primary",children:"Select Doctor"})})]},F._id)})||e.jsx("div",{className:"no-doctors",children:e.jsx("p",{children:"No doctors are available at the moment. Please check back later."})})})]}),A===2&&r&&e.jsxs("div",{className:"time-selection",children:[e.jsxs("div",{className:"selected-doctor-info",children:[e.jsx("h2",{children:"Selected Doctor"}),e.jsxs("div",{className:"doctor-summary",children:[e.jsx("img",{src:(($=(K=r.user)==null?void 0:K.profile)==null?void 0:$.photo)||"/default-doctor.png",alt:((O=(P=r.user)==null?void 0:P.profile)==null?void 0:O.fullName)||`${(Z=(M=r.user)==null?void 0:M.profile)==null?void 0:Z.firstName} ${(oe=(se=r.user)==null?void 0:se.profile)==null?void 0:oe.lastName}`,onError:F=>{F.target.src="/default-doctor.png"}}),e.jsxs("div",{children:[e.jsx("h3",{children:((U=(B=r.user)==null?void 0:B.profile)==null?void 0:U.fullName)||`${(ce=(_=r.user)==null?void 0:_.profile)==null?void 0:ce.firstName} ${(je=(ie=r.user)==null?void 0:ie.profile)==null?void 0:je.lastName}`}),e.jsx("p",{children:r.specialization})]}),e.jsx("button",{className:"btn secondary",onClick:()=>N(1),children:"Change Doctor"})]})]}),e.jsxs("div",{className:"date-time-selection",children:[e.jsx("h3",{children:"Select Date and Time"}),e.jsxs("div",{className:"date-selection",children:[e.jsx("label",{children:"Select Date:"}),e.jsx("input",{type:"date",min:q(),value:d.date,onChange:F=>T(F.target.value),className:"date-input"})]}),d.date&&e.jsxs("div",{className:"time-slots",children:[e.jsx("label",{children:"Available Time Slots:"}),p?e.jsx(De,{}):e.jsx("div",{className:"slots-grid",children:y.length>0?y.map((F,ne)=>{const de=F.startTime||F,fe=d.timeSlot===de,we=F.isAvailable!==!1;return e.jsxs("button",{className:`time-slot ${fe?"selected":""} ${we?"":"unavailable"}`,onClick:()=>H(F),disabled:!we,children:[de,F.endTime&&e.jsxs("span",{className:"slot-duration",children:[" ","- ",F.endTime]})]},F._id||ne)}):e.jsx("p",{children:"No available slots for this date."})})]})]})]}),A===3&&e.jsxs("div",{className:"appointment-confirmation",children:[e.jsx("h2",{children:"Appointment Details"}),e.jsxs("div",{className:"appointment-summary",children:[e.jsxs("div",{className:"summary-section",children:[e.jsx("h3",{children:"Doctor Information"}),e.jsxs("div",{className:"doctor-summary",children:[e.jsx("img",{src:((Ce=(ve=r.user)==null?void 0:ve.profile)==null?void 0:Ce.photo)||"/default-doctor.png",alt:((Q=(z=r.user)==null?void 0:z.profile)==null?void 0:Q.fullName)||`${(ae=(re=r.user)==null?void 0:re.profile)==null?void 0:ae.firstName} ${(le=(ue=r.user)==null?void 0:ue.profile)==null?void 0:le.lastName}`,onError:F=>{F.target.src="/default-doctor.png"}}),e.jsxs("div",{children:[e.jsx("h4",{children:((Ne=(pe=r.user)==null?void 0:pe.profile)==null?void 0:Ne.fullName)||`${(W=(E=r.user)==null?void 0:E.profile)==null?void 0:W.firstName} ${(G=(L=r.user)==null?void 0:L.profile)==null?void 0:G.lastName}`}),e.jsx("p",{children:r.specialization})]})]})]}),e.jsxs("div",{className:"summary-section",children:[e.jsx("h3",{children:"Appointment Details"}),e.jsxs("div",{className:"appointment-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Date:"}),e.jsx("span",{children:new Date(d.date).toLocaleDateString()})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Time:"}),e.jsx("span",{children:d.timeSlot})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Duration:"}),e.jsx("span",{children:"30 minutes"})]})]})]})]}),e.jsxs("div",{className:"appointment-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"reason",children:"Reason for Visit *"}),e.jsx("input",{type:"text",id:"reason",value:d.reason,onChange:F=>S({...d,reason:F.target.value}),placeholder:"Brief description of your concern",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"symptoms",children:"Symptoms"}),e.jsx("input",{type:"text",id:"symptoms",value:d.symptoms,onChange:F=>S({...d,symptoms:F.target.value}),placeholder:"Comma-separated symptoms"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"medicalDocument",children:"Upload Medical Document"}),e.jsx("input",{type:"file",id:"medicalDocument",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",multiple:!0,onChange:F=>C(Array.from(F.target.files))}),x.length>0&&e.jsxs("div",{children:[e.jsx("p",{children:"Selected files:"}),e.jsx("ul",{children:x.map((F,ne)=>e.jsx("li",{children:F.name},ne))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"type",children:"Appointment Type"}),e.jsxs("select",{id:"type",value:d.type,onChange:F=>S({...d,type:F.target.value}),children:[e.jsx("option",{value:"consultation",children:"Consultation"}),e.jsx("option",{value:"follow-up",children:"Follow-up"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"notes",children:"Additional Notes"}),e.jsx("textarea",{id:"notes",value:d.notes,onChange:F=>S({...d,notes:F.target.value}),placeholder:"Any additional information or symptoms...",rows:"4"})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn secondary",onClick:()=>N(2),children:"Back"}),e.jsx("button",{className:"btn primary",onClick:J,disabled:v||!d.reason.trim(),children:v?"Booking...":"Book Appointment"})]})]})]})}function Tt(){var g,v,u,x,C,A,N,d,S,w,k,D;me();const{addNotification:s}=ge(),[a,t]=n.useState([]),[i,h]=n.useState(!0),[l,r]=n.useState(null),[m,y]=n.useState(""),[c,o]=n.useState("all");n.useEffect(()=>{async function b(){try{h(!0);const T=await R.get("/medical-records");if(T.data.success)t(T.data.data);else throw new Error(T.data.message||"Failed to fetch medical records")}catch(T){console.error("Error fetching medical records:",T),s(`Error: ${T.message}`,"error"),t([])}finally{h(!1)}}b()},[]);const f=b=>new Date(b).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),p=Array.isArray(a)?a.filter(b=>{var H,J,q,K,$;const T=((H=b.diagnosis)==null?void 0:H.toLowerCase().includes(m.toLowerCase()))||((J=b.treatment)==null?void 0:J.toLowerCase().includes(m.toLowerCase()))||(($=(K=(q=b.doctor)==null?void 0:q.profile)==null?void 0:K.fullName)==null?void 0:$.toLowerCase().includes(m.toLowerCase()));if(c==="all")return T;if(c==="recent"){const P=new Date(b.date),O=new Date;return O.setDate(O.getDate()-30),T&&P>=O}return T}):[];return i?e.jsx(De,{fullPage:!0}):e.jsxs("div",{className:"medical-records-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"My Medical Records"}),e.jsx("p",{children:"View your complete medical history and records"})]}),e.jsx("div",{className:"records-controls",children:e.jsxs("div",{className:"search-filter-section",children:[e.jsx("div",{className:"search-box",children:e.jsx("input",{type:"text",placeholder:"Search records, diagnoses, treatments...",value:m,onChange:b=>y(b.target.value),className:"search-input"})}),e.jsx("div",{className:"filter-section",children:e.jsxs("select",{value:c,onChange:b=>o(b.target.value),className:"filter-select",children:[e.jsx("option",{value:"all",children:"All Records"}),e.jsx("option",{value:"recent",children:"Last 30 Days"})]})})]})}),e.jsx("div",{className:"records-container",children:p.length===0?e.jsxs("div",{className:"no-records",children:[e.jsx("div",{className:"no-records-icon",children:"📋"}),e.jsx("h3",{children:"No Medical Records Found"}),e.jsx("p",{children:m?"No records match your search criteria.":"You don't have any medical records yet. Records will appear here after your appointments."})]}):e.jsx("div",{className:"records-grid",children:p.map(b=>{var T,H,J,q,K,$,P,O,M;return e.jsxs("div",{className:"record-card",onClick:()=>r(b),children:[e.jsxs("div",{className:"record-header",children:[e.jsx("div",{className:"record-date",children:f(b.date)}),e.jsxs("div",{className:"record-doctor",children:["Dr."," ",((H=(T=b.doctor)==null?void 0:T.profile)==null?void 0:H.firstName)||((J=b.doctor)==null?void 0:J.firstName)," ",((K=(q=b.doctor)==null?void 0:q.profile)==null?void 0:K.lastName)||(($=b.doctor)==null?void 0:$.lastName),!((O=(P=b.doctor)==null?void 0:P.profile)!=null&&O.firstName)&&!((M=b.doctor)!=null&&M.firstName)&&"Unknown Doctor"]})]}),e.jsxs("div",{className:"record-content",children:[e.jsxs("div",{className:"diagnosis",children:[e.jsx("strong",{children:"Diagnosis:"})," ",b.diagnosis]}),b.treatment&&e.jsxs("div",{className:"treatment",children:[e.jsx("strong",{children:"Treatment:"})," ",b.treatment]})]}),b.medications&&b.medications.length>0&&e.jsxs("div",{className:"medications-preview",children:[e.jsx("strong",{children:"Medications:"})," ",b.medications.length," ","prescribed"]}),e.jsx("div",{className:"record-footer",children:e.jsx("span",{className:"view-details",children:"Click to view details →"})})]},b._id)})})}),l&&e.jsx("div",{className:"modal-overlay",onClick:()=>r(null),children:e.jsxs("div",{className:"modal-content record-detail-modal",onClick:b=>b.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Medical Record Details"}),e.jsx("button",{className:"close-btn",onClick:()=>r(null),children:"×"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"record-info-grid",children:[e.jsxs("div",{className:"info-section",children:[e.jsx("h3",{children:"General Information"}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Date:"}),e.jsx("span",{children:f(l.date)})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Doctor:"}),e.jsxs("span",{children:["Dr."," ",((v=(g=l.doctor)==null?void 0:g.profile)==null?void 0:v.firstName)||((u=l.doctor)==null?void 0:u.firstName)," ",((C=(x=l.doctor)==null?void 0:x.profile)==null?void 0:C.lastName)||((A=l.doctor)==null?void 0:A.lastName),!((d=(N=l.doctor)==null?void 0:N.profile)!=null&&d.firstName)&&!((S=l.doctor)!=null&&S.firstName)&&"Unknown Doctor"]})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Specialization:"}),e.jsx("span",{children:((w=l.doctor)==null?void 0:w.specialization)||((D=(k=l.doctor)==null?void 0:k.profile)==null?void 0:D.specialization)||"N/A"})]})]}),e.jsxs("div",{className:"info-section",children:[e.jsx("h3",{children:"Medical Details"}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Diagnosis:"}),e.jsx("span",{children:l.diagnosis})]}),l.treatment&&e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Treatment:"}),e.jsx("span",{children:l.treatment})]}),l.notes&&e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Notes:"}),e.jsx("span",{children:l.notes})]})]}),l.vitals&&Object.keys(l.vitals).length>0&&e.jsxs("div",{className:"info-section",children:[e.jsx("h3",{children:"Vital Signs"}),l.vitals.bloodPressure&&e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Blood Pressure:"}),e.jsx("span",{children:l.vitals.bloodPressure})]}),l.vitals.heartRate&&e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Heart Rate:"}),e.jsxs("span",{children:[l.vitals.heartRate," bpm"]})]}),l.vitals.temperature&&e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Temperature:"}),e.jsxs("span",{children:[l.vitals.temperature,"°F"]})]}),l.vitals.weight&&e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Weight:"}),e.jsxs("span",{children:[l.vitals.weight," lbs"]})]})]}),l.medications&&l.medications.length>0&&e.jsxs("div",{className:"info-section medications-section",children:[e.jsx("h3",{children:"Medications"}),e.jsx("div",{className:"medications-list",children:l.medications.map((b,T)=>e.jsxs("div",{className:"medication-item",children:[e.jsx("div",{className:"medication-name",children:b.name}),e.jsxs("div",{className:"medication-details",children:[e.jsxs("span",{children:["Dosage: ",b.dosage]}),e.jsxs("span",{children:["Frequency: ",b.frequency]}),b.duration&&e.jsxs("span",{children:["Duration: ",b.duration]})]})]},T))})]})]})}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn secondary",onClick:()=>r(null),children:"Close"})})]})})]})}const Et=({patients:s,onSelect:a,selectedPatient:t})=>e.jsxs("div",{className:"patient-list",children:[e.jsx("h3",{children:"My Patients"}),e.jsx("input",{type:"text",placeholder:"Search patients...",className:"patient-search"}),e.jsx("ul",{children:s.map(i=>{var h,l;return e.jsxs("li",{className:(t==null?void 0:t._id)===i._id?"active":"",onClick:()=>a(i),children:[(h=i.profile)==null?void 0:h.firstName," ",(l=i.profile)==null?void 0:l.lastName]},i._id)})})]}),It=({patient:s,onAddNote:a,onCreatePrescription:t,onOrderLabTest:i})=>s?e.jsxs("div",{className:"record-viewer",children:[e.jsxs("div",{className:"record-viewer-header",children:[e.jsxs("h2",{children:["Medical History for ",s.profile.firstName," ",s.profile.lastName]}),e.jsxs("div",{className:"record-actions",children:[e.jsx("button",{className:"btn primary",onClick:a,children:"Add New Note"}),e.jsx("button",{className:"btn",onClick:t,children:"Create Prescription"}),e.jsx("button",{className:"btn",onClick:i,children:"Order Lab Test"})]})]}),e.jsx("div",{className:"records-content",children:e.jsxs("div",{className:"record-item",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," July 23, 2025"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Diagnosis:"})," General Check-up"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Notes:"})," Patient is in good health."]})]})})]}):e.jsx("div",{className:"record-viewer-placeholder",children:e.jsx("h2",{children:"Select a patient to view their medical records."})});function Rt(){me();const{addNotification:s}=ge(),a=ye(),[t,i]=n.useState([]),[h,l]=n.useState(null),[r,m]=n.useState([]),[y,c]=n.useState(!0);n.useEffect(()=>{(async()=>{try{c(!0);const u=await R.get("/doctors/my-patients");if(u.data.success)i(u.data.data);else throw new Error("Failed to fetch patients")}catch(u){console.error("Error fetching doctor's patients:",u),s(u.message||"Could not fetch patient list.","error")}finally{c(!1)}})()},[s]);const o=v=>{l(v)},f=()=>{h&&a(`/doctor/medical-records/new?patientId=${h._id}`)},p=()=>{h&&a(`/doctor/prescriptions/new?patientId=${h._id}`)},g=()=>{h&&a(`/doctor/lab-orders/new?patientId=${h._id}`)};return y?e.jsx(De,{fullPage:!0}):e.jsxs("div",{className:"doctor-medical-records-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Patient Medical Records"}),e.jsx("p",{children:"Manage your patients' health records, prescriptions, and lab orders."})]}),e.jsxs("div",{className:"records-layout",children:[e.jsx(Et,{patients:t,onSelect:o,selectedPatient:h}),e.jsx(It,{patient:h,records:r,onAddNote:f,onCreatePrescription:p,onOrderLabTest:g})]})]})}function Lt(){me();const{addNotification:s}=ge(),a=ye(),{search:t}=cs(),i=new URLSearchParams(t),h=i.get("patientId"),l=i.get("appointmentId"),[r,m]=n.useState(""),[y,c]=n.useState(""),[o,f]=n.useState(!1),p=async g=>{if(g.preventDefault(),!!h)try{f(!0);const v=await R.post("/medical-records",{patientId:h,appointmentId:l,diagnosis:r,notes:y});if(v.data.success)s("Medical record created successfully","success"),a("/doctor/medical-records");else throw new Error(v.data.message||"Failed to create record")}catch(v){console.error(v),s(v.message||"Error creating medical record","error")}finally{f(!1)}};return o?e.jsx(De,{fullPage:!0}):e.jsxs("div",{className:"new-medical-record-page",children:[e.jsx("h1",{children:"New Medical Record"}),e.jsxs("form",{onSubmit:p,className:"record-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Diagnosis"}),e.jsx("input",{type:"text",value:r,onChange:g=>m(g.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes"}),e.jsx("textarea",{value:y,onChange:g=>c(g.target.value),rows:4})]}),e.jsx("button",{type:"submit",className:"btn primary",children:"Save Record"}),e.jsx("button",{type:"button",className:"btn",onClick:()=>a("/doctor/medical-records"),children:"Cancel"})]})]})}function $t(){const s=ye(),{search:a}=cs(),t=new URLSearchParams(a).get("recordId"),{addNotification:i}=ge(),[h,l]=n.useState(""),[r,m]=n.useState(!1),y=async c=>{if(c.preventDefault(),!!t)try{m(!0);const o=await R.put(`/medical-records/${t}`,{prescription:h});if(o.data.success)i("Prescription created successfully","success"),s("/doctor/medical-records");else throw new Error(o.data.message||"Failed to create prescription")}catch(o){console.error(o),i(o.message||"Error creating prescription","error")}finally{m(!1)}};return r?e.jsx(De,{fullPage:!0}):e.jsxs("div",{className:"new-prescription-page",children:[e.jsx("h1",{children:"New Prescription"}),e.jsxs("form",{onSubmit:y,className:"prescription-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Prescription Details"}),e.jsx("textarea",{value:h,onChange:c=>l(c.target.value),rows:4,required:!0})]}),e.jsx("button",{type:"submit",className:"btn primary",children:"Save Prescription"}),e.jsx("button",{type:"button",className:"btn",onClick:()=>s("/doctor/medical-records"),children:"Cancel"})]})]})}function Mt(){const s=ye(),{search:a}=cs(),t=new URLSearchParams(a).get("recordId"),i=new URLSearchParams(a).get("patientId"),[h,l]=n.useState(t),{addNotification:r}=ge();n.useEffect(()=>{!h&&i&&R.get(`/medical-records?patientId=${i}`).then(v=>{v.data.success&&v.data.data.length&&l(v.data.data[0]._id)}).catch(v=>{console.error("Error loading records for lab order:",v)})},[i,h]);const m=["Complete Blood Count","Lipid Panel","Basic Metabolic Panel","Liver Function Test","Thyroid Panel","Hemoglobin A1C","Urinalysis"],[y,c]=n.useState([]),[o,f]=n.useState(!1),p=async v=>{if(v.preventDefault(),!h){r("No medical record found. Please create a medical record first.","error");return}try{f(!0);const u=await R.post("/lab-orders",{recordId:h,labTests:y});if(u.data.success)r("Lab order created successfully","success"),s("/doctor/medical-records");else throw new Error(u.data.message||"Failed to create lab order")}catch(u){console.error(u),r(u.message||"Error creating lab order","error")}finally{f(!1)}},g=v=>{c(u=>u.includes(v)?u.filter(x=>x!==v):[...u,v])};return o?e.jsx(De,{fullPage:!0}):e.jsxs("div",{className:"new-lab-order-page",children:[e.jsx("h1",{children:"New Lab Order"}),e.jsxs("form",{onSubmit:p,className:"lab-order-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Tests"}),e.jsx("div",{className:"tests-options",children:m.map(v=>e.jsxs("div",{className:"test-option",children:[e.jsx("input",{type:"checkbox",id:v,checked:y.includes(v),onChange:()=>g(v)}),e.jsx("label",{htmlFor:v,children:v})]},v))})]}),e.jsx("button",{type:"submit",className:"btn primary",disabled:!h||y.length===0||o,children:"Save Order"}),e.jsx("button",{type:"button",className:"btn",onClick:()=>s("/doctor/medical-records"),children:"Cancel"})]})]})}function Ft(){const{id:s}=We(),a=ye(),{addNotification:t}=ge(),{user:i}=me(),[h,l]=n.useState(null),[r,m]=n.useState(!0);if(n.useEffect(()=>{(async()=>{try{const p=await R.get(`/appointments/${s}`);l(p.data.data)}catch(p){t(p.message||"Failed to load appointment","error"),(i==null?void 0:i.role)==="doctor"?a("/doctor/appointments"):a("/appointments")}finally{m(!1)}})()},[s,t,a,i]),r)return e.jsx(De,{fullPage:!0});const y=()=>{(i==null?void 0:i.role)==="doctor"?a("/doctor/appointments"):a("/appointments")},c=f=>{var v;const p=(v=f.patient)==null?void 0:v._id,g=f._id;a(`/doctor/medical-records/new?patientId=${p}&appointmentId=${g}`)},o=async()=>{if(!h)return;const f=i.role==="doctor"?h.patient._id:h.doctor._id,p=await createSession([i._id,f],h._id);selectSession(p),a(`/chat?sessionId=${p._id}`)};return e.jsxs("div",{className:"appointment-detail-page",children:[e.jsx("button",{onClick:o,className:"btn btn-primary chat-btn",children:"Chat about this appointment"}),e.jsx(ta,{appointment:h,onClose:y,onUpdate:f=>l(f),onCreateMedicalRecord:c})]})}function Ot(){var y,c,o,f,p,g,v,u,x,C,A,N,d,S,w;const{id:s}=We();me();const{addNotification:a}=ge(),[t,i]=n.useState(null),[h,l]=n.useState(!0);n.useEffect(()=>{r()},[s]);const r=async()=>{try{l(!0);const k=await fetch(`http://localhost:5000/api/doctors/${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!k.ok)throw new Error("Failed to fetch doctor details");const D=await k.json();i(D)}catch(k){console.error("Error fetching doctor:",k),a(`Error: ${k.message}`,"error")}finally{l(!1)}};if(h)return e.jsx(De,{fullPage:!0});if(!t)return e.jsx("div",{className:"doctor-profile-view-page",children:e.jsxs("div",{className:"error-message",children:[e.jsx("h2",{children:"Doctor Not Found"}),e.jsx("p",{children:"The requested doctor profile could not be found."}),e.jsx(V,{to:"/doctors",className:"btn primary",children:"Back to Doctors"})]})});const m=()=>{const k=typeof(t==null?void 0:t.verificationStatus)=="string"?/^(approved)$/i.test(t.verificationStatus):!0,D=typeof(t==null?void 0:t.status)=="string"?/^(active)$/i.test(t.status):!0;return k&&D};return e.jsxs("div",{className:"doctor-profile-view-page",children:[e.jsxs("div",{className:"profile-header",children:[e.jsxs("div",{className:"doctor-avatar-section",children:[e.jsx("img",{src:((y=t.profile)==null?void 0:y.avatar)||"/default-doctor.png",alt:(c=t.profile)==null?void 0:c.fullName,className:"doctor-avatar",onError:k=>{k.target.src="/default-doctor.png"}}),e.jsxs("div",{className:"doctor-basic-info",children:[e.jsx("h1",{children:(o=t.profile)==null?void 0:o.fullName}),e.jsx("p",{className:"specialization",children:(f=t.profile)==null?void 0:f.specialization}),((p=t.profile)==null?void 0:p.experience)&&e.jsxs("p",{className:"experience",children:[t.profile.experience," years of experience"]})]})]}),e.jsxs("div",{className:"profile-actions",children:[e.jsx(V,{to:m()?`/appointments/new?doctorId=${t._id}`:"#",className:`btn primary ${m()?"":"disabled"}`,"aria-disabled":!m(),onClick:k=>{m()||k.preventDefault()},title:m()?"":"Doctor not available for booking",children:"Book Appointment"}),e.jsx(V,{to:"/doctors",className:"btn secondary",children:"Back to Doctors"})]})]}),e.jsxs("div",{className:"profile-content",children:[e.jsxs("div",{className:"profile-main",children:[e.jsxs("section",{className:"about-section",children:[e.jsxs("h2",{children:["About Dr. ",((g=t.profile)==null?void 0:g.lastName)||((v=t.profile)==null?void 0:v.fullName)]}),(u=t.profile)!=null&&u.bio?e.jsx("p",{className:"bio",children:t.profile.bio}):e.jsx("p",{className:"no-bio",children:"No biography available."})]}),((x=t.profile)==null?void 0:x.education)&&e.jsxs("section",{className:"education-section",children:[e.jsx("h2",{children:"Education"}),e.jsx("p",{children:t.profile.education})]}),((C=t.profile)==null?void 0:C.licenseNumber)&&e.jsxs("section",{className:"credentials-section",children:[e.jsx("h2",{children:"Credentials"}),e.jsxs("div",{className:"credential-item",children:[e.jsx("strong",{children:"Medical License:"})," ",t.profile.licenseNumber]}),e.jsxs("div",{className:"credential-item",children:[e.jsx("strong",{children:"Verification Status:"}),e.jsx("span",{className:`status ${t.verificationStatus||"pending"}`,children:t.verificationStatus||"Pending"})]})]})]}),e.jsxs("div",{className:"profile-sidebar",children:[e.jsxs("div",{className:"quick-info-card",children:[e.jsx("h3",{children:"Quick Information"}),e.jsxs("div",{className:"info-items",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"label",children:"Specialization:"}),e.jsx("span",{className:"value",children:((A=t.profile)==null?void 0:A.specialization)||"Not specified"})]}),((N=t.profile)==null?void 0:N.experience)&&e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"label",children:"Experience:"}),e.jsxs("span",{className:"value",children:[t.profile.experience," years"]})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"label",children:"Status:"}),e.jsx("span",{className:`value status ${t.status||"active"}`,children:t.status||"Active"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"label",children:"Member Since:"}),e.jsx("span",{className:"value",children:new Date(t.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long"})})]})]})]}),e.jsxs("div",{className:"booking-card",children:[e.jsx("h3",{children:"Book an Appointment"}),e.jsxs("p",{children:["Schedule a consultation with Dr."," ",((d=t.profile)==null?void 0:d.lastName)||((S=t.profile)==null?void 0:S.fullName)]}),e.jsx(V,{to:m()?`/appointments/new?doctorId=${t._id}`:"#",className:`btn primary full-width ${m()?"":"disabled"}`,"aria-disabled":!m(),onClick:k=>{m()||k.preventDefault()},title:m()?"":"Doctor not available for booking",children:"Book Now"}),!m()&&e.jsx("p",{className:"helper-text",children:"This doctor is not currently available for booking."})]}),((w=t.profile)==null?void 0:w.specialization)&&e.jsxs("div",{className:"specialization-card",children:[e.jsx("h3",{children:"Specialization"}),e.jsx("div",{className:"specialization-badge",children:t.profile.specialization}),e.jsxs("p",{children:["Expert care in ",t.profile.specialization.toLowerCase()]})]})]})]})]})}function ee({children:s,roles:a=[]}){const{user:t,loading:i}=me();return i?e.jsx("div",{children:"Loading..."}):t?a.length>0&&!a.includes(t.role)?e.jsx(Cs,{to:"/unauthorized",replace:!0}):s:e.jsx(Cs,{to:"/login",replace:!0})}const ks={getQuestions(){return R.get("/symptom-check/questions").then(s=>s.data.data)},createCheck(s){return R.post("/symptom-check",s).then(a=>a.data.data)},getCheck(s){return R.get(`/symptom-check/${s}`).then(a=>a.data.data)},getHistory(){return R.get("/symptom-check/history").then(s=>s.data.data)}};function _t(){const[s,a]=n.useState([]),[t,i]=n.useState({}),[h,l]=n.useState(!0),r=ye(),{addNotification:m}=ge();n.useEffect(()=>{ks.getQuestions().then(o=>{a(o)}).catch(o=>{console.error("Failed to load questions",o),m("Failed to load symptom questions","error")}).finally(()=>l(!1))},[]);const y=(o,f)=>{i(p=>({...p,[o]:f}))},c=async o=>{o.preventDefault();try{const f={symptoms:Object.entries(t).map(([g,v])=>({questionId:g,answer:v}))},{checkId:p}=await ks.createCheck(f);m("Symptom check submitted","success"),r(`/symptom-check/${p}`)}catch(f){console.error("Error creating symptom check",f),m("Failed to start symptom check","error")}};return h?e.jsx("div",{children:"Loading questions..."}):e.jsxs("div",{className:"symptom-check-page",children:[e.jsx("h1",{children:"Symptom Checker"}),e.jsxs("form",{onSubmit:c,children:[s.map(o=>e.jsxs("div",{children:[e.jsx("label",{children:o.text}),e.jsx("input",{type:"text",value:t[o._id]||"",onChange:f=>y(o._id,f.target.value),required:!0})]},o._id)),e.jsx("button",{type:"submit",children:"Start Check"})]})]})}function Bt(){const{checkId:s}=We(),{user:a}=As(),[t,i]=n.useState(null),[h,l]=n.useState([]),[r,m]=n.useState(!0),{addNotification:y}=ge();return n.useEffect(()=>{let c;const o=async()=>{m(!0);try{const p=await ks.getCheck(s);i(p.check),l(p.answers),p.check.triageLevel==="pending"&&(c=setTimeout(o,5e3))}catch(p){console.error("Failed to load symptom check",p),y("Failed to load symptom check results","error")}finally{m(!1)}};o();const f=Ds({}.VITE_WS_URL||"http://localhost:5000");return a&&a._id&&(f.emit("joinUser",a._id),f.on("symptom-check-complete",({checkId:p})=>{p===s&&o()})),()=>{clearTimeout(c),f.disconnect()}},[s,a]),r?e.jsx("div",{children:"Loading..."}):t?e.jsxs("div",{className:"symptom-check-detail",children:[e.jsx("h1",{children:"Symptom Check Result"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Triage Level:"})," ",t.triageLevel]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Recommendation:"})," ",t.recommendation]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Confidence Score:"})," ",(t.confidenceScore*100).toFixed(1),"%"]}),e.jsx("h2",{children:"Answers"}),e.jsx("ul",{children:h.map(c=>e.jsxs("li",{children:[c.questionId,": ",c.answerValue]},c._id))})]}):e.jsx("div",{children:"Check not found"})}function Ut(){const[s,a]=n.useState([]),[t,i]=n.useState(!0),[h,l]=n.useState(""),[r,m]=n.useState("name"),[y,c]=n.useState(!1),o=ye(),f=async()=>{try{i(!0);const v=await _e.getCategories();a(v)}catch(v){console.log("Error loading categories",v)}finally{i(!1)}};n.useEffect(()=>{f()},[]);const p=async()=>{c(!0),await f(),setTimeout(()=>c(!1),400)},g=n.useMemo(()=>s.filter(v=>{var u;return v.name.toLowerCase().includes(h.toLowerCase())||((u=v.description)==null?void 0:u.toLowerCase().includes(h.toLowerCase()))}).sort((v,u)=>v[r].localeCompare(u[r])),[s,h,r]);return e.jsxs("div",{className:"forum-page",children:[e.jsxs("div",{className:"forum-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"forum-title",children:"Community Forums"}),e.jsx("p",{className:"forum-subtitle",children:"Engage with the community, ask questions, share experiences."})]}),e.jsxs("div",{className:"forum-actions",children:[e.jsxs("button",{className:"btn-secondary",onClick:p,disabled:y,children:[e.jsx(La,{className:"icon-spin "+(y?"spinning":"")}),"Refresh"]}),e.jsxs("button",{className:"btn-primary",disabled:!0,children:[e.jsx(Ys,{className:"icon"})," New Category"]})]})]}),e.jsxs("div",{className:"forum-toolbar",children:[e.jsxs("div",{className:"search-box",children:[e.jsx(Qs,{className:"search-icon"}),e.jsx("input",{placeholder:"Search categories...",value:h,onChange:v=>l(v.target.value)})]}),e.jsxs("div",{className:"sort-box",children:[e.jsx("label",{children:"Sort:"}),e.jsxs("select",{value:r,onChange:v=>m(v.target.value),children:[e.jsx("option",{value:"name",children:"Name A-Z"}),e.jsx("option",{value:"createdAt",children:"Newest"})]})]})]}),t?e.jsx("div",{className:"cards-grid",children:Array.from({length:3}).map((v,u)=>e.jsx("div",{className:"card skeleton"},u))}):e.jsxs("div",{className:"cards-grid",children:[g.map(v=>e.jsxs("div",{className:"card category-card",onClick:()=>o(`/forums/categories/${v._id}/threads`),children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:v.name})}),e.jsx("p",{className:"card-desc",children:v.description}),e.jsx("div",{className:"card-meta",children:e.jsxs("span",{children:["Created ",new Date(v.createdAt).toLocaleDateString()]})})]},v._id)),g.length===0&&e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"No categories match your search."}),e.jsx("button",{className:"btn-secondary",onClick:()=>l(""),children:"Clear Search"})]})]})]})}function zt(){const{categoryId:s}=We(),[a,t]=n.useState([]),[i,h]=n.useState(!0),[l,r]=n.useState(""),[m,y]=n.useState("newest"),[c,o]=n.useState(!1),[f,p]=n.useState(""),[g,v]=n.useState(null),u=ye(),x=async()=>{try{h(!0);const N=await _e.getCategories();v(N.find(S=>S._id===s)||null);const d=await _e.getThreads(s);t(d.threads)}catch(N){console.log("Error loading threads",N)}finally{h(!1)}};n.useEffect(()=>{x()},[s]);const C=n.useMemo(()=>a.filter(N=>N.title.toLowerCase().includes(l.toLowerCase())).sort((N,d)=>m==="newest"?new Date(d.createdAt)-new Date(N.createdAt):m==="oldest"?new Date(N.createdAt)-new Date(d.createdAt):N.title.localeCompare(d.title)),[a,l,m]),A=async N=>{if(N.preventDefault(),!!f.trim())try{await _e.createThread({categoryId:s,title:f}),p(""),o(!1),x()}catch(d){console.log("Error creating thread",d)}};return e.jsxs("div",{className:"forum-page",children:[e.jsxs("div",{className:"forum-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"forum-title",children:g?g.name:"Threads"}),g&&e.jsx("p",{className:"forum-subtitle",children:g.description})]}),e.jsx("div",{className:"forum-actions",children:e.jsxs("button",{className:"btn-primary",onClick:()=>o(!0),children:[e.jsx(Ys,{className:"icon"})," New Discussion"]})})]}),e.jsxs("div",{className:"forum-toolbar",children:[e.jsxs("div",{className:"search-box",children:[e.jsx(Qs,{className:"search-icon"}),e.jsx("input",{placeholder:"Search discussions...",value:l,onChange:N=>r(N.target.value)})]}),e.jsxs("div",{className:"sort-box",children:[e.jsx("label",{children:"Sort:"}),e.jsxs("select",{value:m,onChange:N=>y(N.target.value),children:[e.jsx("option",{value:"newest",children:"Newest"}),e.jsx("option",{value:"oldest",children:"Oldest"}),e.jsx("option",{value:"title",children:"Title A-Z"})]})]})]}),i?e.jsx("div",{className:"cards-grid",children:Array.from({length:4}).map((N,d)=>e.jsx("div",{className:"card skeleton"},d))}):e.jsxs("div",{className:"thread-cards",children:[C.map(N=>{var d,S,w,k;return e.jsx("div",{className:"thread-card",onClick:()=>u(`/forums/threads/${N._id}`),children:e.jsxs("div",{className:"thread-card-main",children:[e.jsx("h2",{children:N.title}),e.jsxs("div",{className:"thread-meta",children:[e.jsxs("span",{children:[e.jsx(es,{className:"meta-icon"})," ",N.postsCount||0," posts"]}),e.jsxs("span",{children:["By ",(S=(d=N.authorId)==null?void 0:d.profile)==null?void 0:S.firstName," ",(k=(w=N.authorId)==null?void 0:w.profile)==null?void 0:k.lastName]}),e.jsx("span",{children:new Date(N.createdAt).toLocaleDateString()})]})]})},N._id)}),C.length===0&&e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"No discussions found."}),e.jsx("button",{className:"btn-secondary",onClick:()=>o(!0),children:"Start first discussion"})]})]}),c&&e.jsx("div",{className:"modal-backdrop",onClick:()=>o(!1),children:e.jsxs("div",{className:"modal",onClick:N=>N.stopPropagation(),children:[e.jsx("h3",{children:"Start a New Discussion"}),e.jsxs("form",{onSubmit:A,className:"modal-form",children:[e.jsx("input",{value:f,onChange:N=>p(N.target.value),placeholder:"Discussion title",maxLength:120,required:!0}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>o(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",children:"Create"})]})]})]})})]})}function Ke({children:s,restricted:a=!1}){const{user:t}=me();if(t&&a){const i=t.role==="doctor"?"/doctor/appointments":"/appointments";return e.jsx(Cs,{to:i,replace:!0})}return s}function qt(){const{threadId:s}=We(),{addNotification:a}=ge();As();const[t,i]=n.useState(null),[h,l]=n.useState([]),[r,m]=n.useState(new Set),[y,c]=n.useState(""),[o,f]=n.useState(!0),[p,g]=n.useState(1),[v,u]=n.useState(1),x=async(d=1)=>{f(!0);try{const S=await _e.getThread(s,d);i(S.thread),l(S.posts),u(S.pagination.pages),g(S.pagination.page)}catch(S){console.log("Error loading thread detail",S),a("Failed to load thread","error")}finally{f(!1)}};n.useEffect(()=>{x(p)},[s]);const C=async d=>{if(d.preventDefault(),!!y.trim())try{await _e.createPost(s,y),c(""),a("Reply posted","success"),x(1)}catch(S){console.log("Error posting reply",S),a("Failed to post reply","error")}},A=async d=>{try{const S=await _e.toggleLike(d);m(w=>{const k=new Set(w);return S.liked?k.add(d):k.delete(d),k})}catch(S){console.log("Error toggling like",S),a("Failed to toggle like","error")}},N=async d=>{const S=window.prompt("Reason for reporting this post:");if(S)try{await _e.reportPost(d,S),a("Post reported","success")}catch(w){console.log("Error reporting post",w),a("Failed to report post","error")}};return o?e.jsx("div",{children:"Loading thread..."}):t?e.jsxs("div",{className:"thread-detail-page",children:[e.jsx("h1",{children:t.title}),e.jsx("div",{className:"posts-list",children:h.map(d=>e.jsxs("div",{className:"post-item",children:[e.jsxs("p",{children:[e.jsxs("strong",{children:[d.authorId.profile.firstName," ",d.authorId.profile.lastName]})," ","said:"]}),e.jsx("div",{children:d.content}),e.jsxs("div",{className:"post-actions",children:[e.jsx("button",{onClick:()=>A(d._id),children:r.has(d._id)?"Unlike":"Like"}),e.jsx("button",{onClick:()=>N(d._id),children:"Report"})]})]},d._id))}),e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{disabled:p<=1,onClick:()=>x(p-1),children:"Previous"}),e.jsxs("span",{children:["Page ",p," of ",v]}),e.jsx("button",{disabled:p>=v,onClick:()=>x(p+1),children:"Next"})]}),e.jsxs("form",{onSubmit:C,className:"reply-form",children:[e.jsx("textarea",{value:y,onChange:d=>c(d.target.value),rows:4,placeholder:"Write your reply...",required:!0}),e.jsx("button",{type:"submit",children:"Submit Reply"})]})]}):e.jsx("div",{children:"Thread not found"})}const Ht=()=>e.jsxs("div",{className:"not-found-page",children:[e.jsx("h1",{children:"404 - Page Not Found"}),e.jsx("p",{children:"Sorry, the page you are looking for does not exist."}),e.jsx(V,{to:"/",className:"home-link",children:"Go Back to Home"})]});function Vt(){const s=ye(),{user:a}=me(),{addNotification:t}=ge(),[i,h]=n.useState(!0),[l,r]=n.useState({firstName:"",lastName:"",phone:"",specialization:"",licenseNumber:"",bio:"",education:[],experience:[]}),[m,y]=n.useState({institution:"",degree:"",year:""}),[c,o]=n.useState({position:"",organization:"",years:""});n.useEffect(()=>{(async()=>{var d,S,w,k,D,b,T,H;try{h(!0);const J=await fetch("http://localhost:5000/api/doctors/profile",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!J.ok)throw new Error("Failed to fetch profile");const q=await J.json();r({firstName:((d=q.profile)==null?void 0:d.firstName)||"",lastName:((S=q.profile)==null?void 0:S.lastName)||"",phone:((w=q.profile)==null?void 0:w.phone)||"",specialization:((k=q.profile)==null?void 0:k.specialization)||"",licenseNumber:((D=q.profile)==null?void 0:D.licenseNumber)||"",bio:((b=q.profile)==null?void 0:b.bio)||"",education:((T=q.profile)==null?void 0:T.education)||[],experience:((H=q.profile)==null?void 0:H.experience)||[]})}catch(J){t(`Error: ${J.message}`,"error")}finally{h(!1)}})()},[t]);const f=N=>{const{name:d,value:S}=N.target;r({...l,[d]:S})},p=N=>{const{name:d,value:S}=N.target;y({...m,[d]:S})},g=N=>{const{name:d,value:S}=N.target;o({...c,[d]:S})},v=()=>{if(!m.institution||!m.degree){t("Please fill in institution and degree","error");return}r({...l,education:[...l.education,{...m,id:Date.now()}]}),y({institution:"",degree:"",year:""})},u=N=>{r({...l,education:l.education.filter(d=>d.id!==N)})},x=()=>{if(!c.position||!c.organization){t("Please fill in position and organization","error");return}r({...l,experience:[...l.experience,{...c,id:Date.now()}]}),o({position:"",organization:"",years:""})},C=N=>{r({...l,experience:l.experience.filter(d=>d.id!==N)})},A=async N=>{var d;N.preventDefault();try{if(!(await fetch("http://localhost:5000/api/doctors/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({profile:l})})).ok)throw new Error("Failed to update profile");t("Profile updated successfully","success"),!((d=a.profile)!=null&&d.isVerified)&&l.licenseNumber&&l.specialization&&s("/doctor/verification")}catch(S){t(`Error: ${S.message}`,"error")}};return i?e.jsx(De,{}):e.jsxs("div",{className:"doctor-page profile-page",children:[e.jsx("h1",{children:"Doctor Profile"}),e.jsx("p",{children:"Manage your profile information visible to patients."}),e.jsxs("form",{onSubmit:A,className:"profile-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{children:"Basic Information"}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"First Name"}),e.jsx("input",{type:"text",name:"firstName",value:l.firstName,onChange:f,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Last Name"}),e.jsx("input",{type:"text",name:"lastName",value:l.lastName,onChange:f,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone Number"}),e.jsx("input",{type:"tel",name:"phone",value:l.phone,onChange:f})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Specialization"}),e.jsxs("select",{name:"specialization",value:l.specialization,onChange:f,required:!0,children:[e.jsx("option",{value:"",children:"Select Specialization"}),e.jsx("option",{value:"Cardiology",children:"Cardiology"}),e.jsx("option",{value:"Dermatology",children:"Dermatology"}),e.jsx("option",{value:"Endocrinology",children:"Endocrinology"}),e.jsx("option",{value:"Gastroenterology",children:"Gastroenterology"}),e.jsx("option",{value:"Neurology",children:"Neurology"}),e.jsx("option",{value:"Obstetrics",children:"Obstetrics"}),e.jsx("option",{value:"Oncology",children:"Oncology"}),e.jsx("option",{value:"Ophthalmology",children:"Ophthalmology"}),e.jsx("option",{value:"Orthopedics",children:"Orthopedics"}),e.jsx("option",{value:"Pediatrics",children:"Pediatrics"}),e.jsx("option",{value:"Psychiatry",children:"Psychiatry"}),e.jsx("option",{value:"Urology",children:"Urology"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"License Number"}),e.jsx("input",{type:"text",name:"licenseNumber",value:l.licenseNumber,onChange:f,required:!0})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{children:"About You"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Professional Bio"}),e.jsx("textarea",{name:"bio",value:l.bio,onChange:f,rows:"4",placeholder:"Tell patients about yourself, your approach to medicine, and what they can expect from your care."})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{children:"Education"}),e.jsx("div",{className:"items-list",children:l.education.map((N,d)=>e.jsxs("div",{className:"list-item",children:[e.jsxs("div",{className:"item-content",children:[e.jsx("h4",{children:N.degree}),e.jsxs("p",{children:[N.institution," ",N.year?`- ${N.year}`:""]})]}),e.jsx("button",{type:"button",className:"btn-sm danger",onClick:()=>u(N.id),children:"Remove"})]},N.id||d))}),e.jsxs("div",{className:"add-item-form",children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Institution"}),e.jsx("input",{type:"text",name:"institution",value:m.institution,onChange:p})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Degree/Certificate"}),e.jsx("input",{type:"text",name:"degree",value:m.degree,onChange:p})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Year"}),e.jsx("input",{type:"text",name:"year",value:m.year,onChange:p})]})]}),e.jsx("button",{type:"button",className:"btn secondary",onClick:v,children:"Add Education"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{children:"Experience"}),e.jsx("div",{className:"items-list",children:l.experience.map((N,d)=>e.jsxs("div",{className:"list-item",children:[e.jsxs("div",{className:"item-content",children:[e.jsx("h4",{children:N.position}),e.jsxs("p",{children:[N.organization," ",N.years?`- ${N.years}`:""]})]}),e.jsx("button",{type:"button",className:"btn-sm danger",onClick:()=>C(N.id),children:"Remove"})]},N.id||d))}),e.jsxs("div",{className:"add-item-form",children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Position"}),e.jsx("input",{type:"text",name:"position",value:c.position,onChange:g})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Organization"}),e.jsx("input",{type:"text",name:"organization",value:c.organization,onChange:g})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Years"}),e.jsx("input",{type:"text",name:"years",value:c.years,onChange:g,placeholder:"e.g. 2018-2022"})]})]}),e.jsx("button",{type:"button",className:"btn secondary",onClick:x,children:"Add Experience"})]})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"btn primary",children:"Save Profile"})})]})]})}function Jt(){var _,ce,ie,je,ve,Ce;me();const{addNotification:s}=ge(),[a,t]=n.useState(!0),[i,h]=n.useState([]),[l,r]=n.useState("monday"),[m,y]=n.useState(null),[c,o]=n.useState(null),[f,p]=n.useState([]),[g,v]=n.useState(null),[u,x]=n.useState(!1),[C,A]=n.useState(null),[N,d]=n.useState(!1),S=14,[w,k]=n.useState({start:"09:00",end:"17:00",slotDuration:30,dirty:!1}),[D,b]=n.useState([]),[T,H]=n.useState("AppendMissing"),J=[{id:"monday",label:"Monday"},{id:"tuesday",label:"Tuesday"},{id:"wednesday",label:"Wednesday"},{id:"thursday",label:"Thursday"},{id:"friday",label:"Friday"},{id:"saturday",label:"Saturday"},{id:"sunday",label:"Sunday"}],q=(z,Q,re)=>{const ae=[];if(!z||!Q)return ae;let[ue,le]=z.split(":").map(Number),[pe,Ne]=Q.split(":").map(Number),E=ue*60+le;const W=pe*60+Ne;for(;E+re<=W;){const L=Math.floor(E/60).toString().padStart(2,"0"),G=(E%60).toString().padStart(2,"0");ae.push(`${L}:${G}`),E+=re}return ae},K=async()=>{var z;if(!(!m||!c))try{const Q=new Date;Q.setDate(Q.getDate()+1);const re=new Date(Q);re.setDate(re.getDate()+S);const ae=await xe.post(`/doctors/${c}/availability/preview`,{rulesJson:m.rulesJSON,from:Q.toISOString().slice(0,10),to:re.toISOString().slice(0,10)});if((z=ae.data)!=null&&z.success){p(ae.data.data.generated||[]),v(ae.data.data.summary||null),b(ae.data.data.conflicts||[]);const ue={generated:ae.data.data.generated||[],summary:ae.data.data.summary,conflicts:ae.data.data.conflicts||[],from:Q.toISOString().slice(0,10),to:re.toISOString().slice(0,10),generatedAt:Date.now(),rulesHash:JSON.stringify(m.rulesJSON||{})};try{localStorage.setItem(`availability_preview_${c}`,JSON.stringify(ue))}catch{}A({from:ue.from,to:ue.to,generatedAt:ue.generatedAt,hash:ue.rulesHash}),s("Preview generated. Publish to persist.","info"),N&&oe()}}catch(Q){console.error("Preview failed",Q),s("Preview failed","warning")}};n.useEffect(()=>{(async()=>{var Q;if(c)try{t(!0);const ae=(Q=(await xe.get(`/doctors/${c}/availability/template`)).data)==null?void 0:Q.data;if(ae){y(ae);const ue={MON:"monday",TUE:"tuesday",WED:"wednesday",THU:"thursday",FRI:"friday",SAT:"saturday",SUN:"sunday"},le=Object.entries(ae.rulesJSON.weekdays||{}).flatMap(([pe,Ne])=>Ne.map(E=>({day:ue[pe],startTime:E.start,endTime:E.end,slotDuration:ae.rulesJSON.slotLengthMinutes||30,slots:q(E.start,E.end,ae.rulesJSON.slotLengthMinutes||30)})));h(le);try{const pe=`availability_preview_${c}`,Ne=localStorage.getItem(pe);if(Ne){const E=JSON.parse(Ne),W=JSON.stringify(ae.rulesJSON||{});E.rulesHash===W&&(p(E.generated||[]),v(E.summary||null),b(E.conflicts||[]),A({from:E.from,to:E.to,generatedAt:E.generatedAt,hash:E.rulesHash}))}}catch{}}}catch(re){console.error("Template load failed",re),s("Failed to load availability template","warning")}finally{t(!1)}})()},[c,s]);const $=z=>{r(z);const Q=i.find(re=>re.day===z);k(Q?{start:Q.startTime,end:Q.endTime,slotDuration:Q.slotDuration,dirty:!1}:{start:"09:00",end:"17:00",slotDuration:30,dirty:!1})},P=z=>k(Q=>({...Q,start:z.target.value,dirty:!0})),O=z=>k(Q=>({...Q,end:z.target.value,dirty:!0})),M=z=>k(Q=>({...Q,slotDuration:parseInt(z.target.value,10),dirty:!0})),Z=async()=>{var z;try{if(!c)return;const re={monday:"MON",tuesday:"TUE",wednesday:"WED",thursday:"THU",friday:"FRI",saturday:"SAT",sunday:"SUN"}[l],ae=m?{...m,rulesJSON:{...m.rulesJSON,weekdays:{...m.rulesJSON.weekdays||{}}}}:{id:null,version:0,rulesJSON:{weekdays:{},slotLengthMinutes:w.slotDuration,bufferMinutes:0},timeZone:"UTC"},le=(ae.rulesJSON.weekdays[re]||[]).filter(L=>!(L.start===w.start&&L.end===w.end));le.push({start:w.start,end:w.end}),le.sort((L,G)=>L.start<G.start?-1:L.start>G.start?1:0),ae.rulesJSON.weekdays[re]=le,ae.rulesJSON.slotLengthMinutes=w.slotDuration,y(ae);const pe=q(w.start,w.end,w.slotDuration),Ne={day:l,startTime:w.start,endTime:w.end,slotDuration:w.slotDuration,slots:pe};h(L=>[...L.filter(F=>!(F.day===l&&F.startTime===w.start&&F.endTime===w.end)),Ne]),k(L=>({...L,dirty:!1}));const E=new Date;E.setDate(E.getDate()+1);const W=new Date(E);W.setDate(W.getDate()+S);try{const L=await xe.post(`/doctors/${c}/availability/preview`,{rulesJson:ae.rulesJSON,from:E.toISOString().slice(0,10),to:W.toISOString().slice(0,10)});if((z=L.data)!=null&&z.success){p(L.data.data.generated||[]),v(L.data.data.summary),b(L.data.data.conflicts||[]);const G={generated:L.data.data.generated||[],summary:L.data.data.summary,conflicts:L.data.data.conflicts||[],from:E.toISOString().slice(0,10),to:W.toISOString().slice(0,10),generatedAt:Date.now(),rulesHash:JSON.stringify(ae.rulesJSON||{})};try{localStorage.setItem(`availability_preview_${c}`,JSON.stringify(G))}catch{}A({from:G.from,to:G.to,generatedAt:G.generatedAt,hash:G.rulesHash}),s("Preview generated. Publish to persist.","info"),N&&oe(ae)}}catch(L){console.error("Preview failed",L),s("Preview failed","warning")}}catch(Q){console.error("Error adding availability:",Q),s("Failed to update availability","error")}},se=async z=>{try{if(!m||!c)return;const re={monday:"MON",tuesday:"TUE",wednesday:"WED",thursday:"THU",friday:"FRI",saturday:"SAT",sunday:"SUN"}[z],ae={...m,rulesJSON:{...m.rulesJSON,weekdays:{...m.rulesJSON.weekdays||{}}}};delete ae.rulesJSON.weekdays[re],y(ae),h(ue=>ue.filter(le=>le.day!==z)),l===z&&k({start:"09:00",end:"17:00",slotDuration:30,dirty:!1}),s("Day removed (publish to persist).","warning")}catch(Q){console.error("Error removing availability:",Q),s("Unable to connect to server","error")}},oe=async z=>{var re,ae;z&&(z.nativeEvent||z.target)&&(z=null);const Q=z||m;if(!(!Q||!c)){x(!0);try{const ue=new Date;ue.setDate(ue.getDate()+1);const le=new Date(ue);le.setDate(le.getDate()+S);const pe=await xe.post(`/doctors/${c}/availability/publish`,{rulesJson:Q.rulesJSON,baseVersion:Q.version,from:ue.toISOString().slice(0,10),to:le.toISOString().slice(0,10),regenerateMode:T});(re=pe.data)!=null&&re.success?(y(Ne=>({...z||Ne,version:pe.data.data.newVersion})),s(`Published availability (added ${pe.data.data.added}, kept ${pe.data.data.kept})`,"success")):s("Publish failed","error")}catch(ue){console.error("Publish error",ue);const le=(ae=ue.response)==null?void 0:ae.data;let pe=(le==null?void 0:le.message)||"Publish failed";le!=null&&le.stage&&(pe+=` (stage: ${le.stage})`),le!=null&&le.errorType&&(pe+=` [${le.errorType}]`),s(pe,"error")}finally{x(!1)}}},B=z=>{try{if(!m)return;const re={monday:"MON",tuesday:"TUE",wednesday:"WED",thursday:"THU",friday:"FRI",saturday:"SAT",sunday:"SUN"}[l],ae={...m,rulesJSON:{...m.rulesJSON,weekdays:{...m.rulesJSON.weekdays||{}}}},ue=(ae.rulesJSON.weekdays[re]||[]).filter(le=>!(le.start===z.startTime&&le.end===z.endTime));ue.length===0?delete ae.rulesJSON.weekdays[re]:ae.rulesJSON.weekdays[re]=ue,y(ae),h(le=>le.filter(pe=>!(pe.day===l&&pe.startTime===z.startTime&&pe.endTime===z.endTime))),s("Block removed (publish to persist).","warning")}catch(Q){console.error("Remove block failed",Q),s("Failed removing block","error")}};if(a)return e.jsx(De,{});const U=i.filter(z=>z.day===l).sort((z,Q)=>z.startTime<Q.startTime?-1:z.startTime>Q.startTime?1:0);return U[0],e.jsxs("div",{className:"doctor-page availability-page",children:[e.jsx("h1",{children:"Set Your Availability"}),e.jsx("p",{children:"Configure when you're available to see patients."}),e.jsxs("div",{className:"availability-container",children:[e.jsxs("div",{className:"days-sidebar",children:[e.jsx("h3",{children:"Days"}),e.jsx("div",{className:"days-list",children:J.map(z=>e.jsxs("div",{className:`day-item ${l===z.id?"selected":""} ${i.some(Q=>Q.day===z.id)?"has-availability":""}`,onClick:()=>$(z.id),children:[e.jsx("span",{className:"day-name",children:z.label}),i.some(Q=>Q.day===z.id)&&e.jsx("span",{className:"availability-indicator",children:"✓"})]},z.id))})]}),e.jsxs("div",{className:"day-config",children:[e.jsxs("div",{className:"day-header",style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:"0.5rem"},children:[e.jsx("h2",{style:{margin:0},children:(_=J.find(z=>z.id===l))==null?void 0:_.label}),U.length>0&&e.jsx("button",{className:"btn-sm danger",onClick:()=>se(l),children:"Remove Availability"}),e.jsx("button",{className:"btn secondary",disabled:!m||u||!((ce=m==null?void 0:m.rulesJSON)!=null&&ce.weekdays)||Object.keys(m.rulesJSON.weekdays).length===0,onClick:()=>oe(),children:u?"Publishing...":"Publish Changes"}),e.jsx("button",{className:"btn outline",onClick:K,disabled:!m||u,children:"Preview"}),e.jsxs("label",{style:{fontSize:"0.75rem",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("input",{type:"checkbox",checked:N,onChange:z=>d(z.target.checked)})," ","Auto publish after preview"]})]}),e.jsxs("div",{className:"time-config",children:[e.jsxs("div",{className:"time-inputs",children:[e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Start Time"}),e.jsx("input",{type:"time",value:w.start,onChange:P})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"End Time"}),e.jsx("input",{type:"time",value:w.end,onChange:O})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Appointment Duration (minutes)"}),e.jsxs("select",{value:w.slotDuration,onChange:M,children:[e.jsx("option",{value:15,children:"15 min"}),e.jsx("option",{value:30,children:"30 min"}),e.jsx("option",{value:45,children:"45 min"}),e.jsx("option",{value:60,children:"60 min"})]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:"0.5rem",marginTop:"0.75rem"},children:[e.jsx("button",{className:"btn primary",onClick:Z,disabled:!l||!w.start||!w.end||w.start>=w.end,children:U.length>0?"Add Block & Preview":"Add & Preview"}),e.jsx("button",{className:"btn secondary",disabled:!m||u||!((ie=m==null?void 0:m.rulesJSON)!=null&&ie.weekdays)||Object.keys(m.rulesJSON.weekdays).length===0,onClick:()=>oe(),children:u?"Publishing...":"Publish Changes"}),!u&&(m==null?void 0:m.rulesJSON)&&(!m.rulesJSON.weekdays||Object.keys(m.rulesJSON.weekdays).length===0)&&e.jsx("span",{style:{fontSize:"0.75rem",color:"#c00"},children:"Add at least one block first"}),e.jsxs("div",{style:{marginLeft:"auto"},children:[e.jsx("label",{style:{fontSize:"0.85rem",display:"block"},children:"Regenerate Mode"}),e.jsxs("select",{value:T,onChange:z=>H(z.target.value),disabled:u,children:[e.jsx("option",{value:"AppendMissing",children:"Append Missing"}),e.jsx("option",{value:"ReplaceUnbooked",children:"Replace Unbooked"})]})]})]})]})]})]}),U.length>0&&e.jsxs("div",{className:"time-slots-preview",children:[e.jsxs("h3",{children:["Draft Time Slots for ",(je=J.find(z=>z.id===l))==null?void 0:je.label]}),U.map((z,Q)=>e.jsxs("div",{style:{marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsxs("strong",{style:{marginRight:"0.5rem"},children:["Block ",Q+1,": ",z.startTime," - ",z.endTime]}),e.jsx("button",{className:"btn-xs danger",onClick:()=>B(z),style:{marginLeft:"0.5rem"},children:"Remove Block"})]}),e.jsx("div",{className:"slots-container",children:z.slots&&z.slots.length>0?z.slots.map((re,ae)=>e.jsxs("div",{className:`time-slot ${re.available?"available":"booked"}`,children:[re.time,re.available?" (Available)":" (Booked)"]},ae)):e.jsx("div",{className:"no-slots",children:"No slots"})})]},Q)),e.jsxs("button",{className:"btn danger",onClick:()=>se(l),children:["Remove All Availability for"," ",(ve=J.find(z=>z.id===l))==null?void 0:ve.label]})]}),U.length===0&&e.jsxs("div",{className:"no-availability",children:[e.jsxs("p",{children:["No availability set for"," ",(Ce=J.find(z=>z.id===l))==null?void 0:Ce.label]}),e.jsx("p",{children:"Use the form above to add your available hours."})]}),g&&e.jsxs("div",{className:"preview-summary",style:{marginTop:"1.5rem"},children:[e.jsxs("h3",{children:["Last Preview Summary (next ",S," days)"]}),e.jsxs("p",{children:["Generated Slots: ",g.generated]}),e.jsxs("p",{children:["Conflicts: ",g.conflicts]}),C&&e.jsxs("p",{style:{fontSize:"0.7rem",opacity:.7},children:["From ",C.from," to ",C.to," • Generated"," ",new Date(C.generatedAt).toLocaleTimeString()," •"," ",JSON.stringify((m==null?void 0:m.rulesJSON)||{})===C.hash?"Up to date":"May be stale"]}),e.jsx("p",{className:"hint",children:"Preview shows potential slots. Publishing writes them as bookable slots (keeps existing booked ones)."}),D&&D.length>0&&e.jsxs("div",{className:"conflicts",style:{marginTop:"0.75rem"},children:[e.jsxs("h4",{children:["Conflicts (",D.length,")"]}),e.jsx("ul",{style:{maxHeight:"160px",overflowY:"auto"},children:D.slice(0,25).map((z,Q)=>e.jsxs("li",{style:{fontSize:"0.8rem"},children:[z.date?`${z.date} `:"",z.start&&z.end?`${z.start}-${z.end}`:"slot",z.reason?`: ${z.reason}`:""]},Q))}),D.length>25&&e.jsxs("div",{style:{fontSize:"0.7rem",opacity:.7},children:["Showing first 25 of ",D.length," conflicts"]})]})]})]})}const Wt=()=>{const[s,a]=n.useState([]),[t,i]=n.useState(!0),[h,l]=n.useState(null),{user:r}=me(),m=ye();return n.useEffect(()=>{(async()=>{if(r)try{i(!0);const c=await R.get("/appointments");let o=[];c.data&&c.data.data&&Array.isArray(c.data.data.appointments)?o=c.data.data.appointments:c.data&&Array.isArray(c.data.data)?o=c.data.data:Array.isArray(c.data)&&(o=c.data),console.log("Processed Doctor appointments array:",o),a(o)}catch(c){console.error("Error fetching doctor appointments:",c),l(c.message||"Failed to fetch appointments."),a([])}finally{i(!1)}})()},[r]),t?e.jsx("div",{className:"text-center p-4",children:"Loading appointments..."}):h?e.jsxs("div",{className:"text-red-500 text-center p-4",children:["Error: ",h]}):e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"My Appointments"}),e.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:e.jsxs("table",{className:"min-w-full leading-normal",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Patient"}),e.jsx("th",{className:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Date & Time"}),e.jsx("th",{className:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:Array.isArray(s)&&s.length>0?s.map(y=>{var c,o,f,p;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-5 py-5 border-b border-gray-200 bg-white text-sm",children:e.jsxs("p",{className:"text-gray-900 whitespace-no-wrap",children:[(o=(c=y.patient)==null?void 0:c.profile)==null?void 0:o.firstName," ",((p=(f=y.patient)==null?void 0:f.profile)==null?void 0:p.lastName)||"N/A"]})}),e.jsx("td",{className:"px-5 py-5 border-b border-gray-200 bg-white text-sm",children:e.jsx("p",{className:"text-gray-900 whitespace-no-wrap",children:new Date(y.startTime||y.date).toLocaleString()})}),e.jsx("td",{className:"px-5 py-5 border-b border-gray-200 bg-white text-sm",children:e.jsxs("span",{className:"relative inline-block px-3 py-1 font-semibold text-green-900 leading-tight",children:[e.jsx("span",{"aria-hidden":!0,className:"absolute inset-0 bg-green-200 opacity-50 rounded-full"}),e.jsx("span",{className:"relative",children:y.status})]})}),e.jsxs("td",{className:"px-5 py-5 border-b border-gray-200 bg-white text-sm",children:[e.jsx("button",{className:"text-blue-500 hover:text-blue-700 mr-3",onClick:()=>m(`/appointments/${y._id}`),children:"View Details"}),e.jsx("button",{className:"text-green-600 hover:text-green-800",onClick:()=>m(`/doctor/appointments/${y._id}/consult`),children:"Consult"})]})]},y._id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center py-10 text-gray-500",children:"No appointments found."})})})]})})]})};function Gt(){me();const{addNotification:s}=ge(),[a,t]=n.useState(new Date),[i,h]=n.useState(new Date),[l,r]=n.useState([]),[m,y]=n.useState([]),[c,o]=n.useState(!0),[f,p]=n.useState(null),[g,v]=n.useState("month"),[u,x]=n.useState(!1),[C,A]=n.useState(null);n.useEffect(()=>{N()},[a,g]);const N=async()=>{var $;try{o(!0),p(null);const P=d(),O=S(),[M,Z]=await Promise.all([R.get("/appointments",{params:{startDate:P.toISOString(),endDate:O.toISOString()}}),R.get("/doctors/my-availability")]);r((($=M.data)==null?void 0:$.data)||[]),y(Z.data||[])}catch(P){console.error("Error fetching calendar data:",P),p("Failed to load calendar data"),s("Failed to load calendar data","error")}finally{o(!1)}},d=()=>{const $=new Date(a);return g==="month"?($.setDate(1),$.setDate($.getDate()-$.getDay())):g==="week"&&$.setDate($.getDate()-$.getDay()),$.setHours(0,0,0,0),$},S=()=>{const $=new Date(a);return g==="month"?($.setMonth($.getMonth()+1),$.setDate(0),$.setDate($.getDate()+(6-$.getDay()))):g==="week"&&$.setDate($.getDate()+6),$.setHours(23,59,59,999),$},w=$=>{const P=new Date(a);g==="month"?P.setMonth(P.getMonth()+$):g==="week"?P.setDate(P.getDate()+$*7):g==="day"&&P.setDate(P.getDate()+$),t(P)},k=$=>l.filter(P=>new Date(P.date).toDateString()===$.toDateString()),D=$=>{const P=$.toLocaleDateString("en-US",{weekday:"lowercase"}),O=m.find(B=>B.day===P);if(!O||!O.isAvailable)return[];const M=[],Z=new Date(`1970-01-01T${O.startTime}`),se=new Date(`1970-01-01T${O.endTime}`),oe=30;for(let B=Z;B<se;B.setMinutes(B.getMinutes()+oe)){const U=B.toTimeString().slice(0,5),_=l.some(ce=>new Date(ce.date).toDateString()===$.toDateString()&&ce.time===U);M.push({time:U,isBooked:_,date:$})}return M},b=$=>{$.isBooked||(A($),x(!0))},T=async $=>{try{await R.post("/doctors/time-slots",{date:$.date,startTime:$.time,duration:30}),s("Time slot created successfully","success"),x(!1),N()}catch(P){console.error("Error creating time slot:",P),s("Failed to create time slot","error")}},H=async($,P)=>{try{await R.put(`/appointments/${$}`,{status:P}),s(`Appointment ${P} successfully`,"success"),N()}catch(O){console.error("Error updating appointment:",O),s("Failed to update appointment","error")}},J=()=>{const $=d(),P=[];let O=[];for(let M=0;M<42;M++){const Z=new Date($);Z.setDate($.getDate()+M);const se=k(Z),oe=Z.getMonth()===a.getMonth(),B=Z.toDateString()===new Date().toDateString(),U=Z.toDateString()===i.toDateString();O.push(e.jsxs("div",{className:`calendar-day ${oe?"":"other-month"} 
                     ${B?"today":""} ${U?"selected":""}`,onClick:()=>h(new Date(Z)),children:[e.jsx("div",{className:"day-header",children:e.jsx("span",{className:"day-number",children:Z.getDate()})}),e.jsxs("div",{className:"day-appointments",children:[se.slice(0,3).map(_=>{var ce,ie,je,ve,Ce,z,Q,re;return e.jsxs("div",{className:`appointment-item ${_.status}`,title:`${_.time} - ${(ie=(ce=_.patient)==null?void 0:ce.profile)==null?void 0:ie.firstName} ${(ve=(je=_.patient)==null?void 0:je.profile)==null?void 0:ve.lastName}`,children:[e.jsx("span",{className:"appointment-time",children:_.time}),e.jsxs("span",{className:"appointment-patient",children:[(z=(Ce=_.patient)==null?void 0:Ce.profile)==null?void 0:z.firstName," ",(re=(Q=_.patient)==null?void 0:Q.profile)==null?void 0:re.lastName]})]},_._id)}),se.length>3&&e.jsxs("div",{className:"more-appointments",children:["+",se.length-3," more"]})]})]},Z.toISOString())),O.length===7&&(P.push(e.jsx("div",{className:"calendar-week",children:O},P.length)),O=[])}return e.jsx("div",{className:"calendar-month",children:P})},q=()=>{const $=d(),P=[];for(let O=0;O<7;O++){const M=new Date($);M.setDate($.getDate()+O);const Z=k(M),se=D(M),oe=M.toDateString()===new Date().toDateString();P.push(e.jsxs("div",{className:`week-day ${oe?"today":""}`,children:[e.jsxs("div",{className:"week-day-header",children:[e.jsx("div",{className:"day-name",children:M.toLocaleDateString("en-US",{weekday:"short"})}),e.jsx("div",{className:"day-date",children:M.getDate()})]}),e.jsx("div",{className:"week-day-content",children:e.jsx("div",{className:"time-slots",children:se.map(B=>{var U,_,ce;return e.jsxs("div",{className:`time-slot ${B.isBooked?"booked":"available"}`,onClick:()=>b(B),children:[e.jsx("span",{className:"slot-time",children:B.time}),B.isBooked&&e.jsx("div",{className:"booked-appointment",children:(ce=(_=(U=Z.find(ie=>ie.time===B.time))==null?void 0:U.patient)==null?void 0:_.profile)==null?void 0:ce.firstName})]},`${M.toISOString()}-${B.time}`)})})})]},M.toISOString()))}return e.jsx("div",{className:"calendar-week-view",children:P})},K=()=>{const $=k(i),P=D(i);return e.jsxs("div",{className:"calendar-day-view",children:[e.jsx("div",{className:"day-view-header",children:e.jsx("h3",{children:i.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})}),e.jsx("div",{className:"day-view-content",children:e.jsx("div",{className:"time-schedule",children:P.map(O=>{var Z,se,oe,B;const M=$.find(U=>U.time===O.time);return e.jsxs("div",{className:`schedule-slot ${O.isBooked?"booked":"available"}`,onClick:()=>b(O),children:[e.jsx("div",{className:"slot-time",children:O.time}),e.jsx("div",{className:"slot-content",children:M?e.jsxs("div",{className:"appointment-details",children:[e.jsxs("div",{className:"patient-name",children:[(se=(Z=M.patient)==null?void 0:Z.profile)==null?void 0:se.firstName," ",(B=(oe=M.patient)==null?void 0:oe.profile)==null?void 0:B.lastName]}),e.jsx("div",{className:"appointment-reason",children:M.reason}),e.jsx("div",{className:"appointment-status",children:M.status}),e.jsx("div",{className:"appointment-actions",children:M.status==="scheduled"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn-complete",onClick:U=>{U.stopPropagation(),H(M._id,"completed")},children:"Complete"}),e.jsx("button",{className:"btn-cancel",onClick:U=>{U.stopPropagation(),H(M._id,"cancelled")},children:"Cancel"})]})})]}):e.jsx("div",{className:"available-slot",children:e.jsx("span",{children:"Available"})})})]},O.time)})})})]})};return c?e.jsx(De,{}):e.jsxs("div",{className:"doctor-calendar-page",children:[e.jsxs("div",{className:"calendar-header",children:[e.jsxs("div",{className:"calendar-title",children:[e.jsx("h1",{children:"Schedule & Calendar"}),e.jsx("p",{children:"Manage your appointments and availability"})]}),e.jsxs("div",{className:"calendar-controls",children:[e.jsxs("div",{className:"view-selector",children:[e.jsx("button",{className:g==="month"?"active":"",onClick:()=>v("month"),children:"Month"}),e.jsx("button",{className:g==="week"?"active":"",onClick:()=>v("week"),children:"Week"}),e.jsx("button",{className:g==="day"?"active":"",onClick:()=>v("day"),children:"Day"})]}),e.jsxs("div",{className:"navigation-controls",children:[e.jsx("button",{onClick:()=>w(-1),children:"←"}),e.jsx("button",{onClick:()=>t(new Date),children:"Today"}),e.jsx("button",{onClick:()=>w(1),children:"→"})]})]})]}),e.jsx("div",{className:"calendar-navigation",children:e.jsxs("div",{className:"current-period",children:[g==="month"&&a.toLocaleDateString("en-US",{month:"long",year:"numeric"}),g==="week"&&`Week of ${d().toLocaleDateString("en-US",{month:"short",day:"numeric"})}`,g==="day"&&i.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})]})}),f&&e.jsxs("div",{className:"error-banner",children:[e.jsx("p",{children:f}),e.jsx("button",{onClick:N,children:"Retry"})]}),e.jsxs("div",{className:"calendar-content",children:[g==="month"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"calendar-weekdays",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map($=>e.jsx("div",{className:"weekday-header",children:$},$))}),J()]}),g==="week"&&q(),g==="day"&&K()]}),u&&C&&e.jsx("div",{className:"schedule-modal-overlay",onClick:()=>x(!1),children:e.jsxs("div",{className:"schedule-modal",onClick:$=>$.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Create Time Slot"}),e.jsx("button",{className:"close-button",onClick:()=>x(!1),children:"×"})]}),e.jsxs("div",{className:"modal-content",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",C.date.toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Time:"})," ",C.time]}),e.jsx("p",{children:"Create an available time slot for patient bookings?"})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn-cancel",onClick:()=>x(!1),children:"Cancel"}),e.jsx("button",{className:"btn-confirm",onClick:()=>T(C),children:"Create Slot"})]})]})}),e.jsxs("div",{className:"calendar-legend",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color scheduled"}),e.jsx("span",{children:"Scheduled"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color completed"}),e.jsx("span",{children:"Completed"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color cancelled"}),e.jsx("span",{children:"Cancelled"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color available"}),e.jsx("span",{children:"Available"})]})]})]})}function Yt(){me();const{addNotification:s}=ge(),[a,t]=n.useState([]),[i,h]=n.useState(!0),[l,r]=n.useState(null),[m,y]=n.useState(""),[c,o]=n.useState(null),[f,p]=n.useState([]),[g,v]=n.useState(!1),[u,x]=n.useState({diagnosis:"",medications:[{name:"",dosage:"",frequency:"",instructions:""}],notes:"",date:new Date().toISOString()}),C=Array.isArray(fs)?fs:[];n.useEffect(()=>{A()},[]);const A=async()=>{try{h(!0),r(null);const P=await R.get("/doctors/my-patients");P.data.success&&t(P.data.data)}catch(P){console.error("Error fetching patients:",P),r("Failed to load patients"),s("Failed to load patients","error")}finally{h(!1)}},N=async P=>{try{const M=(await R.get(`/medical-records?patientId=${P}`)).data,Z=Array.isArray(M)||Array.isArray(M.data)||Array.isArray(M.records)?M.records||M.data||M:[];p(Z)}catch(O){console.error("Error fetching medical records:",O),s("Failed to load medical records","error")}},d=async(P,O)=>{try{const M=await R.post("/medical-records",{patientId:P,...O});s("Medical record added successfully","success");const Z=M.data.record||M.data;p(se=>[Z,...se]),N(P)}catch(M){console.error("Error adding medical record:",M),s("Failed to add medical record","error")}},S=a.filter(P=>{var O,M,Z;return((O=P.firstName)==null?void 0:O.toLowerCase().includes(m.toLowerCase()))||((M=P.lastName)==null?void 0:M.toLowerCase().includes(m.toLowerCase()))||((Z=P.email)==null?void 0:Z.toLowerCase().includes(m.toLowerCase()))}),w=P=>{o(P),N(P._id)},k=()=>{o(null),p([])},D=()=>{v(!0)},b=()=>{v(!1),x({diagnosis:"",medications:[{name:"",dosage:"",frequency:"",instructions:""}],notes:"",date:new Date().toISOString()})},T=(P,O)=>{x(M=>({...M,[P]:O}))},H=(P,O,M)=>{const Z=[...u.medications];Z[P][O]=M,x(se=>({...se,medications:Z}))},J=()=>{x(P=>({...P,medications:[...P.medications,{name:"",dosage:"",frequency:"",instructions:""}]}))},q=P=>{x(O=>({...O,medications:O.medications.filter((M,Z)=>Z!==P)}))},K=()=>{d(c._id,u),b()},$=P=>new Date(P).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return i?e.jsxs("div",{className:"doctor-page",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading patients..."})]}):e.jsxs("div",{className:"doctor-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"My Patients"}),e.jsx("p",{children:"Manage your patient records and medical history"})]}),l&&e.jsxs("div",{className:"error-banner",children:[e.jsx("p",{children:l}),e.jsx("button",{onClick:A,children:"Retry"})]}),e.jsx("div",{className:"patients-search",children:e.jsx("input",{type:"text",placeholder:"Search patients by name or email...",value:m,onChange:P=>y(P.target.value),className:"search-input"})}),e.jsx("div",{className:"patients-list",children:S.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"No patients found."})}):S.map(P=>e.jsxs("div",{className:"patient-card",children:[e.jsxs("div",{className:"patient-info",children:[e.jsxs("h3",{children:[P.firstName," ",P.lastName]}),e.jsx("p",{className:"patient-email",children:P.email}),e.jsx("p",{className:"patient-phone",children:P.phone||"No phone number"}),e.jsxs("p",{className:"patient-dob",children:["DOB:"," ",P.dateOfBirth?$(P.dateOfBirth):"Not provided"]})]}),e.jsx("div",{className:"patient-actions",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>w(P),children:"View Details"})})]},P._id))}),c&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content patient-details-modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[c.firstName," ",c.lastName]}),e.jsx("button",{className:"close-btn",onClick:k,children:"×"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"patient-info-section",children:[e.jsx("h3",{children:"Patient Information"}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("strong",{children:"Email:"})," ",c.email]}),e.jsxs("div",{className:"info-item",children:[e.jsx("strong",{children:"Phone:"})," ",c.phone||"Not provided"]}),e.jsxs("div",{className:"info-item",children:[e.jsx("strong",{children:"Date of Birth:"}),c.dateOfBirth?$(c.dateOfBirth):"Not provided"]}),e.jsxs("div",{className:"info-item",children:[e.jsx("strong",{children:"Gender:"})," ",c.gender||"Not specified"]}),e.jsxs("div",{className:"info-item",children:[e.jsx("strong",{children:"Address:"})," ",c.address||"Not provided"]})]})]}),e.jsxs("div",{className:"medical-records-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Medical Records"}),e.jsx("button",{className:"btn btn-primary",onClick:D,children:"Add Record"})]}),e.jsx("div",{className:"medical-records-list",children:f.length===0?e.jsx("p",{children:"No medical records found."}):f.map(P=>e.jsxs("div",{className:"medical-record-card",children:[e.jsxs("div",{className:"record-header",children:[e.jsx("h4",{children:P.diagnosis}),e.jsx("span",{className:"record-date",children:$(P.date)})]}),e.jsxs("div",{className:"record-content",children:[P.treatment&&e.jsxs("p",{children:[e.jsx("strong",{children:"Treatment:"})," ",P.treatment]}),P.notes&&e.jsxs("p",{children:[e.jsx("strong",{children:"Notes:"})," ",P.notes]}),P.prescription&&e.jsxs("p",{children:[e.jsx("strong",{children:"Prescription:"})," ",P.prescription]})]})]},P._id))})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn btn-secondary",onClick:k,children:"Close"})})]})}),c&&g&&e.jsx("div",{className:"modal-overlay form-modal",children:e.jsxs("div",{className:"modal-content record-form",children:[e.jsx("h3",{children:"New Medical Record"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Diagnosis:"}),e.jsxs("select",{value:u.diagnosis,onChange:P=>T("diagnosis",P.target.value),children:[e.jsx("option",{value:"",children:"Select disease"}),C.map(P=>e.jsx("option",{value:P,children:P},P))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Medications:"}),e.jsx("datalist",{id:"med-list",children:aa.map(P=>e.jsx("option",{value:P},P))}),u.medications.map((P,O)=>e.jsxs("div",{className:"med-row",children:[e.jsx("input",{list:"med-list",placeholder:"Medication",value:P.name,onChange:M=>H(O,"name",M.target.value)}),e.jsx("input",{placeholder:"Dosage",value:P.dosage,onChange:M=>H(O,"dosage",M.target.value)}),e.jsx("input",{placeholder:"Frequency",value:P.frequency,onChange:M=>H(O,"frequency",M.target.value)}),e.jsx("input",{placeholder:"Instructions",value:P.instructions,onChange:M=>H(O,"instructions",M.target.value)}),u.medications.length>1&&e.jsx("button",{onClick:()=>q(O),children:"Remove"})]},O)),e.jsx("button",{className:"btn btn-secondary",onClick:J,children:"Add Medication"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes:"}),e.jsx("textarea",{value:u.notes,onChange:P=>T("notes",P.target.value)})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-primary",onClick:K,children:"Save Record"}),e.jsx("button",{className:"btn btn-secondary",onClick:b,children:"Cancel"})]})]})})]})}function Qt(){return e.jsxs("div",{className:"public-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"About Our Telemedicine Platform"}),e.jsx("p",{children:"Revolutionizing healthcare through technology and compassion"})]}),e.jsxs("div",{className:"content-sections",children:[e.jsxs("section",{className:"about-section",children:[e.jsx("h2",{children:"Our Mission"}),e.jsx("p",{children:"We believe healthcare should be accessible, convenient, and high-quality for everyone. Our telemedicine platform connects patients with certified healthcare professionals from the comfort of their homes, breaking down barriers to medical care."})]}),e.jsxs("section",{className:"about-section",children:[e.jsx("h2",{children:"How It Works"}),e.jsxs("div",{className:"steps-grid",children:[e.jsxs("div",{className:"step-card",children:[e.jsx("div",{className:"step-number",children:"1"}),e.jsx("h3",{children:"Sign Up"}),e.jsx("p",{children:"Create your account and complete your medical profile"})]}),e.jsxs("div",{className:"step-card",children:[e.jsx("div",{className:"step-number",children:"2"}),e.jsx("h3",{children:"Choose Doctor"}),e.jsx("p",{children:"Browse our network of certified healthcare professionals"})]}),e.jsxs("div",{className:"step-card",children:[e.jsx("div",{className:"step-number",children:"3"}),e.jsx("h3",{children:"Book Appointment"}),e.jsx("p",{children:"Schedule a convenient time for your virtual consultation"})]}),e.jsxs("div",{className:"step-card",children:[e.jsx("div",{className:"step-number",children:"4"}),e.jsx("h3",{children:"Get Care"}),e.jsx("p",{children:"Connect with your doctor via secure video call"})]})]})]}),e.jsxs("section",{className:"about-section",children:[e.jsx("h2",{children:"Why Choose Us"}),e.jsxs("div",{className:"benefits-grid",children:[e.jsxs("div",{className:"benefit-card",children:[e.jsx("div",{className:"benefit-icon",children:"🏥"}),e.jsx("h3",{children:"Certified Doctors"}),e.jsx("p",{children:"All our healthcare providers are licensed and board-certified"})]}),e.jsxs("div",{className:"benefit-card",children:[e.jsx("div",{className:"benefit-icon",children:"🔒"}),e.jsx("h3",{children:"HIPAA Compliant"}),e.jsx("p",{children:"Your health information is secure and private"})]}),e.jsxs("div",{className:"benefit-card",children:[e.jsx("div",{className:"benefit-icon",children:"⏰"}),e.jsx("h3",{children:"24/7 Availability"}),e.jsx("p",{children:"Access healthcare when you need it, day or night"})]}),e.jsxs("div",{className:"benefit-card",children:[e.jsx("div",{className:"benefit-icon",children:"💰"}),e.jsx("h3",{children:"Affordable Care"}),e.jsx("p",{children:"Quality healthcare at transparent, affordable prices"})]})]})]}),e.jsxs("section",{className:"about-section",children:[e.jsx("h2",{children:"Our Team"}),e.jsx("p",{children:"Our platform is powered by a team of healthcare professionals, technology experts, and patient advocates who are committed to improving healthcare accessibility and outcomes."}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-number",children:"500+"}),e.jsx("div",{className:"stat-label",children:"Certified Doctors"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-number",children:"50,000+"}),e.jsx("div",{className:"stat-label",children:"Patients Served"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-number",children:"98%"}),e.jsx("div",{className:"stat-label",children:"Satisfaction Rate"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-number",children:"24/7"}),e.jsx("div",{className:"stat-label",children:"Support Available"})]})]})]})]})]})}function Kt(){me();const{addNotification:s}=ge(),a=ye(),[t,i]=n.useState([]),[h,l]=n.useState(!0),[r,m]=n.useState([]),[y,c]=n.useState({Push:!1,SMS:!1,Email:!1,Dashboard:!1}),[o,f]=n.useState([""]),[p,g]=n.useState(!1);n.useEffect(()=>{async function d(){var S;try{const w=await xe.get("/appointments");(S=w.data)!=null&&S.data&&i(w.data.data)}catch(w){console.log("Error fetching appointments",w),s("Failed to load appointments","error")}finally{l(!1)}}d()},[]);const v=d=>{m(S=>S.includes(d)?S.filter(w=>w!==d):[...S,d])},u=d=>{const{name:S,checked:w}=d.target;c(k=>({...k,[S]:w}))},x=(d,S)=>{const w=[...o];w[d]=S,f(w)},C=()=>f(d=>[...d,""]),A=d=>f(S=>S.filter((w,k)=>k!==d)),N=async()=>{if(!r.length){s("Select at least one appointment","warning");return}const d=Object.keys(y).filter(S=>y[S]);if(!d.length){s("Select at least one channel","warning");return}try{g(!0);const S={appointmentId:r,channels:d,reminderTimes:o.filter(w=>w)};await xe.post("/reminders/schedule",S),s("Reminders scheduled successfully","success"),a("/dashboard")}catch(S){console.log("Error scheduling reminders",S),s("Failed to schedule reminders","error")}finally{g(!1)}};return h?e.jsx(De,{fullPage:!0}):e.jsxs("div",{className:"reminder-settings-page",children:[e.jsx("h1",{children:"Schedule Appointment Reminders"}),e.jsxs("section",{children:[e.jsx("h2",{children:"Select Appointments"}),t.length?e.jsx("ul",{className:"appointments-list",children:t.map(d=>{var S,w;return e.jsx("li",{children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.includes(d._id),onChange:()=>v(d._id)}),new Date(d.date).toLocaleString()," -"," ",(S=d.doctor.profile)==null?void 0:S.firstName," ",(w=d.doctor.profile)==null?void 0:w.lastName]})},d._id)})}):e.jsx("p",{children:"No appointments found."})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"Select Channels"}),["Push","SMS","Email","Dashboard"].map(d=>e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:d,checked:y[d],onChange:u})," ",d]},d))]}),e.jsxs("section",{children:[e.jsx("h2",{children:"Reminder Times"}),o.map((d,S)=>e.jsxs("div",{className:"time-field",children:[e.jsx("input",{type:"datetime-local",value:d,onChange:w=>x(S,w.target.value)}),S>0&&e.jsx("button",{onClick:()=>A(S),className:"btn btn-secondary",children:"Remove"})]},S)),e.jsx("button",{onClick:C,className:"btn btn-primary",children:"Add Time"})]}),e.jsx("section",{className:"form-actions",children:e.jsx("button",{onClick:N,disabled:p,className:"btn btn-primary",children:p?"Saving...":"Save Reminders"})})]})}function Zt(){const s=[{id:1,title:"General Consultation",description:"Connect with general practitioners for routine check-ups, health concerns, and medical advice.",features:["Same-day appointments","Prescription services","Follow-up care","Health monitoring"],price:"$49",icon:"🩺"},{id:2,title:"Specialist Care",description:"Access specialized medical care from certified specialists in various fields.",features:["Cardiology","Dermatology","Mental Health","Orthopedics"],price:"$89",icon:"👨‍⚕️"},{id:3,title:"Mental Health",description:"Professional mental health support and counseling services.",features:["Licensed therapists","Anxiety & depression","Stress management","Confidential sessions"],price:"$79",icon:"🧠"},{id:4,title:"Urgent Care",description:"Immediate medical attention for non-emergency urgent health issues.",features:["24/7 availability","Quick diagnosis","Treatment plans","Emergency referrals"],price:"$69",icon:"⚡"},{id:5,title:"Prescription Services",description:"Online prescription management and pharmacy delivery services.",features:["Digital prescriptions","Pharmacy partnerships","Home delivery","Refill reminders"],price:"$19",icon:"💊"},{id:6,title:"Health Monitoring",description:"Ongoing health tracking and preventive care management.",features:["Chronic disease management","Health analytics","Regular check-ins","Care coordination"],price:"$39",icon:"📊"}];return e.jsxs("div",{className:"public-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Our Healthcare Services"}),e.jsx("p",{children:"Comprehensive medical care tailored to your needs"})]}),e.jsx("div",{className:"services-grid",children:s.map(a=>e.jsxs("div",{className:"service-card",children:[e.jsx("div",{className:"service-icon",children:a.icon}),e.jsx("h3",{children:a.title}),e.jsx("p",{className:"service-description",children:a.description}),e.jsxs("div",{className:"service-features",children:[e.jsx("h4",{children:"What's Included:"}),e.jsx("ul",{children:a.features.map((t,i)=>e.jsx("li",{children:t},i))})]}),e.jsxs("div",{className:"service-pricing",children:[e.jsxs("span",{className:"price",children:["Starting at ",a.price]}),e.jsx(V,{to:"/register",className:"btn btn-primary",children:"Get Started"})]})]},a.id))}),e.jsxs("section",{className:"services-info",children:[e.jsxs("div",{className:"info-section",children:[e.jsx("h2",{children:"How Our Services Work"}),e.jsxs("div",{className:"process-steps",children:[e.jsxs("div",{className:"process-step",children:[e.jsx("div",{className:"step-icon",children:"📱"}),e.jsx("h3",{children:"Book Online"}),e.jsx("p",{children:"Choose your service and schedule an appointment that fits your schedule"})]}),e.jsxs("div",{className:"process-step",children:[e.jsx("div",{className:"step-icon",children:"💻"}),e.jsx("h3",{children:"Virtual Visit"}),e.jsx("p",{children:"Meet with your healthcare provider via secure video consultation"})]}),e.jsxs("div",{className:"process-step",children:[e.jsx("div",{className:"step-icon",children:"📋"}),e.jsx("h3",{children:"Follow-up"}),e.jsx("p",{children:"Receive your treatment plan, prescriptions, and ongoing care support"})]})]})]}),e.jsxs("div",{className:"info-section",children:[e.jsx("h2",{children:"Insurance & Payment"}),e.jsx("p",{children:"We accept most major insurance plans and offer transparent pricing for all our services. No hidden fees, no surprises."}),e.jsxs("div",{className:"payment-options",children:[e.jsx("div",{className:"payment-item",children:"✅ Most Insurance Plans Accepted"}),e.jsx("div",{className:"payment-item",children:"✅ Flexible Payment Options"}),e.jsx("div",{className:"payment-item",children:"✅ HSA/FSA Eligible"}),e.jsx("div",{className:"payment-item",children:"✅ Transparent Pricing"})]})]}),e.jsxs("div",{className:"cta-section",children:[e.jsx("h2",{children:"Ready to Start Your Healthcare Journey?"}),e.jsx("p",{children:"Join thousands of patients who trust us with their healthcare needs."}),e.jsxs("div",{className:"cta-buttons",children:[e.jsx(V,{to:"/register",className:"btn btn-primary",children:"Create Account"}),e.jsx(V,{to:"/doctors",className:"btn btn-secondary",children:"Browse Doctors"})]})]})]})]})}function Xt(){const[s,a]=n.useState({name:"",email:"",phone:"",subject:"",message:"",type:"general"}),[t,i]=n.useState(!1),h=r=>{a({...s,[r.target.name]:r.target.value})},l=r=>{r.preventDefault(),console.log("Contact form submitted:",s),i(!0)};return t?e.jsxs("div",{className:"public-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Thank You!"}),e.jsx("p",{children:"Your message has been sent successfully. We'll get back to you within 24 hours."})]}),e.jsx("div",{className:"success-actions",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>{i(!1),a({name:"",email:"",phone:"",subject:"",message:"",type:"general"})},children:"Send Another Message"})})]}):e.jsxs("div",{className:"public-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Contact Us"}),e.jsx("p",{children:"Get in touch with our healthcare support team"})]}),e.jsxs("div",{className:"contact-container",children:[e.jsxs("div",{className:"contact-info",children:[e.jsxs("div",{className:"contact-section",children:[e.jsx("h3",{children:"🏥 Customer Support"}),e.jsx("p",{children:"Available 24/7 for all your healthcare needs"}),e.jsxs("div",{className:"contact-details",children:[e.jsxs("div",{className:"contact-item",children:[e.jsx("strong",{children:"Phone:"})," 1-800-TELEMD1"]}),e.jsxs("div",{className:"contact-item",children:[e.jsx("strong",{children:"Email:"})," support@telemedicine.com"]}),e.jsxs("div",{className:"contact-item",children:[e.jsx("strong",{children:"Chat:"})," Available in your dashboard"]})]})]}),e.jsxs("div",{className:"contact-section",children:[e.jsx("h3",{children:"⚕️ Medical Emergencies"}),e.jsx("p",{children:"For life-threatening emergencies, call 911 immediately"}),e.jsxs("div",{className:"emergency-info",children:[e.jsxs("div",{className:"emergency-item",children:[e.jsx("strong",{children:"Emergency:"})," 911"]}),e.jsxs("div",{className:"emergency-item",children:[e.jsx("strong",{children:"Urgent Care:"})," Available 24/7 on platform"]}),e.jsxs("div",{className:"emergency-item",children:[e.jsx("strong",{children:"Crisis Support:"})," 988 (Suicide & Crisis Lifeline)"]})]})]}),e.jsxs("div",{className:"contact-section",children:[e.jsx("h3",{children:"🏢 Business Inquiries"}),e.jsx("p",{children:"Partnership and enterprise solutions"}),e.jsxs("div",{className:"contact-details",children:[e.jsxs("div",{className:"contact-item",children:[e.jsx("strong",{children:"Phone:"})," 1-800-BUSINESS"]}),e.jsxs("div",{className:"contact-item",children:[e.jsx("strong",{children:"Email:"})," business@telemedicine.com"]})]})]}),e.jsxs("div",{className:"contact-section",children:[e.jsx("h3",{children:"🕒 Support Hours"}),e.jsxs("div",{className:"hours-list",children:[e.jsxs("div",{className:"hours-item",children:[e.jsx("strong",{children:"Medical Support:"})," 24/7"]}),e.jsxs("div",{className:"hours-item",children:[e.jsx("strong",{children:"Technical Support:"})," 6 AM - 10 PM EST"]}),e.jsxs("div",{className:"hours-item",children:[e.jsx("strong",{children:"Billing Support:"})," 9 AM - 6 PM EST"]})]})]})]}),e.jsxs("div",{className:"contact-form-container",children:[e.jsx("h2",{children:"Send us a Message"}),e.jsxs("form",{className:"contact-form",onSubmit:l,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"type",children:"Type of Inquiry"}),e.jsxs("select",{id:"type",name:"type",value:s.type,onChange:h,required:!0,children:[e.jsx("option",{value:"general",children:"General Question"}),e.jsx("option",{value:"technical",children:"Technical Support"}),e.jsx("option",{value:"billing",children:"Billing & Insurance"}),e.jsx("option",{value:"medical",children:"Medical Question"}),e.jsx("option",{value:"partnership",children:"Partnership Inquiry"}),e.jsx("option",{value:"feedback",children:"Feedback"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Full Name *"}),e.jsx("input",{type:"text",id:"name",name:"name",value:s.name,onChange:h,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email Address *"}),e.jsx("input",{type:"email",id:"email",name:"email",value:s.email,onChange:h,required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"phone",children:"Phone Number"}),e.jsx("input",{type:"tel",id:"phone",name:"phone",value:s.phone,onChange:h,placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"subject",children:"Subject *"}),e.jsx("input",{type:"text",id:"subject",name:"subject",value:s.subject,onChange:h,placeholder:"Brief description of your inquiry",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"message",children:"Message *"}),e.jsx("textarea",{id:"message",name:"message",value:s.message,onChange:h,rows:"6",placeholder:"Please provide details about your inquiry...",required:!0})]}),e.jsx("button",{type:"submit",className:"btn btn-primary submit-btn",children:"Send Message"})]})]})]}),e.jsxs("div",{className:"faq-section",children:[e.jsx("h2",{children:"Frequently Asked Questions"}),e.jsxs("div",{className:"faq-grid",children:[e.jsxs("div",{className:"faq-item",children:[e.jsx("h4",{children:"How do I schedule an appointment?"}),e.jsx("p",{children:"Simply create an account, browse our doctors, and book a time that works for you."})]}),e.jsxs("div",{className:"faq-item",children:[e.jsx("h4",{children:"Is telemedicine covered by insurance?"}),e.jsx("p",{children:"Most insurance plans cover telemedicine. We'll verify your coverage before your visit."})]}),e.jsxs("div",{className:"faq-item",children:[e.jsx("h4",{children:"What technology do I need?"}),e.jsx("p",{children:"Just a smartphone, tablet, or computer with camera and internet connection."})]}),e.jsxs("div",{className:"faq-item",children:[e.jsx("h4",{children:"Can I get prescriptions online?"}),e.jsx("p",{children:"Yes! Our doctors can prescribe medications and send them directly to your pharmacy."})]})]})]})]})}const en=()=>{const[s,a]=n.useState([]),[t,i]=n.useState(!0),[h,l]=n.useState(null),{user:r}=me();return n.useEffect(()=>{(async()=>{if(r)try{i(!0);const y=await R.get("/appointments");let c=[];y.data&&y.data.data&&Array.isArray(y.data.data.appointments)?c=y.data.data.appointments:y.data&&Array.isArray(y.data.data)?c=y.data.data:Array.isArray(y.data)&&(c=y.data);const o=c.filter(f=>new Date(f.startTime||f.date)>new Date&&f.type==="video");a(o)}catch(y){console.error("Error fetching video call data:",y),l(y.message||"Failed to fetch data."),a([])}finally{i(!1)}})()},[r]),t?e.jsx("div",{className:"text-center p-4",children:"Loading video calls..."}):h?e.jsxs("div",{className:"text-red-500 text-center p-4",children:["Error: ",h]}):e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Upcoming Video Calls"}),s.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:s.map(m=>{var y,c,o,f;return e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[e.jsx("h2",{className:"font-bold text-lg",children:r.role==="doctor"?`Patient: ${(c=(y=m.patient)==null?void 0:y.profile)==null?void 0:c.firstName}`:`Dr. ${(f=(o=m.doctor)==null?void 0:o.profile)==null?void 0:f.firstName}`}),e.jsx("p",{className:"text-gray-600",children:new Date(m.startTime||m.date).toLocaleString()}),e.jsxs("button",{className:"mt-4 w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 flex items-center justify-center",children:[e.jsx($a,{className:"mr-2",size:20}),"Join Call"]})]},m._id)})}):e.jsx("p",{className:"text-center text-gray-500",children:"No upcoming video calls scheduled."})]})};function sn(){me();const{addNotification:s}=ge(),[a,t]=n.useState({overview:{},appointments:{},patients:{},revenue:{}}),[i,h]=n.useState(!0),[l,r]=n.useState("30");n.useEffect(()=>{m()},[l]);const m=async()=>{try{h(!0);const[o,f]=await Promise.all([R.get("/doctors/stats"),R.get("/appointments")]);let p={};o.data&&o.data.data?p=o.data.data:o.data&&(p=o.data);let g=[];f.data&&f.data.data&&Array.isArray(f.data.data.appointments)?g=f.data.data.appointments:f.data&&Array.isArray(f.data.data)?g=f.data.data:Array.isArray(f.data)&&(g=f.data);const v=new Date,u=new Date(v.getTime()-parseInt(l)*24*60*60*1e3),x=g.filter(k=>new Date(k.date||k.startTime)>=u),C=x.filter(k=>k.status==="completed"),A=x.filter(k=>k.status==="cancelled"),N={};for(let k=parseInt(l);k>=0;k--){const b=new Date(v.getTime()-k*24*60*60*1e3).toISOString().split("T")[0];N[b]=0}C.forEach(k=>{const D=new Date(k.date||k.startTime).toISOString().split("T")[0];N.hasOwnProperty(D)&&N[D]++});const d=new Set(C.map(k=>{var D;return((D=k.patient)==null?void 0:D._id)||k.patientId})).size,S=C.reduce((k,D)=>k+(D.rating||0),0),w=C.length>0?(S/C.length).toFixed(1):0;t({overview:{totalAppointments:x.length,completedAppointments:C.length,cancelledAppointments:A.length,uniquePatients:d,averageRating:w,completionRate:x.length>0?Math.round(C.length/x.length*100):0},appointments:{daily:N,byStatus:{completed:C.length,cancelled:A.length,scheduled:x.filter(k=>k.status==="scheduled").length}},patients:{new:d,returning:Math.max(0,C.length-d)},revenue:{total:C.length*50,average:50,projected:C.length*50+x.filter(k=>k.status==="scheduled").length*50}})}catch(o){console.error("Error fetching analytics:",o),s("Failed to load analytics data","error")}finally{h(!1)}},y=()=>{const o=Object.keys(a.appointments.daily||{}).sort(),f=o.map(p=>a.appointments.daily[p]);return{dates:o,values:f}};if(i)return e.jsxs("div",{className:"doctor-page",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading analytics..."})]});const c=y();return!a.overview||!a.appointments.byStatus?e.jsx("div",{className:"doctor-page",children:e.jsx("p",{children:"Analytics data is being processed..."})}):e.jsxs("div",{className:"doctor-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Analytics Dashboard"}),e.jsxs("div",{className:"time-filter",children:[e.jsx("label",{children:"Time Range:"}),e.jsxs("select",{value:l,onChange:o=>r(o.target.value),children:[e.jsx("option",{value:"7",children:"Last 7 days"}),e.jsx("option",{value:"30",children:"Last 30 days"}),e.jsx("option",{value:"90",children:"Last 3 months"}),e.jsx("option",{value:"365",children:"Last year"})]})]})]}),e.jsxs("div",{className:"analytics-overview",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"📅"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:a.overview.totalAppointments}),e.jsx("p",{children:"Total Appointments"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"✅"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:a.overview.completedAppointments}),e.jsx("p",{children:"Completed"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"👥"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:a.overview.uniquePatients}),e.jsx("p",{children:"Unique Patients"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"⭐"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:a.overview.averageRating}),e.jsx("p",{children:"Average Rating"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"💹"}),e.jsxs("div",{className:"stat-content",children:[e.jsxs("h3",{children:[a.overview.completionRate,"%"]}),e.jsx("p",{children:"Completion Rate"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"💰"}),e.jsxs("div",{className:"stat-content",children:[e.jsxs("h3",{children:["$",a.revenue.total]}),e.jsx("p",{children:"Revenue"})]})]})]}),e.jsxs("div",{className:"analytics-charts",children:[e.jsxs("div",{className:"chart-section",children:[e.jsx("h2",{children:"Appointments Over Time"}),e.jsx("div",{className:"simple-chart",children:e.jsx("div",{className:"chart-container",children:c.dates.map((o,f)=>e.jsxs("div",{className:"chart-bar",children:[e.jsx("div",{className:"bar",style:{height:`${Math.max(c.values[f]*20,5)}px`,backgroundColor:c.values[f]>0?"#2563eb":"#e5e7eb"},title:`${o}: ${c.values[f]} appointments`}),e.jsx("div",{className:"bar-label",children:new Date(o).getDate()})]},o))})})]}),e.jsxs("div",{className:"chart-section",children:[e.jsx("h2",{children:"Appointment Status Distribution"}),e.jsxs("div",{className:"status-distribution",children:[e.jsxs("div",{className:"status-item",children:[e.jsx("div",{className:"status-bar completed",style:{width:`${a.appointments.byStatus.completed/(a.overview.totalAppointments||1)*100}%`}}),e.jsxs("span",{children:["Completed (",a.appointments.byStatus.completed,")"]})]}),e.jsxs("div",{className:"status-item",children:[e.jsx("div",{className:"status-bar scheduled",style:{width:`${a.appointments.byStatus.scheduled/(a.overview.totalAppointments||1)*100}%`}}),e.jsxs("span",{children:["Scheduled (",a.appointments.byStatus.scheduled,")"]})]}),e.jsxs("div",{className:"status-item",children:[e.jsx("div",{className:"status-bar cancelled",style:{width:`${a.appointments.byStatus.cancelled/(a.overview.totalAppointments||1)*100}%`}}),e.jsxs("span",{children:["Cancelled (",a.appointments.byStatus.cancelled,")"]})]})]})]})]}),e.jsxs("div",{className:"analytics-details",children:[e.jsxs("div",{className:"detail-section",children:[e.jsx("h2",{children:"Patient Analytics"}),e.jsxs("div",{className:"detail-stats",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"label",children:"New Patients:"}),e.jsx("span",{className:"value",children:a.patients.new})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"label",children:"Returning Patients:"}),e.jsx("span",{className:"value",children:a.patients.returning})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"label",children:"Patient Retention:"}),e.jsxs("span",{className:"value",children:[a.patients.new>0?Math.round(a.patients.returning/a.patients.new*100):0,"%"]})]})]})]}),e.jsxs("div",{className:"detail-section",children:[e.jsx("h2",{children:"Revenue Analytics"}),e.jsxs("div",{className:"detail-stats",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"label",children:"Total Revenue:"}),e.jsxs("span",{className:"value",children:["$",a.revenue.total]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"label",children:"Average per Appointment:"}),e.jsxs("span",{className:"value",children:["$",a.revenue.average]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"label",children:"Projected Revenue:"}),e.jsxs("span",{className:"value",children:["$",a.revenue.projected]})]})]})]})]}),e.jsxs("div",{className:"analytics-insights",children:[e.jsx("h2",{children:"Key Insights"}),e.jsxs("div",{className:"insights-list",children:[a.overview.completionRate>90&&e.jsxs("div",{className:"insight-item positive",children:[e.jsx("span",{className:"insight-icon",children:"🎉"}),e.jsx("p",{children:"Excellent completion rate! You're maintaining high patient satisfaction."})]}),a.overview.averageRating>=4.5&&e.jsxs("div",{className:"insight-item positive",children:[e.jsx("span",{className:"insight-icon",children:"⭐"}),e.jsx("p",{children:"Outstanding rating! Patients highly appreciate your care."})]}),a.patients.returning>a.patients.new&&e.jsxs("div",{className:"insight-item positive",children:[e.jsx("span",{className:"insight-icon",children:"🔄"}),e.jsx("p",{children:"High patient retention rate indicates strong trust and satisfaction."})]}),a.overview.cancelledAppointments>a.overview.completedAppointments*.2&&e.jsxs("div",{className:"insight-item warning",children:[e.jsx("span",{className:"insight-icon",children:"⚠️"}),e.jsx("p",{children:"Consider reviewing cancellation patterns to improve appointment scheduling."})]})]})]})]})}const an=(s,a,t)=>{const[i,h]=n.useState(null),[l,r]=n.useState(new Map),[m,y]=n.useState(null),[c,o]=n.useState(!0),[f,p]=n.useState(!0),[g,v]=n.useState(!1),[u,x]=n.useState([]),[C,A]=n.useState([]),[N,d]=n.useState("unknown"),[S,w]=n.useState(null),[k,D]=n.useState(!1),b=n.useRef(new Map),T=n.useRef(null);n.useEffect(()=>{if(!s||!a)return;const B=Ds("http://localhost:5000/api".replace("/api","")||"http://localhost:5000",{auth:{token:a},transports:["websocket"]});return B.on("connect",()=>{console.log("Connected to signaling server"),D(!0),w(null)}),B.on("disconnect",()=>{console.log("Disconnected from signaling server"),D(!1)}),B.on("connect_error",U=>{console.log("Socket connection error:",U),w("Failed to connect to video call server")}),B.on("room-joined",U=>{console.log("Room joined successfully",U),A(U.participants),x(U.chatHistory||[])}),B.on("user-joined",U=>{console.log("User joined room",U),A(U.participants),T.current&&J(U.userId,!1)}),B.on("user-left",U=>{console.log("User left room",U),A(U.participants);const _=b.current.get(U.userId);_&&(_.destroy(),b.current.delete(U.userId),r(new Map(b.current)))}),B.on("webrtc-offer",U=>{console.log("Received WebRTC offer from",U.fromUserId),T.current&&J(U.fromUserId,!1,U.offer)}),B.on("webrtc-answer",U=>{console.log("Received WebRTC answer from",U.fromUserId);const _=b.current.get(U.fromUserId);_&&_.signal(U.answer)}),B.on("webrtc-ice-candidate",U=>{const _=b.current.get(U.fromUserId);_&&_.signal(U.candidate)}),B.on("user-video-toggled",U=>{console.log("User toggled video",U)}),B.on("user-audio-toggled",U=>{console.log("User toggled audio",U)}),B.on("user-screen-share",U=>{console.log("User toggled screen share",U)}),B.on("chat-message",U=>{x(_=>[..._,U])}),B.on("call-ended",U=>{console.log("Call ended by",U.endedBy),oe()}),B.on("error",U=>{console.log("Socket error:",U),w(U.message)}),h(B),()=>{oe(),B.disconnect()}},[s,a]);const H=n.useCallback(async()=>{try{const B=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:30}},audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});return y(B),T.current=B,se(),B}catch(B){throw console.log("Failed to get user media:",B),w("Failed to access camera/microphone. Please check permissions."),B}},[]),J=n.useCallback((B,U,_=null)=>{if(!T.current)return;const ce=new Ma({initiator:U,trickle:!1,stream:T.current,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}});return ce.on("signal",ie=>{ie.type==="offer"?i==null||i.emit("webrtc-offer",{roomId:s,targetUserId:B,offer:ie}):ie.type==="answer"?i==null||i.emit("webrtc-answer",{roomId:s,targetUserId:B,answer:ie}):i==null||i.emit("webrtc-ice-candidate",{roomId:s,targetUserId:B,candidate:ie})}),ce.on("stream",ie=>{console.log("Received remote stream from",B)}),ce.on("error",ie=>{console.log("Peer connection error:",ie),w("Connection error with participant")}),ce.on("close",()=>{console.log("Peer connection closed for",B)}),_&&ce.signal(_),b.current.set(B,ce),r(new Map(b.current)),ce},[i,s]),q=n.useCallback(async()=>{if(!(!i||!s))try{await H(),i.emit("join-room",{roomId:s,appointmentId:t})}catch{w("Failed to join video call")}},[i,s,t,H]),K=n.useCallback(()=>{i&&s&&i.emit("leave-room",{roomId:s}),oe()},[i,s]),$=n.useCallback(()=>{T.current&&(T.current.getVideoTracks().forEach(U=>{U.enabled=!U.enabled}),o(!c),i==null||i.emit("toggle-video",{roomId:s,enabled:!c}))},[i,s,c]),P=n.useCallback(()=>{T.current&&(T.current.getAudioTracks().forEach(U=>{U.enabled=!U.enabled}),p(!f),i==null||i.emit("toggle-audio",{roomId:s,enabled:!f}))},[i,s,f]),O=n.useCallback(async()=>{if(g)try{const B=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});y(B),T.current=B,b.current.forEach(U=>{U.replaceTrack(U.streams[0].getVideoTracks()[0],B.getVideoTracks()[0],U.streams[0])}),v(!1)}catch{w("Failed to stop screen sharing")}else try{const B=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0});y(B),T.current=B,b.current.forEach(U=>{U.replaceTrack(U.streams[0].getVideoTracks()[0],B.getVideoTracks()[0],U.streams[0])}),v(!0),B.getVideoTracks()[0].onended=()=>{O()}}catch{w("Failed to start screen sharing")}i==null||i.emit("screen-share",{roomId:s,enabled:!g})},[i,s,g,O]),M=n.useCallback(B=>{i&&B.trim()&&i.emit("chat-message",{roomId:s,message:B.trim(),messageType:"text"})},[i,s]),Z=n.useCallback(()=>{i&&i.emit("call-ended",{roomId:s,reason:"manual"}),oe()},[i,s]),se=n.useCallback(()=>{const B=setInterval(()=>{b.current.size>0&&d("good")},5e3);return()=>clearInterval(B)},[]),oe=n.useCallback(()=>{T.current&&(T.current.getTracks().forEach(B=>B.stop()),T.current=null,y(null)),b.current.forEach(B=>B.destroy()),b.current.clear(),r(new Map),o(!0),p(!0),v(!1),A([]),x([]),d("unknown")},[]);return{localStream:m,peers:l,isVideoEnabled:c,isAudioEnabled:f,isScreenSharing:g,chatMessages:u,participants:C,connectionQuality:N,error:S,isConnected:k,joinRoom:q,leaveRoom:K,toggleVideo:$,toggleAudio:P,toggleScreenShare:O,sendChatMessage:M,endCall:Z,initializeLocalStream:H}};const tn=()=>{const{appointmentId:s}=We(),a=ye(),[t,i]=n.useState(null),[h,l]=n.useState(!0),[r,m]=n.useState(null),[y,c]=n.useState(""),[o,f]=n.useState(!1),[p,g]=n.useState(0),[v,u]=n.useState(!1),x=n.useRef(null),C=n.useRef(new Map),A=n.useRef(null);n.useEffect(()=>{s&&(async()=>{var ce,ie;try{l(!0);const ve=(await R.post(`/video-calls/appointment/${s}/room`)).data.data;i(ve),A.current=new Date;const Ce=setInterval(()=>{if(A.current){const z=Math.floor((new Date-A.current)/1e3);g(z)}},1e3);return()=>clearInterval(Ce)}catch(je){console.error("Failed to initialize video call room:",je),m(((ie=(ce=je.response)==null?void 0:ce.data)==null?void 0:ie.message)||"Failed to start video call")}finally{l(!1)}})()},[s]);const{localStream:N,peers:d,isVideoEnabled:S,isAudioEnabled:w,isScreenSharing:k,chatMessages:D,participants:b,connectionQuality:T,error:H,isConnected:J,joinRoom:q,leaveRoom:K,toggleVideo:$,toggleAudio:P,toggleScreenShare:O,sendChatMessage:M,endCall:Z}=an(t==null?void 0:t.roomId,t==null?void 0:t.webrtcToken,s);n.useEffect(()=>{t&&J&&q()},[t,J,q]),n.useEffect(()=>{x.current&&N&&(x.current.srcObject=N)},[N]),n.useEffect(()=>{d.forEach((_,ce)=>{if(_.streams&&_.streams[0]){const ie=C.current.get(ce);ie&&(ie.srcObject=_.streams[0])}})},[d]);const se=_=>{const ce=Math.floor(_/60),ie=_%60;return`${ce.toString().padStart(2,"0")}:${ie.toString().padStart(2,"0")}`},oe=_=>{_.preventDefault(),y.trim()&&(M(y),c(""))},B=async()=>{try{await R.post(`/video-calls/appointment/${s}/end`,{duration:p,quality:T}),Z(),a("/dashboard")}catch(_){console.error("Error ending call:",_),Z(),a("/dashboard")}},U=()=>{v?document.exitFullscreen():document.documentElement.requestFullscreen(),u(!v)};return h?e.jsxs("div",{className:"video-call-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Initializing video call..."})]}):r||H?e.jsx("div",{className:"video-call-error",children:e.jsxs("div",{className:"error-content",children:[e.jsx("h2",{children:"Video Call Error"}),e.jsx("p",{children:r||H}),e.jsx("button",{onClick:()=>a("/dashboard"),className:"btn primary",children:"Return to Dashboard"})]})}):t?e.jsxs("div",{className:`video-call-room ${v?"fullscreen":""}`,children:[e.jsxs("div",{className:"call-header",children:[e.jsxs("div",{className:"call-info",children:[e.jsx("h2",{children:"Video Consultation"}),e.jsxs("div",{className:"call-details",children:[e.jsxs("span",{className:"participant-info",children:[t.appointmentDetails.doctor.name," & ",t.appointmentDetails.patient.name]}),e.jsx("span",{className:"call-duration",children:se(p)}),e.jsxs("span",{className:`connection-status ${T}`,children:[T==="good"?"🟢":T==="poor"?"🟡":"🔴"," ",T]})]})]}),e.jsxs("div",{className:"call-actions",children:[e.jsx("button",{onClick:U,className:"btn secondary icon-btn",title:"Toggle Fullscreen",children:"⛶"}),e.jsxs("button",{onClick:()=>f(!o),className:`btn secondary icon-btn ${o?"active":""}`,title:"Toggle Chat",children:["💬 ",D.length>0&&e.jsx("span",{className:"badge",children:D.length})]})]})]}),e.jsxs("div",{className:"video-area",children:[e.jsx("div",{className:"remote-videos",children:b.filter(_=>_.userId!==t.appointmentDetails.patient.id&&_.userId!==t.appointmentDetails.doctor.id).length===0?e.jsxs("div",{className:"waiting-message",children:[e.jsx("h3",{children:"Waiting for other participant to join..."}),e.jsxs("p",{children:["Share this room with: ",t.appointmentDetails.doctor.name," and ",t.appointmentDetails.patient.name]})]}):Array.from(d.entries()).map(([_,ce])=>{var ie;return e.jsxs("div",{className:"remote-video-container",children:[e.jsx("video",{ref:je=>{je&&C.current.set(_,je)},autoPlay:!0,playsInline:!0,className:"remote-video"}),e.jsx("div",{className:"video-overlay",children:e.jsx("span",{className:"participant-name",children:((ie=b.find(je=>je.userId===_))==null?void 0:ie.userName)||"Participant"})})]},_)})}),e.jsxs("div",{className:"local-video-container",children:[e.jsx("video",{ref:x,autoPlay:!0,muted:!0,playsInline:!0,className:`local-video ${S?"":"video-off"}`}),e.jsx("div",{className:"video-overlay",children:e.jsx("span",{className:"participant-name",children:"You"})}),!S&&e.jsxs("div",{className:"video-off-indicator",children:[e.jsx("span",{children:"📷"}),e.jsx("p",{children:"Camera Off"})]})]})]}),o&&e.jsxs("div",{className:"chat-panel",children:[e.jsxs("div",{className:"chat-header",children:[e.jsx("h3",{children:"Chat"}),e.jsx("button",{onClick:()=>f(!1),className:"btn secondary small",children:"✕"})]}),e.jsx("div",{className:"chat-messages",children:D.map(_=>e.jsxs("div",{className:`chat-message ${_.userId==="current-user"?"own":""}`,children:[e.jsxs("div",{className:"message-header",children:[e.jsx("span",{className:"sender-name",children:_.userName}),e.jsx("span",{className:"message-time",children:new Date(_.timestamp).toLocaleTimeString()})]}),e.jsx("div",{className:"message-content",children:_.message})]},_.id))}),e.jsxs("form",{onSubmit:oe,className:"chat-input-form",children:[e.jsx("input",{type:"text",value:y,onChange:_=>c(_.target.value),placeholder:"Type a message...",className:"chat-input"}),e.jsx("button",{type:"submit",className:"btn primary small",children:"Send"})]})]}),e.jsxs("div",{className:"call-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("button",{onClick:P,className:`btn control-btn ${w?"":"disabled"}`,title:w?"Mute":"Unmute",children:"🎤"}),e.jsx("button",{onClick:$,className:`btn control-btn ${S?"":"disabled"}`,title:S?"Turn off camera":"Turn on camera",children:"📹"}),e.jsx("button",{onClick:O,className:`btn control-btn ${k?"active":""}`,title:k?"Stop sharing":"Share screen",children:"🖥️"})]}),e.jsx("button",{onClick:B,className:"btn danger end-call-btn",title:"End call",children:"📞 End Call"})]})]}):e.jsx("div",{className:"video-call-error",children:"No room data available"})};function nn(){me();const{addNotification:s}=ge(),[a,t]=n.useState({personalInfo:{firstName:"",lastName:"",email:"",phone:"",bio:"",photo:""},professionalInfo:{specialization:"",licenseNumber:"",experience:"",education:"",certifications:"",consultationFee:""},preferences:{consultationDuration:30,bufferTime:15,maxDailyAppointments:20,autoConfirmBookings:!0,emailNotifications:!0,smsNotifications:!1,timezone:"America/New_York"},availability:{workingDays:{monday:!0,tuesday:!0,wednesday:!0,thursday:!0,friday:!0,saturday:!1,sunday:!1},workingHours:{start:"09:00",end:"17:00"}}}),[i,h]=n.useState(!0),[l,r]=n.useState(!1),[m,y]=n.useState("personal"),[c,o]=n.useState({currentPassword:"",newPassword:"",confirmPassword:""});n.useEffect(()=>{f()},[]);const f=async()=>{try{h(!0);const C=(await R.get("/doctors/profile")).data;C&&t(A=>{var N,d,S,w,k,D,b,T,H;return{...A,personalInfo:{firstName:((d=(N=C.user)==null?void 0:N.profile)==null?void 0:d.firstName)||"",lastName:((w=(S=C.user)==null?void 0:S.profile)==null?void 0:w.lastName)||"",email:((k=C.user)==null?void 0:k.email)||"",phone:((b=(D=C.user)==null?void 0:D.profile)==null?void 0:b.phone)||"",bio:C.bio||"",photo:((H=(T=C.user)==null?void 0:T.profile)==null?void 0:H.photo)||""},professionalInfo:{specialization:C.specialization||"",licenseNumber:C.licenseNumber||"",experience:C.experience||"",education:C.education||"",certifications:C.certifications||"",consultationFee:C.consultationFee||"50"}}})}catch(x){console.error("Error fetching doctor profile:",x),s("Failed to load profile data","error")}finally{h(!1)}},p=(x,C,A)=>{t(N=>({...N,[x]:{...N[x],[C]:A}}))},g=(x,C)=>{t(A=>({...A,availability:{...A.availability,workingDays:{...A.availability.workingDays,[x]:C}}}))},v=async x=>{try{r(!0);let C={};x==="personal"?C={bio:a.personalInfo.bio,user:{profile:{firstName:a.personalInfo.firstName,lastName:a.personalInfo.lastName,phone:a.personalInfo.phone,photo:a.personalInfo.photo}}}:x==="professional"?C={specialization:a.professionalInfo.specialization,licenseNumber:a.professionalInfo.licenseNumber,experience:a.professionalInfo.experience,education:a.professionalInfo.education,certifications:a.professionalInfo.certifications,consultationFee:a.professionalInfo.consultationFee}:x==="preferences"?C={preferences:a.preferences}:x==="availability"&&(C={availability:a.availability}),await R.put("/doctors/profile",C),s("Profile updated successfully","success")}catch(C){console.error("Error saving profile:",C),s("Failed to save profile changes","error")}finally{r(!1)}},u=async()=>{if(c.newPassword!==c.confirmPassword){s("New passwords do not match","error");return}if(c.newPassword.length<8){s("Password must be at least 8 characters long","error");return}try{r(!0),await R.put("/auth/change-password",{currentPassword:c.currentPassword,newPassword:c.newPassword}),s("Password changed successfully","success"),o({currentPassword:"",newPassword:"",confirmPassword:""})}catch{s("Failed to change password","error")}finally{r(!1)}};return i?e.jsxs("div",{className:"doctor-page",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading settings..."})]}):e.jsxs("div",{className:"doctor-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Settings"}),e.jsx("p",{children:"Manage your profile and preferences"})]}),e.jsxs("div",{className:"settings-container",children:[e.jsxs("div",{className:"settings-tabs",children:[e.jsx("button",{className:`tab ${m==="personal"?"active":""}`,onClick:()=>y("personal"),children:"Personal Info"}),e.jsx("button",{className:`tab ${m==="professional"?"active":""}`,onClick:()=>y("professional"),children:"Professional"}),e.jsx("button",{className:`tab ${m==="preferences"?"active":""}`,onClick:()=>y("preferences"),children:"Preferences"}),e.jsx("button",{className:`tab ${m==="availability"?"active":""}`,onClick:()=>y("availability"),children:"Availability"}),e.jsx("button",{className:`tab ${m==="security"?"active":""}`,onClick:()=>y("security"),children:"Security"})]}),e.jsxs("div",{className:"settings-content",children:[m==="personal"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Personal Information"}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"First Name"}),e.jsx("input",{type:"text",value:a.personalInfo.firstName,onChange:x=>p("personalInfo","firstName",x.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Last Name"}),e.jsx("input",{type:"text",value:a.personalInfo.lastName,onChange:x=>p("personalInfo","lastName",x.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email"}),e.jsx("input",{type:"email",value:a.personalInfo.email,disabled:!0,className:"disabled"}),e.jsx("small",{children:"Email cannot be changed. Contact support if needed."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone"}),e.jsx("input",{type:"tel",value:a.personalInfo.phone,onChange:x=>p("personalInfo","phone",x.target.value)})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Bio"}),e.jsx("textarea",{value:a.personalInfo.bio,onChange:x=>p("personalInfo","bio",x.target.value),rows:"4",placeholder:"Tell patients about yourself..."})]})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>v("personal"),disabled:l,children:l?"Saving...":"Save Personal Info"})]}),m==="professional"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Professional Information"}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Specialization"}),e.jsxs("select",{value:a.professionalInfo.specialization,onChange:x=>p("professionalInfo","specialization",x.target.value),children:[e.jsx("option",{value:"",children:"Select Specialization"}),e.jsx("option",{value:"General Medicine",children:"General Medicine"}),e.jsx("option",{value:"Cardiology",children:"Cardiology"}),e.jsx("option",{value:"Dermatology",children:"Dermatology"}),e.jsx("option",{value:"Orthopedics",children:"Orthopedics"}),e.jsx("option",{value:"Neurology",children:"Neurology"}),e.jsx("option",{value:"Psychiatry",children:"Psychiatry"}),e.jsx("option",{value:"Pediatrics",children:"Pediatrics"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"License Number"}),e.jsx("input",{type:"text",value:a.professionalInfo.licenseNumber,onChange:x=>p("professionalInfo","licenseNumber",x.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Years of Experience"}),e.jsx("input",{type:"number",value:a.professionalInfo.experience,onChange:x=>p("professionalInfo","experience",x.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Consultation Fee ($)"}),e.jsx("input",{type:"number",value:a.professionalInfo.consultationFee,onChange:x=>p("professionalInfo","consultationFee",x.target.value)})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Education"}),e.jsx("textarea",{value:a.professionalInfo.education,onChange:x=>p("professionalInfo","education",x.target.value),rows:"3",placeholder:"Medical school, residency, fellowships..."})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Certifications"}),e.jsx("textarea",{value:a.professionalInfo.certifications,onChange:x=>p("professionalInfo","certifications",x.target.value),rows:"3",placeholder:"Board certifications, additional qualifications..."})]})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>v("professional"),disabled:l,children:l?"Saving...":"Save Professional Info"})]}),m==="preferences"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Preferences"}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Default Consultation Duration (minutes)"}),e.jsxs("select",{value:a.preferences.consultationDuration,onChange:x=>p("preferences","consultationDuration",parseInt(x.target.value)),children:[e.jsx("option",{value:15,children:"15 minutes"}),e.jsx("option",{value:30,children:"30 minutes"}),e.jsx("option",{value:45,children:"45 minutes"}),e.jsx("option",{value:60,children:"60 minutes"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Buffer Time Between Appointments (minutes)"}),e.jsxs("select",{value:a.preferences.bufferTime,onChange:x=>p("preferences","bufferTime",parseInt(x.target.value)),children:[e.jsx("option",{value:0,children:"No buffer"}),e.jsx("option",{value:5,children:"5 minutes"}),e.jsx("option",{value:10,children:"10 minutes"}),e.jsx("option",{value:15,children:"15 minutes"}),e.jsx("option",{value:30,children:"30 minutes"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Maximum Daily Appointments"}),e.jsx("input",{type:"number",min:"1",max:"50",value:a.preferences.maxDailyAppointments,onChange:x=>p("preferences","maxDailyAppointments",parseInt(x.target.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Timezone"}),e.jsxs("select",{value:a.preferences.timezone,onChange:x=>p("preferences","timezone",x.target.value),children:[e.jsx("option",{value:"America/New_York",children:"Eastern Time"}),e.jsx("option",{value:"America/Chicago",children:"Central Time"}),e.jsx("option",{value:"America/Denver",children:"Mountain Time"}),e.jsx("option",{value:"America/Los_Angeles",children:"Pacific Time"})]})]})]}),e.jsxs("div",{className:"checkbox-group",children:[e.jsx("h3",{children:"Booking Preferences"}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:a.preferences.autoConfirmBookings,onChange:x=>p("preferences","autoConfirmBookings",x.target.checked)}),"Auto-confirm new bookings"]})]}),e.jsxs("div",{className:"checkbox-group",children:[e.jsx("h3",{children:"Notification Preferences"}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:a.preferences.emailNotifications,onChange:x=>p("preferences","emailNotifications",x.target.checked)}),"Email notifications"]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:a.preferences.smsNotifications,onChange:x=>p("preferences","smsNotifications",x.target.checked)}),"SMS notifications"]})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>v("preferences"),disabled:l,children:l?"Saving...":"Save Preferences"})]}),m==="availability"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Availability Settings"}),e.jsxs("div",{className:"availability-section",children:[e.jsx("h3",{children:"Working Days"}),e.jsx("div",{className:"days-grid",children:Object.keys(a.availability.workingDays).map(x=>e.jsxs("label",{className:"day-checkbox",children:[e.jsx("input",{type:"checkbox",checked:a.availability.workingDays[x],onChange:C=>g(x,C.target.checked)}),x.charAt(0).toUpperCase()+x.slice(1)]},x))})]}),e.jsxs("div",{className:"availability-section",children:[e.jsx("h3",{children:"Working Hours"}),e.jsxs("div",{className:"time-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Start Time"}),e.jsx("input",{type:"time",value:a.availability.workingHours.start,onChange:x=>p("availability","workingHours",{...a.availability.workingHours,start:x.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"End Time"}),e.jsx("input",{type:"time",value:a.availability.workingHours.end,onChange:x=>p("availability","workingHours",{...a.availability.workingHours,end:x.target.value})})]})]})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>v("availability"),disabled:l,children:l?"Saving...":"Save Availability"})]}),m==="security"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Security Settings"}),e.jsxs("div",{className:"security-section",children:[e.jsx("h3",{children:"Change Password"}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Current Password"}),e.jsx("input",{type:"password",value:c.currentPassword,onChange:x=>o({...c,currentPassword:x.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"New Password"}),e.jsx("input",{type:"password",value:c.newPassword,onChange:x=>o({...c,newPassword:x.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Confirm New Password"}),e.jsx("input",{type:"password",value:c.confirmPassword,onChange:x=>o({...c,confirmPassword:x.target.value})})]})]}),e.jsx("button",{className:"btn btn-primary",onClick:u,disabled:l||!c.currentPassword||!c.newPassword,children:l?"Changing...":"Change Password"})]}),e.jsxs("div",{className:"security-section",children:[e.jsx("h3",{children:"Account Security"}),e.jsxs("div",{className:"security-info",children:[e.jsx("p",{children:"✅ Account verified"}),e.jsx("p",{children:"✅ Two-factor authentication enabled"}),e.jsx("p",{children:"✅ HIPAA compliant"})]})]})]})]})]})]})}function rn(){const[s,a]=n.useState(null),[t,i]=n.useState(!0),[h,l]=n.useState(null);return n.useEffect(()=>{let r=!0;async function m(){var y,c,o;try{i(!0);const f=await R.get("/pharmacy/me");if(!r)return;a(((y=f.data)==null?void 0:y.data)||null)}catch(f){if(!r)return;l(((o=(c=f==null?void 0:f.response)==null?void 0:c.data)==null?void 0:o.message)||f.message)}finally{r&&i(!1)}}return m(),()=>{r=!1}},[]),e.jsxs("div",{className:"admin-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Pharmacy Portal"}),e.jsxs("div",{className:"actions",children:[e.jsx(V,{className:"btn",to:"/pharmacy/inventory",children:"Inventory"}),e.jsx(V,{className:"btn",to:"/pharmacy/orders",children:"Orders"}),e.jsx(V,{className:"btn",to:"/pharmacy/profile/edit",children:"Update Profile"})]})]}),t&&e.jsx("p",{children:"Loading…"}),h&&e.jsxs("div",{className:"card",style:{borderColor:"crimson"},children:[e.jsx("p",{style:{color:"crimson"},children:String(h)}),String(h).toLowerCase().includes("no pharmacy profile")&&e.jsx(zs,{})]}),s?e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:s.name}),e.jsxs("p",{children:["Status: ",s.verificationStatus]}),e.jsx("p",{children:s.address||s.city||s.country?`${s.address||""} ${s.city||""} ${s.country||""}`:"No address set"}),e.jsx("div",{style:{marginTop:12},children:e.jsx(V,{className:"btn",to:"/pharmacy/profile/edit",children:"Edit Profile"})})]}):!t&&!h?e.jsxs("div",{className:"card",children:[e.jsx("p",{children:"No profile yet. Use this button to create one."}),e.jsx(zs,{})]}):null,e.jsxs("div",{className:"analytics-section",children:[e.jsx("h2",{children:"Quick Actions"}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx(V,{className:"btn",to:"/pharmacy/inventory",children:"View Inventory"}),e.jsx(V,{className:"btn",to:"/pharmacy/orders",children:"View Orders"}),e.jsx(V,{className:"btn",to:"/pharmacy/profile/edit",children:"Update Profile"})]})]})]})}function zs(){const[s,a]=n.useState(!1),[t,i]=n.useState(""),h=async()=>{var l,r;try{a(!0),i(""),await R.post("/pharmacy/register",{name:"My Pharmacy"}),i("Registered. Refresh the page.")}catch(m){i(((r=(l=m==null?void 0:m.response)==null?void 0:l.data)==null?void 0:r.message)||m.message)}finally{a(!1)}};return e.jsxs("div",{children:[e.jsx("button",{className:"btn",onClick:h,disabled:s,children:s?"Registering…":"Register Pharmacy"}),t&&e.jsx("p",{style:{marginTop:8},children:t})]})}function na(){const[s,a]=n.useState([]),[t,i]=n.useState(!0),[h,l]=n.useState(null),[r,m]=n.useState(!1),[y,c]=n.useState(""),[o,f]=n.useState({sku:"",unitPrice:"",qtyOnHand:""});return n.useEffect(()=>{let p=!0;async function g(){var v,u,x;try{i(!0);const C=await R.get("/pharmacy/inventory?page=1&pageSize=50&sort=-updatedAt");if(!p)return;a(Array.isArray((v=C.data)==null?void 0:v.data)?C.data.data:[])}catch(C){if(!p)return;l(((x=(u=C==null?void 0:C.response)==null?void 0:u.data)==null?void 0:x.message)||C.message)}finally{p&&i(!1)}}return g(),()=>{p=!1}},[]),e.jsxs("div",{className:"admin-page",children:[e.jsx("div",{className:"page-header",children:e.jsx("h1",{children:"Pharmacy Inventory"})}),t&&e.jsx("p",{children:"Loading…"}),h&&e.jsxs("div",{className:"card",style:{borderColor:"crimson"},children:[e.jsx("p",{style:{color:"crimson"},children:String(h)}),String(h).toLowerCase().includes("no pharmacy profile")&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx("p",{children:"Please register your pharmacy profile first."}),e.jsx(V,{className:"btn",to:"/pharmacy/portal",children:"Go to Pharmacy Portal"})]})]}),!t&&s.length===0&&e.jsx("p",{children:"No inventory yet."}),e.jsxs("div",{className:"card",style:{marginBottom:16},children:[e.jsx("h3",{children:"Add Inventory"}),e.jsx("p",{style:{marginTop:-8,color:"#666"},children:"Provide at least SKU, Unit Price, and Quantity."}),e.jsxs("div",{className:"form",style:{display:"grid",gridTemplateColumns:"repeat(4, minmax(160px, 1fr))",gap:8},children:[e.jsxs("label",{children:["SKU",e.jsx("input",{value:o.sku,onChange:p=>f(g=>({...g,sku:p.target.value})),placeholder:"e.g. AMOX-500"})]}),e.jsxs("label",{children:["Unit Price",e.jsx("input",{type:"number",value:o.unitPrice,onChange:p=>f(g=>({...g,unitPrice:p.target.value})),placeholder:"10"})]}),e.jsxs("label",{children:["Qty On Hand",e.jsx("input",{type:"number",value:o.qtyOnHand,onChange:p=>f(g=>({...g,qtyOnHand:p.target.value})),placeholder:"100"})]}),e.jsxs("div",{style:{alignSelf:"end"},children:[e.jsxs("button",{className:"btn",disabled:r,onClick:async()=>{var p,g,v;try{m(!0),c("");const u={sku:o.sku||void 0,unitPrice:o.unitPrice?Number(o.unitPrice):void 0,qtyOnHand:o.qtyOnHand?Number(o.qtyOnHand):void 0};await R.post("/pharmacy/inventory",[u]);const x=await R.get("/pharmacy/inventory?page=1&pageSize=50&sort=-updatedAt");a(Array.isArray((p=x.data)==null?void 0:p.data)?x.data.data:[]),f({sku:"",unitPrice:"",qtyOnHand:""})}catch(u){c(((v=(g=u==null?void 0:u.response)==null?void 0:g.data)==null?void 0:v.message)||u.message)}finally{m(!1)}},children:[" ",r?"Adding…":"Add"," "]}),y&&e.jsx("div",{style:{color:"crimson",marginTop:6},children:y})]})]})]}),e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"SKU"}),e.jsx("th",{children:"Drug"}),e.jsx("th",{children:"Unit Price"}),e.jsx("th",{children:"Qty On Hand"}),e.jsx("th",{children:"Updated"})]})}),e.jsx("tbody",{children:s.map(p=>e.jsxs("tr",{children:[e.jsx("td",{children:p.sku||"-"}),e.jsx("td",{children:String(p.drugId||"").slice(-6)}),e.jsx("td",{children:p.unitPrice!=null?p.unitPrice:"-"}),e.jsx("td",{children:p.qtyOnHand!=null?p.qtyOnHand:"-"}),e.jsx("td",{children:p.updatedAt?new Date(p.updatedAt).toLocaleString():"-"})]},p._id))})]})]})}const ln=["New","Accepted","ReadyForPickup","Dispensed","Rejected","Canceled"];function ra(){const[s,a]=ds(),[t,i]=n.useState([]),[h,l]=n.useState(!0),[r,m]=n.useState(null),y=s.get("status")||"";return n.useEffect(()=>{let c=!0;async function o(){var f,p,g;try{l(!0);const v=`/pharmacy/orders?${y?`status=${encodeURIComponent(y)}&`:""}page=1&pageSize=50&sort=-createdAt`,u=await R.get(v);if(!c)return;i(Array.isArray((f=u.data)==null?void 0:f.data)?u.data.data:[])}catch(v){if(!c)return;m(((g=(p=v==null?void 0:v.response)==null?void 0:p.data)==null?void 0:g.message)||v.message)}finally{c&&l(!1)}}return o(),()=>{c=!1}},[y]),e.jsxs("div",{className:"admin-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Pharmacy Orders"}),e.jsx("div",{className:"actions",children:e.jsxs("select",{value:y,onChange:c=>{const o=c.target.value;o?s.set("status",o):s.delete("status"),a(s,{replace:!0})},children:[e.jsx("option",{value:"",children:"All"}),ln.map(c=>e.jsx("option",{value:c,children:c},c))]})})]}),h&&e.jsx("p",{children:"Loading…"}),r&&e.jsxs("div",{className:"card",style:{borderColor:"crimson"},children:[e.jsx("p",{style:{color:"crimson"},children:String(r)}),String(r).toLowerCase().includes("no pharmacy profile")&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx("p",{children:"Please register your pharmacy profile first."}),e.jsx(V,{className:"btn",to:"/pharmacy/portal",children:"Go to Pharmacy Portal"})]})]}),e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Order"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:t.map(c=>e.jsxs("tr",{children:[e.jsx("td",{children:String(c._id).slice(-8)}),e.jsx("td",{children:c.status}),e.jsx("td",{children:c.createdAt?new Date(c.createdAt).toLocaleString():"-"}),e.jsxs("td",{children:[c.status==="New"&&e.jsx(qs,{id:c._id,path:"accept",label:"Accept"}),c.status==="Accepted"&&e.jsx(qs,{id:c._id,path:"ready",label:"Mark Ready"})]})]},c._id))})]})]})}function qs({id:s,path:a,label:t}){const[i,h]=n.useState(!1),[l,r]=n.useState(""),m=async()=>{var y,c;try{h(!0),r(""),await R.patch(`/pharmacy/orders/${s}/${a}`,{}),window.location.reload()}catch(o){r(((c=(y=o==null?void 0:o.response)==null?void 0:y.data)==null?void 0:c.message)||o.message)}finally{h(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn",disabled:i,onClick:m,children:i?"…":t}),l&&e.jsx("div",{style:{color:"crimson"},children:l})]})}function on(){const s=ye(),[a,t]=n.useState({name:"",address:"",city:"",state:"",country:"",phone:""}),[i,h]=n.useState(!0),[l,r]=n.useState(!1),[m,y]=n.useState(null),[c,o]=n.useState("");n.useEffect(()=>{let g=!0;async function v(){var u,x,C,A;try{h(!0),y(null);const N=await R.get("/pharmacy/me");if(!g)return;const d=((u=N.data)==null?void 0:u.data)||{};t({name:d.name||"",address:d.address||"",city:d.city||"",state:d.state||"",country:d.country||"",phone:d.phone||""})}catch(N){if(!g)return;((x=N==null?void 0:N.response)==null?void 0:x.status)===404?y("No pharmacy profile found. Please register first."):y(((A=(C=N==null?void 0:N.response)==null?void 0:C.data)==null?void 0:A.message)||N.message)}finally{g&&h(!1)}}return v(),()=>{g=!1}},[]);const f=g=>{const{name:v,value:u}=g.target;t(x=>({...x,[v]:u}))},p=async g=>{var v,u;g.preventDefault();try{r(!0),o(""),y(null),await R.put("/pharmacy/me",a),o("Profile updated successfully."),setTimeout(()=>s("/pharmacy/portal"),800)}catch(x){y(((u=(v=x==null?void 0:x.response)==null?void 0:v.data)==null?void 0:u.message)||x.message)}finally{r(!1)}};return e.jsxs("div",{className:"admin-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Edit Pharmacy Profile"}),e.jsx("div",{className:"actions",children:e.jsx(V,{className:"btn",to:"/pharmacy/portal",children:"Back to Portal"})})]}),i&&e.jsx("p",{children:"Loading…"}),m&&e.jsxs("div",{children:[e.jsx("p",{style:{color:"crimson"},children:String(m)}),String(m).includes("register")&&e.jsx(V,{className:"btn",to:"/pharmacy/portal",children:"Go to Portal to Register"})]}),!i&&!m&&e.jsxs("form",{onSubmit:p,className:"form",children:[e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"Name"}),e.jsx("input",{name:"name",value:a.name,onChange:f,required:!0})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"Address"}),e.jsx("input",{name:"address",value:a.address,onChange:f})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"City"}),e.jsx("input",{name:"city",value:a.city,onChange:f})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"State"}),e.jsx("input",{name:"state",value:a.state,onChange:f})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"Country"}),e.jsx("input",{name:"country",value:a.country,onChange:f})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"Phone"}),e.jsx("input",{name:"phone",value:a.phone,onChange:f})]}),e.jsx("div",{className:"actions",children:e.jsx("button",{className:"btn",type:"submit",disabled:l,children:l?"Saving…":"Save Changes"})}),c&&e.jsx("p",{style:{marginTop:8},children:c})]})]})}function cn(){const[s,a]=n.useState(null),[t,i]=n.useState(!0),[h,l]=n.useState(null);return n.useEffect(()=>{let r=!0;async function m(){var y,c,o;try{i(!0);const f=await R.get("/laboratory/me");if(!r)return;a(((y=f.data)==null?void 0:y.data)||null)}catch(f){if(!r)return;l(((o=(c=f==null?void 0:f.response)==null?void 0:c.data)==null?void 0:o.message)||f.message)}finally{r&&i(!1)}}return m(),()=>{r=!1}},[]),e.jsxs("div",{className:"admin-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Laboratory Portal"}),e.jsxs("div",{className:"actions",children:[e.jsx(V,{className:"btn",to:"/laboratory/catalog",children:"Catalog"}),e.jsx(V,{className:"btn",to:"/laboratory/orders",children:"Orders"}),e.jsx(V,{className:"btn",to:"/laboratory/profile/edit",children:"Update Profile"})]})]}),t&&e.jsx("p",{children:"Loading…"}),h&&e.jsxs("div",{className:"card",style:{borderColor:"crimson"},children:[e.jsx("p",{style:{color:"crimson"},children:String(h)}),String(h).toLowerCase().includes("no laboratory profile")&&e.jsx(Hs,{})]}),s?e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:s.name}),e.jsxs("p",{children:["Status: ",s.verificationStatus]}),e.jsx("p",{children:s.address||s.city||s.country?`${s.address||""} ${s.city||""} ${s.country||""}`:"No address set"}),e.jsx("div",{style:{marginTop:12},children:e.jsx(V,{className:"btn",to:"/laboratory/profile/edit",children:"Edit Profile"})})]}):!t&&!h?e.jsxs("div",{className:"card",children:[e.jsx("p",{children:"No profile yet. Use this button to create one."}),e.jsx(Hs,{})]}):null]})}function Hs(){const[s,a]=n.useState(!1),[t,i]=n.useState(""),h=async()=>{var l,r;try{a(!0),i(""),await R.post("/laboratory/register",{name:"My Laboratory"}),i("Registered. Refresh the page.")}catch(m){i(((r=(l=m==null?void 0:m.response)==null?void 0:l.data)==null?void 0:r.message)||m.message)}finally{a(!1)}};return e.jsxs("div",{children:[e.jsx("button",{className:"btn",onClick:h,disabled:s,children:s?"Registering…":"Register Laboratory"}),t&&e.jsx("p",{style:{marginTop:8},children:t})]})}function ia(){const[s,a]=n.useState([]),[t,i]=n.useState(!0),[h,l]=n.useState(null),[r,m]=n.useState(!1),[y,c]=n.useState(""),[o,f]=n.useState({testCode:"",testName:"",price:"",technology:""});return n.useEffect(()=>{let p=!0;async function g(){var v,u,x;try{i(!0);const C=await R.get("/laboratory/catalog?page=1&pageSize=50&sort=-updatedAt");if(!p)return;a(Array.isArray((v=C.data)==null?void 0:v.data)?C.data.data:[])}catch(C){if(!p)return;l(((x=(u=C==null?void 0:C.response)==null?void 0:u.data)==null?void 0:x.message)||C.message)}finally{p&&i(!1)}}return g(),()=>{p=!1}},[]),e.jsxs("div",{className:"admin-page",children:[e.jsx("div",{className:"page-header",children:e.jsx("h1",{children:"Lab Test Catalog"})}),t&&e.jsx("p",{children:"Loading…"}),h&&e.jsxs("div",{className:"card",style:{borderColor:"crimson"},children:[e.jsx("p",{style:{color:"crimson"},children:String(h)}),String(h).toLowerCase().includes("no laboratory profile")&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx("p",{children:"Please register your laboratory profile first."}),e.jsx(V,{className:"btn",to:"/laboratory/portal",children:"Go to Laboratory Portal"})]})]}),!t&&s.length===0&&e.jsx("p",{children:"No catalog items yet."}),e.jsxs("div",{className:"card",style:{marginBottom:16},children:[e.jsx("h3",{children:"Add Test"}),e.jsxs("div",{className:"form",style:{display:"grid",gridTemplateColumns:"repeat(5, minmax(140px, 1fr))",gap:8},children:[e.jsxs("label",{children:["Code",e.jsx("input",{value:o.testCode,onChange:p=>f(g=>({...g,testCode:p.target.value})),placeholder:"HB1AC"})]}),e.jsxs("label",{children:["Name",e.jsx("input",{value:o.testName,onChange:p=>f(g=>({...g,testName:p.target.value})),placeholder:"Hemoglobin A1c"})]}),e.jsxs("label",{children:["Technology",e.jsx("input",{value:o.technology,onChange:p=>f(g=>({...g,technology:p.target.value})),placeholder:"ELISA"})]}),e.jsxs("label",{children:["Price",e.jsx("input",{type:"number",value:o.price,onChange:p=>f(g=>({...g,price:p.target.value})),placeholder:"250"})]}),e.jsxs("div",{style:{alignSelf:"end"},children:[e.jsx("button",{className:"btn",disabled:r,onClick:async()=>{var p,g,v;try{m(!0),c("");const u={testCode:o.testCode||void 0,testName:o.testName||void 0,price:o.price?Number(o.price):void 0,technology:o.technology||void 0};await R.post("/laboratory/catalog",[u]);const x=await R.get("/laboratory/catalog?page=1&pageSize=50&sort=-updatedAt");a(Array.isArray((p=x.data)==null?void 0:p.data)?x.data.data:[]),f({testCode:"",testName:"",price:"",technology:""})}catch(u){c(((v=(g=u==null?void 0:u.response)==null?void 0:g.data)==null?void 0:v.message)||u.message)}finally{m(!1)}},children:r?"Adding…":"Add"}),y&&e.jsx("div",{style:{color:"crimson",marginTop:6},children:y})]})]})]}),e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Technology"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Updated"})]})}),e.jsx("tbody",{children:s.map(p=>e.jsxs("tr",{children:[e.jsx("td",{children:p.testCode}),e.jsx("td",{children:p.testName}),e.jsx("td",{children:p.technology}),e.jsx("td",{children:p.price!=null?p.price:"-"}),e.jsx("td",{children:p.updatedAt?new Date(p.updatedAt).toLocaleString():"-"})]},p._id))})]})]})}const dn=["ordered","in-progress","completed","rejected","canceled"];function Ps(){const[s,a]=ds(),[t,i]=n.useState([]),[h,l]=n.useState(!0),[r,m]=n.useState(null),y=s.get("status")||"";return n.useEffect(()=>{let c=!0;async function o(){var f,p,g;try{l(!0);const v=`/laboratory/orders?${y?`status=${encodeURIComponent(y)}&`:""}page=1&pageSize=50&sort=-createdAt`,u=await R.get(v);if(!c)return;i(Array.isArray((f=u.data)==null?void 0:f.data)?u.data.data:[])}catch(v){if(!c)return;m(((g=(p=v==null?void 0:v.response)==null?void 0:p.data)==null?void 0:g.message)||v.message)}finally{c&&l(!1)}}return o(),()=>{c=!1}},[y]),e.jsxs("div",{className:"admin-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Laboratory Orders"}),e.jsx("div",{className:"actions",children:e.jsxs("select",{value:y,onChange:c=>{const o=c.target.value;o?s.set("status",o):s.delete("status"),a(s,{replace:!0})},children:[e.jsx("option",{value:"",children:"All"}),dn.map(c=>e.jsx("option",{value:c,children:c},c))]})})]}),h&&e.jsx("p",{children:"Loading…"}),r&&e.jsxs("div",{className:"card",style:{borderColor:"crimson"},children:[e.jsx("p",{style:{color:"crimson"},children:String(r)}),String(r).toLowerCase().includes("no laboratory profile")&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx("p",{children:"Please register your laboratory profile first."}),e.jsx(V,{className:"btn",to:"/laboratory/portal",children:"Go to Laboratory Portal"})]})]}),e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Exam"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created"})]})}),e.jsx("tbody",{children:t.map(c=>e.jsxs("tr",{children:[e.jsx("td",{children:String(c._id).slice(-8)}),e.jsx("td",{children:c.status}),e.jsx("td",{children:c.createdAt?new Date(c.createdAt).toLocaleString():"-"})]},c._id))})]})]})}function hn(){const s=ye(),[a,t]=n.useState({name:"",address:"",city:"",state:"",country:"",phone:""}),[i,h]=n.useState(!0),[l,r]=n.useState(!1),[m,y]=n.useState(null),[c,o]=n.useState("");n.useEffect(()=>{let g=!0;async function v(){var u,x,C,A;try{h(!0),y(null);const N=await R.get("/laboratory/me");if(!g)return;const d=((u=N.data)==null?void 0:u.data)||{};t({name:d.name||"",address:d.address||"",city:d.city||"",state:d.state||"",country:d.country||"",phone:d.phone||""})}catch(N){if(!g)return;((x=N==null?void 0:N.response)==null?void 0:x.status)===404?y("No laboratory profile found. Please register first."):y(((A=(C=N==null?void 0:N.response)==null?void 0:C.data)==null?void 0:A.message)||N.message)}finally{g&&h(!1)}}return v(),()=>{g=!1}},[]);const f=g=>{const{name:v,value:u}=g.target;t(x=>({...x,[v]:u}))},p=async g=>{var v,u;g.preventDefault();try{r(!0),o(""),y(null),await R.put("/laboratory/me",a),o("Profile updated successfully."),setTimeout(()=>s("/laboratory/portal"),800)}catch(x){y(((u=(v=x==null?void 0:x.response)==null?void 0:v.data)==null?void 0:u.message)||x.message)}finally{r(!1)}};return e.jsxs("div",{className:"admin-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Edit Laboratory Profile"}),e.jsx("div",{className:"actions",children:e.jsx(V,{className:"btn",to:"/laboratory/portal",children:"Back to Portal"})})]}),i&&e.jsx("p",{children:"Loading…"}),m&&e.jsxs("div",{children:[e.jsx("p",{style:{color:"crimson"},children:String(m)}),String(m).includes("register")&&e.jsx(V,{className:"btn",to:"/laboratory/portal",children:"Go to Portal to Register"})]}),!i&&!m&&e.jsxs("form",{onSubmit:p,className:"form",children:[e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"Name"}),e.jsx("input",{name:"name",value:a.name,onChange:f,required:!0})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"Address"}),e.jsx("input",{name:"address",value:a.address,onChange:f})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"City"}),e.jsx("input",{name:"city",value:a.city,onChange:f})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"State"}),e.jsx("input",{name:"state",value:a.state,onChange:f})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"Country"}),e.jsx("input",{name:"country",value:a.country,onChange:f})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"Phone"}),e.jsx("input",{name:"phone",value:a.phone,onChange:f})]}),e.jsx("div",{className:"actions",children:e.jsx("button",{className:"btn",type:"submit",disabled:l,children:l?"Saving…":"Save Changes"})}),c&&e.jsx("p",{style:{marginTop:8},children:c})]})]})}const Je={countries:["KE","NG","ET","ZA","GH"],technologies:["PCR","ELISA","Chem Analyzer","Hematology","Immunoassay"],turnaround:["6h","12h","24h","2-3 days"],drugs:[{id:101,name:"Amoxicillin 500mg cap"},{id:102,name:"Paracetamol 500mg tab"},{id:103,name:"Metformin 500mg tab"}]};function mn(){const{user:s}=me(),a=s==null?void 0:s.role,[t,i]=ds(),h=a==="pharmacist"?"Pharmacy":a==="laboratory"?"Laboratory":"Discovery",l=a==="pharmacist"?["Pharmacy","Discovery"]:a==="laboratory"?["Laboratory","Discovery"]:["Discovery"],r=t.get("tab"),m=l.includes(r||"")?r:h,y=f=>{t.set("tab",f),f==="Pharmacy"&&t.set("sub","Profile"),f==="Laboratory"&&t.set("sub","Profile"),f==="Discovery"&&t.set("sub","Pharmacy Finder"),i(t,{replace:!0})},c=t.get("sub")||(m==="Pharmacy"||m==="Laboratory"?"Profile":"Pharmacy Finder"),o=f=>{t.set("sub",f),i(t,{replace:!0})};return n.useEffect(()=>{l.includes(m)||(t.set("tab",h),i(t,{replace:!0}))},[a]),e.jsxs("div",{className:"admin-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Portals"}),e.jsxs("div",{className:"actions",children:[l.includes("Pharmacy")&&e.jsx(js,{active:m==="Pharmacy",onClick:()=>y("Pharmacy"),children:"Pharmacy"}),l.includes("Laboratory")&&e.jsx(js,{active:m==="Laboratory",onClick:()=>y("Laboratory"),children:"Laboratory"}),l.includes("Discovery")&&e.jsx(js,{active:m==="Discovery",onClick:()=>y("Discovery"),children:"Discovery"})]})]}),m==="Pharmacy"&&a==="pharmacist"&&e.jsxs(ws,{subTabs:["Profile","Inventory","Orders","Reports"],current:c,onChange:o,children:[c==="Profile"&&e.jsx(un,{}),c==="Inventory"&&e.jsx(na,{}),c==="Orders"&&e.jsx(ra,{}),c==="Reports"&&e.jsx(pn,{})]}),m==="Pharmacy"&&a!=="pharmacist"&&e.jsx(Vs,{portalName:"Pharmacy",allowedRole:"pharmacist"}),m==="Laboratory"&&a==="laboratory"&&e.jsxs(ws,{subTabs:["Profile","Test Catalog","Orders","Results"],current:c,onChange:o,children:[c==="Profile"&&e.jsx(xn,{}),c==="Test Catalog"&&e.jsx(ia,{}),c==="Orders"&&e.jsx(Ps,{}),c==="Results"&&e.jsx(Ps,{})]}),m==="Laboratory"&&a!=="laboratory"&&e.jsx(Vs,{portalName:"Laboratory",allowedRole:"laboratory"}),m==="Discovery"&&e.jsxs(ws,{subTabs:["Pharmacy Finder","Lab Finder","Order Threads"],current:c,onChange:o,children:[c==="Pharmacy Finder"&&e.jsx(jn,{}),c==="Lab Finder"&&e.jsx(gn,{}),c==="Order Threads"&&e.jsxs("div",{children:[e.jsx("p",{children:"Open contextual chat for orders."}),e.jsx(V,{className:"btn",to:"/chat",children:"Open Chat"})]})]})]})}function js({active:s,onClick:a,children:t}){return e.jsx("button",{className:"btn",style:{background:s?"#2563eb":void 0,color:s?"#fff":void 0},onClick:a,children:t})}function ws({subTabs:s,current:a,onChange:t,children:i}){return e.jsxs("div",{children:[e.jsx("div",{style:{display:"flex",gap:8,marginBottom:12},children:s.map(h=>e.jsx(js,{active:a===h,onClick:()=>t(h),children:h},h))}),e.jsx("div",{children:i})]})}function un(){const[s,a]=n.useState(!0),[t,i]=n.useState(""),[h,l]=n.useState(""),[r,m]=n.useState({name:"",address:"",city:"",country:"KE",phone:""});n.useEffect(()=>{let o=!0;return(async()=>{var f,p,g,v;try{a(!0);const u=await xe.get("/pharmacy/me");if(!o)return;const x=((f=u.data)==null?void 0:f.data)||{};m({name:x.name||"",address:x.address||"",city:x.city||"",country:x.country||"KE",phone:x.phone||""})}catch(u){if(!o)return;((p=u==null?void 0:u.response)==null?void 0:p.status)===404?i("No pharmacy profile"):i(((v=(g=u==null?void 0:u.response)==null?void 0:g.data)==null?void 0:v.message)||u.message)}finally{o&&a(!1)}})(),()=>{o=!1}},[]);const y=async o=>{var f,p;o.preventDefault();try{if(l(""),i(""),!/^\+[0-9\-\s]{6,}$/.test(r.phone||"")){i("Phone should be E.164 (e.g. +254712345678)");return}await xe.put("/pharmacy/me",r),l("Saved")}catch(g){i(((p=(f=g==null?void 0:g.response)==null?void 0:f.data)==null?void 0:p.message)||g.message)}},c=async()=>{var o,f;try{await xe.post("/pharmacy/register",{name:r.name||"My Pharmacy"}),i(""),l("Registered. You can now save full details.")}catch(p){i(((f=(o=p==null?void 0:p.response)==null?void 0:o.data)==null?void 0:f.message)||p.message)}};return e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Pharmacy Profile"}),s&&e.jsx("p",{children:"Loading…"}),t&&e.jsxs("div",{style:{color:"crimson",marginBottom:8},children:[t," ",t.includes("No pharmacy profile")&&e.jsx("button",{className:"btn",onClick:c,style:{marginLeft:8},children:"Register"})]}),e.jsxs("form",{onSubmit:y,className:"form",style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(220px, 1fr))",gap:8},children:[e.jsxs("label",{children:["Name",e.jsx("input",{value:r.name,onChange:o=>m(f=>({...f,name:o.target.value})),required:!0})]}),e.jsxs("label",{children:["Phone",e.jsx("input",{value:r.phone,onChange:o=>m(f=>({...f,phone:o.target.value})),placeholder:"+254..."})]}),e.jsxs("label",{children:["Address",e.jsx("input",{value:r.address,onChange:o=>m(f=>({...f,address:o.target.value}))})]}),e.jsxs("label",{children:["City",e.jsx("input",{value:r.city,onChange:o=>m(f=>({...f,city:o.target.value}))})]}),e.jsxs("label",{children:["Country",e.jsx("select",{value:r.country,onChange:o=>m(f=>({...f,country:o.target.value})),children:Je.countries.map(o=>e.jsx("option",{value:o,children:o},o))})]}),e.jsxs("div",{style:{alignSelf:"end"},children:[e.jsx("button",{className:"btn",type:"submit",children:"Save"}),h&&e.jsx("span",{style:{marginLeft:8},children:h})]})]}),e.jsx("div",{style:{marginTop:12},children:e.jsx(V,{className:"btn",to:"/pharmacy/profile/edit",children:"Open Full Profile Editor"})})]})}function pn(){const[s,a]=n.useState([]);n.useEffect(()=>{let h=!0;return(async()=>{var l;try{const r=await xe.get("/pharmacy/inventory?page=1&pageSize=200&sort=-updatedAt");if(!h)return;a(Array.isArray((l=r.data)==null?void 0:l.data)?r.data.data:[])}catch{}})(),()=>{h=!1}},[]);const t=s.filter(h=>typeof h.reorderLevel=="number"&&typeof h.qtyOnHand=="number"&&h.qtyOnHand<=h.reorderLevel).slice(0,10),i=s.filter(h=>h.expiryDate&&new Date(h.expiryDate).getTime()-Date.now()<30*24*3600*1e3).slice(0,10);return e.jsxs("div",{className:"grid-2",style:{display:"grid",gap:12,gridTemplateColumns:"1fr 1fr"},children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Low Stock"}),t.length===0?e.jsx("p",{children:"None"}):t.map(h=>e.jsxs("div",{children:[h.sku||String(h.drugId).slice(-6)," — ",h.qtyOnHand]},h._id))]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Expiring Soon"}),i.length===0?e.jsx("p",{children:"None"}):i.map(h=>e.jsxs("div",{children:[h.sku||String(h.drugId).slice(-6)," —"," ",new Date(h.expiryDate).toLocaleDateString()]},h._id))]})]})}function xn(){const[s,a]=n.useState(!0),[t,i]=n.useState(""),[h,l]=n.useState(""),[r,m]=n.useState({name:"",address:"",city:"",country:"KE",phone:""});n.useEffect(()=>{let o=!0;return(async()=>{var f,p,g,v;try{a(!0);const u=await xe.get("/laboratory/me");if(!o)return;const x=((f=u.data)==null?void 0:f.data)||{};m({name:x.name||"",address:x.address||"",city:x.city||"",country:x.country||"KE",phone:x.phone||""})}catch(u){if(!o)return;((p=u==null?void 0:u.response)==null?void 0:p.status)===404?i("No laboratory profile"):i(((v=(g=u==null?void 0:u.response)==null?void 0:g.data)==null?void 0:v.message)||u.message)}finally{o&&a(!1)}})(),()=>{o=!1}},[]);const y=async o=>{var f,p;o.preventDefault();try{if(l(""),i(""),!/^\+[0-9\-\s]{6,}$/.test(r.phone||"")){i("Phone should be E.164 (e.g. +254712345678)");return}await xe.put("/laboratory/me",r),l("Saved")}catch(g){i(((p=(f=g==null?void 0:g.response)==null?void 0:f.data)==null?void 0:p.message)||g.message)}},c=async()=>{var o,f;try{await xe.post("/laboratory/register",{name:r.name||"My Laboratory"}),i(""),l("Registered. You can now save full details.")}catch(p){i(((f=(o=p==null?void 0:p.response)==null?void 0:o.data)==null?void 0:f.message)||p.message)}};return e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Laboratory Profile"}),s&&e.jsx("p",{children:"Loading…"}),t&&e.jsxs("div",{style:{color:"crimson",marginBottom:8},children:[t," ",t.includes("No laboratory profile")&&e.jsx("button",{className:"btn",onClick:c,style:{marginLeft:8},children:"Register"})]}),e.jsxs("form",{onSubmit:y,className:"form",style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(220px, 1fr))",gap:8},children:[e.jsxs("label",{children:["Name",e.jsx("input",{value:r.name,onChange:o=>m(f=>({...f,name:o.target.value})),required:!0})]}),e.jsxs("label",{children:["Phone",e.jsx("input",{value:r.phone,onChange:o=>m(f=>({...f,phone:o.target.value})),placeholder:"+254..."})]}),e.jsxs("label",{children:["Address",e.jsx("input",{value:r.address,onChange:o=>m(f=>({...f,address:o.target.value}))})]}),e.jsxs("label",{children:["City",e.jsx("input",{value:r.city,onChange:o=>m(f=>({...f,city:o.target.value}))})]}),e.jsxs("label",{children:["Country",e.jsx("select",{value:r.country,onChange:o=>m(f=>({...f,country:o.target.value})),children:Je.countries.map(o=>e.jsx("option",{value:o,children:o},o))})]}),e.jsxs("div",{style:{alignSelf:"end"},children:[e.jsx("button",{className:"btn",type:"submit",children:"Save"}),h&&e.jsx("span",{style:{marginLeft:8},children:h})]})]}),e.jsx("div",{style:{marginTop:12},children:e.jsx(V,{className:"btn",to:"/laboratory/profile/edit",children:"Open Full Profile Editor"})})]})}function jn(){const[s,a]=n.useState({country:"KE",query:"",drugId:101}),[t,i]=n.useState([]),[h,l]=n.useState(!1);return n.useEffect(()=>{const r=setTimeout(async()=>{var m;try{l(!0);const y=await xe.get(`/discovery/pharmacies?query=${encodeURIComponent(s.query)}&page=1`);i(((m=y.data)==null?void 0:m.data)||[])}catch{}finally{l(!1)}},250);return()=>clearTimeout(r)},[s.query,s.country,s.drugId]),e.jsxs("div",{children:[e.jsxs("div",{className:"form",style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:8},children:[e.jsxs("label",{children:["Country",e.jsx("select",{value:s.country,onChange:r=>a(m=>({...m,country:r.target.value})),children:Je.countries.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("label",{children:["Drug",e.jsx("select",{value:s.drugId,onChange:r=>a(m=>({...m,drugId:Number(r.target.value)})),children:Je.drugs.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))})]}),e.jsxs("label",{children:["Search",e.jsx("input",{placeholder:"Search pharmacies…",value:s.query,onChange:r=>a(m=>({...m,query:r.target.value}))})]})]}),h&&e.jsx("p",{children:"Loading…"}),e.jsxs("div",{className:"table-like",children:[t.map(r=>e.jsx("div",{className:"card",style:{marginBottom:8},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:r.name}),e.jsxs("div",{style:{fontSize:12,color:"#555"},children:[r.city||""," ",r.country||""]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"badge",children:"Verified"}),e.jsx("button",{className:"btn",style:{marginLeft:8},title:"Requires an existing prescription context",children:"Route Rx"})]})]})},r._id)),t.length===0&&!h&&e.jsx("p",{children:"No results."})]})]})}function gn(){const[s,a]=n.useState({country:"KE",query:"",technology:"PCR",tat:"24h"}),[t,i]=n.useState([]),[h,l]=n.useState(!1);return n.useEffect(()=>{const r=setTimeout(async()=>{var m;try{l(!0);const y=await xe.get(`/discovery/labs?query=${encodeURIComponent(s.query)}&page=1`);i(((m=y.data)==null?void 0:m.data)||[])}catch{}finally{l(!1)}},250);return()=>clearTimeout(r)},[s.query,s.country,s.technology,s.tat]),e.jsxs("div",{children:[e.jsxs("div",{className:"form",style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:8},children:[e.jsxs("label",{children:["Country",e.jsx("select",{value:s.country,onChange:r=>a(m=>({...m,country:r.target.value})),children:Je.countries.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("label",{children:["Technology",e.jsx("select",{value:s.technology,onChange:r=>a(m=>({...m,technology:r.target.value})),children:Je.technologies.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("label",{children:["TAT",e.jsx("select",{value:s.tat,onChange:r=>a(m=>({...m,tat:r.target.value})),children:Je.turnaround.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("label",{children:["Search",e.jsx("input",{placeholder:"Search labs…",value:s.query,onChange:r=>a(m=>({...m,query:r.target.value}))})]})]}),h&&e.jsx("p",{children:"Loading…"}),e.jsxs("div",{className:"table-like",children:[t.map(r=>e.jsx("div",{className:"card",style:{marginBottom:8},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:r.name}),e.jsxs("div",{style:{fontSize:12,color:"#555"},children:[r.city||""," ",r.country||""]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"badge",children:"Verified"}),e.jsx("button",{className:"btn",style:{marginLeft:8},title:"Requires an order context",children:"Order to this lab"})]})]})},r._id)),t.length===0&&!h&&e.jsx("p",{children:"No results."})]})]})}function Vs({portalName:s,allowedRole:a}){return e.jsxs("div",{className:"card",style:{borderColor:"#ef4444"},children:[e.jsxs("h3",{children:[s," portal"]}),e.jsxs("p",{style:{color:"#b91c1c"},children:["You don’t have permission to access the ",s," portal with your account. This section is only available to the “",a,"” role."]}),e.jsx("p",{children:"If you need access, contact an administrator, or switch to the Discovery tab to explore public information."})]})}const fn=()=>{const s=ye(),[a,t]=n.useState(null),[i,h]=n.useState([]),[l,r]=n.useState([]),[m,y]=n.useState(!0),[c,o]=n.useState("");n.useEffect(()=>{f()},[]);const f=async()=>{var u,x;try{y(!0);const A=await fetch("http://localhost:5000/api/appointments",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(A.ok){const N=await A.json(),d=new Date,S=N.filter(b=>b.status==="scheduled"&&new Date(b.date)>d).sort((b,T)=>new Date(b.date)-new Date(T.date)).map(b=>{var T,H;return{id:b._id,doctorName:b.doctor?`Dr. ${b.doctor.profile.firstName} ${b.doctor.profile.lastName}`:"Doctor Assigned",specialty:((H=(T=b.doctor)==null?void 0:T.profile)==null?void 0:H.specialization)||"General Medicine",scheduledTime:b.date,type:b.reason||"Consultation",meetingLink:b.meetingUrl||`https://meet.telemedicine.com/room/${b._id}`,duration:b.duration||30}}),w=N.filter(b=>b.status==="completed").sort((b,T)=>new Date(T.date)-new Date(b.date)).map(b=>{var T,H;return{id:b._id,doctorName:b.doctor?`Dr. ${b.doctor.profile.firstName} ${b.doctor.profile.lastName}`:"Doctor",specialty:((H=(T=b.doctor)==null?void 0:T.profile)==null?void 0:H.specialization)||"General Medicine",date:b.date,duration:`${b.duration||30} minutes`,type:b.reason||"Consultation",status:"completed",recording:"not-available",notes:b.notes}}),k=N.find(b=>{const T=new Date(b.date),H=new Date(T.getTime()+(b.duration||30)*6e4);return b.status==="scheduled"&&T<=d&&d<=H}),D=k?{id:k._id,doctorName:k.doctor?`Dr. ${k.doctor.profile.firstName} ${k.doctor.profile.lastName}`:"Doctor",specialty:((x=(u=k.doctor)==null?void 0:u.profile)==null?void 0:x.specialization)||"General Medicine",startTime:k.date,meetingLink:k.meetingUrl||`https://meet.telemedicine.com/room/${k._id}`,type:k.reason||"Consultation"}:null;t(D),h(S),r(w)}else throw new Error(`Failed to fetch appointments: ${A.status}`)}catch(C){o("Failed to load video call data"),console.error("Error fetching video call data:",C),t(null),h([]),r([])}finally{y(!1)}},p=u=>{s(`/video-call/${u}`)},g=u=>new Date(u).toLocaleString(),v=u=>{const x=new Date,A=new Date(u).getTime()-x.getTime();return A<=15*60*1e3&&A>=-5*60*1e3};return m?e.jsx("div",{className:"patient-video-calls-page",children:e.jsx("div",{className:"loading-spinner",children:"Loading video calls..."})}):e.jsxs("div",{className:"patient-video-calls-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Video Calls"}),e.jsx("p",{children:"Manage your video consultations with doctors"})]}),c&&e.jsx("div",{className:"error-message",children:c}),a&&e.jsxs("div",{className:"active-call-section",children:[e.jsx("h2",{children:"Active Call"}),e.jsxs("div",{className:"active-call-card",children:[e.jsxs("div",{className:"call-info",children:[e.jsx("h3",{children:a.doctorName}),e.jsx("p",{children:a.specialty}),e.jsxs("p",{children:["Started: ",g(a.startTime)]})]}),e.jsxs("div",{className:"call-actions",children:[e.jsx("button",{className:"btn-rejoin",onClick:()=>p(a.id),children:"Rejoin Call"}),e.jsx("button",{className:"btn-end-call",children:"End Call"})]})]})]}),e.jsxs("div",{className:"upcoming-calls-section",children:[e.jsx("h2",{children:"Upcoming Calls"}),i.length===0?e.jsx("div",{className:"no-data",children:e.jsx("p",{children:"No upcoming video calls scheduled"})}):e.jsx("div",{className:"calls-grid",children:i.map(u=>e.jsxs("div",{className:"call-card",children:[e.jsxs("div",{className:"call-header",children:[e.jsx("h3",{children:u.doctorName}),e.jsx("span",{className:"call-type",children:u.type})]}),e.jsxs("div",{className:"call-details",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Specialty:"})," ",u.specialty]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Scheduled:"})," ",g(u.scheduledTime)]})]}),e.jsxs("div",{className:"call-actions",children:[v(u.scheduledTime)?e.jsx("button",{className:"btn-join",onClick:()=>p(u.id),children:"Join Call"}):e.jsx("button",{className:"btn-join disabled",disabled:!0,children:"Not Yet Available"}),e.jsx("button",{className:"btn-reschedule",children:"Reschedule"})]})]},u.id))})]}),e.jsxs("div",{className:"call-history-section",children:[e.jsx("h2",{children:"Call History"}),l.length===0?e.jsx("div",{className:"no-data",children:e.jsx("p",{children:"No previous video calls"})}):e.jsx("div",{className:"history-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Doctor"}),e.jsx("th",{children:"Specialty"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Duration"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Recording"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:l.map(u=>e.jsxs("tr",{children:[e.jsx("td",{children:u.doctorName}),e.jsx("td",{children:u.specialty}),e.jsx("td",{children:g(u.date)}),e.jsx("td",{children:u.duration}),e.jsx("td",{children:u.type}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${u.status}`,children:u.status})}),e.jsx("td",{children:u.recording==="available"?e.jsx("button",{className:"btn-small",children:"View"}):e.jsx("span",{className:"not-available",children:"N/A"})}),e.jsx("td",{children:e.jsx("button",{className:"btn-small",children:"Book Follow-up"})})]},u.id))})]})})]})]})};const vn=()=>{const[s,a]=n.useState("profile"),[t,i]=n.useState(!1),[h,l]=n.useState(""),[r,m]=n.useState({firstName:"John",lastName:"Doe",email:"john.doe@example.com",phone:"+1 (555) 123-4567",dateOfBirth:"1990-05-15",gender:"male",address:"123 Main St",city:"New York",state:"NY",zipCode:"10001",emergencyContact:"Jane Doe",emergencyPhone:"+1 (555) 987-6543"}),[y,c]=n.useState({bloodType:"O+",allergies:"Penicillin, Shellfish",medications:"Lisinopril 10mg daily",medicalConditions:"Hypertension",primaryDoctor:"Dr. Sarah Johnson",insurance:"Blue Cross Blue Shield",policyNumber:"BC123456789"}),[o,f]=n.useState({appointmentReminders:!0,emailNotifications:!0,smsNotifications:!1,medicationReminders:!0,healthTips:!0,marketingEmails:!1}),[p,g]=n.useState({shareDataWithDoctors:!0,allowDataAnalytics:!1,shareWithInsurance:!0,publicProfile:!1}),[v,u]=n.useState({currentPassword:"",newPassword:"",confirmPassword:"",twoFactorAuth:!1}),[x,C]=n.useState({members:[],group:null,actingAsUserId:null}),[A,N]=n.useState(""),[d,S]=n.useState("adult"),[w,k]=n.useState([]),[D,b]=n.useState({provider:"",plan:"",memberId:"",policyNumber:"",groupNumber:"",isPrimary:!1}),[T,H]=n.useState([]),[J,q]=n.useState({type:"card",brand:"",last4:"",expMonth:"",expYear:"",cardholderName:"",billingAddress:{line1:"",city:"",state:"",postalCode:"",country:""},isDefault:!1}),[K,$]=n.useState([]),[P,O]=n.useState("ET"),[M,Z]=n.useState("SelfPay"),[se,oe]=n.useState(""),[B,U]=n.useState(1),[_,ce]=n.useState(null),[ie,je]=n.useState(null),[ve,Ce]=n.useState("card"),[z,Q]=n.useState(""),[re,ae]=n.useState(""),[ue,le]=n.useState("ET"),[pe,Ne]=n.useState(""),[E,W]=n.useState([]),[L,G]=n.useState("paystack"),[F,ne]=n.useState(""),[de,fe]=n.useState(""),[we,Le]=n.useState(!1),[be,Ue]=n.useState(""),[Ge,ze]=n.useState([]),[hs,ts]=n.useState([]),[Ye,la]=n.useState([]);n.useEffect(()=>{(async()=>{var I,X,te,he;try{i(!0);const[ke,$e,Pe,Te,Ie]=await Promise.all([R.get("/settings/personal"),R.get("/settings/preferences"),R.get("/family").catch(()=>({data:{group:null,members:[]}})),R.get("/insurance").catch(()=>({data:{items:[]}})),R.get("/billing/methods").catch(()=>({data:{items:[]}}))]),{user:Ae}=ke.data||{};Ae!=null&&Ae.profile&&m(Fe=>({...Fe,firstName:Ae.profile.firstName||"",lastName:Ae.profile.lastName||"",email:Ae.email||Fe.email,phone:Ae.profile.phone||"",dateOfBirth:Ae.profile.dateOfBirth?String(Ae.profile.dateOfBirth).slice(0,10):"",gender:Ae.profile.gender||"other",address:Ae.profile.address||"",city:Ae.profile.city||"",state:Ae.profile.state||"",zipCode:Ae.profile.zipCode||"",emergencyContact:Ae.profile.emergencyContact||"",emergencyPhone:Ae.profile.emergencyPhone||""}));const{preferences:qe,privacy:Rs}=$e.data||{};qe&&f(Fe=>{var $s,Ms;return{...Fe,appointmentReminders:!!qe.appointmentReminders,emailNotifications:(($s=qe.channels)==null?void 0:$s.email)??Fe.emailNotifications,smsNotifications:((Ms=qe.channels)==null?void 0:Ms.sms)??Fe.smsNotifications,medicationReminders:!!qe.medicationReminders,healthTips:!!qe.healthTips,marketingEmails:!!qe.marketingEmails}}),Rs&&g(Fe=>({...Fe,...Rs}));const Ls=(Pe==null?void 0:Pe.data)||{group:null,members:[]};C({members:Ls.members||[],group:Ls.group||null,actingAsUserId:((X=(I=ke.data)==null?void 0:I.settings)==null?void 0:X.actingAsUserId)||null}),k(((te=Te==null?void 0:Te.data)==null?void 0:te.items)||[]),H(((he=Ie==null?void 0:Ie.data)==null?void 0:he.items)||[])}catch{l("Failed to load settings"),setTimeout(()=>l(""),3e3)}finally{i(!1)}})()},[]);const Ee=(j,I)=>{m(X=>({...X,[j]:I}))},ns=(j,I)=>{c(X=>({...X,[j]:I}))},Qe=(j,I)=>{f(X=>({...X,[j]:I}))},ms=(j,I)=>{g(X=>({...X,[j]:I}))},us=(j,I)=>{u(X=>({...X,[j]:I}))},rs=async j=>{try{i(!0),j==="profile"?await R.put("/settings/personal",{profile:{firstName:r.firstName,lastName:r.lastName,phone:r.phone,dateOfBirth:r.dateOfBirth||void 0,gender:r.gender,address:r.address,city:r.city,state:r.state,zipCode:r.zipCode,emergencyContact:r.emergencyContact,emergencyPhone:r.emergencyPhone}}):j==="medical"?await new Promise(I=>setTimeout(I,300)):j==="notifications"?await R.put("/settings/preferences",{preferences:{appointmentReminders:o.appointmentReminders,medicationReminders:o.medicationReminders,healthTips:o.healthTips,marketingEmails:o.marketingEmails,channels:{email:o.emailNotifications,sms:o.smsNotifications}}}):j==="privacy"?await R.put("/settings/preferences",{privacy:p}):j==="security"&&await new Promise(I=>setTimeout(I,300)),l(`${j} settings saved successfully!`),setTimeout(()=>l(""),3e3),j==="security"&&u(I=>({...I,currentPassword:"",newPassword:"",confirmPassword:""}))}catch(I){l("Error saving settings. Please try again."),console.error("Error saving settings:",I)}finally{i(!1)}},vs=async()=>{const I=(await R.get("/family")).data;C(X=>({...X,members:I.members||[],group:I.group||null}))},oa=async()=>{await R.post("/family/groups"),await vs()},Ts=async j=>{await R.patch("/family/acting-as",{userId:j}),C(I=>({...I,actingAsUserId:j||null}))},ca=async j=>{var I,X;if(j)try{i(!0),await R.delete(`/family/members/${j}`),await vs(),l("Family member removed."),setTimeout(()=>l(""),2500)}catch(te){const he=((X=(I=te==null?void 0:te.response)==null?void 0:I.data)==null?void 0:X.error)||"Failed to remove member";l(`Error: ${he}`),setTimeout(()=>l(""),3e3)}finally{i(!1)}},ys=async()=>{var I;const j=await R.get("/insurance");k(((I=j==null?void 0:j.data)==null?void 0:I.items)||[])},da=async()=>{var j,I;try{i(!0),await R.post("/insurance",D),await ys(),b({provider:"",plan:"",memberId:"",policyNumber:"",groupNumber:"",isPrimary:!1}),l("Insurance added."),setTimeout(()=>l(""),2500)}catch(X){const te=((I=(j=X==null?void 0:X.response)==null?void 0:j.data)==null?void 0:I.error)||"Failed to add insurance";l(`Error: ${te}`),setTimeout(()=>l(""),3e3)}finally{i(!1)}},ha=async j=>{var I,X;try{i(!0),await R.put(`/insurance/${j}`,{isPrimary:!0}),await ys()}catch(te){const he=((X=(I=te==null?void 0:te.response)==null?void 0:I.data)==null?void 0:X.error)||"Failed to update insurance";l(`Error: ${he}`),setTimeout(()=>l(""),3e3)}finally{i(!1)}},ma=async j=>{var I,X;try{i(!0),await R.delete(`/insurance/${j}`),await ys()}catch(te){const he=((X=(I=te==null?void 0:te.response)==null?void 0:I.data)==null?void 0:X.error)||"Failed to delete insurance";l(`Error: ${he}`),setTimeout(()=>l(""),3e3)}finally{i(!1)}},Ns=async()=>{var I;const j=await R.get("/billing/methods");H(((I=j==null?void 0:j.data)==null?void 0:I.items)||[])},ua=async()=>{var j,I;try{i(!0),await R.post("/billing/methods",J),await Ns(),q({type:"card",brand:"",last4:"",expMonth:"",expYear:"",cardholderName:"",billingAddress:{line1:"",city:"",state:"",postalCode:"",country:""},isDefault:!1}),l("Payment method added."),setTimeout(()=>l(""),2500)}catch(X){const te=((I=(j=X==null?void 0:X.response)==null?void 0:j.data)==null?void 0:I.error)||"Failed to add payment method";l(`Error: ${te}`),setTimeout(()=>l(""),3e3)}finally{i(!1)}},pa=async j=>{var I,X;try{i(!0),await R.put(`/billing/methods/${j}`,{isDefault:!0}),await Ns()}catch(te){const he=((X=(I=te==null?void 0:te.response)==null?void 0:I.data)==null?void 0:X.error)||"Failed to update payment method";l(`Error: ${he}`),setTimeout(()=>l(""),3e3)}finally{i(!1)}},xa=async j=>{var I,X;try{i(!0),await R.delete(`/billing/methods/${j}`),await Ns()}catch(te){const he=((X=(I=te==null?void 0:te.response)==null?void 0:I.data)==null?void 0:X.error)||"Failed to delete payment method";l(`Error: ${he}`),setTimeout(()=>l(""),3e3)}finally{i(!1)}},Es=async()=>{var j,I,X,te;try{i(!0);const he=await R.get("/pricing/services",{params:{region:P,payerType:M}});$(((j=he==null?void 0:he.data)==null?void 0:j.items)||[]),(((I=he==null?void 0:he.data)==null?void 0:I.items)||[]).length&&!se&&oe(he.data.items[0].code)}catch(he){const ke=((te=(X=he==null?void 0:he.response)==null?void 0:X.data)==null?void 0:te.error)||"Failed to load services";l(`Error: ${ke}`),setTimeout(()=>l(""),3e3)}finally{i(!1)}},ja=async()=>{var j;try{const I=await R.get("/pricing/quotes");ze(((j=I==null?void 0:I.data)==null?void 0:j.items)||[])}catch{}},ga=async()=>{var j;try{const I=await R.get("/checkout/payments");ts(((j=I==null?void 0:I.data)==null?void 0:j.items)||[])}catch{}},fa=async()=>{var j;try{const I=await R.get("/invoices");la(((j=I==null?void 0:I.data)==null?void 0:j.items)||[])}catch{}},Is=async()=>{var j;try{const I=await R.get("/banks",{params:{country:ue||P,channel:"bank_transfer",search:pe||void 0}});W(((j=I==null?void 0:I.data)==null?void 0:j.items)||[])}catch{}};n.useEffect(()=>{s==="billing"&&(K.length===0&&Es(),ja(),ga(),fa())},[s]),n.useEffect(()=>{le(P||"ET")},[P]),n.useEffect(()=>{s==="billing"&&ve==="bank"&&Is()},[ve]);const va=async()=>{var j,I,X;if(!se){l("Select a service first."),setTimeout(()=>l(""),2e3);return}try{i(!0);const te=await R.post("/pricing/quote",{items:[{serviceCode:se,qty:Number(B)||1}]});ce(((j=te==null?void 0:te.data)==null?void 0:j.quote)||null),je(null),l("Quote created."),setTimeout(()=>l(""),2e3)}catch(te){const he=((X=(I=te==null?void 0:te.response)==null?void 0:I.data)==null?void 0:X.error)||"Failed to create quote";l(`Error: ${he}`),setTimeout(()=>l(""),3e3)}finally{i(!1)}},ya=async()=>{var I,X,te;if(!_){l("Create a quote first."),setTimeout(()=>l(""),2e3);return}const j=Number(_==null?void 0:_.patientResponsibility)||Number(_==null?void 0:_.subtotal)||0;if(!j){l("Quote amount is zero."),setTimeout(()=>l(""),2e3);return}try{i(!0);const he={card:"Card",bank:"Bank",mobile:"MobileWallet"},ke=await R.post("/checkout/intents",{amount:j,currency:(_==null?void 0:_.currency)||"USD",method:he[ve]||"Card",provider:ve==="bank"?L:z||void 0,quoteId:_==null?void 0:_._id}),$e=((I=ke==null?void 0:ke.data)==null?void 0:I.intent)||null;if(je($e),$e&&ve==="mobile"&&z&&re)try{z==="mpesa"?await R.post("/checkout/mpesa/stk-push",{intentId:$e._id,phone:re}):z==="telebirr"&&await R.post("/checkout/telebirr/init",{intentId:$e._id,phone:re})}catch(Pe){console.log("Mobile init failed",Pe)}if($e&&ve==="bank")try{let Pe=de;if(!Pe&&F){const Te=E.find(Ie=>String(Ie._id)===String(F));Te&&(Pe=(Te.providerCodes||{})[L]||Te.shortCode||Te.centralBankCode||Te.swiftBIC||Te.name)}!Pe&&we&&(Pe=be||"OTHER"),Pe&&await R.post("/checkout/bank/init",{intentId:$e._id,bankCode:Pe})}catch(Pe){console.log("Bank init failed",Pe)}l("Payment intent created."),setTimeout(()=>l(""),2e3)}catch(he){const ke=((te=(X=he==null?void 0:he.response)==null?void 0:X.data)==null?void 0:te.error)||"Failed to create payment intent";l(`Error: ${ke}`),setTimeout(()=>l(""),3e3)}finally{i(!1)}},Na=async()=>{var j,I;if(!A){l("Please enter an email."),setTimeout(()=>l(""),2500);return}try{i(!0),await R.post("/family/members/by-email",{email:A,role:d}),N(""),S("adult"),await vs(),l("Family member added."),setTimeout(()=>l(""),2500)}catch(X){const te=((I=(j=X==null?void 0:X.response)==null?void 0:j.data)==null?void 0:I.error)||"Failed to add member";l(`Error: ${te}`),setTimeout(()=>l(""),3e3)}finally{i(!1)}},ba=[{id:"profile",label:"Profile",icon:"👤"},{id:"medical",label:"Medical Info",icon:"🏥"},{id:"notifications",label:"Notifications",icon:"🔔"},{id:"privacy",label:"Privacy",icon:"🔒"},{id:"security",label:"Security",icon:"🛡️"},{id:"family",label:"Family",icon:"👪"},{id:"billing",label:"Billing",icon:"💳"}];return e.jsxs("div",{className:"patient-settings-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Settings"}),e.jsx("p",{children:"Manage your account preferences and information"})]}),h&&e.jsx("div",{className:`save-message ${h.includes("Error")?"error":"success"}`,children:h}),e.jsxs("div",{className:"settings-container",children:[e.jsx("div",{className:"settings-tabs",children:ba.map(j=>e.jsxs("button",{className:`tab-button ${s===j.id?"active":""}`,onClick:()=>a(j.id),children:[e.jsx("span",{className:"tab-icon",children:j.icon}),j.label]},j.id))}),e.jsxs("div",{className:"settings-content",children:[s==="profile"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Profile Information"}),e.jsxs("form",{onSubmit:j=>{j.preventDefault(),rs("profile")},children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"First Name"}),e.jsx("input",{type:"text",value:r.firstName,onChange:j=>Ee("firstName",j.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Last Name"}),e.jsx("input",{type:"text",value:r.lastName,onChange:j=>Ee("lastName",j.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email"}),e.jsx("input",{type:"email",value:r.email,onChange:j=>Ee("email",j.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone"}),e.jsx("input",{type:"tel",value:r.phone,onChange:j=>Ee("phone",j.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Date of Birth"}),e.jsx("input",{type:"date",value:r.dateOfBirth,onChange:j=>Ee("dateOfBirth",j.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Gender"}),e.jsxs("select",{value:r.gender,onChange:j=>Ee("gender",j.target.value),children:[e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"}),e.jsx("option",{value:"prefer-not-to-say",children:"Prefer not to say"})]})]})]}),e.jsx("h3",{children:"Address Information"}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Address"}),e.jsx("input",{type:"text",value:r.address,onChange:j=>Ee("address",j.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"City"}),e.jsx("input",{type:"text",value:r.city,onChange:j=>Ee("city",j.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"State"}),e.jsx("input",{type:"text",value:r.state,onChange:j=>Ee("state",j.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"ZIP Code"}),e.jsx("input",{type:"text",value:r.zipCode,onChange:j=>Ee("zipCode",j.target.value)})]})]}),e.jsx("h3",{children:"Emergency Contact"}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contact Name"}),e.jsx("input",{type:"text",value:r.emergencyContact,onChange:j=>Ee("emergencyContact",j.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contact Phone"}),e.jsx("input",{type:"tel",value:r.emergencyPhone,onChange:j=>Ee("emergencyPhone",j.target.value)})]})]}),e.jsx("button",{type:"submit",className:"save-button",disabled:t,children:t?"Saving...":"Save Profile"})]})]}),s==="medical"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Medical Information"}),e.jsxs("form",{onSubmit:j=>{j.preventDefault(),rs("medical")},children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Blood Type"}),e.jsxs("select",{value:y.bloodType,onChange:j=>ns("bloodType",j.target.value),children:[e.jsx("option",{value:"",children:"Select Blood Type"}),e.jsx("option",{value:"A+",children:"A+"}),e.jsx("option",{value:"A-",children:"A-"}),e.jsx("option",{value:"B+",children:"B+"}),e.jsx("option",{value:"B-",children:"B-"}),e.jsx("option",{value:"AB+",children:"AB+"}),e.jsx("option",{value:"AB-",children:"AB-"}),e.jsx("option",{value:"O+",children:"O+"}),e.jsx("option",{value:"O-",children:"O-"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Primary Doctor"}),e.jsx("input",{type:"text",value:y.primaryDoctor,onChange:j=>ns("primaryDoctor",j.target.value)})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Allergies"}),e.jsx("textarea",{value:y.allergies,onChange:j=>ns("allergies",j.target.value),placeholder:"List any allergies you have..."})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Current Medications"}),e.jsx("textarea",{value:y.medications,onChange:j=>ns("medications",j.target.value),placeholder:"List your current medications..."})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Medical Conditions"}),e.jsx("textarea",{value:y.medicalConditions,onChange:j=>ns("medicalConditions",j.target.value),placeholder:"List any medical conditions..."})]})]}),e.jsx("h3",{children:"Insurance"}),e.jsx("div",{style:{marginBottom:12},children:(w||[]).length===0?e.jsx("p",{children:"No insurance on file."}):e.jsx("ul",{children:w.map(j=>e.jsxs("li",{style:{marginBottom:8},children:[e.jsxs("span",{children:[j.provider," ",j.plan?`- ${j.plan}`:"",j.policyNumber?` (Policy ${j.policyNumber})`:"",j.isPrimary?" • Primary":""]}),!j.isPrimary&&e.jsx("button",{style:{marginLeft:8},onClick:()=>ha(j._id),disabled:t,children:"Make Primary"}),e.jsx("button",{className:"danger-button",style:{marginLeft:8},onClick:()=>ma(j._id),disabled:t,children:"Delete"})]},j._id))})}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Provider"}),e.jsx("input",{type:"text",value:D.provider,onChange:j=>b(I=>({...I,provider:j.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Plan"}),e.jsx("input",{type:"text",value:D.plan,onChange:j=>b(I=>({...I,plan:j.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Member ID"}),e.jsx("input",{type:"text",value:D.memberId,onChange:j=>b(I=>({...I,memberId:j.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Policy Number"}),e.jsx("input",{type:"text",value:D.policyNumber,onChange:j=>b(I=>({...I,policyNumber:j.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Group Number"}),e.jsx("input",{type:"text",value:D.groupNumber,onChange:j=>b(I=>({...I,groupNumber:j.target.value}))})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:D.isPrimary,onChange:j=>b(I=>({...I,isPrimary:j.target.checked}))}),e.jsx("span",{className:"checkmark"}),"Set as primary"]})}),e.jsx("div",{className:"form-group",style:{alignSelf:"end"},children:e.jsx("button",{type:"button",className:"save-button",onClick:da,disabled:t||!D.provider,children:t?"Adding...":"Add Insurance"})})]}),e.jsx("button",{type:"submit",className:"save-button",disabled:t,children:t?"Saving...":"Save Medical Info"})]})]}),s==="notifications"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Notification Preferences"}),e.jsxs("form",{onSubmit:j=>{j.preventDefault(),rs("notifications")},children:[e.jsxs("div",{className:"notification-groups",children:[e.jsxs("div",{className:"notification-group",children:[e.jsx("h3",{children:"Appointment Notifications"}),e.jsx("div",{className:"checkbox-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:o.appointmentReminders,onChange:j=>Qe("appointmentReminders",j.target.checked)}),e.jsx("span",{className:"checkmark"}),"Appointment reminders"]})})]}),e.jsxs("div",{className:"notification-group",children:[e.jsx("h3",{children:"Communication Preferences"}),e.jsxs("div",{className:"checkbox-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:o.emailNotifications,onChange:j=>Qe("emailNotifications",j.target.checked)}),e.jsx("span",{className:"checkmark"}),"Email notifications"]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:o.smsNotifications,onChange:j=>Qe("smsNotifications",j.target.checked)}),e.jsx("span",{className:"checkmark"}),"SMS notifications"]})]})]}),e.jsxs("div",{className:"notification-group",children:[e.jsx("h3",{children:"Health & Wellness"}),e.jsxs("div",{className:"checkbox-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:o.medicationReminders,onChange:j=>Qe("medicationReminders",j.target.checked)}),e.jsx("span",{className:"checkmark"}),"Medication reminders"]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:o.healthTips,onChange:j=>Qe("healthTips",j.target.checked)}),e.jsx("span",{className:"checkmark"}),"Health tips and articles"]})]})]}),e.jsxs("div",{className:"notification-group",children:[e.jsx("h3",{children:"Marketing"}),e.jsx("div",{className:"checkbox-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:o.marketingEmails,onChange:j=>Qe("marketingEmails",j.target.checked)}),e.jsx("span",{className:"checkmark"}),"Marketing emails and promotions"]})})]})]}),e.jsx("button",{type:"submit",className:"save-button",disabled:t,children:t?"Saving...":"Save Preferences"})]})]}),s==="privacy"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Privacy Settings"}),e.jsxs("form",{onSubmit:j=>{j.preventDefault(),rs("privacy")},children:[e.jsxs("div",{className:"privacy-groups",children:[e.jsxs("div",{className:"privacy-group",children:[e.jsx("h3",{children:"Data Sharing"}),e.jsxs("div",{className:"checkbox-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:p.shareDataWithDoctors,onChange:j=>ms("shareDataWithDoctors",j.target.checked)}),e.jsx("span",{className:"checkmark"}),"Share medical data with healthcare providers"]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:p.allowDataAnalytics,onChange:j=>ms("allowDataAnalytics",j.target.checked)}),e.jsx("span",{className:"checkmark"}),"Allow anonymized data for analytics and research"]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:p.shareWithInsurance,onChange:j=>ms("shareWithInsurance",j.target.checked)}),e.jsx("span",{className:"checkmark"}),"Share relevant data with insurance providers"]})]})]}),e.jsxs("div",{className:"privacy-group",children:[e.jsx("h3",{children:"Profile Visibility"}),e.jsx("div",{className:"checkbox-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:p.publicProfile,onChange:j=>ms("publicProfile",j.target.checked)}),e.jsx("span",{className:"checkmark"}),"Make profile visible to other patients (name and general info only)"]})})]})]}),e.jsx("button",{type:"submit",className:"save-button",disabled:t,children:t?"Saving...":"Save Privacy Settings"})]})]}),s==="security"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Security Settings"}),e.jsxs("form",{onSubmit:j=>{j.preventDefault(),rs("security")},children:[e.jsxs("div",{className:"security-groups",children:[e.jsxs("div",{className:"security-group",children:[e.jsx("h3",{children:"Change Password"}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Current Password"}),e.jsx("input",{type:"password",value:v.currentPassword,onChange:j=>us("currentPassword",j.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"New Password"}),e.jsx("input",{type:"password",value:v.newPassword,onChange:j=>us("newPassword",j.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Confirm New Password"}),e.jsx("input",{type:"password",value:v.confirmPassword,onChange:j=>us("confirmPassword",j.target.value)})]})]})]}),e.jsxs("div",{className:"security-group",children:[e.jsx("h3",{children:"Two-Factor Authentication"}),e.jsx("div",{className:"checkbox-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:v.twoFactorAuth,onChange:j=>us("twoFactorAuth",j.target.checked)}),e.jsx("span",{className:"checkmark"}),"Enable two-factor authentication for additional security"]})})]})]}),e.jsx("button",{type:"submit",className:"save-button",disabled:t,children:t?"Saving...":"Update Security"})]})]}),s==="family"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Family & Household"}),x.group?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Household: ",x.group.name]}),e.jsxs("div",{className:"form-grid",style:{marginBottom:16},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Add member by email"}),e.jsx("input",{type:"email",placeholder:"member@example.com",value:A,onChange:j=>N(j.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role"}),e.jsxs("select",{value:d,onChange:j=>S(j.target.value),children:[e.jsx("option",{value:"adult",children:"Adult (Spouse/Partner)"}),e.jsx("option",{value:"dependent",children:"Dependent (Child)"})]})]}),e.jsx("div",{className:"form-group",style:{alignSelf:"end"},children:e.jsx("button",{type:"button",className:"save-button",onClick:Na,disabled:t,children:t?"Adding...":"Add Member"})})]}),e.jsx("h3",{children:"Members"}),e.jsx("ul",{children:(x.members||[]).map(j=>{var I,X,te,he,ke,$e,Pe,Te;return e.jsxs("li",{children:[e.jsxs("span",{children:[(X=(I=j.userId)==null?void 0:I.profile)==null?void 0:X.firstName," ",(he=(te=j.userId)==null?void 0:te.profile)==null?void 0:he.lastName," (",(ke=j.userId)==null?void 0:ke.email,") -"," ",j.role]}),e.jsx("button",{style:{marginLeft:8},onClick:()=>{var Ie;return Ts(((Ie=j.userId)==null?void 0:Ie._id)||j.userId)},disabled:x.actingAsUserId===((($e=j.userId)==null?void 0:$e._id)||j.userId),children:x.actingAsUserId===(((Pe=j.userId)==null?void 0:Pe._id)||j.userId)?"Acting As":"Act as this member"}),j.role!=="owner"&&e.jsx("button",{style:{marginLeft:8},className:"danger-button",onClick:()=>{var Ie;return ca(((Ie=j.userId)==null?void 0:Ie._id)||j.userId)},disabled:t,children:"Remove"})]},((Te=j.userId)==null?void 0:Te._id)||j.userId)})}),e.jsx("button",{className:"save-button",onClick:()=>Ts(null),children:"Stop Acting As"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"You don't have a household yet."}),e.jsx("button",{className:"save-button",disabled:t,onClick:oa,children:t?"Working...":"Create Household"})]})]}),s==="billing"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Billing & Payment Methods"}),e.jsx("div",{style:{marginBottom:12},children:(T||[]).length===0?e.jsx("p",{children:"No payment methods on file."}):e.jsx("ul",{children:T.map(j=>{var I;return e.jsxs("li",{style:{marginBottom:8},children:[e.jsxs("span",{children:[(I=j.type)==null?void 0:I.toUpperCase()," ",j.brand," •••• ",j.last4,j.expMonth&&j.expYear?` exp ${j.expMonth}/${j.expYear}`:"",j.isDefault?" • Default":""]}),!j.isDefault&&e.jsx("button",{style:{marginLeft:8},onClick:()=>pa(j._id),disabled:t,children:"Make Default"}),e.jsx("button",{className:"danger-button",style:{marginLeft:8},onClick:()=>xa(j._id),disabled:t,children:"Delete"})]},j._id)})})}),e.jsx("h3",{children:"Add Payment Method"}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Type"}),e.jsxs("select",{value:J.type,onChange:j=>q(I=>({...I,type:j.target.value})),children:[e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"bank",children:"Bank"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Brand"}),e.jsx("input",{type:"text",value:J.brand,onChange:j=>q(I=>({...I,brand:j.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Last 4"}),e.jsx("input",{type:"text",value:J.last4,onChange:j=>q(I=>({...I,last4:j.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Exp Month"}),e.jsx("input",{type:"text",value:J.expMonth,onChange:j=>q(I=>({...I,expMonth:j.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Exp Year"}),e.jsx("input",{type:"text",value:J.expYear,onChange:j=>q(I=>({...I,expYear:j.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Cardholder Name"}),e.jsx("input",{type:"text",value:J.cardholderName,onChange:j=>q(I=>({...I,cardholderName:j.target.value}))})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Billing Address"}),e.jsx("input",{type:"text",placeholder:"Address Line 1",value:J.billingAddress.line1,onChange:j=>q(I=>({...I,billingAddress:{...I.billingAddress,line1:j.target.value}}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"City"}),e.jsx("input",{type:"text",value:J.billingAddress.city,onChange:j=>q(I=>({...I,billingAddress:{...I.billingAddress,city:j.target.value}}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"State"}),e.jsx("input",{type:"text",value:J.billingAddress.state,onChange:j=>q(I=>({...I,billingAddress:{...I.billingAddress,state:j.target.value}}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Postal Code"}),e.jsx("input",{type:"text",value:J.billingAddress.postalCode,onChange:j=>q(I=>({...I,billingAddress:{...I.billingAddress,postalCode:j.target.value}}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Country"}),e.jsx("input",{type:"text",value:J.billingAddress.country,onChange:j=>q(I=>({...I,billingAddress:{...I.billingAddress,country:j.target.value}}))})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:J.isDefault,onChange:j=>q(I=>({...I,isDefault:j.target.checked}))}),e.jsx("span",{className:"checkmark"}),"Set as default"]})}),e.jsx("div",{className:"form-group",style:{alignSelf:"end"},children:e.jsx("button",{type:"button",className:"save-button",onClick:ua,disabled:t||!J.brand||!J.last4,children:t?"Adding...":"Add Payment Method"})})]}),e.jsx("h3",{style:{marginTop:24},children:"Quick Quote & Checkout (Demo)"}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Region"}),e.jsx("input",{type:"text",value:P,onChange:j=>O(j.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Payer Type"}),e.jsx("input",{type:"text",value:M,onChange:j=>Z(j.target.value)})]}),e.jsx("div",{className:"form-group",style:{alignSelf:"end"},children:e.jsx("button",{type:"button",className:"save-button",onClick:Es,disabled:t,children:t?"Loading...":"Load Services"})})]}),K.length>0&&e.jsxs("div",{className:"form-grid",style:{marginTop:8},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Service"}),e.jsx("select",{value:se,onChange:j=>oe(j.target.value),children:K.map(j=>e.jsxs("option",{value:j.code,children:[j.code," — ",j.name," (",j.currency," ",j.price,")"]},j.code))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Qty"}),e.jsx("input",{type:"number",min:1,value:B,onChange:j=>U(j.target.value)})]}),e.jsx("div",{className:"form-group",style:{alignSelf:"end"},children:e.jsx("button",{type:"button",className:"save-button",onClick:va,disabled:t||!se,children:t?"Working...":"Create Quote"})})]}),_&&e.jsxs("div",{style:{marginTop:12},children:[e.jsxs("p",{children:["Quote: Subtotal ",_.currency," ",_.subtotal," • Estimated Insurance ",_.currency," ",_.estimatedInsurance," • You Pay ",_.currency," ",_.patientResponsibility]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Method"}),e.jsxs("select",{value:ve,onChange:j=>Ce(j.target.value),children:[e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"bank",children:"Bank"}),e.jsx("option",{value:"mobile",children:"Mobile Wallet"})]})]}),ve==="bank"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Country"}),e.jsx("input",{type:"text",placeholder:"e.g. ET, KE, NG",value:ue,onChange:j=>le(j.target.value.toUpperCase())})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Provider/Aggregator"}),e.jsxs("select",{value:L,onChange:j=>G(j.target.value),children:[e.jsx("option",{value:"paystack",children:"Paystack"}),e.jsx("option",{value:"flutterwave",children:"Flutterwave"}),e.jsx("option",{value:"dpo",children:"DPO"}),e.jsx("option",{value:"cellulant",children:"Cellulant"}),e.jsx("option",{value:"chapa",children:"Chapa"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Search Bank"}),e.jsx("input",{type:"text",placeholder:"Search name (e.g. Equity, KCB)",value:pe,onChange:j=>Ne(j.target.value)})]}),e.jsx("div",{className:"form-group",style:{alignSelf:"end"},children:e.jsx("button",{type:"button",className:"save-button",onClick:Is,disabled:t,children:t?"Loading...":"Find Banks"})}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Pick Your Bank"}),E.length===0?e.jsx("p",{children:"No banks found. You can enter manually below."}):e.jsxs("select",{value:F,onChange:j=>{ne(j.target.value),Le(!1),fe("")},children:[e.jsx("option",{value:"",children:"Select a bank"}),E.map(j=>e.jsxs("option",{value:j._id,children:[j.name," (",j.countryIso2,")"]},j._id))]})]}),e.jsx("div",{className:"form-group full-width",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:we,onChange:j=>{Le(j.target.checked),j.target.checked&&ne("")}}),e.jsx("span",{style:{marginLeft:8},children:"My bank is not listed"})]})}),we?e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Enter Bank Name"}),e.jsx("input",{type:"text",placeholder:"Your Bank Name",value:be,onChange:j=>Ue(j.target.value)})]}):e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Bank Code (optional override)"}),e.jsx("input",{type:"text",placeholder:"Override provider bank code if needed",value:de,onChange:j=>fe(j.target.value)})]})]}),ve==="mobile"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Provider"}),e.jsxs("select",{value:z,onChange:j=>Q(j.target.value),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"mpesa",children:"M-Pesa"}),e.jsx("option",{value:"telebirr",children:"Telebirr"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone"}),e.jsx("input",{type:"tel",placeholder:"e.g. +2547...",value:re,onChange:j=>ae(j.target.value)})]})]}),e.jsx("div",{className:"form-group",style:{alignSelf:"end"},children:e.jsx("button",{type:"button",className:"save-button",onClick:ya,disabled:t,children:t?"Working...":"Create Checkout Intent"})})]})]}),e.jsx("h3",{style:{marginTop:24},children:"Your Quotes"}),Ge.length===0?e.jsx("p",{children:"No quotes yet."}):e.jsx("ul",{children:Ge.map(j=>{var I,X,te,he,ke;return e.jsx("li",{children:e.jsxs("span",{children:[new Date(j.createdAt).toLocaleString()," • ",j.currency," ",j.patientResponsibility||j.subtotal," •"," ",((X=(I=j.items)==null?void 0:I[0])==null?void 0:X.name)||((he=(te=j.items)==null?void 0:te[0])==null?void 0:he.serviceCode)," (+",(((ke=j.items)==null?void 0:ke.length)||1)-1," more)"]})},j._id)})}),e.jsx("h3",{style:{marginTop:16},children:"Payments"}),hs.length===0?e.jsx("p",{children:"No payments yet."}):e.jsx("ul",{children:hs.map(j=>e.jsx("li",{children:e.jsxs("span",{children:[new Date(j.createdAt).toLocaleString()," • ",j.currency," ",j.amount," • ",j.method," • ",j.status]})},j._id))}),e.jsx("h3",{style:{marginTop:16},children:"Invoices"}),Ye.length===0?e.jsx("p",{children:"No invoices yet."}):e.jsx("ul",{children:Ye.map(j=>e.jsx("li",{children:e.jsxs("span",{children:[new Date(j.createdAt).toLocaleString()," •"," ",j.currency," ",j.total," • ",j.status]})},j._id))})]})]})]})]})};function yn(){var w,k;const{user:s}=me(),[a]=ds(),t=ye(),{sessions:i,contacts:h,selectedSession:l,messages:r,loading:m,fetchSessions:y,getSupportSession:c,selectSession:o,sendMessage:f,createSession:p}=nt(),[g,v]=n.useState(""),u=D=>o(D),x=()=>{g.trim()&&(f(g),v(""))},C=async D=>{try{const b=await p([s._id,D._id]);b&&(o(b),t(`/chat?sessionId=${b._id}`))}catch(b){console.log("Error initiating chat with contact:",b)}},A=((h==null?void 0:h.others)||[]).find(D=>D.role==="admin");n.useEffect(()=>{y()},[]),n.useEffect(()=>{a.get("support")==="true"&&c().then(D=>{D&&o(D)})},[a,c,o]),n.useEffect(()=>{const D=a.get("sessionId");if(D&&i.length>0&&!l){const b=i.find(T=>T._id===D);b&&o(b)}},[a,i,l,o]);const N=l?i.findIndex(D=>D._id===l._id):-1,d=()=>{N>0&&o(i[N-1])},S=()=>{N<i.length-1&&o(i[N+1])};return e.jsxs("div",{className:"chat-page",children:[e.jsxs("div",{className:"chat-sessions",children:[e.jsxs("div",{className:"session-nav",children:[e.jsx("button",{onClick:d,disabled:N<=0,children:"‹ Prev"}),e.jsx("button",{onClick:S,disabled:N<0||N>=i.length-1,children:"Next ›"})]}),A&&e.jsx("div",{className:"admin-chat-link",children:e.jsx("button",{onClick:()=>C(A),children:"Chat with Administrator"})}),e.jsxs("div",{className:"chat-contacts",children:[e.jsx("h4",{children:"Contacts"}),e.jsxs("div",{className:"contacts-section",children:[e.jsx("strong",{children:"Providers:"}),((h==null?void 0:h.providers)||[]).map(D=>{var b,T;return e.jsxs("button",{type:"button",className:"contact-item",onClick:()=>C(D),children:[((b=D.profile)==null?void 0:b.firstName)||D.username||""," ",((T=D.profile)==null?void 0:T.lastName)||""]},D._id)}),(h==null?void 0:h.support)&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Support:"}),e.jsxs("button",{type:"button",className:"contact-item",onClick:()=>C(h.support),children:[((w=h.support.profile)==null?void 0:w.firstName)||h.support.username||""," ",((k=h.support.profile)==null?void 0:k.lastName)||""]})]}),e.jsx("strong",{children:"Administrators:"}),((h==null?void 0:h.others)||[]).filter(D=>D.role==="admin").map(D=>{var b,T;return e.jsxs("button",{type:"button",className:"contact-item",onClick:()=>C(D),children:[((b=D.profile)==null?void 0:b.firstName)||D.username||""," ",((T=D.profile)==null?void 0:T.lastName)||""]},D._id)}),e.jsx("strong",{children:"Others:"}),((h==null?void 0:h.others)||[]).filter(D=>D.role!=="admin").map(D=>{var b,T;return e.jsxs("button",{type:"button",className:"contact-item",onClick:()=>C(D),children:[((b=D.profile)==null?void 0:b.firstName)||D.username||""," ",((T=D.profile)==null?void 0:T.lastName)||""," (",D.role,")"]},D._id)})]})]}),e.jsx("h3",{children:"Conversations"}),i.length===0&&e.jsx("p",{children:"No conversations yet."}),(i||[]).map(D=>e.jsx("button",{type:"button",className:`chat-session-item ${(l==null?void 0:l._id)===D._id?"active":""}`,onClick:()=>u(D),children:(D.participants||[]).filter(b=>b._id!==s._id).map(b=>{var T,H;return`${((T=b.profile)==null?void 0:T.firstName)||b.username||""} ${((H=b.profile)==null?void 0:H.lastName)||""}`}).join(", ")},D._id))]}),e.jsx("div",{className:"chat-window",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"chat-messages",children:[m&&e.jsx("p",{children:"Loading messages..."}),!m&&r.map(D=>{var b,T,H;return e.jsxs("div",{className:`chat-message-item ${D.sender._id===s._id?"sent":"received"}`,children:[e.jsx("span",{className:"sender",children:((T=(b=D.sender)==null?void 0:b.profile)==null?void 0:T.firstName)||((H=D.sender)==null?void 0:H.username)||""}),e.jsx("span",{className:"content",children:D.content}),e.jsx("span",{className:"timestamp",children:new Date(D.createdAt).toLocaleTimeString()})]},D._id)})]}),e.jsxs("div",{className:"chat-input",children:[e.jsx("input",{type:"text",value:g,onChange:D=>v(D.target.value),placeholder:"Type a message..."}),e.jsx("button",{onClick:x,children:"Send"})]})]}):e.jsx("div",{className:"chat-placeholder",children:e.jsx("p",{children:"Select a conversation to start chatting."})})})]})}const Se={getOverview(){return R.get("/phr/overview").then(s=>s.data.data)},createShareLink(s){return R.post("/phr/share-links",s).then(a=>a.data.data)},listShareLinks(){return R.get("/phr/share-links").then(s=>s.data.data)},revokeShareLink(s){return R.patch(`/phr/share-links/${s}/revoke`).then(a=>a.data.data)},externalShare(s){return R.get(`/phr/share/${s}`).then(a=>a.data.data)},consultations(s={}){return R.get("/phr/consultations",{params:s}).then(a=>a.data.data)},prescriptions(s={}){return R.get("/phr/prescriptions",{params:s}).then(a=>a.data.data)},documents(s={}){return R.get("/phr/documents",{params:s}).then(a=>a.data.data)},labs(s={}){return R.get("/phr/labs",{params:s}).then(a=>a.data.data)},imaging(s={}){return R.get("/phr/imaging",{params:s}).then(a=>a.data.data)},getPreferences(){return R.get("/phr/settings").then(s=>s.data.data)},updatePreferences(s){return R.put("/phr/settings",s).then(a=>a.data.data)},audit(s={}){return R.get("/phr/audit",{params:s}).then(a=>a.data.data)},createExportJob(s){return R.post("/phr/export/jobs",{format:s}).then(a=>a.data.data)},getExportJob(s){return R.get(`/phr/export/jobs/${s}`).then(a=>a.data.data)}};const Me=10;function Nn(){var re,ae,ue,le,pe,Ne;const[s,a]=n.useState(null),[t,i]=n.useState(!0),[h,l]=n.useState([]),[r,m]=n.useState(!1),[y,c]=n.useState(24),[o,f]=n.useState("summary"),[p,g]=n.useState(null),[v,u]=n.useState(null),[x,C]=n.useState(null),[A,N]=n.useState(null),[d,S]=n.useState(null),[w,k]=n.useState(null),[D,b]=n.useState(1),[T,H]=n.useState(null),[J,q]=n.useState(1),[K,$]=n.useState(null),[P,O]=n.useState(null);n.useState(null);const[M,Z]=n.useState(null),[se,oe]=n.useState(null),[B,U]=n.useState(1),[_,ce]=n.useState(null),[ie,je]=n.useState(null),[ve,Ce]=n.useState(1);n.useEffect(()=>{if(!w||["Completed","Failed"].includes(w.status))return;const E=setInterval(()=>{Se.getExportJob(w._id).then(W=>k(W)).catch(()=>{})},2e3);return()=>clearInterval(E)},[w]),n.useEffect(()=>{(async()=>{try{const E=await Se.getOverview();a(E);const W=await Se.listShareLinks();l(W)}catch(E){console.log("PHR load error",E)}finally{i(!1)}})()},[]);const z=async E=>{E.preventDefault(),m(!0);try{const W=await Se.createShareLink({scope:{all:!0},expiresInHours:y});l(L=>[W,...L])}catch(W){console.log("Create link error",W)}finally{m(!1)}},Q=async E=>{try{await Se.revokeShareLink(E),l(W=>W.filter(L=>L.id!==E&&L._id!==E))}catch(W){console.log("Revoke error",W)}};return t?e.jsx("div",{className:"phr-loading",children:"Loading Personal Health Record..."}):e.jsxs("div",{className:"phr-page",children:[e.jsx("h1",{children:"Personal Health Record"}),e.jsx("div",{className:"phr-tabs",children:["summary","consultations","prescriptions","documents","labs","imaging","export","audit","preferences"].map(E=>e.jsx("button",{className:"phr-tab "+(o===E?"active":""),onClick:()=>{f(E),E==="consultations"&&!p&&Se.consultations({page:D,limit:Me}).then(W=>{g(W.items),H(W.pagination)}),E==="prescriptions"&&!v&&Se.prescriptions().then(u),E==="documents"&&!x&&Se.documents().then(C),E==="labs"&&!M&&Se.labs({page:B,limit:Me}).then(W=>{Z(W.items),oe(W.pagination)}),E==="imaging"&&!_&&Se.imaging({page:ve,limit:Me}).then(W=>{ce(W.items),je(W.pagination)}),E==="audit"&&!A&&Se.audit({page:J,limit:20}).then(W=>{N(W.rows),$(W.pagination)}),E==="preferences"&&!d&&Se.getPreferences().then(S)},children:E.charAt(0).toUpperCase()+E.slice(1)},E))}),o==="summary"&&e.jsxs("section",{className:"phr-section",children:[e.jsx("h2",{children:"Summary"}),!s&&e.jsx("p",{children:"No data found."}),s&&e.jsxs("div",{className:"phr-summary-grid",children:[e.jsxs("div",{className:"phr-card",children:[e.jsx("h3",{children:"Latest Consultation"}),s.latestRecord?e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",new Date(s.latestRecord.createdAt).toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Diagnosis:"})," ",s.latestRecord.diagnosis||"N/A"]})]}):e.jsx("p",{children:"No consultations yet."})]}),e.jsxs("div",{className:"phr-card",children:[e.jsx("h3",{children:"Recent Prescriptions"}),(re=s.activePrescriptions)!=null&&re.length?e.jsx("ul",{children:s.activePrescriptions.map(E=>e.jsx("li",{children:E.prescription},E._id))}):e.jsx("p",{children:"None"})]}),e.jsxs("div",{className:"phr-card",children:[e.jsx("h3",{children:"Recent Documents"}),(ae=s.documents)!=null&&ae.length?e.jsx("ul",{children:s.documents.map(E=>e.jsx("li",{children:E.originalName||E.fileName},E._id))}):e.jsx("p",{children:"No documents"})]}),e.jsxs("div",{className:"phr-card",children:[e.jsx("h3",{children:"Recent Labs"}),(ue=s.recentLabs)!=null&&ue.length?e.jsx("ul",{children:s.recentLabs.map(E=>e.jsxs("li",{children:[E.testType," • ",E.status]},E._id))}):e.jsx("p",{children:"No labs"})]}),e.jsxs("div",{className:"phr-card",children:[e.jsx("h3",{children:"Recent Imaging"}),(le=s.recentImaging)!=null&&le.length?e.jsx("ul",{children:s.recentImaging.map(E=>e.jsxs("li",{children:[E.modality," • ",E.status]},E._id))}):e.jsx("p",{children:"No imaging"})]})]})]}),o==="consultations"&&e.jsxs("section",{className:"phr-section",children:[e.jsx("h2",{children:"Consultations"}),!p&&e.jsx("p",{children:"Loading..."}),p&&p.length===0&&e.jsx("p",{children:"No records."}),p&&p.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"phr-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Doctor"}),e.jsx("th",{children:"Diagnosis"})]})}),e.jsx("tbody",{children:p.map(E=>{var W,L,G,F;return e.jsxs("tr",{children:[e.jsx("td",{children:new Date(E.createdAt).toLocaleDateString()}),e.jsxs("td",{children:[(L=(W=E.doctor)==null?void 0:W.profile)==null?void 0:L.firstName," ",(F=(G=E.doctor)==null?void 0:G.profile)==null?void 0:F.lastName]}),e.jsx("td",{children:E.diagnosis})]},E._id)})})]}),T&&e.jsxs("div",{className:"phr-pagination",children:[e.jsx("button",{disabled:T.page<=1,onClick:()=>{const E=T.page-1;b(E),Se.consultations({page:E,limit:Me}).then(W=>{g(W.items),H(W.pagination)})},children:"Prev"}),e.jsxs("span",{children:["Page ",T.page," / ",T.pages]}),e.jsx("button",{disabled:T.page>=T.pages,onClick:()=>{const E=T.page+1;b(E),Se.consultations({page:E,limit:Me}).then(W=>{g(W.items),H(W.pagination)})},children:"Next"})]})]})]}),o==="prescriptions"&&e.jsxs("section",{className:"phr-section",children:[e.jsx("h2",{children:"Prescriptions"}),!v&&e.jsx("p",{children:"Loading..."}),v&&v.length===0&&e.jsx("p",{children:"No prescriptions."}),v&&v.length>0&&e.jsx("ul",{children:v.map(E=>e.jsx("li",{children:E.prescription},E._id))})]}),o==="documents"&&e.jsxs("section",{className:"phr-section",children:[e.jsx("h2",{children:"Documents"}),!x&&e.jsx("p",{children:"Loading..."}),x&&x.length===0&&e.jsx("p",{children:"No documents."}),x&&x.length>0&&e.jsx("div",{className:"phr-doc-grid",children:x.map(E=>{var L;const W=(L=E.mimeType)!=null&&L.startsWith("image/")?"image":E.mimeType==="application/pdf"?"pdf":"file";return e.jsxs("div",{className:`doc-card doc-${W}`,onClick:()=>O(E),children:[e.jsx("div",{className:"doc-name",children:E.originalName||E.filename}),e.jsxs("div",{className:"doc-meta",children:[(E.size/1024).toFixed(1)," KB • ",E.mimeType]})]},E._id)})}),P&&e.jsx("div",{className:"doc-modal",onClick:()=>O(null),children:e.jsxs("div",{className:"doc-modal-content",onClick:E=>E.stopPropagation(),children:[e.jsx("button",{className:"close-btn",onClick:()=>O(null),children:"×"}),e.jsx("h3",{children:P.originalName||P.filename}),P.mimeType==="application/pdf"&&e.jsx("iframe",{title:"pdf",src:P.fileUrl,className:"doc-frame"}),((pe=P.mimeType)==null?void 0:pe.startsWith("image/"))&&e.jsx("img",{src:P.fileUrl,alt:"preview",className:"doc-image"}),!((Ne=P.mimeType)!=null&&Ne.startsWith("image/"))&&P.mimeType!=="application/pdf"&&e.jsxs("p",{children:["No inline preview available."," ",e.jsx("a",{href:P.fileUrl,target:"_blank",rel:"noreferrer",children:"Download"})]})]})})]}),o==="labs"&&e.jsxs("section",{className:"phr-section",children:[e.jsx("h2",{children:"Labs"}),!M&&e.jsx("p",{children:"Loading..."}),M&&M.length===0&&e.jsx("p",{children:"No lab examinations."}),M&&M.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"phr-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Test"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:M.map(E=>e.jsxs("tr",{children:[e.jsx("td",{children:new Date(E.createdAt).toLocaleDateString()}),e.jsx("td",{children:E.testType}),e.jsx("td",{children:E.status})]},E._id))})]}),se&&e.jsxs("div",{className:"phr-pagination",children:[e.jsx("button",{disabled:se.page<=1,onClick:()=>{const E=se.page-1;U(E),Se.labs({page:E,limit:Me}).then(W=>{Z(W.items),oe(W.pagination)})},children:"Prev"}),e.jsxs("span",{children:["Page ",se.page," / ",se.pages]}),e.jsx("button",{disabled:se.page>=se.pages,onClick:()=>{const E=se.page+1;U(E),Se.labs({page:E,limit:Me}).then(W=>{Z(W.items),oe(W.pagination)})},children:"Next"})]})]})]}),o==="imaging"&&e.jsxs("section",{className:"phr-section",children:[e.jsx("h2",{children:"Imaging"}),!_&&e.jsx("p",{children:"Loading..."}),_&&_.length===0&&e.jsx("p",{children:"No imaging reports."}),_&&_.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"phr-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Modality"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:_.map(E=>e.jsxs("tr",{children:[e.jsx("td",{children:new Date(E.createdAt).toLocaleDateString()}),e.jsx("td",{children:E.modality}),e.jsx("td",{children:E.status})]},E._id))})]}),ie&&e.jsxs("div",{className:"phr-pagination",children:[e.jsx("button",{disabled:ie.page<=1,onClick:()=>{const E=ie.page-1;Ce(E),Se.imaging({page:E,limit:Me}).then(W=>{ce(W.items),je(W.pagination)})},children:"Prev"}),e.jsxs("span",{children:["Page ",ie.page," / ",ie.pages]}),e.jsx("button",{disabled:ie.page>=ie.pages,onClick:()=>{const E=ie.page+1;Ce(E),Se.imaging({page:E,limit:Me}).then(W=>{ce(W.items),je(W.pagination)})},children:"Next"})]})]})]}),o==="export"&&e.jsxs("section",{className:"phr-section",children:[e.jsx("h2",{children:"Export"}),e.jsx("button",{onClick:()=>Se.createExportJob("pdf").then(k),children:"Generate PDF"})," ",e.jsx("button",{onClick:()=>Se.createExportJob("json_fhir").then(k),children:"Generate FHIR JSON"}),w&&e.jsx("div",{className:"phr-card",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Job:"})," ",w._id," ",e.jsx("strong",{children:"Status:"})," ",w.status," ",e.jsx("strong",{children:"Progress:"})," ",w.progress||0,"%"," ",w.artifactUrl&&e.jsx("a",{href:w.artifactUrl,target:"_blank",rel:"noreferrer",children:"Download"})]})})]}),o==="preferences"&&e.jsxs("section",{className:"phr-section",children:[e.jsx("h2",{children:"Preferences"}),!d&&e.jsx("p",{children:"Loading..."}),d&&e.jsx("div",{className:"phr-prefs",children:["share_phr_by_default","allow_ephemeral_links","allow_export_pdf","allow_export_fhir"].map(E=>e.jsxs("label",{className:"pref-item",children:[e.jsx("input",{type:"checkbox",checked:!!d[E],onChange:W=>{const L={...d,[E]:W.target.checked};S(L),Se.updatePreferences({[E]:W.target.checked})}})," ",E]},E))})]}),e.jsxs("section",{className:"phr-section",children:[e.jsx("h2",{children:"Share Links"}),e.jsxs("form",{onSubmit:z,className:"share-form",children:[e.jsxs("label",{children:["Expiry (hours):"," ",e.jsx("input",{type:"number",min:1,max:168,value:y,onChange:E=>c(E.target.value)})]}),e.jsx("button",{type:"submit",disabled:r,children:r?"Creating...":"Create Share Link"})]}),e.jsxs("table",{className:"phr-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Expires"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[h.map(E=>e.jsxs("tr",{children:[e.jsx("td",{children:(E.id||E._id).slice(-6)}),e.jsx("td",{children:new Date(E.expiresAt).toLocaleString()}),e.jsx("td",{children:e.jsx("button",{onClick:()=>Q(E.id||E._id),children:"Revoke"})})]},E.id||E._id)),!h.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,children:"No active links"})})]})]})]})]})}const is={connectDevice(s){return R.post("/devices/connect",{provider:s,scopes:["vitals","activity"]}).then(a=>a.data)},getStatus(){return R.get("/devices/status").then(s=>s.data.data)},syncData(s){return R.post("/devices/sync",{integrationId:s}).then(a=>a.data)},getVitals(s={}){return R.get("/devices/vitals",{params:s}).then(a=>{var i;const t=(i=a.data)==null?void 0:i.data;return t&&Array.isArray(t.items)?t.items:Array.isArray(t)?t:[]})},disconnectDevice(s){return R.delete(`/devices/${s}`).then(a=>a.data).catch(()=>R.delete("/devices/disconnect",{params:{integrationId:s},data:{integrationId:s}}).then(a=>a.data))}};function bn(){const[s,a]=n.useState([]),[t,i]=n.useState([]),[h,l]=n.useState(!0),[r,m]=n.useState(null),y=v=>{var u;return v?Array.isArray(v)?v:Array.isArray(v==null?void 0:v.items)?v.items:Array.isArray((u=v==null?void 0:v.data)==null?void 0:u.items)?v.data.items:v&&typeof v=="object"?Object.values(v):[]:[]},c=v=>{if(v==null)return"";if(typeof v=="object")try{return JSON.stringify(v)}catch{return String(v)}return String(v)};n.useEffect(()=>{o()},[]);const o=async()=>{l(!0),m(null);try{const[v,u]=await Promise.all([is.getStatus(),is.getVitals()]);a(v),i(y(u))}catch(v){m("Failed to load device data."),console.error(v)}finally{l(!1)}},f=async v=>{try{await is.connectDevice(v),o()}catch{m(`Failed to connect to ${v}.`)}},p=async v=>{try{await is.disconnectDevice(v),o()}catch{m("Failed to disconnect device.")}},g=async v=>{try{await is.syncData(v),o()}catch{m("Failed to sync data.")}};return h?e.jsx("div",{children:"Loading devices..."}):e.jsxs("div",{className:"devices-page",children:[e.jsx("h1",{children:"Wearable Device Integrations"}),r&&e.jsx("p",{className:"error-message",children:r}),e.jsxs("section",{className:"integration-panel",children:[e.jsx("h2",{children:"Connect a Device"}),e.jsxs("div",{className:"connect-buttons",children:[e.jsx("button",{onClick:()=>f("GoogleFit"),children:"Connect Google Fit"}),e.jsx("button",{onClick:()=>f("AppleHealth"),children:"Connect Apple Health"}),e.jsx("button",{onClick:()=>f("Fitbit"),children:"Connect Fitbit"})]})]}),e.jsxs("section",{className:"status-panel",children:[e.jsx("h2",{children:"Connected Devices"}),s.length===0?e.jsx("p",{children:"No devices connected."}):e.jsxs("table",{className:"phr-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Provider"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Last Synced"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:s.map(v=>e.jsxs("tr",{children:[e.jsx("td",{children:v.provider}),e.jsx("td",{children:e.jsx("span",{className:`status-badge status-${v.status.toLowerCase()}`,children:v.status})}),e.jsx("td",{children:v.lastSyncAt?new Date(v.lastSyncAt).toLocaleString():"Never"}),e.jsxs("td",{className:"actions",children:[e.jsx("button",{onClick:()=>g(v._id),disabled:v.status!=="Active",children:"Sync Now"}),e.jsx("button",{onClick:()=>p(v._id),className:"disconnect-btn",children:"Disconnect"})]})]},v._id))})]})]}),e.jsxs("section",{className:"vitals-dashboard",children:[e.jsx("h2",{children:"Recent Vitals"}),(()=>{const v=Array.isArray(t)?t:y(t);return!Array.isArray(v)||v.length===0?e.jsx("p",{children:"No vitals synced yet."}):e.jsxs("table",{className:"phr-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Value"}),e.jsx("th",{children:"Source"})]})}),e.jsx("tbody",{children:v.map((u,x)=>e.jsxs("tr",{children:[e.jsx("td",{children:new Date((u==null?void 0:u.recordedAt)||(u==null?void 0:u.date)||Date.now()).toLocaleString()}),e.jsx("td",{children:(u==null?void 0:u.vitalType)||(u==null?void 0:u.type)||""}),e.jsx("td",{children:`${c((u==null?void 0:u.value)??(u==null?void 0:u.reading)??(u==null?void 0:u.measurement))} ${(u==null?void 0:u.unit)||(u==null?void 0:u.units)||""}`}),e.jsx("td",{children:(u==null?void 0:u.source)||(u==null?void 0:u.provider)||""})]},(u==null?void 0:u._id)||(u==null?void 0:u.id)||`${(u==null?void 0:u.vitalType)||(u==null?void 0:u.type)}-${(u==null?void 0:u.recordedAt)||(u==null?void 0:u.date)||x}`))})]})})()]})]})}const ss={getChart(s){return R.get(`/appointments/${s}/chart`).then(a=>a.data.data)},upsertNote(s,a){return R.post(`/appointments/${s}/chart/notes`,a).then(t=>t.data.data||t.data)},updateNote(s,a,t){return R.patch(`/appointments/${s}/chart/notes/${a}`,t).then(i=>i.data.data||i.data)},signNote(s,a){return R.post(`/appointments/${s}/chart/notes/${a}/sign`).then(t=>t.data.data||t.data)},listTemplates(s){return R.get(`/appointments/${s}/chart/note-templates`).then(a=>a.data.data||a.data)},upsertTemplate(s,a){return R.post(`/appointments/${s}/chart/note-templates`,a).then(t=>t.data.data||t.data)}};function Sn({appointmentId:s,initialNote:a,lifecycleId:t,onNoteSaved:i}){const[h,l]=n.useState(a||null),[r,m]=n.useState({subjective:"",objective:"",assessment:"",plan:"",freeText:""}),[y,c]=n.useState(!1),[o,f]=n.useState(""),[p,g]=n.useState([]),[v,u]=n.useState((a==null?void 0:a.templateId)||"");n.useEffect(()=>{if(a){l(a);const N=a.sectionsJSON||{};m({subjective:N.subjective||"",objective:N.objective||"",assessment:N.assessment||"",plan:N.plan||"",freeText:N.freeText||""}),u(a.templateId||"")}},[a]),n.useEffect(()=>{let N=!0;return ss.listTemplates(s).then(d=>{N&&g(Array.isArray(d)?d:(d==null?void 0:d.items)||[])}).catch(()=>{}),()=>{N=!1}},[s]);const x=n.useMemo(()=>{let N;return(d,S=800)=>{clearTimeout(N),N=setTimeout(d,S)}},[]);n.useEffect(()=>{!Object.values(r).some(d=>(d??"")!=="")&&!h||(f(""),x(async()=>{var d,S;try{c(!0);const w={sectionsJSON:r,templateId:v||void 0,lifecycleId:t||void 0};let k;h!=null&&h._id?k=await ss.updateNote(s,h._id,w):k=await ss.upsertNote(s,w),l(k),i&&i(k)}catch(w){f(((S=(d=w==null?void 0:w.response)==null?void 0:d.data)==null?void 0:S.message)||"Failed to save note")}finally{c(!1)}},800))},[r,v,s]);const C=async()=>{var N,d;if(h!=null&&h._id){f("");try{c(!0);const S=await ss.signNote(s,h._id);l(S),i&&i(S)}catch(S){f(((d=(N=S==null?void 0:S.response)==null?void 0:N.data)==null?void 0:d.message)||"Failed to sign note")}finally{c(!1)}}},A=N=>{u(N);const d=p.find(S=>S._id===N);d!=null&&d.sectionsJSON&&m(S=>({...S,subjective:d.sectionsJSON.subjective||S.subjective,objective:d.sectionsJSON.objective||S.objective,assessment:d.sectionsJSON.assessment||S.assessment,plan:d.sectionsJSON.plan||S.plan}))};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Consultation Notes"}),e.jsxs("div",{className:"flex items-center gap-3 text-sm muted",children:[e.jsx("span",{children:y?"Saving…":(h==null?void 0:h.noteStatus)||"Draft"}),e.jsx("span",{children:(h==null?void 0:h.version)!=null?`v${h.version}`:null})]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2 mb-3",children:e.jsxs("label",{className:"col-span-2 flex items-center gap-2",children:[e.jsx("span",{className:"label",children:"Template"}),e.jsxs("select",{className:"select",value:v,onChange:N=>A(N.target.value),children:[e.jsx("option",{value:"",children:"— None —"}),p.map(N=>e.jsx("option",{value:N._id,children:N.name||N.Name||"Template"},N._id))]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Subjective"}),e.jsx("textarea",{className:"textarea",rows:5,value:r.subjective,onChange:N=>m(d=>({...d,subjective:N.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Objective"}),e.jsx("textarea",{className:"textarea",rows:5,value:r.objective,onChange:N=>m(d=>({...d,objective:N.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Assessment"}),e.jsx("textarea",{className:"textarea",rows:5,value:r.assessment,onChange:N=>m(d=>({...d,assessment:N.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Plan"}),e.jsx("textarea",{className:"textarea",rows:5,value:r.plan,onChange:N=>m(d=>({...d,plan:N.target.value}))})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Free text"}),e.jsx("textarea",{className:"textarea",rows:6,placeholder:"Type notes… (autosaves)",value:r.freeText,onChange:N=>m(d=>({...d,freeText:N.target.value}))})]}),o&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:o}),e.jsx("div",{className:"mt-3 flex gap-2",children:e.jsx("button",{className:"btn btn-primary",onClick:C,disabled:!(h!=null&&h._id)||(h==null?void 0:h.noteStatus)==="Signed"||y,children:"Sign Note"})})]})}const Ze={searchPharmacies(s){return R.get("/pharmacies",{params:{query:s}}).then(a=>a.data.data||a.data)},listPrescriptions(s={}){return R.get("/prescriptions",{params:s}).then(a=>a.data.data||a.data)},createPrescription(s){return R.post("/prescriptions",s).then(a=>a.data.data||a.data)},sendPrescription(s){return R.post(`/prescriptions/${s}/send`).then(a=>a.data.data||a.data)},cancelPrescription(s,a){return R.patch(`/prescriptions/${s}/cancel`,{reason:a}).then(t=>t.data.data||t.data)},routeToPharmacy(s,a){return R.post(`/prescriptions/${s}/route-to-pharmacy`,a).then(t=>t.data.data||t.data)}};function wn({appointmentId:s,lifecycleId:a}){const[t,i]=n.useState({drugName:"",dose:"",route:"",frequency:"",durationDays:5,refills:0,substitutionAllowed:!0,pharmacyId:""}),[h,l]=n.useState([]),[r,m]=n.useState(!1),[y,c]=n.useState(""),[o,f]=n.useState(""),[p,g]=n.useState([]),v=async()=>{var d,S;m(!0);try{const w=await Ze.listPrescriptions({appointmentId:s});l(Array.isArray(w)?w:(w==null?void 0:w.items)||[])}catch(w){c(((S=(d=w==null?void 0:w.response)==null?void 0:d.data)==null?void 0:S.message)||"Failed to load prescriptions")}finally{m(!1)}};n.useEffect(()=>{v()},[s]);const u=async()=>{try{const d=await Ze.searchPharmacies(o);g(Array.isArray(d)?d:(d==null?void 0:d.items)||[])}catch{}},x=async()=>{var d,S;c("");try{await Ze.createPrescription({appointmentId:s,lifecycleId:a,...t}),i({drugName:"",dose:"",route:"",frequency:"",durationDays:5,refills:0,substitutionAllowed:!0,pharmacyId:""}),await v()}catch(w){c(((S=(d=w==null?void 0:w.response)==null?void 0:d.data)==null?void 0:S.message)||"Failed to create prescription")}},C=async d=>{var S,w;c("");try{await Ze.sendPrescription(d),await v()}catch(k){c(((w=(S=k==null?void 0:k.response)==null?void 0:S.data)==null?void 0:w.message)||"Failed to send eRx")}},A=async d=>{var S,w;c("");try{await Ze.cancelPrescription(d,"Clinician cancelled"),await v()}catch(k){c(((w=(S=k==null?void 0:k.response)==null?void 0:S.data)==null?void 0:w.message)||"Failed to cancel eRx")}},N=async d=>{var S,w;c("");try{if(!t.pharmacyId){c("Select a pharmacy first");return}await Ze.routeToPharmacy(d,{pharmacyId:t.pharmacyId,lifecycleId:a}),await v()}catch(k){c(((w=(S=k==null?void 0:k.response)==null?void 0:S.data)==null?void 0:w.message)||"Failed to route prescription")}};return e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Medications"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[e.jsx("input",{className:"input",placeholder:"Drug name",value:t.drugName,onChange:d=>i(S=>({...S,drugName:d.target.value}))}),e.jsx("input",{className:"input",placeholder:"Dose (e.g., 500 mg)",value:t.dose,onChange:d=>i(S=>({...S,dose:d.target.value}))}),e.jsx("input",{className:"input",placeholder:"Route (PO)",value:t.route,onChange:d=>i(S=>({...S,route:d.target.value}))}),e.jsx("input",{className:"input",placeholder:"Frequency (BID)",value:t.frequency,onChange:d=>i(S=>({...S,frequency:d.target.value}))}),e.jsx("input",{className:"input",type:"number",placeholder:"Duration (days)",value:t.durationDays,onChange:d=>i(S=>({...S,durationDays:Number(d.target.value)||0}))}),e.jsx("input",{className:"input",type:"number",placeholder:"Refills",value:t.refills,onChange:d=>i(S=>({...S,refills:Number(d.target.value)||0}))}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.substitutionAllowed,onChange:d=>i(S=>({...S,substitutionAllowed:d.target.checked}))})," ","Allow substitution"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"input flex-1",placeholder:"Search pharmacies",value:o,onChange:d=>f(d.target.value)}),e.jsx("button",{className:"btn btn-secondary",type:"button",onClick:u,children:"Search"})]}),e.jsxs("select",{className:"select col-span-2",value:t.pharmacyId,onChange:d=>i(S=>({...S,pharmacyId:d.target.value})),children:[e.jsx("option",{value:"",children:"— Select pharmacy (optional) —"}),p.map(d=>e.jsx("option",{value:d._id,children:d.name||`${d.Name||"Pharmacy"}${d.city?` - ${d.city}`:""}`},d._id))]})]}),e.jsx("button",{className:"btn btn-primary",onClick:x,children:"Add Medication"}),y&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:y}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Current Prescriptions"}),r?e.jsx("p",{children:"Loading…"}):h.length===0?e.jsx("p",{children:"None"}):e.jsx("ul",{className:"divide-y",children:h.map(d=>e.jsxs("li",{className:"py-2 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[d.drugName," ",d.dose," ",d.route," ",d.frequency]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Status: ",d.transmissionStatus||d.status||"Draft"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>C(d._id),disabled:d.transmissionStatus==="Queued"||d.transmissionStatus==="Sent",children:"Send"}),e.jsx("button",{className:"btn",title:"Route to selected pharmacy",onClick:()=>N(d._id),children:"Route Rx"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>A(d._id),disabled:d.transmissionStatus==="Cancelled"||d.transmissionStatus==="Sent",children:"Cancel"})]})]},d._id))})]})]})}const Oe={createLabOrders(s){return R.post("/orders/labs",s).then(a=>a.data.data||a.data)},createImagingOrder(s){return R.post("/orders/imaging",s).then(a=>a.data.data||a.data)},listLabOrders(s){return R.get("/orders/labs",{params:s}).then(a=>a.data.data||a.data)},listImagingOrders(s){return R.get("/orders/imaging",{params:s}).then(a=>a.data.data||a.data)}};function Cn({appointmentId:s,patientId:a,lifecycleId:t}){const[i,h]=n.useState("labs"),[l,r]=n.useState([{code:"",display:"",priority:"Routine",specimenType:""}]),[m,y]=n.useState(""),[c,o]=n.useState({modality:"X-Ray",bodyPart:"",priority:"Routine",indicationText:"",contrast:!1}),[f,p]=n.useState(""),[g,v]=n.useState(""),u=()=>r(A=>[...A,{code:"",display:"",priority:"Routine",specimenType:""}]),x=async()=>{var A,N;v(""),p("");try{const d=l.filter(w=>w.code||w.display).map(w=>({code:w.code,display:w.display,priority:w.priority,specimenType:w.specimenType})),S={appointmentId:s,patientId:a,lifecycleId:t,items:d,indicationText:m};await Oe.createLabOrders(S),p("Lab orders placed"),r([{code:"",display:"",priority:"Routine",specimenType:""}]),y("")}catch(d){v(((N=(A=d==null?void 0:d.response)==null?void 0:A.data)==null?void 0:N.message)||"Failed to create lab orders")}},C=async()=>{var A,N;v(""),p("");try{const d={appointmentId:s,patientId:a,lifecycleId:t,modality:c.modality,bodyPart:c.bodyPart,priority:c.priority,indicationText:c.indicationText,contrast:c.contrast};await Oe.createImagingOrder(d),p("Imaging order placed"),o({modality:"X-Ray",bodyPart:"",priority:"Routine",indicationText:"",contrast:!1})}catch(d){v(((N=(A=d==null?void 0:d.response)==null?void 0:A.data)==null?void 0:N.message)||"Failed to create imaging order")}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-4 mb-3 border-b",children:[e.jsx("button",{className:`pb-2 ${i==="labs"?"border-b-2 border-blue-600":"text-gray-500"}`,onClick:()=>h("labs"),children:"Labs"}),e.jsx("button",{className:`pb-2 ${i==="imaging"?"border-b-2 border-blue-600":"text-gray-500"}`,onClick:()=>h("imaging"),children:"Imaging"})]}),i==="labs"?e.jsxs("div",{children:[e.jsxs("div",{className:"space-y-2",children:[l.map((A,N)=>e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{className:"input",placeholder:"Code (e.g., CBC)",value:A.code,onChange:d=>{const S=d.target.value;r(w=>w.map((k,D)=>D===N?{...k,code:S}:k))}}),e.jsx("input",{className:"input",placeholder:"Display (Complete Blood Count)",value:A.display,onChange:d=>{const S=d.target.value;r(w=>w.map((k,D)=>D===N?{...k,display:S}:k))}}),e.jsxs("select",{className:"select",value:A.priority,onChange:d=>{const S=d.target.value;r(w=>w.map((k,D)=>D===N?{...k,priority:S}:k))},children:[e.jsx("option",{children:"Routine"}),e.jsx("option",{children:"Urgent"}),e.jsx("option",{children:"Stat"})]}),e.jsx("input",{className:"input",placeholder:"Specimen (e.g., Blood)",value:A.specimenType,onChange:d=>{const S=d.target.value;r(w=>w.map((k,D)=>D===N?{...k,specimenType:S}:k))}})]},N)),e.jsx("button",{className:"btn btn-secondary",onClick:u,children:"Add Test"})]}),e.jsx("div",{className:"mt-3",children:e.jsx("textarea",{className:"textarea",rows:3,placeholder:"Indication / clinical question",value:m,onChange:A=>y(A.target.value)})}),e.jsx("div",{className:"mt-3",children:e.jsx("button",{className:"btn btn-primary",onClick:x,children:"Order Labs"})})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("select",{className:"select",value:c.modality,onChange:A=>o(N=>({...N,modality:A.target.value})),children:[e.jsx("option",{children:"X-Ray"}),e.jsx("option",{children:"CT"}),e.jsx("option",{children:"MRI"}),e.jsx("option",{children:"Ultrasound"})]}),e.jsx("input",{className:"input",placeholder:"Body part (e.g., Chest)",value:c.bodyPart,onChange:A=>o(N=>({...N,bodyPart:A.target.value}))}),e.jsxs("select",{className:"select",value:c.priority,onChange:A=>o(N=>({...N,priority:A.target.value})),children:[e.jsx("option",{children:"Routine"}),e.jsx("option",{children:"Urgent"}),e.jsx("option",{children:"Stat"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:c.contrast,onChange:A=>o(N=>({...N,contrast:A.target.checked}))})," ","Contrast"]}),e.jsx("textarea",{className:"textarea col-span-2",rows:3,placeholder:"Indication / clinical question",value:c.indicationText,onChange:A=>o(N=>({...N,indicationText:A.target.value}))}),e.jsx("div",{className:"col-span-2",children:e.jsx("button",{className:"btn btn-primary",onClick:C,children:"Order Imaging"})})]}),f&&e.jsx("p",{className:"text-green-700 text-sm mt-2",children:f}),g&&e.jsx("p",{className:"text-red-600 text-sm mt-2",children:g})]})}function kn(s){if(!s)return"";const a=s.firstName||s.givenName||"",t=s.lastName||s.familyName||"";return`${a} ${t}`.trim()||s.name||"Patient"}function Pn(s){try{if(!s)return"";const a=new Date(s);if(Number.isNaN(a.getTime()))return"";const t=Date.now()-a.getTime();return`${new Date(t).getUTCFullYear()-1970}y`}catch{return""}}function xs(s,a){const t=Array.isArray(s)?s:[];for(let i=t.length-1;i>=0;i-=1){const h=t[i];if(h&&(h.type===a||h.code===a))return h}return null}function Dn({chart:s}){var u;const a=(s==null?void 0:s.patient)||((u=s==null?void 0:s.appointment)==null?void 0:u.patient)||{},t=(s==null?void 0:s.demographics)||(a==null?void 0:a.demographics)||{},i=(s==null?void 0:s.allergies)||(a==null?void 0:a.allergies)||[],h=(s==null?void 0:s.medications)||(a==null?void 0:a.medications)||[],l=(s==null?void 0:s.vitals)||(a==null?void 0:a.vitals)||[],r=kn(a),m=(a==null?void 0:a.mrn)||(t==null?void 0:t.mrn)||"",y=(a==null?void 0:a.sex)||(t==null?void 0:t.sex)||(t==null?void 0:t.gender)||"",c=(a==null?void 0:a.dob)||(t==null?void 0:t.dob)||"",o=Pn(c),f=xs(l,"BP")||{},p=xs(l,"HR")||{},g=xs(l,"TEMP")||{},v=xs(l,"SPO2")||{};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Patient Snapshot"}),e.jsxs("p",{className:"text-sm muted",children:[r,o&&e.jsxs("span",{className:"ml-2",children:["• ",o]}),y&&e.jsxs("span",{className:"ml-2",children:["• ",y]}),m&&e.jsxs("span",{className:"ml-2",children:["• MRN ",m]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Allergies"}),Array.isArray(i)&&i.length>0?e.jsx("ul",{className:"list-disc ml-5 text-sm",children:i.slice(0,5).map((x,C)=>e.jsxs("li",{children:[(x==null?void 0:x.substance)||(x==null?void 0:x.name)||"Allergy",(x==null?void 0:x.reaction)&&e.jsxs("span",{className:"ml-1",children:["- ",x.reaction]}),(x==null?void 0:x.severity)&&e.jsxs("span",{className:"ml-1",children:["(",x.severity,")"]})]},C))}):e.jsx("p",{className:"text-sm text-gray-500",children:"No known allergies"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Active Medications"}),Array.isArray(h)&&h.length>0?e.jsx("ul",{className:"list-disc ml-5 text-sm",children:h.slice(0,6).map((x,C)=>e.jsxs("li",{children:[(x==null?void 0:x.drugName)||(x==null?void 0:x.name),(x==null?void 0:x.dose)&&e.jsx("span",{className:"ml-1",children:x.dose}),(x==null?void 0:x.route)&&e.jsx("span",{className:"ml-1",children:x.route}),(x==null?void 0:x.frequency)&&e.jsx("span",{className:"ml-1",children:x.frequency})]},C))}):e.jsx("p",{className:"text-sm text-gray-500",children:"No active meds"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Latest Vitals"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"card p-2",children:["BP:"," ",f!=null&&f.systolic&&(f!=null&&f.diastolic)?`${f.systolic}/${f.diastolic}`:(f==null?void 0:f.value)||"-"]}),e.jsxs("div",{className:"card p-2",children:["HR: ",(p==null?void 0:p.value)||"-"]}),e.jsxs("div",{className:"card p-2",children:["Temp: ",(g==null?void 0:g.value)||"-"]}),e.jsxs("div",{className:"card p-2",children:["SpO2: ",(v==null?void 0:v.value)||"-"]})]})]})]})}function An(s){var t;const a=[s==null?void 0:s.labResults,s==null?void 0:s.labs,(t=s==null?void 0:s.orders)==null?void 0:t.labs,s==null?void 0:s.orders];for(const i of a){if(Array.isArray(i)&&i.length)return i;if(i&&Array.isArray(i==null?void 0:i.items)&&i.items.length)return i.items}return[]}function Tn(s){var t;const a=[s==null?void 0:s.imagingResults,s==null?void 0:s.imaging,(t=s==null?void 0:s.orders)==null?void 0:t.imaging];for(const i of a){if(Array.isArray(i)&&i.length)return i;if(i&&Array.isArray(i==null?void 0:i.items)&&i.items.length)return i.items}return[]}function En({appointmentId:s,patientId:a,chart:t}){const[i,h]=n.useState([]),[l,r]=n.useState([]),[m,y]=n.useState(!1),[c,o]=n.useState(""),f=n.useMemo(()=>An(t),[t]),p=n.useMemo(()=>Tn(t),[t]);return n.useEffect(()=>{let g=!0;return o(""),f.length||p.length?(h(f),r(p),()=>{g=!1}):((async()=>{var u,x,C,A;y(!0);try{const[N,d]=await Promise.allSettled([(u=Oe.listLabOrders)==null?void 0:u.call(Oe,{appointmentId:s,patientId:a}),(x=Oe.listImagingOrders)==null?void 0:x.call(Oe,{appointmentId:s,patientId:a})]);if(!g)return;N.status==="fulfilled"&&Array.isArray(N.value)&&h(N.value),d.status==="fulfilled"&&Array.isArray(d.value)&&r(d.value)}catch(N){g&&o(((A=(C=N==null?void 0:N.response)==null?void 0:C.data)==null?void 0:A.message)||"Failed to load results")}finally{g&&y(!1)}})(),()=>{g=!1})},[s,a,f,p]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Results"}),m&&e.jsx("p",{className:"text-sm muted",children:"Loading results…"}),c&&e.jsx("p",{className:"text-sm text-red-600",children:c}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Lab Results"}),Array.isArray(i)&&i.length?e.jsx("ul",{className:"divide-y",children:i.slice(-5).reverse().map((g,v)=>{var u;return e.jsxs("li",{className:"py-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:g.display||g.name||g.code||"Lab"}),e.jsx("span",{className:"text-gray-600",children:g.status||g.resultStatus||""})]}),e.jsx("div",{children:((u=g.result)==null?void 0:u.value)!=null?e.jsxs("span",{children:[g.result.value,g.result.unit?` ${g.result.unit}`:"",g.result.referenceRange?` (ref ${g.result.referenceRange})`:"",g.result.abnormal&&e.jsx("strong",{className:"ml-1 text-amber-700",children:"(!)"})]}):e.jsx("span",{className:"text-gray-500",children:"No values"})}),g.collectedAt&&e.jsxs("div",{className:"muted",children:["Collected: ",new Date(g.collectedAt).toLocaleString()]}),g.reportedAt&&e.jsxs("div",{className:"muted",children:["Reported: ",new Date(g.reportedAt).toLocaleString()]})]},v)})}):e.jsx("p",{className:"text-sm text-gray-500",children:"No lab results"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Imaging Reports"}),Array.isArray(l)&&l.length?e.jsx("ul",{className:"divide-y",children:l.slice(-5).reverse().map((g,v)=>{var u,x,C;return e.jsxs("li",{className:"py-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:[g.modality,g.bodyPart].filter(Boolean).join(" ")||"Imaging"}),e.jsx("span",{className:"text-gray-600",children:g.status||""})]}),((u=g.report)==null?void 0:u.impression)&&e.jsx("div",{className:"mt-1 whitespace-pre-wrap",children:g.report.impression}),!((x=g.report)!=null&&x.impression)&&((C=g.report)==null?void 0:C.text)&&e.jsx("div",{className:"mt-1 whitespace-pre-wrap",children:g.report.text}),(g.reportedAt||g.performedAt)&&e.jsxs("div",{className:"muted mt-1",children:[g.performedAt&&e.jsxs(e.Fragment,{children:["Performed: ",new Date(g.performedAt).toLocaleString()]}),g.reportedAt&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-1",children:"•"}),"Reported:"," ",new Date(g.reportedAt).toLocaleString()]})]})]},v)})}):e.jsx("p",{className:"text-sm text-gray-500",children:"No imaging reports"})]})]})}function In({appointmentId:s}){const[a,t]=n.useState(null),[i,h]=n.useState([]),[l,r]=n.useState(!0),[m,y]=n.useState("");if(n.useEffect(()=>{let o=!0;return(async()=>{r(!0),y("");try{const p=await xe.get(`/appointments/${s}/lifecycle`);if(!o)return;const{lifecycle:g,events:v}=p.data.data||{};t(g||null),h(Array.isArray(v)?v:[])}catch(p){o&&y((p==null?void 0:p.message)||"Failed to load lifecycle")}finally{o&&r(!1)}})(),()=>{o=!1}},[s]),l)return e.jsx("div",{children:"Loading lifecycle…"});if(m)return e.jsx("div",{className:"text-red-600",children:m});if(!a)return e.jsx("div",{children:"No lifecycle found."});const c=[...i].slice(-5).reverse();return e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Lifecycle"}),e.jsxs("div",{className:"text-sm mt-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",a.currentStatus]}),e.jsxs("div",{children:[e.jsx("strong",{children:"ID:"})," ",a.lifecycleId]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"font-medium",children:"Recent Events"}),c.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No events yet."}):e.jsx("ul",{className:"text-sm divide-y",children:c.map(o=>e.jsxs("li",{className:"py-1 flex items-center justify-between",children:[e.jsx("span",{children:o.eventType}),e.jsx("span",{className:"text-gray-500",children:new Date(o.timestamp).toLocaleString()})]},o._id))})]})]})}function Rn(){var f,p,g,v;const{appointmentId:s}=We(),[a,t]=n.useState(null),[i,h]=n.useState(!0),[l,r]=n.useState("");n.useEffect(()=>{let u=!0;return h(!0),r(""),ss.getChart(s).then(x=>{u&&t(x)}).catch(x=>{var C,A;u&&r(((A=(C=x==null?void 0:x.response)==null?void 0:C.data)==null?void 0:A.message)||"Failed to load chart")}).finally(()=>{u&&h(!1)}),()=>{u=!1}},[s]);const m=u=>t(x=>({...x,note:u})),y=async(u,x)=>{try{await R.patch(`/appointments/${s}/lifecycle/status`,{currentStatus:u,closureNotes:x});const C=await ss.getChart(s);t(C)}catch(C){console.error("Failed to update lifecycle",C),r((C==null?void 0:C.message)||"Failed to update lifecycle"),setTimeout(()=>r(""),3e3)}};if(i)return e.jsx("div",{className:"p-4",children:"Loading chart…"});if(l)return e.jsx("div",{className:"p-4 text-red-600",children:l});if(!a)return e.jsx("div",{className:"p-4",children:"No chart found."});const c=((p=(f=a==null?void 0:a.appointment)==null?void 0:f.patient)==null?void 0:p._id)||((g=a==null?void 0:a.appointment)==null?void 0:g.patient),o=(v=a==null?void 0:a.note)==null?void 0:v.lifecycleId;return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Consultation Workspace"}),e.jsx(Xs,{variant:"icon"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{className:"col-span-2 space-y-4",children:[e.jsxs("div",{className:"card p-3 flex items-center gap-2",children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>y("UnderReview"),children:"Mark Under Review"}),e.jsx("button",{className:"btn btn-outline",onClick:async()=>{const u=prompt("Closure notes (optional)")||void 0;await y("Closed",u)},children:"Close Appointment"})]}),e.jsx("div",{className:"card p-4",children:e.jsx(Sn,{appointmentId:s,initialNote:a.note,lifecycleId:o,onNoteSaved:m})}),e.jsx("div",{className:"card p-4",children:e.jsx(wn,{appointmentId:s,lifecycleId:o})})]}),e.jsxs("div",{className:"col-span-1 space-y-4",children:[e.jsx("div",{className:"card p-4",children:e.jsx(In,{appointmentId:s})}),e.jsx("div",{className:"card p-4",children:e.jsx(Dn,{chart:a})}),e.jsx("div",{className:"card p-4",children:e.jsx(Cn,{appointmentId:s,patientId:c,lifecycleId:o})}),e.jsx("div",{className:"card p-4",children:e.jsx(En,{appointmentId:s,patientId:c,chart:a})})]})]})]})}function Ln(){return e.jsx(Fa,{children:e.jsx(Ua,{children:e.jsx(za,{children:e.jsx(tt,{children:e.jsx(rt,{children:e.jsx(it,{children:e.jsx(ut,{children:e.jsxs(Oa,{children:[e.jsx(Y,{path:"/forums/categories",element:e.jsx(ee,{children:e.jsx(Ut,{})})}),e.jsx(Y,{path:"/forums/categories/:categoryId/threads",element:e.jsx(ee,{children:e.jsx(zt,{})})}),e.jsx(Y,{path:"/forums/threads/:threadId",element:e.jsx(ee,{children:e.jsx(qt,{})})}),e.jsx(Y,{path:"/devices",element:e.jsx(ee,{children:e.jsx(bn,{})})}),e.jsx(Y,{path:"/",element:e.jsx(Ke,{children:e.jsx(pt,{})})}),e.jsx(Y,{path:"/about",element:e.jsx(Ke,{children:e.jsx(Qt,{})})}),e.jsx(Y,{path:"/services",element:e.jsx(Ke,{children:e.jsx(Zt,{})})}),e.jsx(Y,{path:"/contact",element:e.jsx(Ke,{children:e.jsx(Xt,{})})}),e.jsx(Y,{path:"/login",element:e.jsx(Ke,{restricted:!0,children:e.jsx(xt,{})})}),e.jsx(Y,{path:"/register",element:e.jsx(Ke,{restricted:!0,children:e.jsx(jt,{})})}),e.jsx(Y,{path:"/dashboard",element:e.jsx(ee,{children:e.jsx(St,{})})}),e.jsx(Y,{path:"/doctors",element:e.jsx(ee,{children:e.jsx(wt,{})})}),e.jsx(Y,{path:"/doctors/:id",element:e.jsx(ee,{children:e.jsx(Ot,{})})}),e.jsx(Y,{path:"/appointments",element:e.jsx(ee,{children:e.jsx(Dt,{})})}),e.jsx(Y,{path:"/appointments/new",element:e.jsx(ee,{children:e.jsx(At,{})})}),e.jsx(Y,{path:"/reminders/settings",element:e.jsx(Kt,{})}),e.jsx(Y,{path:"/chat",element:e.jsx(ee,{children:e.jsx(yn,{})})}),e.jsx(Y,{path:"/medical-records",element:e.jsx(ee,{roles:["patient"],children:e.jsx(Tt,{})})}),e.jsx(Y,{path:"/video-call/:appointmentId",element:e.jsx(ee,{children:e.jsx(tn,{})})}),e.jsx(Y,{path:"/symptom-check",element:e.jsx(ee,{children:e.jsx(_t,{})})}),e.jsx(Y,{path:"/symptom-check/:checkId",element:e.jsx(ee,{children:e.jsx(Bt,{})})}),e.jsx(Y,{path:"/admin/verifications",element:e.jsx(ee,{roles:["admin"],children:e.jsx(_s,{})})}),e.jsx(Y,{path:"/admin/verifications/:doctorId",element:e.jsx(ee,{roles:["admin"],children:e.jsx(_s,{})})}),e.jsx(Y,{path:"/admin/users",element:e.jsx(ee,{roles:["admin"],children:e.jsx(qa,{})})}),e.jsx(Y,{path:"/admin/reports",element:e.jsx(ee,{roles:["admin"],children:e.jsx(Ha,{})})}),e.jsx(Y,{path:"/admin/audit-logs",element:e.jsx(ee,{roles:["admin"],children:e.jsx(Va,{})})}),e.jsx(Y,{path:"/admin/doctors",element:e.jsx(ee,{roles:["admin"],children:e.jsx(Ja,{})})}),e.jsx(Y,{path:"/admin/appointments",element:e.jsx(ee,{roles:["admin"],children:e.jsx(Wa,{})})}),e.jsx(Y,{path:"/admin/analytics",element:e.jsx(ee,{roles:["admin"],children:e.jsx(Ga,{})})}),e.jsx(Y,{path:"/admin/metrics",element:e.jsx(ee,{roles:["admin"],children:e.jsx(Ya,{})})}),e.jsx(Y,{path:"/admin/pricing",element:e.jsx(ee,{roles:["admin"],children:e.jsx(Qa,{})})}),e.jsx(Y,{path:"/admin/banks",element:e.jsx(ee,{roles:["admin"],children:e.jsx(Ka,{})})}),e.jsx(Y,{path:"/admin/appointments/:appointmentId/lifecycle",element:e.jsx(ee,{roles:["admin"],children:e.jsx(Za,{})})}),e.jsx(Y,{path:"/admin/settings",element:e.jsx(ee,{roles:["admin"],children:e.jsx(Xa,{})})}),e.jsx(Y,{path:"/admin/roles",element:e.jsx(ee,{roles:["admin"],children:e.jsx(et,{})})}),e.jsx(Y,{path:"/admin/forums/moderation",element:e.jsx(ee,{roles:["admin"],children:e.jsx(st,{})})}),e.jsx(Y,{path:"/doctor/profile",element:e.jsx(ee,{roles:["doctor"],children:e.jsx(Vt,{})})}),e.jsx(Y,{path:"/doctor/availability",element:e.jsx(ee,{roles:["doctor"],children:e.jsx(Jt,{})})}),e.jsx(Y,{path:"/doctor/appointments",element:e.jsx(ee,{roles:["doctor"],children:e.jsx(Wt,{})})}),e.jsx(Y,{path:"/doctor/patients",element:e.jsx(ee,{roles:["doctor"],children:e.jsx(Yt,{})})}),e.jsx(Y,{path:"/doctor/medical-records",element:e.jsx(ee,{roles:["doctor"],children:e.jsx(Rt,{})})}),e.jsx(Y,{path:"/doctor/medical-records/new",element:e.jsx(ee,{roles:["doctor"],children:e.jsx(Lt,{})})}),e.jsx(Y,{path:"/doctor/prescriptions/new",element:e.jsx(ee,{roles:["doctor"],children:e.jsx($t,{})})}),e.jsx(Y,{path:"/doctor/lab-orders/new",element:e.jsx(ee,{roles:["doctor"],children:e.jsx(Mt,{})})}),e.jsx(Y,{path:"/doctor/calendar",element:e.jsx(ee,{roles:["doctor"],children:e.jsx(Gt,{})})}),e.jsx(Y,{path:"/video-calls",element:e.jsx(ee,{roles:["doctor"],children:e.jsx(en,{})})}),e.jsx(Y,{path:"/analytics",element:e.jsx(ee,{roles:["doctor"],children:e.jsx(sn,{})})}),e.jsx(Y,{path:"/settings",element:e.jsx(ee,{roles:["doctor","patient"],children:e.jsx(nn,{})})}),e.jsx(Y,{path:"/patient/video-calls",element:e.jsx(ee,{roles:["patient"],children:e.jsx(fn,{})})}),e.jsx(Y,{path:"/patient/settings",element:e.jsx(ee,{roles:["patient"],children:e.jsx(vn,{})})}),e.jsx(Y,{path:"/appointments/:id",element:e.jsx(ee,{children:e.jsx(Ft,{})})}),e.jsx(Y,{path:"/phr",element:e.jsx(ee,{children:e.jsx(Nn,{})})}),e.jsx(Y,{path:"/doctor/appointments/:appointmentId/consult",element:e.jsx(ee,{roles:["doctor"],children:e.jsx(Rn,{})})}),e.jsx(Y,{path:"/portals",element:e.jsx(ee,{roles:["pharmacist","laboratory","admin"],children:e.jsx(mn,{})})}),e.jsx(Y,{path:"/pharmacy/portal",element:e.jsx(ee,{roles:["pharmacist"],children:e.jsx(rn,{})})}),e.jsx(Y,{path:"/pharmacy/profile/edit",element:e.jsx(ee,{roles:["pharmacist"],children:e.jsx(on,{})})}),e.jsx(Y,{path:"/pharmacy/inventory",element:e.jsx(ee,{roles:["pharmacist"],children:e.jsx(na,{})})}),e.jsx(Y,{path:"/pharmacy/orders",element:e.jsx(ee,{roles:["pharmacist"],children:e.jsx(ra,{})})}),e.jsx(Y,{path:"/laboratory/portal",element:e.jsx(ee,{roles:["laboratory"],children:e.jsx(cn,{})})}),e.jsx(Y,{path:"/laboratory/profile/edit",element:e.jsx(ee,{roles:["laboratory"],children:e.jsx(hn,{})})}),e.jsx(Y,{path:"/laboratory/catalog",element:e.jsx(ee,{roles:["laboratory"],children:e.jsx(ia,{})})}),e.jsx(Y,{path:"/laboratory/orders",element:e.jsx(ee,{roles:["laboratory"],children:e.jsx(Ps,{})})}),e.jsx(Y,{path:"*",element:e.jsx(Ht,{})})]})})})})})})})})}_a(document.getElementById("root")).render(e.jsx(n.StrictMode,{children:e.jsx(ot,{children:e.jsx(Ln,{})})}));
