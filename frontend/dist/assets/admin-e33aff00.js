import{a as we,r as a,j as e,u as Xe,b as Se,L as le,U as he,c as ve,C as fe,S as es,d as ss,F as ts,A as ue,M as as,P as ns,e as is,f as rs,g as Ne,K as ye,E as cs,h as Ce,T as ls,X as os,i as ds,k as me}from"./vendor-5f7f2f36.js";const P=we.create({baseURL:"http://localhost:5000/api"});P.interceptors.request.use(i=>{const c=localStorage.getItem("token");c&&(i.headers.Authorization=`Bearer ${c}`);const g=localStorage.getItem("locale")||"en";return i.headers["Accept-Language"]=g,i},i=>Promise.reject(i));P.interceptors.response.use(i=>i,i=>(i.response&&i.response.status===401&&(localStorage.removeItem("token"),window.location.pathname!=="/login"&&(window.location.href="/login")),Promise.reject(i)));const ke=a.createContext(null),vs=({children:i})=>{const[c,g]=a.useState(null),[S,f]=a.useState(()=>localStorage.getItem("token")),[w,b]=a.useState(!0);a.useEffect(()=>{(async()=>{var R,x;if(S)try{const h=await P.get("/auth/me");(R=h.data)!=null&&R.success&&((x=h.data.data)!=null&&x.user)?g(h.data.data.user):(console.warn("AuthContext: unexpected /auth/me response",h.data),k())}catch(h){console.error("Failed to load user:",h),k()}b(!1)})()},[S]);const y=async(T,R)=>{var x,h;try{const m=await P.post("/auth/login",{email:T,password:R}),{user:n,token:N}=m.data.data;return localStorage.setItem("token",N),f(N),g(n),n}catch(m){throw new Error(((h=(x=m.response)==null?void 0:x.data)==null?void 0:h.message)||m.message)}},k=()=>{localStorage.removeItem("token"),f(null),g(null)},A={user:c,token:S,login:y,register:async T=>{var R,x;try{const h=await P.post("/auth/register",T),{user:m,token:n}=h.data.data;return localStorage.setItem("token",n),f(n),g(m),m}catch(h){throw new Error(((x=(R=h.response)==null?void 0:R.data)==null?void 0:x.message)||h.message)}},logout:k,isAuthenticated:!!c,loading:w};return e.jsx(ke.Provider,{value:A,children:!w&&i})},pe=()=>{const i=a.useContext(ke);if(i===void 0)throw new Error("useAuth must be used within an AuthProvider");return i},Pe=a.createContext(null),ie=()=>{const i=a.useContext(Pe);if(!i)throw new Error("useNotifications must be used within a NotificationProvider");return i},fs=({children:i})=>{const[c,g]=a.useState([]),S=(y,k="info",E=5e3)=>{const A=Date.now()+Math.random(),T={id:A,message:y,type:k,duration:E};return g(R=>[...R,T]),E>0&&setTimeout(()=>{f(A)},E),A},f=y=>{g(k=>k.filter(E=>E.id!==y))},b={notifications:c,addNotification:S,removeNotification:f,clearNotifications:()=>{g([])}};return e.jsx(Pe.Provider,{value:b,children:i})};function hs({status:i,size:c="medium",showLabel:g=!0}){const f=(()=>{switch(i){case"approved":return{label:"Verified",color:"green",icon:"✓"};case"rejected":return{label:"Not Verified",color:"red",icon:"✕"};case"pending":default:return{label:"Pending Verification",color:"amber",icon:"⟳"}}})(),w=`verification-status-${c}`;return e.jsx("div",{className:"verification-status-container",children:e.jsxs("span",{className:`verification-status ${w} ${f.color}`,children:[e.jsx("span",{className:"status-icon",children:f.icon}),g&&e.jsx("span",{className:"status-label",children:f.label})]})})}function Ns(){var N,o,l,v,p;const{user:i}=pe(),{addNotification:c}=ie(),g=Xe(),{doctorId:S}=Se(),[f,w]=a.useState(null),[b,y]=a.useState(!0),[k,E]=a.useState(""),[A,T]=a.useState(!1),[R,x]=a.useState([]);a.useEffect(()=>{(async()=>{try{const s=await fetch("http://localhost:5000/api/admin/verifications/pending",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(s.ok){const D=await s.json();x(D)}}catch(s){console.error("Error fetching pending verifications:",s)}})()},[]),a.useEffect(()=>{if(!S){y(!1);return}(async()=>{try{y(!0);const s=await fetch(`http://localhost:5000/api/admin/verifications/${S}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(s.ok){const D=await s.json();w(D)}else c("Failed to fetch doctor details","error")}catch(s){console.error("Error fetching doctor details:",s),c("Error fetching doctor details","error")}finally{y(!1)}})()},[S,c]);const h=async()=>{await n("approve")},m=async()=>{if(!k.trim()){c("Please provide rejection reason in the notes","error");return}await n("reject")},n=async u=>{try{T(!0);const s=await fetch(`http://localhost:5000/api/admin/verifications/${S}/${u}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({notes:k})});if(s.ok)c(`Doctor verification ${u==="approve"?"approved":"rejected"} successfully`,"success"),x(R.filter(D=>D._id!==S)),g("/admin/verifications");else{const D=await s.json();throw new Error(D.error||`Failed to ${u} verification`)}}catch(s){console.error(`Error ${u}ing verification:`,s),c(s.message||`Error ${u}ing verification`,"error")}finally{T(!1)}};return!i||i.role!=="admin"?e.jsx("div",{className:"verification-review-page",children:e.jsxs("div",{className:"unauthorized-message",children:[e.jsx("h2",{children:"Unauthorized Access"}),e.jsx("p",{children:"You must be an admin to view this page."}),e.jsx(le,{to:"/",className:"btn-back",children:"Return to Home"})]})}):b?e.jsx("div",{className:"verification-review-page",children:e.jsx("div",{className:"loading-spinner",children:"Loading..."})}):e.jsx("div",{className:"verification-review-page",children:e.jsxs("div",{className:"verification-review-container",children:[e.jsx("h1",{children:"Doctor Verification Review"}),S?f&&e.jsxs("div",{className:"doctor-verification-details",children:[e.jsxs("div",{className:"verification-header",children:[e.jsxs("div",{className:"doctor-info",children:[e.jsxs("h2",{children:["Dr. ",(o=(N=f.user)==null?void 0:N.profile)==null?void 0:o.firstName," ",(v=(l=f.user)==null?void 0:l.profile)==null?void 0:v.lastName]}),e.jsx("p",{className:"doctor-email",children:(p=f.user)==null?void 0:p.email}),e.jsx(hs,{status:f.verificationStatus})]}),e.jsx(le,{to:"/admin/verifications",className:"btn-back",children:"Back to List"})]}),e.jsxs("div",{className:"detail-section",children:[e.jsx("h3",{children:"Professional Information"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Specialization"}),e.jsx("span",{className:"detail-value",children:f.specialization})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"License Number"}),e.jsx("span",{className:"detail-value",children:f.licenseNumber})]})]})]}),e.jsxs("div",{className:"detail-section",children:[e.jsx("h3",{children:"Education"}),f.education&&f.education.length>0?e.jsx("ul",{className:"education-list",children:f.education.map((u,s)=>e.jsxs("li",{className:"education-item",children:[e.jsx("div",{className:"education-degree",children:u.degree}),e.jsx("div",{className:"education-institution",children:u.institution}),e.jsx("div",{className:"education-year",children:u.year})]},s))}):e.jsx("p",{className:"no-items",children:"No education information provided"})]}),e.jsxs("div",{className:"detail-section",children:[e.jsx("h3",{children:"Experience"}),f.experience&&f.experience.length>0?e.jsx("ul",{className:"experience-list",children:f.experience.map((u,s)=>e.jsxs("li",{className:"experience-item",children:[e.jsx("div",{className:"experience-position",children:u.position}),e.jsx("div",{className:"experience-hospital",children:u.hospital}),e.jsxs("div",{className:"experience-period",children:[u.startYear," - ",u.endYear]})]},s))}):e.jsx("p",{className:"no-items",children:"No experience information provided"})]}),e.jsxs("div",{className:"detail-section",children:[e.jsx("h3",{children:"Verification Documents"}),f.verificationDocuments&&f.verificationDocuments.length>0?e.jsx("ul",{className:"document-list",children:f.verificationDocuments.map((u,s)=>e.jsxs("li",{className:"document-item",children:[e.jsx("div",{className:"document-type",children:u.type.charAt(0).toUpperCase()+u.type.slice(1)}),e.jsx("a",{href:u.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"document-link",children:"View Document"}),e.jsxs("div",{className:"document-date",children:["Uploaded: ",new Date(u.uploadedAt).toLocaleDateString()]})]},s))}):e.jsx("p",{className:"no-items",children:"No documents uploaded"})]}),e.jsxs("div",{className:"detail-section",children:[e.jsx("h3",{children:"Review Notes"}),e.jsx("textarea",{className:"review-notes",value:k,onChange:u=>E(u.target.value),placeholder:"Enter your review notes here (required for rejection)",rows:4})]}),e.jsxs("div",{className:"verification-actions",children:[e.jsx("button",{className:"btn-reject",onClick:m,disabled:A,children:A?"Processing...":"Reject Verification"}),e.jsx("button",{className:"btn-approve",onClick:h,disabled:A,children:A?"Processing...":"Approve Verification"})]})]}):e.jsxs("div",{className:"pending-verifications-list",children:[e.jsx("h2",{children:"Pending Verifications"}),R.length===0?e.jsx("p",{className:"no-items",children:"No pending verification requests"}):e.jsx("ul",{className:"pending-list",children:R.map(u=>{var s,D,C,L;return e.jsxs("li",{className:"pending-list-item",children:[e.jsxs("div",{className:"doctor-basic-info",children:[e.jsxs("h3",{children:["Dr. ",(D=(s=u.user)==null?void 0:s.profile)==null?void 0:D.firstName," ",(L=(C=u.user)==null?void 0:C.profile)==null?void 0:L.lastName]}),e.jsx("p",{children:u.specialization}),e.jsxs("p",{className:"submitted-date",children:["Submitted: ",new Date(u.createdAt).toLocaleDateString()]})]}),e.jsx(le,{to:`/admin/verifications/${u._id}`,className:"btn-view-details",children:"Review Request"})]},u._id)})})]})]})})}const xe=we.create({baseURL:"http://localhost:5000/api",headers:{"Content-Type":"application/json"}});xe.interceptors.request.use(i=>{const c=localStorage.getItem("token");c&&(i.headers.Authorization=`Bearer ${c}`);const g=localStorage.getItem("locale")||"en";return i.headers["Accept-Language"]=g,i},i=>Promise.reject(i));xe.interceptors.response.use(i=>i,i=>{var S,f,w,b,y;i.response&&i.response.status===401&&(localStorage.removeItem("token"),console.error("Unauthorized access - 401. Token removed."));const g={message:((f=(S=i.response)==null?void 0:S.data)==null?void 0:f.message)||((b=(w=i.response)==null?void 0:w.data)==null?void 0:b.error)||i.message,status:(y=i.response)==null?void 0:y.status,originalError:i};return Promise.reject(g)});function je({size:i="medium",color:c="primary",fullPage:g=!1,className:S=""}){const f=`
    loading-spinner 
    ${i} 
    ${c}
  `;return e.jsx("div",{className:`loading-spinner-container ${g?"full-page":""} ${S}`,children:e.jsx("div",{className:f.trim(),"aria-label":"Loading",role:"status"})})}const be={getCategories(){return P.get("/forums/categories").then(i=>i.data.data)},getThreads(i,c=1,g=20){return P.get(`/forums/categories/${i}/threads`,{params:{page:c,limit:g}}).then(S=>S.data.data)},getThread(i,c=1,g=50){return P.get(`/forums/threads/${i}`,{params:{page:c,limit:g}}).then(S=>S.data.data)},createThread(i){return P.post("/forums/threads",i).then(c=>c.data.data)},createPost(i,c){return P.post(`/forums/threads/${i}/posts`,{content:c}).then(g=>g.data.data)},toggleLike(i){return P.post(`/forums/posts/${i}/like`).then(c=>c.data.data)},reportPost(i,c){return P.post(`/forums/posts/${i}/report`,{reason:c}).then(g=>g.data.data)},getReports(i){const c=i?{status:i}:{};return P.get("/forums/reports",{params:c}).then(g=>g.data.data)},updateReportStatus(i,c){return P.patch(`/forums/reports/${i}`,{status:c}).then(g=>g.data.data)}};const ys=()=>{const[i,c]=a.useState([]),[g,S]=a.useState(!0),[f,w]=a.useState(null),[b,y]=a.useState(""),[k,E]=a.useState("all"),[A,T]=a.useState("all"),[R,x]=a.useState(!1),[h,m]=a.useState(!1),[n,N]=a.useState(!1),[o,l]=a.useState(null),[v,p]=a.useState(null),[u,s]=a.useState({email:"",firstName:"",lastName:"",role:"patient",password:"",phone:"",specialization:""}),[D,C]=a.useState({userId:"",newPassword:"",confirmPassword:""}),[L,I]=a.useState({firstName:"",lastName:"",email:"",username:"",role:"",timeZone:"",phone:"",specialization:""}),[_,Q]=a.useState({totalUsers:0,activeUsers:0,pendingUsers:0,doctors:0,patients:0,admins:0});a.useEffect(()=>{$(),O()},[]);const $=async()=>{try{S(!0);const r=await P.get("/admin/users");r.data.users&&c(r.data.users)}catch(r){console.log("Error fetching users:",r),w("Failed to fetch users")}finally{S(!1)}},O=async()=>{var r,V,z;try{const F=await P.get("/admin/users/stats");F.data&&Q({totalUsers:F.data.totalUsers||0,doctors:((r=F.data.summary)==null?void 0:r.doctors)||0,patients:((V=F.data.summary)==null?void 0:V.patients)||0,admins:((z=F.data.summary)==null?void 0:z.admins)||0})}catch(F){console.log("Error fetching dashboard stats:",F)}},G=async r=>{var V,z;r.preventDefault();try{const F=await P.post("/admin/users",u);F.data.message&&F.data.user&&(await $(),await O(),x(!1),s({email:"",firstName:"",lastName:"",role:"patient",password:"",phone:"",specialization:""}),w(null))}catch(F){console.log("Error creating user:",F),w(((z=(V=F.response)==null?void 0:V.data)==null?void 0:z.error)||"Failed to create user")}},M=async r=>{var V,z;if(window.confirm("Are you sure you want to delete this user? This action cannot be undone."))try{(await P.delete(`/admin/users/${r}`)).data.message&&(await $(),await O(),w(null))}catch(F){console.log("Error deleting user:",F),w(((z=(V=F.response)==null?void 0:V.data)==null?void 0:z.error)||"Failed to delete user")}},Z=async r=>{var V,z;if(r.preventDefault(),D.newPassword!==D.confirmPassword){w("Passwords do not match");return}try{(await P.post(`/admin/users/${D.userId}/reset-password`,{newPassword:D.newPassword})).data.message&&(m(!1),C({userId:"",newPassword:"",confirmPassword:""}),w(null),alert("Password reset successfully"))}catch(F){console.log("Error resetting password:",F),w(((z=(V=F.response)==null?void 0:V.data)==null?void 0:z.error)||"Failed to reset password")}},Y=async(r,V)=>{var z,F;try{const q=V==="active"?"inactive":"active";(await P.put(`/admin/users/${r}/status`,{status:q})).data.message&&(await $(),await O())}catch(q){console.log("Error updating user status:",q),w(((F=(z=q.response)==null?void 0:z.data)==null?void 0:F.error)||"Failed to update user status")}},B=(i||[]).filter(r=>{var X,ee;const V=r.firstName||((X=r.profile)==null?void 0:X.firstName)||"",z=r.lastName||((ee=r.profile)==null?void 0:ee.lastName)||"",F=r.email.toLowerCase().includes(b.toLowerCase())||`${V} ${z}`.toLowerCase().includes(b.toLowerCase()),q=k==="all"||r.role===k,H=A==="all"||r.status===A;return F&&q&&H}),J=r=>{switch(r){case"active":return e.jsx(fe,{className:"status-icon active",size:16});case"inactive":return e.jsx(os,{className:"status-icon inactive",size:16});case"pending":return e.jsx(ue,{className:"status-icon pending",size:16});default:return e.jsx(ue,{className:"status-icon",size:16})}},se=r=>{switch(r){case"admin":return"role-admin";case"doctor":return"role-doctor";case"patient":return"role-patient";default:return"role-default"}};return g?e.jsxs("div",{className:"admin-users-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading users..."})]}):e.jsxs("div",{className:"admin-users-management",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{className:"header-content",children:[e.jsxs("h1",{children:[e.jsx(he,{size:24})," User Management"]}),e.jsx("p",{children:"Manage platform users, roles, and permissions"})]}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>x(!0),children:[e.jsx(ve,{size:18}),"Add User"]})]}),e.jsxs("div",{className:"dashboard-stats",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon total",children:e.jsx(he,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:_.totalUsers}),e.jsx("p",{children:"Total Users"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon active",children:e.jsx(fe,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:_.activeUsers}),e.jsx("p",{children:"Active Users"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon doctors",children:e.jsx(es,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:_.doctors}),e.jsx("p",{children:"Doctors"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon patients",children:e.jsx(he,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:_.patients}),e.jsx("p",{children:"Patients"})]})]})]}),e.jsxs("div",{className:"filters-section",children:[e.jsxs("div",{className:"search-box",children:[e.jsx(ss,{size:18}),e.jsx("input",{type:"text",placeholder:"Search users by name or email...",value:b,onChange:r=>y(r.target.value)})]}),e.jsxs("div",{className:"filter-controls",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx(ts,{size:16}),e.jsxs("select",{value:k,onChange:r=>E(r.target.value),children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"doctor",children:"Doctor"}),e.jsx("option",{value:"patient",children:"Patient"})]})]}),e.jsx("div",{className:"filter-group",children:e.jsxs("select",{value:A,onChange:r=>T(r.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"pending",children:"Pending"})]})})]})]}),f&&e.jsxs("div",{className:"error-message",children:[e.jsx(ue,{size:18}),f]}),e.jsx("div",{className:"users-table-container",children:e.jsxs("table",{className:"users-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Joined"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:B.map(r=>{var V,z,F,q,H;return e.jsxs("tr",{children:[e.jsxs("td",{className:"user-info",children:[e.jsxs("div",{className:"user-avatar",children:[(r.firstName||((V=r.profile)==null?void 0:V.firstName)||"U")[0],(r.lastName||((z=r.profile)==null?void 0:z.lastName)||"N")[0]]}),e.jsxs("div",{className:"user-details",children:[e.jsxs("div",{className:"user-name",children:[r.firstName||((F=r.profile)==null?void 0:F.firstName)||"Unknown"," ",r.lastName||((q=r.profile)==null?void 0:q.lastName)||"User"]}),e.jsx("div",{className:"user-email",children:r.email})]})]}),e.jsx("td",{children:e.jsx("span",{className:`role-badge ${se(r.role)}`,children:r.role})}),e.jsx("td",{children:e.jsxs("div",{className:"status-container",children:[J(r.status),e.jsx("span",{className:`status-text ${r.status}`,children:r.status})]})}),e.jsxs("td",{className:"contact-info",children:[e.jsxs("div",{className:"contact-item",children:[e.jsx(as,{size:14}),r.email]}),((H=r.profile)==null?void 0:H.phone)&&e.jsxs("div",{className:"contact-item",children:[e.jsx(ns,{size:14}),r.profile.phone]})]}),e.jsxs("td",{className:"joined-date",children:[e.jsx(is,{size:14}),new Date(r.createdAt).toLocaleDateString()]}),e.jsx("td",{className:"actions-cell",children:e.jsxs("div",{className:"actions-dropdown",children:[e.jsx("button",{className:"dropdown-toggle",onClick:()=>p(v===r._id?null:r._id),children:e.jsx(rs,{size:18})}),v===r._id&&e.jsxs("div",{className:"dropdown-menu",children:[e.jsxs("button",{onClick:()=>{var X,ee,W,re;l(r),I({firstName:r.firstName||((X=r.profile)==null?void 0:X.firstName)||"",lastName:r.lastName||((ee=r.profile)==null?void 0:ee.lastName)||"",email:r.email||"",username:r.username||"",role:r.role||"patient",timeZone:r.timeZone||"",phone:((W=r.profile)==null?void 0:W.phone)||"",specialization:((re=r.profile)==null?void 0:re.specialization)||""}),N(!0),p(null)},children:[e.jsx(Ne,{size:16}),"Edit User"]}),e.jsxs("button",{onClick:()=>{C({...D,userId:r._id}),m(!0),p(null)},children:[e.jsx(ye,{size:16}),"Reset Password"]}),e.jsxs("button",{onClick:()=>{Y(r._id,r.status),p(null)},children:[r.status==="active"?e.jsx(cs,{size:16}):e.jsx(Ce,{size:16}),r.status==="active"?"Deactivate":"Activate"]}),e.jsxs("button",{onClick:()=>{M(r._id),p(null)},className:"delete-action",children:[e.jsx(ls,{size:16}),"Delete User"]})]})]})})]},r._id)})})]})}),R&&e.jsx("div",{className:"modal-overlay",onClick:()=>x(!1),children:e.jsxs("div",{className:"modal-content",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(ve,{size:20})," Create New User"]}),e.jsx("button",{className:"modal-close",onClick:()=>x(!1),children:"×"})]}),e.jsxs("form",{onSubmit:G,children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email *"}),e.jsx("input",{type:"email",value:u.email,onChange:r=>s({...u,email:r.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role *"}),e.jsxs("select",{value:u.role,onChange:r=>s({...u,role:r.target.value}),required:!0,children:[e.jsx("option",{value:"patient",children:"Patient"}),e.jsx("option",{value:"doctor",children:"Doctor"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"First Name *"}),e.jsx("input",{type:"text",value:u.firstName,onChange:r=>s({...u,firstName:r.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Last Name *"}),e.jsx("input",{type:"text",value:u.lastName,onChange:r=>s({...u,lastName:r.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Password *"}),e.jsx("input",{type:"password",value:u.password,onChange:r=>s({...u,password:r.target.value}),required:!0,minLength:"6"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone"}),e.jsx("input",{type:"tel",value:u.phone,onChange:r=>s({...u,phone:r.target.value})})]}),u.role==="doctor"&&e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Specialization"}),e.jsx("input",{type:"text",value:u.specialization,onChange:r=>s({...u,specialization:r.target.value}),placeholder:"e.g., Cardiology, General Medicine"})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:()=>x(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",children:"Create User"})]})]})]})}),h&&e.jsx("div",{className:"modal-overlay",onClick:()=>m(!1),children:e.jsxs("div",{className:"modal-content",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(ye,{size:20})," Reset Password"]}),e.jsx("button",{className:"modal-close",onClick:()=>m(!1),children:"×"})]}),e.jsxs("form",{onSubmit:Z,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"New Password *"}),e.jsx("input",{type:"password",value:D.newPassword,onChange:r=>C({...D,newPassword:r.target.value}),required:!0,minLength:"6"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Confirm Password *"}),e.jsx("input",{type:"password",value:D.confirmPassword,onChange:r=>C({...D,confirmPassword:r.target.value}),required:!0,minLength:"6"})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",children:"Reset Password"})]})]})]})}),n&&o&&e.jsx("div",{className:"modal-overlay",onClick:()=>N(!1),children:e.jsxs("div",{className:"modal-content",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(Ne,{size:20})," Edit User"]}),e.jsx("button",{className:"modal-close",onClick:()=>N(!1),children:"×"})]}),e.jsxs("form",{onSubmit:async r=>{var V,z,F;r.preventDefault();try{const q={profile:{firstName:L.firstName,lastName:L.lastName,...L.phone?{phone:L.phone}:{},...L.role==="doctor"&&L.specialization?{specialization:L.specialization}:{}},role:L.role},H={};L.email&&(H.email=L.email),L.username&&(H.username=L.username),L.timeZone&&(H.timeZone=L.timeZone);const X=Object.keys(H).length>0,ee=X?{...q,...H}:q;let W;X?W=await P.patch(`/admin/users/super/${o._id}`,ee):W=await P.put(`/admin/users/${o._id}`,ee),(V=W.data)!=null&&V.message&&(await $(),await O(),N(!1),l(null),w(null))}catch(q){console.log("Error updating user:",q),w(((F=(z=q.response)==null?void 0:z.data)==null?void 0:F.error)||"Failed to update user")}},children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"First Name"}),e.jsx("input",{type:"text",value:L.firstName,onChange:r=>I({...L,firstName:r.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Last Name"}),e.jsx("input",{type:"text",value:L.lastName,onChange:r=>I({...L,lastName:r.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email (super admin)"}),e.jsx("input",{type:"email",value:L.email,onChange:r=>I({...L,email:r.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Username (super admin)"}),e.jsx("input",{type:"text",value:L.username,onChange:r=>I({...L,username:r.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role"}),e.jsxs("select",{value:L.role,onChange:r=>I({...L,role:r.target.value}),children:[e.jsx("option",{value:"patient",children:"Patient"}),e.jsx("option",{value:"doctor",children:"Doctor"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Time Zone (super admin)"}),e.jsx("input",{type:"text",value:L.timeZone,onChange:r=>I({...L,timeZone:r.target.value}),placeholder:"e.g., UTC"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone"}),e.jsx("input",{type:"tel",value:L.phone,onChange:r=>I({...L,phone:r.target.value})})]}),L.role==="doctor"&&e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Specialization"}),e.jsx("input",{type:"text",value:L.specialization,onChange:r=>I({...L,specialization:r.target.value})})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:()=>N(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",children:"Save Changes"})]})]})]})})]})};function bs(){var E,A,T,R,x,h,m,n,N;const{addNotification:i}=ie(),[c,g]=a.useState(!0),[S,f]=a.useState("month"),[w,b]=a.useState({registrations:[],appointments:[],verifications:[]});a.useEffect(()=>{(async()=>{try{g(!0);const l=await fetch(`http://localhost:5000/api/admin/reports?range=${S}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!l.ok)throw console.error("Reports API error:",l.status),new Error("Failed to fetch report data");const v=await l.json();b(v),i("Report data loaded successfully","success")}catch(l){i(`Error: ${l.message}`,"error")}finally{g(!1)}})()},[S,i]);const y=o=>{f(o.target.value)},k=async o=>{try{const l=await fetch(`http://localhost:5000/api/admin/reports/${o}/export?range=${S}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!l.ok)throw new Error("Failed to download report");const v=await l.blob(),p=window.URL.createObjectURL(v),u=document.createElement("a");u.style.display="none",u.href=p,u.download=`${o}-${S}-report.csv`,document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(p),i("Report downloaded successfully","success")}catch(l){i(`Error: ${l.message}`,"error")}};return c?e.jsx(je,{}):e.jsxs("div",{className:"admin-page reports-page",children:[e.jsx("h1",{children:"System Reports"}),e.jsx("div",{className:"filters-container",children:e.jsx("div",{className:"filter-dropdown",children:e.jsxs("select",{value:S,onChange:y,children:[e.jsx("option",{value:"week",children:"Last Week"}),e.jsx("option",{value:"month",children:"Last Month"}),e.jsx("option",{value:"quarter",children:"Last Quarter"}),e.jsx("option",{value:"year",children:"Last Year"})]})})}),e.jsxs("div",{className:"reports-grid",children:[e.jsxs("div",{className:"report-card",children:[e.jsxs("div",{className:"report-header",children:[e.jsx("h2",{children:"User Registrations"}),e.jsx("button",{className:"btn-sm secondary",onClick:()=>k("registrations"),children:"Download CSV"})]}),e.jsxs("div",{className:"report-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:((E=w.summary)==null?void 0:E.totalRegistrations)||0}),e.jsx("span",{className:"stat-label",children:"Total"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:((A=w.summary)==null?void 0:A.patientRegistrations)||0}),e.jsx("span",{className:"stat-label",children:"Patients"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:((T=w.summary)==null?void 0:T.doctorRegistrations)||0}),e.jsx("span",{className:"stat-label",children:"Doctors"})]})]}),e.jsx("div",{className:"report-chart",children:e.jsx("div",{className:"placeholder-chart",children:"Registration trend visualization"})})]}),e.jsxs("div",{className:"report-card",children:[e.jsxs("div",{className:"report-header",children:[e.jsx("h2",{children:"Appointments"}),e.jsx("button",{className:"btn-sm secondary",onClick:()=>k("appointments"),children:"Download CSV"})]}),e.jsxs("div",{className:"report-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:((R=w.summary)==null?void 0:R.totalAppointments)||0}),e.jsx("span",{className:"stat-label",children:"Total"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:((x=w.summary)==null?void 0:x.completedAppointments)||0}),e.jsx("span",{className:"stat-label",children:"Completed"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:((h=w.summary)==null?void 0:h.canceledAppointments)||0}),e.jsx("span",{className:"stat-label",children:"Canceled"})]})]}),e.jsx("div",{className:"report-chart",children:e.jsx("div",{className:"placeholder-chart",children:"Appointment trend visualization"})})]}),e.jsxs("div",{className:"report-card",children:[e.jsxs("div",{className:"report-header",children:[e.jsx("h2",{children:"Doctor Verifications"}),e.jsx("button",{className:"btn-sm secondary",onClick:()=>k("verifications"),children:"Download CSV"})]}),e.jsxs("div",{className:"report-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:((m=w.summary)==null?void 0:m.totalVerifications)||0}),e.jsx("span",{className:"stat-label",children:"Total"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:((n=w.summary)==null?void 0:n.approvedVerifications)||0}),e.jsx("span",{className:"stat-label",children:"Approved"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:((N=w.summary)==null?void 0:N.rejectedVerifications)||0}),e.jsx("span",{className:"stat-label",children:"Rejected"})]})]}),e.jsx("div",{className:"report-chart",children:e.jsx("div",{className:"placeholder-chart",children:"Verification trend visualization"})})]})]})]})}function ws(){const{addNotification:i}=ie(),[c,g]=a.useState([]),[S,f]=a.useState(!0);a.useEffect(()=>{(async()=>{try{f(!0);const y=await be.getReports();g(y),i("Reports loaded","success")}catch{i("Error loading reports","error")}finally{f(!1)}})()},[i]);const w=async(b,y)=>{try{await be.updateReportStatus(b,y),g(k=>k.map(E=>E._id===b?{...E,status:y}:E)),i("Report status updated","success")}catch{i("Error updating report status","error")}};return S?e.jsx(je,{}):e.jsxs("div",{className:"admin-page moderation-page",children:[e.jsx("h1",{children:"Forum Moderation"}),e.jsxs("table",{className:"admin-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Post"}),e.jsx("th",{children:"Author"}),e.jsx("th",{children:"Reason"}),e.jsx("th",{children:"Reporter"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:c.map(b=>e.jsxs("tr",{children:[e.jsxs("td",{children:[b.postId.content.slice(0,50),"..."]}),e.jsxs("td",{children:[b.postId.authorId.profile.firstName," ",b.postId.authorId.profile.lastName]}),e.jsx("td",{children:b.reason}),e.jsxs("td",{children:[b.reporterId.profile.firstName," ",b.reporterId.profile.lastName]}),e.jsx("td",{children:e.jsxs("select",{value:b.status,onChange:y=>w(b._id,y.target.value),children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Reviewed",children:"Reviewed"}),e.jsx("option",{value:"ActionTaken",children:"ActionTaken"})]})})]},b._id))})]})]})}const ce=()=>{const{addNotification:i}=ie(),[c,g]=a.useState([]),[S,f]=a.useState(!0),[w,b]=a.useState(null),[y,k]=a.useState(""),[E,A]=a.useState("all"),[T,R]=a.useState(null),[x,h]=a.useState(!1);a.useEffect(()=>{const o=async(v=null,p=!1)=>{var u;try{p||f(!0);const s=new URL("http://localhost:5000/api/admin/users");s.searchParams.set("role","doctor"),s.searchParams.set("limit","20"),v&&s.searchParams.set("cursor",v);const D=await fetch(s.toString(),{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!D.ok)throw new Error(`Failed to fetch doctors (${D.status})`);const C=await D.json(),I=(Array.isArray(C==null?void 0:C.users)?C.users:Array.isArray(C)?C:Array.isArray((u=C==null?void 0:C.data)==null?void 0:u.users)?C.data.users:Array.isArray(C==null?void 0:C.data)?C.data:[]).filter(_=>_.role==="doctor");g(_=>p?[..._,...I]:I),R((C==null?void 0:C.nextCursor)||null)}catch(s){b(s.message||"Failed to fetch doctors")}finally{p||f(!1)}};o();const l=async()=>{T&&(h(!0),await o(T,!0),h(!1))};ce.loadMore=l},[T]);const m=a.useMemo(()=>{const o=y.trim().toLowerCase();return c.filter(l=>{var D,C,L,I,_,Q;if(E!=="all"&&(l.status||"").toLowerCase()!==E)return!1;if(!o)return!0;const v=(l.email||"").toLowerCase(),p=((C=(D=l.profile)==null?void 0:D.firstName)==null?void 0:C.toLowerCase())||"",u=((I=(L=l.profile)==null?void 0:L.lastName)==null?void 0:I.toLowerCase())||"",s=((Q=(_=l.profile)==null?void 0:_.fullName)==null?void 0:Q.toLowerCase())||`${p} ${u}`.trim();return v.includes(o)||s.includes(o)})},[c,y,E]),n=async(o,l)=>{try{if(!(await fetch(`http://localhost:5000/api/admin/users/${o}/status`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({status:l})})).ok)throw new Error("Failed to update status");g(p=>p.map(u=>u._id===o?{...u,status:l}:u)),i("Doctor status updated","success")}catch(v){i(v.message||"Failed to update status","error")}},N=async o=>{var l;try{const v=await fetch(`http://localhost:5000/api/admin/users/${o}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!v.ok)throw new Error("Failed to resolve doctor profile");const p=await v.json(),u=(l=p==null?void 0:p.doctorDetails)==null?void 0:l._id;if(!u)throw new Error("Doctor profile not found");window.open(`/doctors/${u}`,"_blank")}catch(v){i(v.message||"Could not open doctor profile","error")}};return S?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"loader",children:"Loading..."})}):w?e.jsxs("div",{className:"text-red-500 text-center p-4",children:["Error: ",w]}):e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Manage Doctors"}),e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Search by name or email",className:"border rounded px-3 py-2 w-full max-w-md",value:y,onChange:o=>k(o.target.value)}),e.jsxs("select",{className:"border rounded px-3 py-2",value:E,onChange:o=>A(o.target.value),children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"suspended",children:"Suspended"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:e.jsxs("table",{className:"min-w-full leading-normal",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Verification"}),e.jsx("th",{className:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Account Status"}),e.jsx("th",{className:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:m.length>0?m.map(o=>{var l,v,p;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-5 py-5 border-b border-gray-200 bg-white text-sm",children:e.jsx("p",{className:"text-gray-900 whitespace-no-wrap",children:((l=o.profile)==null?void 0:l.fullName)||`${((v=o.profile)==null?void 0:v.firstName)||""} ${((p=o.profile)==null?void 0:p.lastName)||""}`.trim()})}),e.jsx("td",{className:"px-5 py-5 border-b border-gray-200 bg-white text-sm",children:e.jsx("p",{className:"text-gray-900 whitespace-no-wrap",children:o.email})}),e.jsx("td",{className:"px-5 py-5 border-b border-gray-200 bg-white text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${/^(approved|verified)$/i.test(o.verificationStatus||"")?"bg-green-100 text-green-800":/^(rejected)$/i.test(o.verificationStatus||"")?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:(o.verificationStatus||"pending").toString().replace(/\b\w/g,u=>u.toUpperCase())})}),e.jsx("td",{className:"px-5 py-5 border-b border-gray-200 bg-white text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${/^(active)$/i.test(o.status||"")?"bg-green-100 text-green-800":"bg-gray-100 text-gray-700"}`,children:o.status||"unknown"})}),e.jsx("td",{className:"px-5 py-5 border-b border-gray-200 bg-white text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-blue-500 hover:text-blue-700",title:"View Profile",onClick:()=>N(o._id),children:e.jsx(Ce,{size:18})}),/^active$/i.test(o.status||"")?e.jsx("button",{className:"text-red-600 hover:text-red-800 text-sm border px-2 py-1 rounded",onClick:()=>n(o._id,"suspended"),children:"Suspend"}):e.jsx("button",{className:"text-green-600 hover:text-green-800 text-sm border px-2 py-1 rounded",onClick:()=>n(o._id,"active"),children:"Activate"})]})})]},o._id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-10 text-gray-500",children:"No doctors found."})})})]})}),T&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("button",{className:"border px-4 py-2 rounded disabled:opacity-50",onClick:()=>{var o;return(o=ce.loadMore)==null?void 0:o.call(ce)},disabled:x,children:x?"Loading…":"Load More"})})]})};function Ss(){pe();const{addNotification:i}=ie(),[c,g]=a.useState([]),[S,f]=a.useState(!0),[w,b]=a.useState("all"),[y,k]=a.useState(""),[E,A]=a.useState("");a.useEffect(()=>{T()},[]);const T=async()=>{try{f(!0);const n=await P.get("/appointments");let N=[];n.data&&(Array.isArray(n.data)?N=n.data:(n.data.success&&Array.isArray(n.data.data)||n.data.data&&Array.isArray(n.data.data))&&(N=n.data.data)),console.log("Fetched appointments:",N),g(N)}catch(n){console.error("Error fetching appointments:",n),i("Failed to load appointments","error"),g([])}finally{f(!1)}},R=async(n,N)=>{try{await P.put(`/appointments/${n}`,{status:N}),i(`Appointment ${N} successfully`,"success"),T()}catch{i("Failed to update appointment status","error")}},x=Array.isArray(c)?c.filter(n=>{var v,p,u,s,D,C,L,I,_,Q,$,O,G,M;const N=!y||((u=(p=(v=n.patient)==null?void 0:v.profile)==null?void 0:p.firstName)==null?void 0:u.toLowerCase().includes(y.toLowerCase()))||((C=(D=(s=n.patient)==null?void 0:s.profile)==null?void 0:D.lastName)==null?void 0:C.toLowerCase().includes(y.toLowerCase()))||((Q=(_=(I=(L=n.doctor)==null?void 0:L.user)==null?void 0:I.profile)==null?void 0:_.firstName)==null?void 0:Q.toLowerCase().includes(y.toLowerCase()))||((M=(G=(O=($=n.doctor)==null?void 0:$.user)==null?void 0:O.profile)==null?void 0:G.lastName)==null?void 0:M.toLowerCase().includes(y.toLowerCase())),o=w==="all"||n.status===w,l=!E||new Date(n.date).toDateString()===new Date(E).toDateString();return N&&o&&l}):[],h=n=>new Date(n).toLocaleString(),m=n=>{switch(n){case"scheduled":return"#2563eb";case"completed":return"#10b981";case"cancelled":return"#dc2626";case"no-show":return"#f59e0b";default:return"#6b7280"}};return S?e.jsxs("div",{className:"admin-page",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading appointments..."})]}):e.jsxs("div",{className:"admin-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Appointment Management"}),e.jsx("p",{children:"Monitor and manage all appointments"})]}),e.jsxs("div",{className:"filters-section",children:[e.jsx("div",{className:"search-bar",children:e.jsx("input",{type:"text",placeholder:"Search by patient or doctor name...",value:y,onChange:n=>k(n.target.value)})}),e.jsxs("div",{className:"filter-controls",children:[e.jsxs("select",{value:w,onChange:n=>b(n.target.value),children:[e.jsx("option",{value:"all",children:"All Appointments"}),e.jsx("option",{value:"scheduled",children:"Scheduled"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"no-show",children:"No Show"})]}),e.jsx("input",{type:"date",value:E,onChange:n=>A(n.target.value),placeholder:"Filter by date"})]})]}),e.jsxs("div",{className:"stats-overview",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:c.filter(n=>n.status==="scheduled").length}),e.jsx("p",{children:"Scheduled"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:c.filter(n=>n.status==="completed").length}),e.jsx("p",{children:"Completed"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:c.filter(n=>n.status==="cancelled").length}),e.jsx("p",{children:"Cancelled"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:c.length}),e.jsx("p",{children:"Total"})]})]}),e.jsxs("div",{className:"appointments-table",children:[e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Patient"}),e.jsx("th",{children:"Doctor"}),e.jsx("th",{children:"Date & Time"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Reason"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:x.map(n=>{var N,o,l,v,p,u,s,D,C,L,I,_;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"patient-info",children:[e.jsxs("div",{className:"patient-name",children:[(o=(N=n.patient)==null?void 0:N.profile)==null?void 0:o.firstName," ",(v=(l=n.patient)==null?void 0:l.profile)==null?void 0:v.lastName]}),e.jsx("div",{className:"patient-email",children:(p=n.patient)==null?void 0:p.email})]})}),e.jsx("td",{children:e.jsxs("div",{className:"doctor-info",children:[e.jsxs("div",{className:"doctor-name",children:[(D=(s=(u=n.doctor)==null?void 0:u.user)==null?void 0:s.profile)==null?void 0:D.firstName," ",(I=(L=(C=n.doctor)==null?void 0:C.user)==null?void 0:L.profile)==null?void 0:I.lastName]}),e.jsx("div",{className:"doctor-specialty",children:(_=n.doctor)==null?void 0:_.specialization})]})}),e.jsx("td",{children:e.jsxs("div",{className:"datetime-info",children:[e.jsx("div",{className:"date",children:h(n.date)}),e.jsxs("div",{className:"duration",children:[n.duration||30," min"]})]})}),e.jsx("td",{children:n.type||"Consultation"}),e.jsx("td",{children:e.jsx("span",{className:"status-badge",style:{backgroundColor:m(n.status)},children:n.status})}),e.jsx("td",{children:e.jsx("div",{className:"reason",title:n.reason,children:n.reason?n.reason.length>30?n.reason.substring(0,30)+"...":n.reason:"No reason provided"})}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[n.status==="scheduled"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-success",onClick:()=>R(n._id,"completed"),children:"Complete"}),e.jsx("button",{className:"btn btn-danger",onClick:()=>R(n._id,"cancelled"),children:"Cancel"})]}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>{console.log("View appointment details:",n._id)},children:"Details"}),e.jsx(le,{to:`/admin/appointments/${n._id}/lifecycle`,className:"btn btn-info",children:"Lifecycle"})]})})]},n._id)})})]}),x.length===0&&e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"No appointments found matching your criteria."})})]}),e.jsxs("div",{className:"appointment-insights",children:[e.jsx("h2",{children:"Appointment Insights"}),e.jsxs("div",{className:"insights-grid",children:[e.jsxs("div",{className:"insight-card",children:[e.jsx("h3",{children:"Most Popular Time"}),e.jsx("p",{children:"2:00 PM - 4:00 PM"})]}),e.jsxs("div",{className:"insight-card",children:[e.jsx("h3",{children:"Average Duration"}),e.jsx("p",{children:"32 minutes"})]}),e.jsxs("div",{className:"insight-card",children:[e.jsx("h3",{children:"Completion Rate"}),e.jsxs("p",{children:[c.length>0?Math.round(c.filter(n=>n.status==="completed").length/c.length*100):0,"%"]})]}),e.jsxs("div",{className:"insight-card",children:[e.jsx("h3",{children:"No-Show Rate"}),e.jsxs("p",{children:[c.length>0?Math.round(c.filter(n=>n.status==="no-show").length/c.length*100):0,"%"]})]})]})]})]})}function Cs(){pe();const{addNotification:i}=ie(),[c,g]=a.useState({overview:{totalUsers:0,totalDoctors:0,totalPatients:0,totalAppointments:0,completedAppointments:0,revenue:0},growth:{newUsers:0,newAppointments:0,userGrowthRate:0,appointmentGrowthRate:0},usage:{averageAppointmentsPerDoctor:0,averageAppointmentsPerPatient:0,completionRate:0,popularSpecialties:[]},performance:{dailyData:{},topDoctors:[],recentActivity:[]}}),[S,f]=a.useState(!0),[w,b]=a.useState(null),[y,k]=a.useState("30");a.useEffect(()=>{E()},[y]);const E=async()=>{var x,h;try{f(!0);const[m,n,N,o,l]=await Promise.all([P.get("/admin/users"),P.get("/doctors"),P.get("/appointments"),P.get("/admin/stats"),P.get("/admin/metrics")]),v=Array.isArray((x=m.data)==null?void 0:x.users)?m.data.users:[],p=Array.isArray(n.data)?n.data:[],u=Array.isArray(N.data)?N.data:[],s=o.data||{},D=s.totalUsers||v.length,C=s.doctorCount||p.length,L=s.patientCount||v.filter(B=>B.role==="patient").length,I=s.appointmentCount||u.length,_=s.completedCount||u.filter(B=>B.status==="completed").length,Q=s.scheduledCount||u.filter(B=>B.status==="scheduled").length,$=s.cancelledCount||u.filter(B=>B.status==="cancelled").length,O=_*50,G=new Date;G.setDate(G.getDate()-parseInt(y));const M=v.filter(B=>new Date(B.createdAt)>=G),Z=u.filter(B=>new Date(B.createdAt)>=G),Y={};for(let B=parseInt(y);B>=0;B--){const J=new Date;J.setDate(J.getDate()-B);const se=J.toISOString().split("T")[0];Y[se]={newUsers:0,appointments:0,revenue:0}}M.forEach(B=>{const J=new Date(B.createdAt).toISOString().split("T")[0];Y[J]&&Y[J].newUsers++}),Z.forEach(B=>{const J=new Date(B.createdAt).toISOString().split("T")[0];Y[J]&&(Y[J].appointments++,B.status==="completed"&&(Y[J].revenue+=50))}),g({overview:{totalUsers:D,totalDoctors:C,totalPatients:L,totalAppointments:I,completedAppointments:_,revenue:O},growth:{newUsers:M.length,newAppointments:Z.length,userGrowthRate:D>0?Math.round(M.length/D*100):0,appointmentGrowthRate:I>0?Math.round(Z.length/I*100):0},usage:{averageAppointmentsPerDoctor:C>0?Math.round(I/C):0,averageAppointmentsPerPatient:L>0?Math.round(I/L):0,completionRate:I>0?Math.round(_/I*100):0,popularSpecialties:A(p,u)},performance:{dailyData:Y,topDoctors:T(p,u),recentActivity:R(v,u)}}),b(((h=l==null?void 0:l.data)==null?void 0:h.data)||{})}catch(m){console.error("Error fetching analytics:",m),i("Failed to load analytics data","error")}finally{f(!1)}},A=(x,h)=>{try{const m={},n=Array.isArray(x)?x:[],N=Array.isArray(h)?h:[];return n.forEach(o=>{const l=o.specialty||o.specialization||"General";m[l]=(m[l]||0)+1}),N.forEach(o=>{var v,p;const l=((v=o.doctor)==null?void 0:v.specialty)||((p=o.doctor)==null?void 0:p.specialization)||"General";l!=="General"&&(m[l]=(m[l]||0)+1)}),Object.entries(m).sort(([,o],[,l])=>l-o).slice(0,5).map(([o,l])=>({specialty:o,count:l}))}catch(m){return console.error("Error calculating popular specialties:",m),[]}},T=(x,h)=>{try{const m=Array.isArray(x)?x:[],n=Array.isArray(h)?h:[],N={};return m.forEach(o=>{N[o.id||o._id]={doctor:o,appointmentCount:0,completedCount:0}}),n.forEach(o=>{var v,p;const l=o.doctorId||((v=o.doctor)==null?void 0:v.id)||((p=o.doctor)==null?void 0:p._id);l&&N[l]&&(N[l].appointmentCount++,o.status==="completed"&&N[l].completedCount++)}),Object.values(N).sort((o,l)=>l.appointmentCount-o.appointmentCount).slice(0,5)}catch(m){return console.error("Error getting top doctors:",m),[]}},R=(x,h)=>{try{const m=[],n=Array.isArray(x)?x:[],N=Array.isArray(h)?h:[];return n.slice(-5).forEach(o=>{var l,v;m.push({type:"user_registered",message:`New ${o.role||"user"} registered: ${((l=o.profile)==null?void 0:l.firstName)||o.firstName||"Unknown"} ${((v=o.profile)==null?void 0:v.lastName)||o.lastName||"User"}`,timestamp:o.createdAt||new Date().toISOString()})}),N.slice(-5).forEach(o=>{var u,s,D,C,L,I;const l=((s=(u=o.doctor)==null?void 0:u.profile)==null?void 0:s.firstName)||((D=o.doctor)==null?void 0:D.firstName),v=((L=(C=o.doctor)==null?void 0:C.profile)==null?void 0:L.lastName)||((I=o.doctor)==null?void 0:I.lastName),p=l&&v?`Dr. ${l} ${v}`:"Unknown Doctor";m.push({type:"appointment_created",message:`New appointment scheduled with ${p}`,timestamp:o.createdAt||new Date().toISOString()})}),m.sort((o,l)=>new Date(l.timestamp)-new Date(o.timestamp)).slice(0,10)}catch(m){return console.error("Error getting recent activity:",m),[]}};return S?e.jsxs("div",{className:"admin-page",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading analytics..."})]}):e.jsxs("div",{className:"admin-page",children:[w&&e.jsxs("div",{className:"analytics-section",children:[e.jsx("h2",{children:"Platform Metrics Snapshot"}),e.jsx("div",{className:"analytics-overview",children:Object.entries(w).slice(0,12).map(([x,h])=>e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"📈"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:String(h)}),e.jsx("p",{children:x})]})]},x))})]}),e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Platform Analytics"}),e.jsxs("div",{className:"time-filter",children:[e.jsx("label",{children:"Time Range:"}),e.jsxs("select",{value:y,onChange:x=>k(x.target.value),children:[e.jsx("option",{value:"7",children:"Last 7 days"}),e.jsx("option",{value:"30",children:"Last 30 days"}),e.jsx("option",{value:"90",children:"Last 3 months"}),e.jsx("option",{value:"365",children:"Last year"})]})]})]}),e.jsxs("div",{className:"analytics-overview",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"👥"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:c.overview.totalUsers}),e.jsx("p",{children:"Total Users"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"👨‍⚕️"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:c.overview.totalDoctors}),e.jsx("p",{children:"Doctors"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"🤒"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:c.overview.totalPatients}),e.jsx("p",{children:"Patients"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"📅"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:c.overview.totalAppointments}),e.jsx("p",{children:"Appointments"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"✅"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:c.overview.completedAppointments}),e.jsx("p",{children:"Completed"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"💰"}),e.jsxs("div",{className:"stat-content",children:[e.jsxs("h3",{children:["$",c.overview.revenue]}),e.jsx("p",{children:"Revenue"})]})]})]}),e.jsxs("div",{className:"analytics-section",children:[e.jsx("h2",{children:"Growth Metrics"}),e.jsxs("div",{className:"growth-grid",children:[e.jsxs("div",{className:"growth-card",children:[e.jsx("h3",{children:"New Users"}),e.jsx("div",{className:"growth-number",children:c.growth.newUsers}),e.jsxs("div",{className:"growth-rate",children:["+",c.growth.userGrowthRate,"% of total"]})]}),e.jsxs("div",{className:"growth-card",children:[e.jsx("h3",{children:"New Appointments"}),e.jsx("div",{className:"growth-number",children:c.growth.newAppointments}),e.jsxs("div",{className:"growth-rate",children:["+",c.growth.appointmentGrowthRate,"% of total"]})]})]})]}),e.jsxs("div",{className:"analytics-section",children:[e.jsx("h2",{children:"Usage Statistics"}),e.jsxs("div",{className:"usage-grid",children:[e.jsxs("div",{className:"usage-card",children:[e.jsx("h3",{children:"Avg Appointments/Doctor"}),e.jsx("div",{className:"usage-number",children:c.usage.averageAppointmentsPerDoctor})]}),e.jsxs("div",{className:"usage-card",children:[e.jsx("h3",{children:"Avg Appointments/Patient"}),e.jsx("div",{className:"usage-number",children:c.usage.averageAppointmentsPerPatient})]}),e.jsxs("div",{className:"usage-card",children:[e.jsx("h3",{children:"Completion Rate"}),e.jsxs("div",{className:"usage-number",children:[c.usage.completionRate,"%"]})]})]})]}),e.jsxs("div",{className:"analytics-section",children:[e.jsx("h2",{children:"Popular Specialties"}),e.jsxs("div",{className:"specialties-list",children:[(c.usage.popularSpecialties||[]).map((x,h)=>{var n,N;const m=((N=(n=c.usage.popularSpecialties)==null?void 0:n[0])==null?void 0:N.count)||1;return e.jsxs("div",{className:"specialty-item",children:[e.jsx("span",{className:"specialty-name",children:x.specialty}),e.jsxs("span",{className:"specialty-count",children:[x.count," appointments"]}),e.jsx("div",{className:"specialty-bar",children:e.jsx("div",{className:"specialty-fill",style:{width:`${Math.min(x.count/m*100,100)}%`}})})]},h)}),(!c.usage.popularSpecialties||c.usage.popularSpecialties.length===0)&&e.jsx("div",{className:"no-data",children:"No specialty data available"})]})]}),e.jsxs("div",{className:"analytics-section",children:[e.jsx("h2",{children:"Top Performing Doctors"}),e.jsxs("div",{className:"top-doctors",children:[(c.performance.topDoctors||[]).map((x,h)=>{var m,n,N,o,l,v,p,u;return e.jsxs("div",{className:"doctor-stat",children:[e.jsxs("div",{className:"doctor-rank",children:["#",h+1]}),e.jsxs("div",{className:"doctor-info",children:[e.jsxs("div",{className:"doctor-name",children:[((n=(m=x.doctor)==null?void 0:m.profile)==null?void 0:n.firstName)||((N=x.doctor)==null?void 0:N.firstName)||"Dr."," ",((l=(o=x.doctor)==null?void 0:o.profile)==null?void 0:l.lastName)||((v=x.doctor)==null?void 0:v.lastName)||"Unknown"]}),e.jsx("div",{className:"doctor-specialty",children:((p=x.doctor)==null?void 0:p.specialty)||((u=x.doctor)==null?void 0:u.specialization)||"General"})]}),e.jsxs("div",{className:"doctor-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-value",children:x.appointmentCount||0}),e.jsx("span",{className:"metric-label",children:"Appointments"})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-value",children:x.completedCount||0}),e.jsx("span",{className:"metric-label",children:"Completed"})]})]})]},h)}),(!c.performance.topDoctors||c.performance.topDoctors.length===0)&&e.jsx("div",{className:"no-data",children:"No doctor performance data available"})]})]}),e.jsxs("div",{className:"analytics-section",children:[e.jsx("h2",{children:"Recent Activity"}),e.jsxs("div",{className:"activity-feed",children:[(c.performance.recentActivity||[]).map((x,h)=>e.jsxs("div",{className:"activity-item",children:[e.jsx("div",{className:"activity-icon",children:x.type==="user_registered"?"👤":"📅"}),e.jsxs("div",{className:"activity-content",children:[e.jsx("div",{className:"activity-message",children:x.message}),e.jsx("div",{className:"activity-time",children:new Date(x.timestamp).toLocaleString()})]})]},h)),(!c.performance.recentActivity||c.performance.recentActivity.length===0)&&e.jsx("div",{className:"no-data",children:"No recent activity"})]})]})]})}function ks(){const[i,c]=a.useState({}),[g,S]=a.useState(!0),[f,w]=a.useState(null);return a.useEffect(()=>{let b=!0;async function y(){var E,A;try{S(!0);const T=await P.get("/admin/metrics");if(!b)return;c(T.data||T)}catch(T){if(!b)return;w(((A=(E=T==null?void 0:T.response)==null?void 0:E.data)==null?void 0:A.message)||T.message)}finally{b&&S(!1)}}y();const k=setInterval(y,1e4);return()=>{b=!1,clearInterval(k)}},[]),e.jsxs("div",{className:"admin-page",children:[e.jsx("div",{className:"page-header",children:e.jsx("h1",{children:"Admin Metrics"})}),g&&e.jsx("p",{children:"Loading…"}),f&&e.jsx("p",{style:{color:"crimson"},children:String(f)}),e.jsx("div",{className:"analytics-overview",children:Object.entries((i==null?void 0:i.counters)||{}).map(([b,y])=>e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"📈"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:y}),e.jsx("p",{children:b})]})]},b))})]})}function Ps(){const[i,c]=a.useState([]),[g,S]=a.useState([]),[f,w]=a.useState(null),[b,y]=a.useState([]),[k,E]=a.useState(1),[A,T]=a.useState(10),[R,x]=a.useState(0),[h,m]=a.useState({code:"",name:"",description:"",defaultPrice:0,currency:"USD",active:!0}),[n,N]=a.useState({region:"ET",payerType:"SelfPay",effectiveFrom:"",items:[]}),[o,l]=a.useState({name:"",price:0,interval:"month",currency:"USD",description:""}),[v,p]=a.useState(!1),[u,s]=a.useState(""),[D,C]=a.useState("success"),[L,I]=a.useState(""),[_,Q]=a.useState(""),$=i.filter(t=>{const d=L.trim().toLowerCase();return d?(t.code||"").toLowerCase().includes(d)||(t.name||"").toLowerCase().includes(d):!0}),O=g.filter(t=>{const d=_.trim().toLowerCase();return d?(t.region||"").toLowerCase().includes(d)||(t.payerType||"").toLowerCase().includes(d):!0}),[G,M]=a.useState(null),[Z,Y]=a.useState({region:"",payerType:"",effectiveFrom:""}),[B,J]=a.useState(null),[se,r]=a.useState({name:"",description:"",defaultPrice:0,currency:"USD",active:!0}),[V,z]=a.useState(null),[F,q]=a.useState({name:"",price:0,interval:"month",currency:"USD",description:"",active:!0}),[H,X]=a.useState(null),[ee,W]=a.useState([]),[re,ge]=a.useState(""),K=async()=>{var t,d,j,U,ne;try{p(!0);const[te,ae,de]=await Promise.all([P.get("/pricing/admin/services"),P.get("/pricing/admin/pricebooks",{params:{page:k,pageSize:A}}),P.get("/pricing/admin/plans")]);c(((t=te==null?void 0:te.data)==null?void 0:t.items)||[]),S(((d=ae==null?void 0:ae.data)==null?void 0:d.items)||[]),ae!=null&&ae.data&&(x(ae.data.total||0),E(ae.data.page||1),T(ae.data.pageSize||A)),y(((j=de==null?void 0:de.data)==null?void 0:j.items)||[])}catch(te){C("error"),s(((ne=(U=te==null?void 0:te.response)==null?void 0:U.data)==null?void 0:ne.error)||"Failed to load"),setTimeout(()=>s(""),3e3)}finally{p(!1)}};a.useEffect(()=>{K()},[k,A]);const De=async()=>{var t,d;try{p(!0);const j=await P.get("/pricing/price-books",{params:{limit:20,cursor:f||void 0}}),U=((t=j==null?void 0:j.data)==null?void 0:t.items)||[];S(ne=>[...ne,...U]),w(((d=j==null?void 0:j.data)==null?void 0:d.nextCursor)||null)}catch{}finally{p(!1)}},Le=async()=>{var t,d;try{p(!0),await P.post("/pricing/admin/services",h),m({code:"",name:"",description:"",defaultPrice:0,currency:"USD",active:!0}),await K(),s("Service created"),setTimeout(()=>s(""),2e3)}catch(j){s(((d=(t=j==null?void 0:j.response)==null?void 0:t.data)==null?void 0:d.error)||"Failed to create service"),setTimeout(()=>s(""),3e3)}finally{p(!1)}},Ee=async(t,d)=>{try{p(!0),await P.patch(`/pricing/admin/services/${t}`,{active:!d}),await K()}catch{}},Te=async t=>{try{if(!window.confirm("Delete this service? This cannot be undone."))return;p(!0),await P.delete(`/pricing/admin/services/${t}`),await K()}catch{}},Re=t=>{J(t._id),r({name:t.name||"",description:t.description||"",defaultPrice:t.defaultPrice??0,currency:t.currency||"USD",active:!!t.active})},$e=()=>J(null),Fe=async t=>{var d,j;try{p(!0),await P.patch(`/pricing/admin/services/${t}`,se),await K(),J(null),s("Service updated"),setTimeout(()=>s(""),2e3)}catch(U){s(((j=(d=U==null?void 0:U.response)==null?void 0:d.data)==null?void 0:j.error)||"Failed to update service"),setTimeout(()=>s(""),3e3)}finally{p(!1)}},Ie=async()=>{var t,d;try{p(!0),await P.post("/pricing/admin/pricebooks",n),N({region:"ET",payerType:"SelfPay",effectiveFrom:"",items:[]}),await K(),s("Pricebook created"),setTimeout(()=>s(""),2e3)}catch(j){s(((d=(t=j==null?void 0:j.response)==null?void 0:t.data)==null?void 0:d.error)||"Failed to create pricebook"),setTimeout(()=>s(""),3e3)}finally{p(!1)}},Ue=async t=>{try{if(!window.confirm("Delete this pricebook? This cannot be undone."))return;p(!0),await P.delete(`/pricing/admin/pricebooks/${t}`),await K()}catch{}},Me=async(t,d)=>{try{p(!0),await P.patch(`/pricing/admin/pricebooks/${t}`,{active:!d}),await K()}catch{}},_e=async()=>{var t,d;try{p(!0),await P.post("/pricing/admin/plans",o),l({name:"",price:0,interval:"month",currency:"USD",description:""}),await K(),s("Plan created"),setTimeout(()=>s(""),2e3)}catch(j){s(((d=(t=j==null?void 0:j.response)==null?void 0:t.data)==null?void 0:d.error)||"Failed to create plan"),setTimeout(()=>s(""),3e3)}finally{p(!1)}},ze=async(t,d)=>{try{p(!0),await P.patch(`/pricing/admin/plans/${t}`,{active:!d}),await K()}catch{}},Be=async t=>{try{if(!window.confirm("Delete this plan? This cannot be undone."))return;p(!0),await P.delete(`/pricing/admin/plans/${t}`),await K()}catch{}},Ve=t=>{M(t._id);const d=t.effectiveFrom?new Date(t.effectiveFrom):null,j=d?`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`:"";Y({region:t.region||"",payerType:t.payerType||"",effectiveFrom:j})},qe=()=>M(null),Oe=async t=>{var d,j;if(!Z.region||!Z.payerType){C("error"),s("region and payerType are required"),setTimeout(()=>s(""),3e3);return}try{p(!0);const U={region:Z.region,payerType:Z.payerType};Z.effectiveFrom&&(U.effectiveFrom=Z.effectiveFrom),await P.patch(`/pricing/admin/pricebooks/${t}`,U),await K(),M(null),C("success"),s("PriceBook updated"),setTimeout(()=>s(""),2e3)}catch(U){C("error"),s(((j=(d=U==null?void 0:U.response)==null?void 0:d.data)==null?void 0:j.error)||"Failed to update pricebook"),setTimeout(()=>s(""),3e3)}finally{p(!1)}},Ge=t=>{z(t._id),q({name:t.name||"",price:t.price??0,interval:t.interval||"month",currency:t.currency||"USD",description:t.description||"",active:!!t.active})},Ze=()=>z(null),He=async t=>{var d,j;try{p(!0),await P.patch(`/pricing/admin/plans/${t}`,F),await K(),z(null),s("Plan updated"),setTimeout(()=>s(""),2e3)}catch(U){s(((j=(d=U==null?void 0:U.response)==null?void 0:d.data)==null?void 0:j.error)||"Failed to update plan"),setTimeout(()=>s(""),3e3)}finally{p(!1)}},Ye=t=>{X(t),W((t.items||[]).map(d=>({...d})))},Je=()=>{X(null),W([])},Ke=()=>{const t=i[0];t&&W(d=>[...d,{serviceId:t._id,unitPrice:t.defaultPrice||0,taxRate:0,discount:{}}])},Qe=t=>{W(d=>d.filter((j,U)=>U!==t))},oe=(t,d,j)=>{W(U=>U.map((ne,te)=>te===t?{...ne,[d]:j}:ne))},We=async()=>{var t,d;if(H)try{p(!0);const j=ee.map(U=>({serviceId:U.serviceId,unitPrice:Number(U.unitPrice)||0,taxRate:Number(U.taxRate)||0,discount:U.discount||{}}));await P.patch(`/pricing/admin/pricebooks/${H._id}`,{items:j}),await K(),s("PriceBook items saved"),setTimeout(()=>s(""),2e3)}catch(j){s(((d=(t=j==null?void 0:j.response)==null?void 0:t.data)==null?void 0:d.error)||"Failed to save items"),setTimeout(()=>s(""),3e3)}finally{p(!1)}};return e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Admin Pricing Management"}),u&&e.jsx("div",{className:`save-message ${D==="error"?"error":"success"}`,children:u}),e.jsx("h3",{children:"Services"}),e.jsx("div",{className:"form-group",children:e.jsx("input",{placeholder:"Search services by code or name...",value:L,onChange:t=>I(t.target.value)})}),e.jsx("ul",{children:$.map(t=>e.jsx("li",{children:e.jsxs("div",{children:[e.jsx("strong",{children:t.code})," ",B===t._id?e.jsxs(e.Fragment,{children:[e.jsx("input",{style:{width:160,marginLeft:8},value:se.name,onChange:d=>r(j=>({...j,name:d.target.value}))}),e.jsx("input",{style:{width:100,marginLeft:8},type:"number",value:se.defaultPrice,onChange:d=>r(j=>({...j,defaultPrice:Number(d.target.value)}))}),e.jsx("input",{style:{width:80,marginLeft:8},value:se.currency,onChange:d=>r(j=>({...j,currency:d.target.value}))}),e.jsx("input",{style:{width:220,marginLeft:8},placeholder:"Description",value:se.description,onChange:d=>r(j=>({...j,description:d.target.value}))}),e.jsx("button",{style:{marginLeft:8},className:"save-button",onClick:()=>Fe(t._id),disabled:v,children:"Save"}),e.jsx("button",{style:{marginLeft:8},onClick:$e,children:"Cancel"})]}):e.jsxs(e.Fragment,{children:["— ",t.name," • ",t.currency," ",t.defaultPrice," •"," ",t.active?"Active":"Inactive",e.jsx("button",{style:{marginLeft:8},onClick:()=>Ee(t._id,t.active),children:t.active?"Deactivate":"Activate"}),e.jsx("button",{style:{marginLeft:8},onClick:()=>Re(t),children:"Edit"}),e.jsx("button",{style:{marginLeft:8},className:"danger-button",onClick:()=>Te(t._id),children:"Delete"})]})]})},t._id))}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Code"}),e.jsx("input",{value:h.code,onChange:t=>m(d=>({...d,code:t.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Name"}),e.jsx("input",{value:h.name,onChange:t=>m(d=>({...d,name:t.target.value}))})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Description"}),e.jsx("input",{value:h.description,onChange:t=>m(d=>({...d,description:t.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Price"}),e.jsx("input",{type:"number",value:h.defaultPrice,onChange:t=>m(d=>({...d,defaultPrice:Number(t.target.value)}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Currency"}),e.jsx("input",{value:h.currency,onChange:t=>m(d=>({...d,currency:t.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Active"}),e.jsx("input",{type:"checkbox",checked:!!h.active,onChange:t=>m(d=>({...d,active:t.target.checked}))})]}),e.jsx("div",{className:"form-group",style:{alignSelf:"end"},children:e.jsx("button",{className:"save-button",onClick:Le,disabled:v||!h.code||!h.name,children:"Create Service"})})]}),e.jsx("h3",{style:{marginTop:24},children:"PriceBooks"}),e.jsx("div",{className:"form-group",children:e.jsx("input",{placeholder:"Search pricebooks by region or payer type...",value:_,onChange:t=>Q(t.target.value)})}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("span",{children:"Page"}),e.jsx("button",{disabled:k<=1,onClick:()=>E(t=>Math.max(1,t-1)),children:"<"}),e.jsx("span",{children:k}),e.jsx("button",{disabled:k*A>=R,onClick:()=>E(t=>t+1),children:">"}),e.jsx("span",{style:{marginLeft:8},children:"Page Size"}),e.jsxs("select",{value:A,onChange:t=>{T(Number(t.target.value)),E(1)},children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"})]}),e.jsxs("span",{style:{marginLeft:8},children:["Total: ",R]})]}),e.jsx("p",{style:{fontSize:12,color:"#555"},children:"Tip: Use the button below to append more results using the new cursor-based endpoint."}),e.jsx("ul",{children:O.map(t=>{var d;return e.jsx("li",{children:G===t._id?e.jsxs(e.Fragment,{children:[e.jsx("input",{style:{width:90},value:Z.region,onChange:j=>Y(U=>({...U,region:j.target.value}))}),"/",e.jsx("input",{style:{width:120},value:Z.payerType,onChange:j=>Y(U=>({...U,payerType:j.target.value}))}),e.jsx("span",{children:" • effective: "}),e.jsx("input",{type:"date",value:Z.effectiveFrom,onChange:j=>Y(U=>({...U,effectiveFrom:j.target.value}))}),e.jsx("button",{style:{marginLeft:8},className:"save-button",onClick:()=>Oe(t._id),disabled:v,children:"Save"}),e.jsx("button",{style:{marginLeft:8},onClick:qe,children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[t.region,"/",t.payerType," • items: ",((d=t.items)==null?void 0:d.length)||0," • effective:"," ",t.effectiveFrom?new Date(t.effectiveFrom).toLocaleDateString():"-"," ","• ",t.active?"Active":"Inactive",e.jsx("button",{style:{marginLeft:8},onClick:()=>Me(t._id,t.active),children:t.active?"Deactivate":"Activate"}),e.jsx("button",{style:{marginLeft:8},onClick:()=>Ve(t),children:"Edit"}),e.jsx("button",{style:{marginLeft:8},onClick:()=>Ye(t),children:"Manage Items"}),e.jsx("a",{style:{marginLeft:8},className:"save-button",href:`${P.defaults&&P.defaults.baseURL?P.defaults.baseURL:""}/pricing/admin/pricebooks/${t._id}/export`,target:"_blank",rel:"noreferrer",children:"Export CSV"}),e.jsx("button",{style:{marginLeft:8},className:"danger-button",onClick:()=>Ue(t._id),children:"Delete"})]})},t._id)})}),e.jsx("div",{style:{marginTop:8},children:e.jsx("button",{className:"save-button",onClick:De,disabled:v,children:v?"Loading...":"Load more (cursor)"})}),H&&e.jsxs("div",{style:{border:"1px solid #ddd",padding:12,borderRadius:6,marginTop:10},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs("strong",{children:["Editing PriceBook Items — ",H.region,"/",H.payerType]}),e.jsxs("div",{children:[e.jsx("button",{className:"save-button",onClick:We,disabled:v,children:"Save Items"}),e.jsx("button",{style:{marginLeft:8},onClick:Je,children:"Close"})]})]}),e.jsxs("div",{style:{marginTop:10},children:[(ee||[]).map((t,d)=>e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("select",{value:t.serviceId,onChange:j=>oe(d,"serviceId",j.target.value),children:i.map(j=>e.jsxs("option",{value:j._id,children:[j.code," — ",j.name]},j._id))}),e.jsx("input",{style:{width:100},type:"number",value:t.unitPrice,onChange:j=>oe(d,"unitPrice",Number(j.target.value))}),e.jsx("input",{style:{width:80},type:"number",value:t.taxRate,onChange:j=>oe(d,"taxRate",Number(j.target.value))}),e.jsx("button",{className:"danger-button",onClick:()=>Qe(d),children:"Remove"})]},d)),e.jsx("button",{onClick:Ke,children:"Add Item"})]}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("h4",{children:"CSV Import"}),e.jsx("p",{style:{margin:0},children:"Columns: serviceCode,unitPrice,taxRate"}),e.jsx("textarea",{rows:6,style:{width:"100%",fontFamily:"monospace"},placeholder:`serviceCode,unitPrice,taxRate
CONSULT_NEW,25,0
LAB_CBC,10,0`,value:re,onChange:t=>ge(t.target.value)}),e.jsx("button",{className:"save-button",disabled:v||!re.trim(),onClick:async()=>{var t,d;try{p(!0),await P.post(`/pricing/admin/pricebooks/${H._id}/import`,{csv:re}),ge(""),await K(),s("CSV imported"),C("success"),setTimeout(()=>s(""),2e3)}catch(j){C("error"),s(((d=(t=j==null?void 0:j.response)==null?void 0:t.data)==null?void 0:d.error)||"Import failed"),setTimeout(()=>s(""),3e3)}finally{p(!1)}},children:"Import CSV"})]})]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Region"}),e.jsx("input",{value:n.region,onChange:t=>N(d=>({...d,region:t.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Payer Type"}),e.jsx("input",{value:n.payerType,onChange:t=>N(d=>({...d,payerType:t.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Effective From"}),e.jsx("input",{type:"date",value:n.effectiveFrom,onChange:t=>N(d=>({...d,effectiveFrom:t.target.value}))})]}),e.jsx("div",{className:"form-group",style:{alignSelf:"end"},children:e.jsx("button",{className:"save-button",onClick:Ie,disabled:v||!n.region||!n.payerType,children:"Create Pricebook"})})]}),e.jsx("h3",{style:{marginTop:24},children:"Plans"}),e.jsx("ul",{children:b.map(t=>e.jsx("li",{children:V===t._id?e.jsxs(e.Fragment,{children:[e.jsx("input",{style:{width:160},value:F.name,onChange:d=>q(j=>({...j,name:d.target.value}))}),e.jsx("input",{style:{width:100,marginLeft:8},type:"number",value:F.price,onChange:d=>q(j=>({...j,price:Number(d.target.value)}))}),e.jsxs("select",{style:{marginLeft:8},value:F.interval,onChange:d=>q(j=>({...j,interval:d.target.value})),children:[e.jsx("option",{value:"month",children:"month"}),e.jsx("option",{value:"year",children:"year"}),e.jsx("option",{value:"quarter",children:"quarter"})]}),e.jsx("input",{style:{width:80,marginLeft:8},value:F.currency,onChange:d=>q(j=>({...j,currency:d.target.value}))}),e.jsx("input",{style:{width:220,marginLeft:8},placeholder:"Description",value:F.description,onChange:d=>q(j=>({...j,description:d.target.value}))}),e.jsx("button",{style:{marginLeft:8},className:"save-button",onClick:()=>He(t._id),disabled:v,children:"Save"}),e.jsx("button",{style:{marginLeft:8},onClick:Ze,children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[t.name," • ",t.currency," ",t.price,"/",t.interval," •"," ",t.active?"Active":"Inactive",e.jsx("button",{style:{marginLeft:8},onClick:()=>ze(t._id,t.active),children:t.active?"Deactivate":"Activate"}),e.jsx("button",{style:{marginLeft:8},onClick:()=>Ge(t),children:"Edit"}),e.jsx("button",{style:{marginLeft:8},className:"danger-button",onClick:()=>Be(t._id),children:"Delete"})]})},t._id))}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Name"}),e.jsx("input",{value:o.name,onChange:t=>l(d=>({...d,name:t.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Price"}),e.jsx("input",{type:"number",value:o.price,onChange:t=>l(d=>({...d,price:Number(t.target.value)}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Interval"}),e.jsxs("select",{value:o.interval,onChange:t=>l(d=>({...d,interval:t.target.value})),children:[e.jsx("option",{value:"month",children:"month"}),e.jsx("option",{value:"year",children:"year"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Currency"}),e.jsx("input",{value:o.currency,onChange:t=>l(d=>({...d,currency:t.target.value}))})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Description"}),e.jsx("input",{value:o.description,onChange:t=>l(d=>({...d,description:t.target.value}))})]}),e.jsx("div",{className:"form-group",style:{alignSelf:"end"},children:e.jsx("button",{className:"save-button",onClick:_e,disabled:v||!o.name,children:"Create Plan"})})]})]})}function As(){const[i,c]=ds(),[g,S]=a.useState("ET"),[f,w]=a.useState("paystack"),[b,y]=a.useState(""),[k,E]=a.useState([]),[A,T]=a.useState(""),[R,x]=a.useState(!1),h=a.useMemo(()=>i.get("tab")||"banks",[i]),[m,n]=a.useState(h),[N,o]=a.useState([]),[l,v]=a.useState(null),[p,u]=a.useState(!1),[s,D]=a.useState(""),[C,L]=a.useState(""),I=async()=>{var $,O,G;try{x(!0);const M=await P.get("/banks",{params:{country:g,search:b||void 0,channel:"bank_transfer"}});E((($=M==null?void 0:M.data)==null?void 0:$.items)||[])}catch(M){T(((G=(O=M==null?void 0:M.response)==null?void 0:O.data)==null?void 0:G.error)||"Failed to load banks"),setTimeout(()=>T(""),3e3)}finally{x(!1)}},_=async()=>{var $,O;try{x(!0),await P.post(`/banks/sync/${f}`,null,{params:{country:g}}),await I(),T(`Synced ${f.toUpperCase()} for ${g}`),setTimeout(()=>T(""),2e3)}catch(G){T(((O=($=G==null?void 0:G.response)==null?void 0:$.data)==null?void 0:O.error)||"Sync failed"),setTimeout(()=>T(""),3e3)}finally{x(!1)}};a.useEffect(()=>{I()},[]),a.useEffect(()=>{n(h)},[h]),a.useEffect(()=>{m==="logs"&&N.length===0&&!p&&Q(!0);const $=new URLSearchParams(i);$.get("tab")!==m&&($.set("tab",m),c($,{replace:!1}))},[m]);const Q=async($=!1)=>{var O,G;try{u(!0);const M=await P.get("/banks/logs",{params:{provider:f,country:g,from:s||void 0,to:C||void 0,cursor:$?void 0:l||void 0,limit:20}}),Z=((O=M==null?void 0:M.data)==null?void 0:O.items)||[];o(Y=>$?Z:[...Y,...Z]),v(((G=M==null?void 0:M.data)==null?void 0:G.nextCursor)||null)}catch{}finally{u(!1)}};return e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Admin Bank Registry"}),A&&e.jsx("div",{className:`save-message ${A.includes("fail")||A.includes("Fail")?"error":"success"}`,children:A}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Country"}),e.jsx("input",{value:g,onChange:$=>S($.target.value.toUpperCase())})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Provider"}),e.jsxs("select",{value:f,onChange:$=>w($.target.value),children:[e.jsx("option",{value:"paystack",children:"Paystack"}),e.jsx("option",{value:"flutterwave",children:"Flutterwave"}),e.jsx("option",{value:"dpo",children:"DPO"}),e.jsx("option",{value:"cellulant",children:"Cellulant"}),e.jsx("option",{value:"chapa",children:"Chapa"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Tab"}),e.jsxs("select",{value:m,onChange:$=>n($.target.value),children:[e.jsx("option",{value:"banks",children:"Banks"}),e.jsx("option",{value:"logs",children:"Change Log"})]})]}),e.jsx("div",{className:"form-group",style:{alignSelf:"end"},children:e.jsx("button",{className:"save-button",onClick:_,disabled:R,children:R?"Syncing...":"Sync Provider"})}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Search"}),e.jsx("input",{value:b,onChange:$=>y($.target.value)})]}),e.jsx("div",{className:"form-group",style:{alignSelf:"end"},children:e.jsx("button",{className:"save-button",onClick:I,disabled:R,children:R?"Loading...":"Load Banks"})})]}),m==="banks"?e.jsxs(e.Fragment,{children:[e.jsx("h3",{style:{marginTop:16},children:"Banks"}),k.length===0?e.jsx("p",{children:"No banks found"}):e.jsx("ul",{children:k.map($=>e.jsxs("li",{children:[$.name," (",$.countryIso2,") • Status: ",$.status]},$._id))})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{style:{marginTop:16},children:"Change Log"}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"From"}),e.jsx("input",{type:"date",value:s,onChange:$=>D($.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"To"}),e.jsx("input",{type:"date",value:C,onChange:$=>L($.target.value)})]}),e.jsx("div",{className:"form-group",style:{alignSelf:"end"},children:e.jsx("button",{className:"save-button",disabled:p,onClick:()=>Q(!0),children:p?"Loading...":"Load Logs"})})]}),N.length===0?e.jsx("p",{children:"No logs"}):e.jsxs(e.Fragment,{children:[e.jsx("ul",{children:N.map($=>e.jsxs("li",{children:[$.provider," ",$.countryIso2||""," • added ",$.added," • updated ",$.updated," • finished"," ",$.finishedAt?new Date($.finishedAt).toLocaleString():"—"]},$._id))}),l&&e.jsx("button",{className:"save-button",disabled:p,onClick:()=>Q(!1),children:p?"Loading...":"Load More"})]})]})]})}const Ds=()=>{const[i,c]=a.useState("platform"),[g,S]=a.useState(!1),[f,w]=a.useState(""),[b,y]=a.useState({siteName:"TeleMed Platform",siteDescription:"Modern telemedicine platform for healthcare providers",allowRegistration:!0,requireEmailVerification:!0,enableVideoCalss:!0,maintenanceMode:!1,maxAppointmentsPerDay:50,appointmentDuration:30,timeZone:"America/New_York"}),[k,E]=a.useState({autoApprovePatients:!0,requireDoctorVerification:!0,sessionTimeout:60,passwordComplexity:"medium",maxLoginAttempts:5,lockoutDuration:30}),[A,T]=a.useState({emailEnabled:!0,smsEnabled:!1,pushEnabled:!0,adminNotifications:!0,systemAlerts:!0,appointmentReminders:!0,marketingEmails:!1}),[R,x]=a.useState({acceptPayments:!0,paymentProvider:"stripe",currency:"USD",consultationFee:75,platformFee:10,refundPolicy:"Within 24 hours",autoRefunds:!1}),[h,m]=a.useState({enableTwoFactor:!1,requireHttps:!0,enableAuditLogs:!0,dataRetentionDays:365,enableBackups:!0,backupFrequency:"daily",encryptSensitiveData:!0}),n=(s,D)=>{y(C=>({...C,[s]:D}))},N=(s,D)=>{E(C=>({...C,[s]:D}))},o=(s,D)=>{T(C=>({...C,[s]:D}))},l=(s,D)=>{x(C=>({...C,[s]:D}))},v=(s,D)=>{m(C=>({...C,[s]:D}))},p=async s=>{try{S(!0),await new Promise(D=>setTimeout(D,1e3)),w(`${s} settings saved successfully!`),setTimeout(()=>w(""),3e3)}catch(D){w("Error saving settings. Please try again."),console.error("Error saving settings:",D)}finally{S(!1)}},u=[{id:"platform",label:"Platform",icon:"⚙️"},{id:"users",label:"User Management",icon:"👥"},{id:"notifications",label:"Notifications",icon:"🔔"},{id:"payments",label:"Payments",icon:"💳"},{id:"security",label:"Security",icon:"🔒"}];return e.jsxs("div",{className:"admin-settings-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Admin Settings"}),e.jsx("p",{children:"Configure platform settings and preferences"})]}),f&&e.jsx("div",{className:`save-message ${f.includes("Error")?"error":"success"}`,children:f}),e.jsxs("div",{className:"settings-container",children:[e.jsx("div",{className:"settings-tabs",children:u.map(s=>e.jsxs("button",{className:`tab-button ${i===s.id?"active":""}`,onClick:()=>c(s.id),children:[e.jsx("span",{className:"tab-icon",children:s.icon}),s.label]},s.id))}),e.jsxs("div",{className:"settings-content",children:[i==="platform"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Platform Configuration"}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),p("platform")},children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Site Name"}),e.jsx("input",{type:"text",value:b.siteName,onChange:s=>n("siteName",s.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Time Zone"}),e.jsxs("select",{value:b.timeZone,onChange:s=>n("timeZone",s.target.value),children:[e.jsx("option",{value:"America/New_York",children:"Eastern Time"}),e.jsx("option",{value:"America/Chicago",children:"Central Time"}),e.jsx("option",{value:"America/Denver",children:"Mountain Time"}),e.jsx("option",{value:"America/Los_Angeles",children:"Pacific Time"})]})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Site Description"}),e.jsx("textarea",{value:b.siteDescription,onChange:s=>n("siteDescription",s.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Max Appointments Per Day"}),e.jsx("input",{type:"number",value:b.maxAppointmentsPerDay,onChange:s=>n("maxAppointmentsPerDay",parseInt(s.target.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Default Appointment Duration (minutes)"}),e.jsxs("select",{value:b.appointmentDuration,onChange:s=>n("appointmentDuration",parseInt(s.target.value)),children:[e.jsx("option",{value:15,children:"15 minutes"}),e.jsx("option",{value:30,children:"30 minutes"}),e.jsx("option",{value:45,children:"45 minutes"}),e.jsx("option",{value:60,children:"60 minutes"})]})]})]}),e.jsx("h3",{children:"Feature Toggles"}),e.jsxs("div",{className:"checkbox-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:b.allowRegistration,onChange:s=>n("allowRegistration",s.target.checked)}),e.jsx("span",{className:"checkmark"}),"Allow new user registration"]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:b.requireEmailVerification,onChange:s=>n("requireEmailVerification",s.target.checked)}),e.jsx("span",{className:"checkmark"}),"Require email verification"]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:b.enableVideoCalss,onChange:s=>n("enableVideoCalss",s.target.checked)}),e.jsx("span",{className:"checkmark"}),"Enable video calls"]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:b.maintenanceMode,onChange:s=>n("maintenanceMode",s.target.checked)}),e.jsx("span",{className:"checkmark"}),"Maintenance mode"]})]}),e.jsx("button",{type:"submit",className:"save-button",disabled:g,children:g?"Saving...":"Save Platform Settings"})]})]}),i==="users"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"User Management"}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),p("user management")},children:[e.jsx("h3",{children:"User Approval"}),e.jsxs("div",{className:"checkbox-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:k.autoApprovePatients,onChange:s=>N("autoApprovePatients",s.target.checked)}),e.jsx("span",{className:"checkmark"}),"Auto-approve patient registrations"]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:k.requireDoctorVerification,onChange:s=>N("requireDoctorVerification",s.target.checked)}),e.jsx("span",{className:"checkmark"}),"Require manual verification for doctors"]})]}),e.jsx("h3",{children:"Security Policies"}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Session Timeout (minutes)"}),e.jsx("input",{type:"number",value:k.sessionTimeout,onChange:s=>N("sessionTimeout",parseInt(s.target.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Password Complexity"}),e.jsxs("select",{value:k.passwordComplexity,onChange:s=>N("passwordComplexity",s.target.value),children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Max Login Attempts"}),e.jsx("input",{type:"number",value:k.maxLoginAttempts,onChange:s=>N("maxLoginAttempts",parseInt(s.target.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Lockout Duration (minutes)"}),e.jsx("input",{type:"number",value:k.lockoutDuration,onChange:s=>N("lockoutDuration",parseInt(s.target.value))})]})]}),e.jsx("button",{type:"submit",className:"save-button",disabled:g,children:g?"Saving...":"Save User Settings"})]})]}),i==="notifications"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Notification Configuration"}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),p("notification")},children:[e.jsx("h3",{children:"Communication Channels"}),e.jsxs("div",{className:"checkbox-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:A.emailEnabled,onChange:s=>o("emailEnabled",s.target.checked)}),e.jsx("span",{className:"checkmark"}),"Email notifications"]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:A.smsEnabled,onChange:s=>o("smsEnabled",s.target.checked)}),e.jsx("span",{className:"checkmark"}),"SMS notifications"]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:A.pushEnabled,onChange:s=>o("pushEnabled",s.target.checked)}),e.jsx("span",{className:"checkmark"}),"Push notifications"]})]}),e.jsx("h3",{children:"Notification Types"}),e.jsxs("div",{className:"checkbox-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:A.adminNotifications,onChange:s=>o("adminNotifications",s.target.checked)}),e.jsx("span",{className:"checkmark"}),"Admin notifications"]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:A.systemAlerts,onChange:s=>o("systemAlerts",s.target.checked)}),e.jsx("span",{className:"checkmark"}),"System alerts"]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:A.appointmentReminders,onChange:s=>o("appointmentReminders",s.target.checked)}),e.jsx("span",{className:"checkmark"}),"Appointment reminders"]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:A.marketingEmails,onChange:s=>o("marketingEmails",s.target.checked)}),e.jsx("span",{className:"checkmark"}),"Marketing emails"]})]}),e.jsx("button",{type:"submit",className:"save-button",disabled:g,children:g?"Saving...":"Save Notification Settings"})]})]}),i==="payments"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Payment Configuration"}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),p("payment")},children:[e.jsxs("div",{className:"checkbox-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:R.acceptPayments,onChange:s=>l("acceptPayments",s.target.checked)}),e.jsx("span",{className:"checkmark"}),"Accept online payments"]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:R.autoRefunds,onChange:s=>l("autoRefunds",s.target.checked)}),e.jsx("span",{className:"checkmark"}),"Enable automatic refunds"]})]}),R.acceptPayments&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Payment Configuration"}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Payment Provider"}),e.jsxs("select",{value:R.paymentProvider,onChange:s=>l("paymentProvider",s.target.value),children:[e.jsx("option",{value:"stripe",children:"Stripe"}),e.jsx("option",{value:"paypal",children:"PayPal"}),e.jsx("option",{value:"square",children:"Square"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Currency"}),e.jsxs("select",{value:R.currency,onChange:s=>l("currency",s.target.value),children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"EUR",children:"EUR"}),e.jsx("option",{value:"GBP",children:"GBP"}),e.jsx("option",{value:"CAD",children:"CAD"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Default Consultation Fee"}),e.jsx("input",{type:"number",value:R.consultationFee,onChange:s=>l("consultationFee",parseFloat(s.target.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Platform Fee (%)"}),e.jsx("input",{type:"number",value:R.platformFee,onChange:s=>l("platformFee",parseFloat(s.target.value))})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Refund Policy"}),e.jsx("textarea",{value:R.refundPolicy,onChange:s=>l("refundPolicy",s.target.value)})]})]})]}),e.jsx("button",{type:"submit",className:"save-button",disabled:g,children:g?"Saving...":"Save Payment Settings"})]})]}),i==="security"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Security Configuration"}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),p("security")},children:[e.jsx("h3",{children:"Authentication & Access"}),e.jsxs("div",{className:"checkbox-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:h.enableTwoFactor,onChange:s=>v("enableTwoFactor",s.target.checked)}),e.jsx("span",{className:"checkmark"}),"Enable two-factor authentication"]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:h.requireHttps,onChange:s=>v("requireHttps",s.target.checked)}),e.jsx("span",{className:"checkmark"}),"Require HTTPS connections"]})]}),e.jsx("h3",{children:"Data Protection"}),e.jsxs("div",{className:"checkbox-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:h.enableAuditLogs,onChange:s=>v("enableAuditLogs",s.target.checked)}),e.jsx("span",{className:"checkmark"}),"Enable audit logging"]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:h.encryptSensitiveData,onChange:s=>v("encryptSensitiveData",s.target.checked)}),e.jsx("span",{className:"checkmark"}),"Encrypt sensitive data"]})]}),e.jsx("div",{className:"form-grid",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Data Retention (days)"}),e.jsx("input",{type:"number",value:h.dataRetentionDays,onChange:s=>v("dataRetentionDays",parseInt(s.target.value))})]})}),e.jsx("h3",{children:"Backup Configuration"}),e.jsx("div",{className:"checkbox-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:h.enableBackups,onChange:s=>v("enableBackups",s.target.checked)}),e.jsx("span",{className:"checkmark"}),"Enable automatic backups"]})}),h.enableBackups&&e.jsx("div",{className:"form-grid",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Backup Frequency"}),e.jsxs("select",{value:h.backupFrequency,onChange:s=>v("backupFrequency",s.target.value),children:[e.jsx("option",{value:"hourly",children:"Hourly"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"})]})]})}),e.jsx("button",{type:"submit",className:"save-button",disabled:g,children:g?"Saving...":"Save Security Settings"})]})]})]})]})]})},us=()=>P.get("/admin/roles/privileges"),ms=()=>P.get("/admin/roles"),ps=i=>P.post("/admin/roles",i),xs=(i,c)=>P.put(`/admin/roles/${i}`,c),js=i=>P.patch(`/admin/roles/${i}/disable`);function Ae({initialData:i,onSubmit:c,onCancel:g}){const S=i||{},[f,w]=a.useState(S.name||""),[b,y]=a.useState(S.description||""),[k,E]=a.useState(S.privileges||[]),[A,T]=a.useState([]),[R,x]=a.useState(!0),[h,m]=a.useState(S.isActive!==void 0?S.isActive:!0);a.useEffect(()=>{const l=i||{};w(l.name||""),y(l.description||""),E(l.privileges||[]),m(l.isActive!==void 0?l.isActive:!0)},[i]),a.useEffect(()=>{us().then(l=>T(l.data.data||[])).catch(l=>console.error("Failed to fetch privileges",l)).finally(()=>x(!1))},[]);const n=l=>{E(v=>v.includes(l)?v.filter(p=>p!==l):[...v,l])},N=()=>{k.length===A.length?E([]):E([...A])},o=l=>{l.preventDefault(),c({name:f,description:b,privileges:k,isActive:h})};return e.jsxs("form",{className:"role-form",onSubmit:o,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role Name"}),e.jsx("input",{type:"text",value:f,onChange:l=>w(l.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:b,onChange:l=>y(l.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Privileges"}),e.jsx("div",{className:"select-all",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:!R&&k.length===A.length,disabled:R,onChange:N}),"Select All Privileges"]})}),e.jsx("div",{className:"privileges-list",children:A.map(l=>e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:k.includes(l),onChange:()=>n(l),disabled:R}),l]},l))})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:h,onChange:l=>m(l.target.checked)}),"Active"]})}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Save Role"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:g,children:"Cancel"})]})]})}Ae.propTypes={initialData:me.object,onSubmit:me.func.isRequired,onCancel:me.func.isRequired};function Ls(){const[i,c]=a.useState([]),[g,S]=a.useState(null),[f,w]=a.useState(!1),[b,y]=a.useState(null),k=async()=>{try{const h=await ms();c(h.data.data)}catch{y("Failed to load roles")}};a.useEffect(()=>{k()},[]);const E=()=>{S(null),w(!0)},A=h=>{S(h),w(!0)},T=()=>{w(!1),S(null)},R=async h=>{try{g?await xs(g._id,h):await ps(h),w(!1),k()}catch{y("Failed to save role")}},x=async h=>{try{await js(h),k()}catch{y("Failed to update role status")}};return e.jsxs("div",{className:"role-mgmt-page",children:[e.jsxs("header",{children:[e.jsx("h2",{children:"Role Management"}),e.jsx("button",{className:"btn btn-primary",onClick:E,children:"Add New Role"})]}),b&&e.jsx("div",{className:"error-banner",children:b}),e.jsxs("table",{className:"roles-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Privileges"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:i.map(h=>e.jsxs("tr",{className:h.isActive?"":"inactive",children:[e.jsx("td",{children:h.name}),e.jsx("td",{children:h.description}),e.jsx("td",{children:h.privileges.join(", ")}),e.jsx("td",{children:h.isActive?"Active":"Inactive"}),e.jsxs("td",{children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>A(h),children:"Edit"}),e.jsx("button",{className:"btn btn-warning",onClick:()=>x(h._id),children:h.isActive?"Disable":"Enable"})]})]},h._id))})]}),f&&e.jsx("div",{className:"modal-overlay",children:e.jsx("div",{className:"modal-content",children:e.jsx(Ae,{initialData:g,onSubmit:R,onCancel:T})})})]})}function Es(){const{addNotification:i}=ie(),[c,g]=a.useState(!0),[S,f]=a.useState([]),[w,b]=a.useState(null),[y,k]=a.useState(1),[E]=a.useState(50),[A,T]=a.useState(0);a.useEffect(()=>{R()},[y]);const R=async()=>{var m;try{g(!0);const n=await P.get("/admin/audit-logs",{params:{page:y,limit:E}});n.data.logs&&(i(`Loaded ${n.data.logs.length} audit logs`,"success"),f(n.data.logs),T(((m=n.data.pagination)==null?void 0:m.total)||0))}catch(n){console.error("Error fetching audit logs:",n),b("Failed to load audit logs")}finally{g(!1)}},x=()=>{y>1&&k(m=>m-1)},h=()=>{y*E<A&&k(m=>m+1)};return c?e.jsx(je,{}):w?e.jsx("div",{className:"admin-page",children:e.jsx("p",{children:w})}):e.jsxs("div",{className:"admin-page audit-logs-page",children:[e.jsx("h1",{children:"Audit Logs"}),e.jsxs("table",{className:"users-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Timestamp"}),e.jsx("th",{children:"User"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Action"}),e.jsx("th",{children:"Resource"}),e.jsx("th",{children:"Resource ID"}),e.jsx("th",{children:"Details"})]})}),e.jsx("tbody",{children:S.map(m=>{var n,N;return e.jsxs("tr",{children:[e.jsx("td",{children:new Date(m.timestamp).toLocaleString()}),e.jsx("td",{children:m.userId?`${((n=m.userId.profile)==null?void 0:n.firstName)||""} ${((N=m.userId.profile)==null?void 0:N.lastName)||""}`:"System"}),e.jsx("td",{children:m.userRole}),e.jsx("td",{children:m.action}),e.jsx("td",{children:m.resourceType}),e.jsx("td",{children:m.resourceId}),e.jsx("td",{children:e.jsx("pre",{children:JSON.stringify(m.details)})})]},m._id)})})]}),e.jsxs("div",{className:"pagination",children:[e.jsx("button",{onClick:x,disabled:y===1,children:"Previous"}),e.jsxs("span",{children:["Page ",y," of ",Math.ceil(A/E)||1]}),e.jsx("button",{onClick:h,disabled:y*E>=A,children:"Next"})]})]})}function Ts(){var E,A,T,R;const{appointmentId:i}=Se(),[c,g]=a.useState(null),[S,f]=a.useState([]),[w,b]=a.useState(!0),[y,k]=a.useState(null);return a.useEffect(()=>{(async()=>{try{b(!0);const h=await xe.get(`/appointments/${i}/lifecycle`),{lifecycle:m,events:n}=h.data.data;g(m),f(n)}catch(h){k(h.message)}finally{b(!1)}})()},[i]),w?e.jsx("p",{children:"Loading lifecycle data..."}):y?e.jsxs("p",{className:"error",children:["Error: ",y]}):c?e.jsxs("div",{className:"lifecycle-page",children:[e.jsx("h2",{children:"Appointment Lifecycle Audit"}),e.jsx("div",{className:"lifecycle-header",children:e.jsx("table",{children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"Lifecycle ID"}),e.jsx("td",{children:c.lifecycleId})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Appointment ID"}),e.jsx("td",{children:c.appointmentId})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Patient"}),e.jsxs("td",{children:[(E=c.patientId.profile)==null?void 0:E.firstName," ",(A=c.patientId.profile)==null?void 0:A.lastName," (",c.patientId._id,")"]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Doctor"}),e.jsxs("td",{children:[(T=c.doctorId.profile)==null?void 0:T.firstName," ",(R=c.doctorId.profile)==null?void 0:R.lastName," (",c.doctorId._id,")"]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Status"}),e.jsx("td",{children:c.currentStatus})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Start At"}),e.jsx("td",{children:new Date(c.startAt).toLocaleString()})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"End At"}),e.jsx("td",{children:c.endAt?new Date(c.endAt).toLocaleString():"—"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Last Updated"}),e.jsx("td",{children:new Date(c.lastUpdatedAt).toLocaleString()})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Updated By"}),e.jsx("td",{children:c.lastUpdatedBy})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Closure Notes"}),e.jsx("td",{children:c.closureNotes||"—"})]})]})})}),e.jsx("h3",{children:"Event Timeline"}),e.jsxs("table",{className:"lifecycle-events",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Timestamp"}),e.jsx("th",{children:"Event Type"}),e.jsx("th",{children:"Actor"}),e.jsx("th",{children:"Details"})]})}),e.jsx("tbody",{children:S.map(x=>e.jsxs("tr",{children:[e.jsx("td",{children:new Date(x.timestamp).toLocaleString()}),e.jsx("td",{children:x.eventType}),e.jsx("td",{children:x.actorId}),e.jsx("td",{children:e.jsx("pre",{children:JSON.stringify(x.payload,null,2)})})]},x._id))})]})]}):e.jsx("p",{children:"No lifecycle found for this appointment."})}export{ke as A,be as F,je as L,fs as N,bs as R,Ns as V,xe as a,ie as b,P as c,vs as d,ys as e,Es as f,ce as g,Ss as h,Cs as i,ks as j,Ps as k,As as l,Ts as m,Ds as n,Ls as o,ws as p,pe as u};
